<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Enterprise Universe - Ultimate Dashboard - Complete Business Management System">
    <meta name="theme-color" content="#0a0a0f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="robots" content="noindex, nofollow">
    <title>ULTIMATE DASHBOARD | Enterprise Universe</title>

    <!-- Auth Guard (temporarily disabled for design) -->
    <!-- <script src="/js/auth-guard.js"></script> -->

    <!-- External Resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Ultimate Dashboard Styles -->
    <link href="/styles/ultimate.css" rel="stylesheet">
</head>
<body>
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MEGA MENU HEADER
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <header class="header">
        <!-- Brand -->
        <a href="#/" class="header-brand">
            <div class="header-logo">U</div>
            <div>
                <div class="header-title">ULTIMATE</div>
                <div class="header-subtitle">Command Center</div>
            </div>
        </a>

        <!-- Mega Menu Navigation -->
        <nav class="mega-menu" id="mega-menu">
            <!-- Dashboard -->
            <div class="menu-item">
                <a href="#/" class="menu-trigger" data-route="/">
                    <span class="icon">ğŸ </span>
                    <span>Dashboard</span>
                </a>
            </div>

            <!-- CRM -->
            <div class="menu-item">
                <button class="menu-trigger">
                    <span class="icon">ğŸ‘¤</span>
                    <span>CRM</span>
                    <span class="arrow">â–¼</span>
                </button>
                <div class="menu-dropdown">
                    <a href="#/crm/contacts" class="dropdown-item">
                        <span class="icon">ğŸ‘¥</span>
                        <span>Contacts</span>
                    </a>
                    <a href="#/crm/companies" class="dropdown-item">
                        <span class="icon">ğŸ¢</span>
                        <span>Companies</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#/crm/scoring" class="dropdown-item">
                        <span class="icon">â­</span>
                        <span>Lead Scoring</span>
                    </a>
                </div>
            </div>

            <!-- Sales -->
            <div class="menu-item">
                <button class="menu-trigger">
                    <span class="icon">ğŸ’°</span>
                    <span>Sales</span>
                    <span class="arrow">â–¼</span>
                </button>
                <div class="menu-dropdown">
                    <a href="#/sales/deals" class="dropdown-item">
                        <span class="icon">ğŸ“Š</span>
                        <span>Deals Pipeline</span>
                    </a>
                    <a href="#/sales/leads" class="dropdown-item">
                        <span class="icon">ğŸ¯</span>
                        <span>Lead Discovery</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#/sales/proposals" class="dropdown-item">
                        <span class="icon">ğŸ“„</span>
                        <span>Proposals</span>
                    </a>
                </div>
            </div>

            <!-- Communication -->
            <div class="menu-item">
                <button class="menu-trigger">
                    <span class="icon">ğŸ“§</span>
                    <span>Communication</span>
                    <span class="arrow">â–¼</span>
                </button>
                <div class="menu-dropdown">
                    <a href="#/email" class="dropdown-item">
                        <span class="icon">ğŸ“§</span>
                        <span>Email Hub</span>
                    </a>
                    <a href="#/whatsapp" class="dropdown-item">
                        <span class="icon">ğŸ“±</span>
                        <span>WhatsApp</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#/campaigns" class="dropdown-item">
                        <span class="icon">ğŸš€</span>
                        <span>Campaigns</span>
                    </a>
                </div>
            </div>

            <!-- AI -->
            <div class="menu-item">
                <button class="menu-trigger">
                    <span class="icon">ğŸ¤–</span>
                    <span>AI</span>
                    <span class="arrow">â–¼</span>
                </button>
                <div class="menu-dropdown">
                    <a href="#/ai/bots" class="dropdown-item">
                        <span class="icon">ğŸ¤–</span>
                        <span>Genius Bots</span>
                    </a>
                    <a href="#/ai/haiku" class="dropdown-item">
                        <span class="icon">ğŸ’</span>
                        <span>HAIKU God Mode</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#/ai/prophecy" class="dropdown-item">
                        <span class="icon">ğŸ”®</span>
                        <span>Prophecy</span>
                    </a>
                </div>
            </div>

            <!-- Finance -->
            <div class="menu-item">
                <button class="menu-trigger">
                    <span class="icon">ğŸ’³</span>
                    <span>Finance</span>
                    <span class="arrow">â–¼</span>
                </button>
                <div class="menu-dropdown">
                    <a href="#/finance/cashflow" class="dropdown-item">
                        <span class="icon">ğŸ“ˆ</span>
                        <span>Cashflow</span>
                    </a>
                    <a href="#/finance/invoices" class="dropdown-item">
                        <span class="icon">ğŸ“„</span>
                        <span>Invoices</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#/finance/stripe" class="dropdown-item">
                        <span class="icon">ğŸ’³</span>
                        <span>Stripe</span>
                    </a>
                </div>
            </div>

            <!-- Partners & Contracts -->
            <div class="menu-item">
                <button class="menu-trigger">
                    <span class="icon">ğŸ¤</span>
                    <span>Partners</span>
                    <span class="arrow">â–¼</span>
                </button>
                <div class="menu-dropdown">
                    <a href="#/partners/overview" class="dropdown-item">
                        <span class="icon">ğŸ“Š</span>
                        <span>Partner Overview</span>
                    </a>
                    <a href="#/partners/contracts" class="dropdown-item">
                        <span class="icon">ğŸ“</span>
                        <span>Contracts</span>
                    </a>
                    <a href="#/partners/commissions" class="dropdown-item">
                        <span class="icon">ğŸ’µ</span>
                        <span>Commissions</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#/partners/onboarding" class="dropdown-item">
                        <span class="icon">ğŸš€</span>
                        <span>Partner Onboarding</span>
                    </a>
                </div>
            </div>

            <!-- West Money Bau Projects -->
            <div class="menu-item">
                <button class="menu-trigger">
                    <span class="icon">ğŸ—ï¸</span>
                    <span>Projects</span>
                    <span class="arrow">â–¼</span>
                </button>
                <div class="menu-dropdown">
                    <a href="#/projects/overview" class="dropdown-item">
                        <span class="icon">ğŸ“Š</span>
                        <span>Project Overview</span>
                    </a>
                    <a href="#/projects/active" class="dropdown-item">
                        <span class="icon">ğŸ”§</span>
                        <span>Active Projects</span>
                    </a>
                    <a href="#/projects/subcontractors" class="dropdown-item">
                        <span class="icon">ğŸ‘·</span>
                        <span>Subcontractors</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#/projects/smart-home" class="dropdown-item">
                        <span class="icon">ğŸ </span>
                        <span>Smart Home</span>
                    </a>
                    <a href="#/projects/industry40" class="dropdown-item">
                        <span class="icon">ğŸ­</span>
                        <span>Industry 4.0</span>
                    </a>
                    <a href="#/projects/smart-factory" class="dropdown-item">
                        <span class="icon">ğŸ¤–</span>
                        <span>Smart Factory</span>
                    </a>
                    <a href="#/projects/software" class="dropdown-item">
                        <span class="icon">ğŸ’»</span>
                        <span>Software Dev</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#/projects/loxone" class="dropdown-item">
                        <span class="icon">ğŸ”Œ</span>
                        <span>Loxone Calculator</span>
                    </a>
                </div>
            </div>

            <!-- System -->
            <div class="menu-item">
                <button class="menu-trigger">
                    <span class="icon">âš™ï¸</span>
                    <span>System</span>
                    <span class="arrow">â–¼</span>
                </button>
                <div class="menu-dropdown">
                    <a href="#/integrations" class="dropdown-item">
                        <span class="icon">ğŸ”—</span>
                        <span>Integrations</span>
                    </a>
                    <a href="#/settings" class="dropdown-item">
                        <span class="icon">âš™ï¸</span>
                        <span>Settings</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#/docs" class="dropdown-item">
                        <span class="icon">ğŸ“š</span>
                        <span>Documentation</span>
                    </a>
                </div>
            </div>
        </nav>

        <!-- Header Actions -->
        <div class="header-actions">
            <div class="header-search" id="search-trigger">
                <span>ğŸ”</span>
                <span>Search...</span>
                <kbd>Ctrl+K</kbd>
            </div>

            <!-- Offline Indicator -->
            <div class="offline-indicator" id="offline-indicator" style="display: none;">
                <span style="color: #ef4444;">âš ï¸ Offline</span>
            </div>

            <!-- Notifications -->
            <button class="header-icon-btn" id="notifications-btn" onclick="UltimateApp.showNotifications()" title="Notifications">
                <span>ğŸ””</span>
                <span class="notification-badge" id="notification-count" style="display: none;">0</span>
            </button>

            <!-- Quick Export -->
            <button class="header-icon-btn" onclick="UltimateApp.showExportModal()" title="Export Data">
                <span>ğŸ“¤</span>
            </button>

            <!-- Dark Mode Toggle -->
            <button class="header-icon-btn" id="dark-mode-toggle" onclick="UltimateApp.toggleDarkMode()" title="Toggle Dark Mode">
                <span id="dark-mode-icon">ğŸŒ™</span>
            </button>

            <div class="header-status">
                <span class="status-dot"></span>
                <span id="haiku-status-text">HAIKU ONLINE</span>
            </div>
            <button class="btn-god-mode" onclick="location.hash='#/ai/haiku'">
                GOD MODE
            </button>
        </div>
    </header>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MAIN CONTENT AREA (SPA Router Target)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <main class="main-content">
        <div class="content-wrapper" id="app-content">
            <!-- Content loaded dynamically by router -->
            <div class="loading-skeleton" style="height: 200px;"></div>
        </div>
    </main>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         STATUS BAR
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <footer class="status-bar">
        <div class="status-bar-left">
            <span class="status-item connected" id="status-hubspot">
                <span class="status-dot"></span> HubSpot
            </span>
            <span class="status-item connected" id="status-whatsapp">
                <span class="status-dot"></span> WhatsApp
            </span>
            <span class="status-item connected" id="status-stripe">
                <span class="status-dot"></span> Stripe
            </span>
        </div>
        <div class="status-bar-right">
            <span id="last-sync">Last sync: --</span>
            <span id="current-user">User: Admin</span>
        </div>
    </footer>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MODAL CONTAINER
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal" id="modal-container">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Modal</h3>
                <button class="modal-close" onclick="UltimateApp.closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Modal content loaded dynamically -->
            </div>
            <div class="modal-footer" id="modal-footer">
                <button class="btn btn-secondary" onclick="UltimateApp.closeModal()">Cancel</button>
                <button class="btn btn-primary" id="modal-confirm">Confirm</button>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         JAVASCRIPT - SPA Core
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script>
    /**
     * ULTIMATE DASHBOARD - Main Application
     * Single Page Application with Mega Menu Navigation
     */

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // UTILITY FUNCTIONS
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function escapeHtml(text) {
        if (!text) return '';
        var div = document.createElement('div');
        div.textContent = String(text);
        return div.innerHTML;
    }

    function formatCurrency(value, currency) {
        if (value === null || value === undefined) return '-';
        currency = currency || 'EUR';
        return new Intl.NumberFormat('de-DE', {
            style: 'currency',
            currency: currency,
            minimumFractionDigits: 0,
            maximumFractionDigits: 0
        }).format(value);
    }

    function formatNumber(value) {
        if (value === null || value === undefined) return '-';
        // If already a formatted string, return as-is
        if (typeof value === 'string' && value.includes('.')) return value;
        return new Intl.NumberFormat('de-DE').format(value);
    }

    function formatDate(dateStr) {
        if (!dateStr) return '-';
        return new Date(dateStr).toLocaleDateString('de-DE');
    }

    function formatDateTime(dateStr) {
        if (!dateStr) return '-';
        return new Date(dateStr).toLocaleString('de-DE');
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // NOTIFICATION SYSTEM
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    var Notify = {
        container: null,

        init: function() {
            if (this.container) return;
            this.container = document.createElement('div');
            this.container.id = 'notification-container';
            this.container.style.cssText = 'position:fixed;top:20px;right:20px;z-index:10000;display:flex;flex-direction:column;gap:10px;max-width:400px;';
            document.body.appendChild(this.container);
        },

        show: function(message, type) {
            type = type || 'info';
            this.init();

            var colors = {
                success: 'linear-gradient(135deg, #10b981, #059669)',
                error: 'linear-gradient(135deg, #ef4444, #dc2626)',
                warning: 'linear-gradient(135deg, #f59e0b, #d97706)',
                info: 'linear-gradient(135deg, #3b82f6, #2563eb)'
            };
            var icons = { success: '\u2713', error: '\u2715', warning: '\u26A0', info: '\u2139' };

            var toast = document.createElement('div');
            toast.style.cssText = 'background:' + colors[type] + ';color:#fff;padding:14px 20px;border-radius:12px;display:flex;align-items:center;gap:12px;box-shadow:0 10px 40px rgba(0,0,0,0.3);animation:slideIn 0.3s ease;font-size:14px;';

            var iconSpan = document.createElement('span');
            iconSpan.style.fontSize = '18px';
            iconSpan.textContent = icons[type];

            var msgSpan = document.createElement('span');
            msgSpan.style.flex = '1';
            msgSpan.textContent = message;

            var closeBtn = document.createElement('button');
            closeBtn.style.cssText = 'background:none;border:none;color:#fff;cursor:pointer;font-size:18px;opacity:0.7;';
            closeBtn.textContent = '\u00D7';
            closeBtn.onclick = function() { toast.remove(); };

            toast.appendChild(iconSpan);
            toast.appendChild(msgSpan);
            toast.appendChild(closeBtn);
            this.container.appendChild(toast);

            setTimeout(function() {
                toast.style.animation = 'slideOut 0.3s ease forwards';
                setTimeout(function() { toast.remove(); }, 300);
            }, 5000);
        },

        success: function(msg) { this.show(msg, 'success'); },
        error: function(msg) { this.show(msg, 'error'); },
        warning: function(msg) { this.show(msg, 'warning'); },
        info: function(msg) { this.show(msg, 'info'); }
    };

    // Add notification animations
    var notifyStyle = document.createElement('style');
    notifyStyle.textContent = '@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}@keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}';
    document.head.appendChild(notifyStyle);

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // API SERVICE (with error notifications)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    var API = {
        baseUrl: '',
        silentMode: false,

        async get(endpoint, options) {
            options = options || {};
            try {
                var response = await fetch(this.baseUrl + endpoint);
                if (!response.ok) {
                    var errorMsg = 'Server Error: ' + response.status;
                    if (response.status === 401) errorMsg = 'Nicht autorisiert - bitte neu einloggen';
                    if (response.status === 403) errorMsg = 'Zugriff verweigert';
                    if (response.status === 404) errorMsg = 'Daten nicht gefunden';
                    if (response.status >= 500) errorMsg = 'Server nicht erreichbar';
                    throw new Error(errorMsg);
                }
                return await response.json();
            } catch (error) {
                console.error('API GET Error:', endpoint, error);
                if (!this.silentMode && !options.silent) {
                    Notify.error('Fehler: ' + error.message);
                }
                return null;
            }
        },

        async post(endpoint, data, options) {
            options = options || {};
            try {
                var response = await fetch(this.baseUrl + endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    var errorData = await response.json().catch(function() { return {}; });
                    throw new Error(errorData.message || 'Server Error: ' + response.status);
                }
                if (!options.silent) Notify.success('Erfolgreich gespeichert');
                return await response.json();
            } catch (error) {
                console.error('API POST Error:', endpoint, error);
                if (!this.silentMode && !options.silent) {
                    Notify.error('Speichern fehlgeschlagen: ' + error.message);
                }
                return null;
            }
        },

        async patch(endpoint, data, options) {
            options = options || {};
            try {
                var response = await fetch(this.baseUrl + endpoint, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) {
                    var errorData = await response.json().catch(function() { return {}; });
                    throw new Error(errorData.message || 'Server Error: ' + response.status);
                }
                if (!options.silent) Notify.success('Erfolgreich aktualisiert');
                return await response.json();
            } catch (error) {
                console.error('API PATCH Error:', endpoint, error);
                if (!this.silentMode && !options.silent) {
                    Notify.error('Update fehlgeschlagen: ' + error.message);
                }
                return null;
            }
        },

        async delete(endpoint, options) {
            options = options || {};
            try {
                var response = await fetch(this.baseUrl + endpoint, {
                    method: 'DELETE'
                });
                if (!response.ok) throw new Error('Server Error: ' + response.status);
                if (!options.silent) Notify.success('Erfolgreich gelÃ¶scht');
                return true;
            } catch (error) {
                console.error('API DELETE Error:', endpoint, error);
                if (!this.silentMode && !options.silent) {
                    Notify.error('LÃ¶schen fehlgeschlagen: ' + error.message);
                }
                return false;
            }
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // DATA VALIDATION HELPERS
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    var Validate = {
        // Safely extract contacts from various API response formats
        contacts: function(data) {
            if (!data) return [];
            return data.contacts || data.results || (Array.isArray(data) ? data : []);
        },

        // Safely extract deals from various API response formats
        deals: function(data) {
            if (!data) return [];
            return data.deals || data.results || (Array.isArray(data) ? data : []);
        },

        // Safely extract companies from various API response formats
        companies: function(data) {
            if (!data) return [];
            return data.companies || data.results || (Array.isArray(data) ? data : []);
        },

        // Safely parse numeric value
        number: function(value, fallback) {
            fallback = fallback !== undefined ? fallback : 0;
            var parsed = parseFloat(value);
            return isNaN(parsed) ? fallback : parsed;
        },

        // Safely get nested property
        prop: function(obj, path, fallback) {
            fallback = fallback !== undefined ? fallback : null;
            if (!obj) return fallback;
            var parts = path.split('.');
            var current = obj;
            for (var i = 0; i < parts.length; i++) {
                if (current === null || current === undefined) return fallback;
                current = current[parts[i]];
            }
            return current !== undefined && current !== null ? current : fallback;
        },

        // Check if response has expected structure
        isValid: function(data, requiredFields) {
            if (!data) return false;
            if (!requiredFields) return true;
            for (var i = 0; i < requiredFields.length; i++) {
                if (this.prop(data, requiredFields[i]) === null) {
                    console.warn('Missing required field:', requiredFields[i]);
                    return false;
                }
            }
            return true;
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // DOM HELPER
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    var DOM = {
        el: function(tag, attrs, children) {
            var element = document.createElement(tag);
            if (attrs) {
                Object.keys(attrs).forEach(function(key) {
                    if (key === 'className') {
                        element.className = attrs[key];
                    } else if (key === 'onclick' || key === 'onchange') {
                        element[key] = attrs[key];
                    } else if (key === 'dataset') {
                        Object.keys(attrs[key]).forEach(function(dataKey) {
                            element.dataset[dataKey] = attrs[key][dataKey];
                        });
                    } else {
                        element.setAttribute(key, attrs[key]);
                    }
                });
            }
            if (children !== null && children !== undefined) {
                // Convert numbers to strings
                if (typeof children === 'number') {
                    children = String(children);
                }
                if (typeof children === 'string') {
                    // Decode HTML entities safely using a temporary element
                    if (children.includes('&#')) {
                        var temp = document.createElement('div');
                        temp.textContent = ''; // Clear first
                        // Only decode numeric HTML entities (safe)
                        var decoded = children.replace(/&#(\d+);/g, function(match, code) {
                            return String.fromCharCode(parseInt(code, 10));
                        });
                        element.textContent = decoded;
                    } else {
                        element.textContent = children;
                    }
                } else if (Array.isArray(children)) {
                    children.forEach(function(child) {
                        if (child) element.appendChild(child);
                    });
                } else if (children instanceof Node) {
                    element.appendChild(children);
                }
            }
            return element;
        },

        clear: function(container) {
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // UI COMPONENT HELPERS
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function createQuickAction(href, icon, label) {
        return DOM.el('a', { href: href, className: 'quick-action' }, [
            DOM.el('span', { className: 'quick-action-icon' }, icon),
            DOM.el('span', { className: 'quick-action-label' }, label)
        ]);
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ROUTER
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    var Router = {
        routes: {
            '/': 'renderDashboard',
            '/crm/contacts': 'renderContacts',
            '/crm/companies': 'renderCompanies',
            '/crm/scoring': 'renderLeadScoring',
            '/sales/deals': 'renderDeals',
            '/sales/leads': 'renderLeadDiscovery',
            '/sales/proposals': 'renderProposals',
            '/email': 'renderEmailHub',
            '/whatsapp': 'renderWhatsApp',
            '/campaigns': 'renderCampaigns',
            '/ai/bots': 'renderBots',
            '/ai/haiku': 'renderHaiku',
            '/ai/prophecy': 'renderProphecy',
            '/finance/cashflow': 'renderCashflow',
            '/finance/invoices': 'renderInvoices',
            '/finance/stripe': 'renderStripe',
            '/partners/overview': 'renderPartnersOverview',
            '/partners/contracts': 'renderContracts',
            '/partners/commissions': 'renderCommissions',
            '/partners/onboarding': 'renderPartnerOnboarding',
            '/projects/overview': 'renderProjectsOverview',
            '/projects/active': 'renderActiveProjects',
            '/projects/subcontractors': 'renderSubcontractors',
            '/projects/smart-home': 'renderSmartHome',
            '/projects/industry40': 'renderIndustry40',
            '/projects/smart-factory': 'renderSmartFactory',
            '/projects/software': 'renderSoftware',
            '/projects/loxone': 'renderLoxoneCalculator',
            '/integrations': 'renderIntegrations',
            '/settings': 'renderSettings',
            '/docs': 'renderDocs'
        },

        init: function() {
            var self = this;
            window.addEventListener('hashchange', function() {
                self.navigate();
            });
            this.navigate();
        },

        navigate: function() {
            var hash = window.location.hash || '#/';
            var path = hash.replace('#', '') || '/';

            // Update active menu item
            this.updateActiveMenu(path);

            // Find matching route
            var handler = this.routes[path];
            if (handler && typeof Modules[handler] === 'function') {
                Modules[handler]();
            } else {
                Modules.render404();
            }

            // Scroll to top
            window.scrollTo(0, 0);
        },

        updateActiveMenu: function(path) {
            // Remove all active states
            document.querySelectorAll('.menu-trigger, .dropdown-item').forEach(function(el) {
                el.classList.remove('active');
            });

            // Add active to current
            var selector = '[href="#' + path + '"]';
            var activeEl = document.querySelector(selector);
            if (activeEl) {
                activeEl.classList.add('active');
                // Also highlight parent menu trigger
                var menuItem = activeEl.closest('.menu-item');
                if (menuItem) {
                    var trigger = menuItem.querySelector('.menu-trigger');
                    if (trigger) trigger.classList.add('active');
                }
            }
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // MODULES (Page Renderers)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    var Modules = {
        // Contacts Pagination State
        contactsState: {
            currentPage: 1,
            pageSize: 50,
            totalContacts: 0,
            sortBy: 'createdate',
            sortOrder: 'desc',
            after: null,
            cursors: { 1: null }
        },

        container: function() {
            return document.getElementById('app-content');
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // DASHBOARD
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderDashboard: async function() {
            var container = this.container();
            DOM.clear(container);

            // Page Header
            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Dashboard'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Business Overview')
                ]),
                DOM.el('div', { className: 'page-actions' }, [
                    DOM.el('button', { className: 'btn btn-secondary', onclick: function() { location.reload(); } }, 'Refresh'),
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { location.hash = '#/sales/deals'; } }, '+ New Deal')
                ])
            ]);
            container.appendChild(header);

            // KPI Grid
            var kpiGrid = DOM.el('div', { className: 'grid grid-4 mb-4', id: 'kpi-grid' });
            container.appendChild(kpiGrid);

            // Load KPI data
            this.loadDashboardKPIs(kpiGrid);

            // Two Column Layout
            var twoCol = DOM.el('div', { className: 'grid grid-2', style: 'margin-top: 1.5rem;' });
            container.appendChild(twoCol);

            // Recent Contacts Card
            var contactsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'ğŸ‘¥ Recent Contacts'),
                    DOM.el('a', { href: '#/crm/contacts', className: 'btn btn-ghost btn-sm' }, 'View All')
                ]),
                DOM.el('div', { className: 'card-body', id: 'recent-contacts' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 200px;' })
                ])
            ]);
            twoCol.appendChild(contactsCard);

            // Pipeline Overview Card
            var pipelineCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'ğŸ“Š Pipeline Overview'),
                    DOM.el('a', { href: '#/sales/deals', className: 'btn btn-ghost btn-sm' }, 'View Pipeline')
                ]),
                DOM.el('div', { className: 'card-body', id: 'pipeline-overview' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 200px;' })
                ])
            ]);
            twoCol.appendChild(pipelineCard);

            // Load data
            this.loadRecentContacts();
            this.loadPipelineOverview();

            // Quick Actions - Premium Design
            var quickActions = DOM.el('div', { className: 'card', style: 'margin-top: 1.5rem;' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, [
                        DOM.el('span', { style: 'margin-right: 0.5rem;' }, '\u26A1'),
                        DOM.el('span', {}, 'Quick Actions')
                    ])
                ]),
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'grid grid-6' }, [
                        createQuickAction('#/crm/contacts', '\uD83D\uDC64', 'Contacts'),
                        createQuickAction('#/sales/deals', '\uD83D\uDCB0', 'Deals'),
                        createQuickAction('#/email', '\uD83D\uDCE7', 'Email'),
                        createQuickAction('#/ai/bots', '\uD83E\uDD16', 'AI Bots'),
                        createQuickAction('#/finance/invoices', '\uD83D\uDCCB', 'Invoices'),
                        createQuickAction('#/ai/haiku', '\uD83D\uDC8E', 'God Mode')
                    ])
                ])
            ]);
            container.appendChild(quickActions);
        },

        loadDashboardKPIs: async function(grid) {
            var data = await API.get('/api/overview');
            DOM.clear(grid);

            var metrics = data && data.metrics ? data.metrics : {};

            var kpis = [
                { label: 'REVENUE', value: metrics.revenue ? metrics.revenue.value : '-', change: metrics.revenue ? metrics.revenue.change : '', type: 'primary', icon: '\uD83D\uDCB0' },
                { label: 'PIPELINE', value: metrics.pipeline ? metrics.pipeline.value : '-', change: metrics.pipeline ? metrics.pipeline.change : '', type: 'success', icon: '\uD83D\uDCC8' },
                { label: 'CONTACTS', value: metrics.contacts ? formatNumber(metrics.contacts.value) : '-', change: metrics.contacts ? '+' + metrics.contacts.change : '', type: 'info', icon: '\uD83D\uDC65' },
                { label: 'TASKS TODAY', value: metrics.tasksToday || '0', change: 'active', type: 'warning', icon: '\u2705' }
            ];

            kpis.forEach(function(kpi) {
                var card = DOM.el('div', { className: 'kpi-card ' + kpi.type + ' animate-slide-up' }, [
                    DOM.el('div', { className: 'kpi-header' }, [
                        DOM.el('span', { className: 'kpi-label' }, kpi.label),
                        DOM.el('span', { className: 'kpi-icon' }, kpi.icon)
                    ]),
                    DOM.el('div', { className: 'kpi-value' }, kpi.value),
                    DOM.el('div', { className: 'kpi-change positive' }, kpi.change)
                ]);
                grid.appendChild(card);
            });
        },

        loadRecentContacts: async function() {
            var container = document.getElementById('recent-contacts');
            var data = await API.get('/api/hubspot/contacts?limit=5');
            DOM.clear(container);

            // API returns 'contacts' not 'results'
            var contacts = data && (data.contacts || data.results);
            if (!contacts || contacts.length === 0) {
                container.appendChild(DOM.el('div', { className: 'empty-state' }, [
                    DOM.el('div', { className: 'empty-state-icon' }, 'ğŸ‘¤'),
                    DOM.el('div', { className: 'empty-state-title' }, 'No contacts yet'),
                    DOM.el('div', { className: 'empty-state-text' }, 'Add your first contact to get started')
                ]));
                return;
            }

            var list = DOM.el('div', { className: 'flex flex-col gap-2' });
            contacts.forEach(function(contact) {
                var props = contact.properties || {};
                var name = [props.firstname, props.lastname].filter(Boolean).join(' ') || 'Unknown';
                var initials = name.split(' ').map(function(n) { return n[0]; }).join('').toUpperCase().slice(0, 2);

                var row = DOM.el('div', { className: 'flex items-center gap-3', style: 'padding: 0.5rem; border-radius: 8px; cursor: pointer;', onclick: function() { UltimateApp.showContactDetail(contact.id); } }, [
                    DOM.el('div', { className: 'contact-avatar', style: 'width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, #8b5cf6, #3b82f6); display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 600;' }, initials),
                    DOM.el('div', { className: 'flex-1' }, [
                        DOM.el('div', { style: 'font-weight: 500;' }, escapeHtml(name)),
                        DOM.el('div', { style: 'font-size: 0.8rem; color: var(--text-muted);' }, escapeHtml(props.email || ''))
                    ]),
                    DOM.el('div', { style: 'font-size: 0.8rem; color: var(--text-muted);' }, escapeHtml(props.company || ''))
                ]);
                list.appendChild(row);
            });
            container.appendChild(list);
        },

        loadPipelineOverview: async function() {
            var container = document.getElementById('pipeline-overview');
            var data = await API.get('/api/hubspot/deals');
            DOM.clear(container);

            // API returns 'deals' not 'results'
            var deals = data && (data.deals || data.results);
            if (!deals || deals.length === 0) {
                container.textContent = 'Could not load pipeline data';
                return;
            }

            // Group by stage
            var stages = {};
            var stageNames = {
                'qualifiedtobuy': 'Qualified',
                'presentationscheduled': 'Presentation',
                'decisionmakerboughtin': 'Decision',
                'negotiation': 'Negotiation',
                'closedwon': 'Won',
                'closedlost': 'Lost'
            };

            deals.forEach(function(deal) {
                var stage = deal.properties && deal.properties.dealstage ? deal.properties.dealstage : 'unknown';
                if (!stages[stage]) stages[stage] = { count: 0, value: 0 };
                stages[stage].count++;
                stages[stage].value += parseFloat(deal.properties && deal.properties.amount ? deal.properties.amount : 0);
            });

            var grid = DOM.el('div', { className: 'grid grid-3 gap-3' });
            Object.keys(stages).slice(0, 6).forEach(function(stage) {
                var stageName = stageNames[stage] || stage;
                var stageData = stages[stage];
                var colorClass = stage === 'closedwon' ? 'text-success' : (stage === 'closedlost' ? 'text-error' : 'text-info');

                var stageCard = DOM.el('div', { style: 'background: var(--bg-elevated); border-radius: 12px; padding: 1rem;' }, [
                    DOM.el('div', { className: 'flex justify-between items-center mb-2' }, [
                        DOM.el('span', { className: colorClass, style: 'font-weight: 500; font-size: 0.9rem;' }, stageName),
                        DOM.el('span', { style: 'font-size: 0.8rem; color: var(--text-muted);' }, String(stageData.count))
                    ]),
                    DOM.el('div', { style: 'font-size: 1.25rem; font-weight: 700;' }, formatCurrency(stageData.value))
                ]);
                grid.appendChild(stageCard);
            });
            container.appendChild(grid);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CRM - CONTACTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderContacts: async function() {
            var container = this.container();
            DOM.clear(container);

            // Reset pagination state on page render
            this.contactsState.currentPage = 1;
            this.contactsState.after = null;
            this.contactsState.cursors = { 1: null };

            var self = this;

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Contacts'),
                    DOM.el('p', { className: 'page-subtitle', id: 'contacts-subtitle' }, 'Manage your CRM contacts')
                ]),
                DOM.el('div', { className: 'page-actions', style: 'display: flex; gap: 1rem; align-items: center;' }, [
                    // Sort Dropdown
                    DOM.el('select', {
                        className: 'form-select',
                        id: 'contacts-sort',
                        style: 'background: var(--bg-elevated); border: 1px solid var(--border); color: var(--text-primary); padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;',
                        onchange: function() { self.changeContactsSort(this.value); }
                    }, [
                        DOM.el('option', { value: 'createdate-desc' }, 'ğŸ“… Newest First'),
                        DOM.el('option', { value: 'createdate-asc' }, 'ğŸ“… Oldest First'),
                        DOM.el('option', { value: 'score-desc' }, 'ğŸ”¥ Lead Score (High-Low)'),
                        DOM.el('option', { value: 'score-asc' }, 'â„ï¸ Lead Score (Low-High)'),
                        DOM.el('option', { value: 'firstname-asc' }, 'ğŸ”¤ Name (A-Z)'),
                        DOM.el('option', { value: 'firstname-desc' }, 'ğŸ”¤ Name (Z-A)')
                    ]),
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewContactModal(); } }, '+ New Contact')
                ])
            ]);
            container.appendChild(header);

            // Table Card
            var card = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'table-container', id: 'contacts-table' }, [
                        DOM.el('div', { className: 'loading-skeleton', style: 'height: 300px;' })
                    ]),
                    // Pagination Controls
                    DOM.el('div', { className: 'pagination-controls', id: 'contacts-pagination', style: 'display: flex; justify-content: space-between; align-items: center; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);' })
                ])
            ]);
            container.appendChild(card);

            this.loadContactsTable();
        },

        changeContactsSort: function(value) {
            var parts = value.split('-');
            this.contactsState.sortBy = parts[0];
            this.contactsState.sortOrder = parts[1];
            this.contactsState.currentPage = 1;
            this.contactsState.after = null;
            this.contactsState.cursors = { 1: null };
            this.loadContactsTable();
        },

        goToContactsPage: function(page) {
            if (page < 1) return;
            this.contactsState.currentPage = page;
            this.contactsState.after = this.contactsState.cursors[page] || null;
            this.loadContactsTable();
        },

        // Calculate Lead Score (0-100)
        calculateLeadScore: function(contact) {
            var props = contact.properties || {};
            var score = 0;

            // Email exists (+20)
            if (props.email) score += 20;

            // Phone exists (+15)
            if (props.phone) score += 15;

            // Company exists (+15)
            if (props.company) score += 15;

            // First and Last name (+10)
            if (props.firstname && props.lastname) score += 10;

            // Job title (+10)
            if (props.jobtitle) score += 10;

            // Website (+5)
            if (props.website) score += 5;

            // City/Address (+5)
            if (props.city || props.address) score += 5;

            // Recent activity - created in last 30 days (+10)
            if (props.createdate) {
                var created = new Date(props.createdate);
                var daysAgo = (Date.now() - created.getTime()) / (1000 * 60 * 60 * 24);
                if (daysAgo <= 30) score += 10;
            }

            // Number of form submissions or notes (+10)
            if (props.num_notes && parseInt(props.num_notes) > 0) score += 10;

            return Math.min(score, 100);
        },

        getScoreBadge: function(score) {
            var label, className;
            if (score >= 70) {
                label = 'ğŸ”¥ Hot';
                className = 'badge badge-success';
            } else if (score >= 40) {
                label = 'ğŸŒ¡ï¸ Warm';
                className = 'badge badge-warning';
            } else {
                label = 'â„ï¸ Cold';
                className = 'badge badge-secondary';
            }
            return DOM.el('span', { className: className, style: 'font-size: 0.75rem;' }, label + ' (' + score + ')');
        },

        loadContactsTable: async function() {
            var self = this;
            var tableContainer = document.getElementById('contacts-table');
            var paginationContainer = document.getElementById('contacts-pagination');
            var state = this.contactsState;

            // Build API URL with pagination
            var url = '/api/hubspot/contacts?limit=' + state.pageSize;
            if (state.after) {
                url += '&after=' + state.after;
            }

            var data = await API.get(url);
            DOM.clear(tableContainer);
            if (paginationContainer) DOM.clear(paginationContainer);

            // API returns 'contacts' not 'results'
            var contacts = data && (data.contacts || data.results) || [];
            var paging = data && data.paging;
            var total = data && data.total ? data.total : (contacts.length * state.currentPage + (paging && paging.next ? 50 : 0));

            // Store next cursor
            if (paging && paging.next && paging.next.after) {
                state.cursors[state.currentPage + 1] = paging.next.after;
            }

            // Update subtitle with count
            var subtitle = document.getElementById('contacts-subtitle');
            if (subtitle) {
                subtitle.textContent = 'Page ' + state.currentPage + ' â€¢ ' + contacts.length + ' contacts shown';
            }

            if (!contacts || contacts.length === 0) {
                tableContainer.appendChild(DOM.el('div', { className: 'empty-state' }, [
                    DOM.el('div', { className: 'empty-state-icon' }, 'ğŸ‘¤'),
                    DOM.el('div', { className: 'empty-state-title' }, 'No contacts yet'),
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewContactModal(); } }, '+ Add First Contact')
                ]));
                return;
            }

            // Calculate scores and add to contacts
            contacts.forEach(function(contact) {
                contact._score = self.calculateLeadScore(contact);
            });

            // Sort by score if selected
            if (state.sortBy === 'score') {
                contacts.sort(function(a, b) {
                    return state.sortOrder === 'desc' ? b._score - a._score : a._score - b._score;
                });
            } else if (state.sortBy === 'firstname') {
                contacts.sort(function(a, b) {
                    var nameA = (a.properties && a.properties.firstname || '').toLowerCase();
                    var nameB = (b.properties && b.properties.firstname || '').toLowerCase();
                    return state.sortOrder === 'asc' ? nameA.localeCompare(nameB) : nameB.localeCompare(nameA);
                });
            }
            // createdate sorting is done by API

            var table = DOM.el('table', { className: 'table' });

            // Header with Score column
            var thead = DOM.el('thead', {}, [
                DOM.el('tr', {}, [
                    DOM.el('th', { style: 'width: 100px;' }, 'Score'),
                    DOM.el('th', {}, 'Name'),
                    DOM.el('th', {}, 'Email'),
                    DOM.el('th', {}, 'Company'),
                    DOM.el('th', {}, 'Phone'),
                    DOM.el('th', {}, 'Created'),
                    DOM.el('th', {}, 'Actions')
                ])
            ]);
            table.appendChild(thead);

            // Body
            var tbody = DOM.el('tbody');
            contacts.forEach(function(contact) {
                var props = contact.properties || {};
                var name = [props.firstname, props.lastname].filter(Boolean).join(' ') || 'Unknown';

                var row = DOM.el('tr', {}, [
                    DOM.el('td', {}, [self.getScoreBadge(contact._score)]),
                    DOM.el('td', { style: 'font-weight: 500;' }, escapeHtml(name)),
                    DOM.el('td', {}, escapeHtml(props.email || '-')),
                    DOM.el('td', {}, escapeHtml(props.company || '-')),
                    DOM.el('td', {}, escapeHtml(props.phone || '-')),
                    DOM.el('td', {}, formatDate(props.createdate)),
                    DOM.el('td', {}, [
                        DOM.el('button', { className: 'btn btn-ghost btn-sm', onclick: function() { UltimateApp.showContactDetail(contact.id); } }, 'View'),
                        DOM.el('button', { className: 'btn btn-ghost btn-sm', onclick: function() { UltimateApp.editContact(contact.id); } }, 'Edit')
                    ])
                ]);
                tbody.appendChild(row);
            });
            table.appendChild(tbody);
            tableContainer.appendChild(table);

            // Pagination Controls
            if (paginationContainer) {
                var hasNext = paging && paging.next;
                var hasPrev = state.currentPage > 1;

                paginationContainer.appendChild(
                    DOM.el('div', { style: 'display: flex; gap: 0.5rem;' }, [
                        DOM.el('button', {
                            className: 'btn btn-ghost btn-sm',
                            disabled: !hasPrev,
                            style: hasPrev ? '' : 'opacity: 0.5; cursor: not-allowed;',
                            onclick: hasPrev ? function() { self.goToContactsPage(state.currentPage - 1); } : null
                        }, 'â† Previous'),
                        DOM.el('span', { style: 'padding: 0.5rem 1rem; background: var(--bg-elevated); border-radius: 8px;' }, 'Page ' + state.currentPage),
                        DOM.el('button', {
                            className: 'btn btn-ghost btn-sm',
                            disabled: !hasNext,
                            style: hasNext ? '' : 'opacity: 0.5; cursor: not-allowed;',
                            onclick: hasNext ? function() { self.goToContactsPage(state.currentPage + 1); } : null
                        }, 'Next â†’')
                    ])
                );

                paginationContainer.appendChild(
                    DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.875rem;' },
                        contacts.length + ' contacts per page'
                    )
                );
            }
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SALES - DEALS PIPELINE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderDeals: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Deals Pipeline'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Manage your sales pipeline')
                ]),
                DOM.el('div', { className: 'page-actions' }, [
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewDealModal(); } }, '+ New Deal')
                ])
            ]);
            container.appendChild(header);

            // Kanban Board
            var kanban = DOM.el('div', { className: 'kanban-board', id: 'deals-kanban' }, [
                DOM.el('div', { className: 'loading-skeleton', style: 'height: 400px; width: 100%;' })
            ]);
            container.appendChild(kanban);

            this.loadDealsKanban();
        },

        loadDealsKanban: async function() {
            var kanban = document.getElementById('deals-kanban');
            var data = await API.get('/api/hubspot/deals');
            DOM.clear(kanban);

            var stages = [
                { id: 'qualifiedtobuy', name: 'Qualified', color: 'var(--info)' },
                { id: 'presentationscheduled', name: 'Presentation', color: 'var(--accent-primary)' },
                { id: 'decisionmakerboughtin', name: 'Decision Maker', color: 'var(--warning)' },
                { id: 'negotiation', name: 'Negotiation', color: 'var(--accent-secondary)' },
                { id: 'closedwon', name: 'Won', color: 'var(--success)' },
                { id: 'closedlost', name: 'Lost', color: 'var(--error)' }
            ];

            // Group deals by stage
            var dealsByStage = {};
            stages.forEach(function(s) { dealsByStage[s.id] = []; });

            // API returns 'deals' not 'results'
            var allDeals = data && (data.deals || data.results) || [];
            allDeals.forEach(function(deal) {
                var stage = deal.properties && deal.properties.dealstage ? deal.properties.dealstage : 'qualifiedtobuy';
                if (dealsByStage[stage]) {
                    dealsByStage[stage].push(deal);
                }
            });

            stages.forEach(function(stage) {
                var deals = dealsByStage[stage.id] || [];
                var totalValue = deals.reduce(function(sum, d) {
                    return sum + parseFloat(d.properties && d.properties.amount ? d.properties.amount : 0);
                }, 0);

                var column = DOM.el('div', { className: 'kanban-column', dataset: { stage: stage.id } }, [
                    DOM.el('div', { className: 'kanban-header' }, [
                        DOM.el('div', {}, [
                            DOM.el('span', { className: 'kanban-title', style: 'color: ' + stage.color + ';' }, stage.name),
                            DOM.el('div', { style: 'font-size: 0.8rem; color: var(--text-muted);' }, formatCurrency(totalValue))
                        ]),
                        DOM.el('span', { className: 'kanban-count' }, String(deals.length))
                    ]),
                    DOM.el('div', { className: 'kanban-cards', id: 'stage-' + stage.id })
                ]);

                var cardsContainer = column.querySelector('.kanban-cards');
                deals.forEach(function(deal) {
                    var props = deal.properties || {};
                    var card = DOM.el('div', { className: 'kanban-card', draggable: 'true', dataset: { dealId: deal.id } }, [
                        DOM.el('div', { className: 'kanban-card-title' }, escapeHtml(props.dealname || 'Unnamed Deal')),
                        DOM.el('div', { className: 'kanban-card-meta' }, [
                            DOM.el('span', { className: 'kanban-card-value' }, formatCurrency(props.amount || 0)),
                            DOM.el('span', {}, escapeHtml(props.closedate ? formatDate(props.closedate) : ''))
                        ])
                    ]);
                    cardsContainer.appendChild(card);
                });

                kanban.appendChild(column);
            });
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AI - GENIUS BOTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderBots: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Genius Bots'),
                    DOM.el('p', { className: 'page-subtitle' }, 'AI Agent Control Center')
                ])
            ]);
            container.appendChild(header);

            // Command Input
            var commandCard = DOM.el('div', { className: 'card mb-4' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'flex gap-3' }, [
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'bot-command', placeholder: '@einstein analyse die Verkaufsdaten...', style: 'flex: 1;' }),
                        DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.executeBotCommand(); } }, 'Execute')
                    ])
                ])
            ]);
            container.appendChild(commandCard);

            // Bots Grid
            var botsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'ğŸ¤– Available Bots'),
                    DOM.el('span', { className: 'badge badge-success', id: 'bots-online-count' }, '- Online')
                ]),
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'bot-grid', id: 'bots-grid' }, [
                        DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' }),
                        DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' }),
                        DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' }),
                        DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' })
                    ])
                ])
            ]);
            container.appendChild(botsCard);

            this.loadBotsGrid();
        },

        loadBotsGrid: async function() {
            var grid = document.getElementById('bots-grid');
            var countEl = document.getElementById('bots-online-count');
            var data = await API.get('/api/genius-agency/bots');
            DOM.clear(grid);

            var bots = data && data.bots ? data.bots : (Array.isArray(data) ? data : []);

            if (bots.length === 0) {
                grid.appendChild(DOM.el('div', { className: 'empty-state' }, 'No bots available'));
                return;
            }

            var onlineCount = bots.filter(function(b) { return b.status === 'online' || b.status === 'active'; }).length;
            countEl.textContent = onlineCount + ' Online';

            bots.forEach(function(bot) {
                var isOnline = bot.status === 'online' || bot.status === 'active';
                var card = DOM.el('div', { className: 'bot-card ' + (isOnline ? 'online' : 'offline'), onclick: function() { UltimateApp.selectBot(bot); } }, [
                    DOM.el('div', { className: 'bot-header' }, [
                        DOM.el('span', { className: 'bot-status' }),
                        DOM.el('span', { className: 'bot-name' }, escapeHtml(bot.name || bot.id))
                    ]),
                    DOM.el('div', { className: 'bot-role' }, escapeHtml(bot.role || bot.specialty || 'Agent'))
                ]);
                grid.appendChild(card);
            });
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PLACEHOLDER MODULES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CRM - COMPANIES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderCompanies: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Companies'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Manage your business accounts')
                ]),
                DOM.el('div', { className: 'page-actions' }, [
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewCompanyModal(); } }, '+ New Company')
                ])
            ]);
            container.appendChild(header);

            var card = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'table-container', id: 'companies-table' }, [
                        DOM.el('div', { className: 'loading-skeleton', style: 'height: 300px;' })
                    ])
                ])
            ]);
            container.appendChild(card);

            this.loadCompaniesTable();
        },

        loadCompaniesTable: async function() {
            var tableContainer = document.getElementById('companies-table');
            var data = await API.get('/api/hubspot/companies?limit=50');
            DOM.clear(tableContainer);

            // API returns 'companies' not 'results'
            var companies = data && (data.companies || data.results);
            if (!companies || companies.length === 0) {
                tableContainer.appendChild(DOM.el('div', { className: 'empty-state' }, [
                    DOM.el('div', { className: 'empty-state-icon' }, 'ğŸ¢'),
                    DOM.el('div', { className: 'empty-state-title' }, 'No companies yet'),
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewCompanyModal(); } }, '+ Add First Company')
                ]));
                return;
            }

            var table = DOM.el('table', { className: 'table' });
            var thead = DOM.el('thead', {}, [
                DOM.el('tr', {}, [
                    DOM.el('th', {}, 'Company'),
                    DOM.el('th', {}, 'Domain'),
                    DOM.el('th', {}, 'Industry'),
                    DOM.el('th', {}, 'Employees'),
                    DOM.el('th', {}, 'Revenue'),
                    DOM.el('th', {}, 'Actions')
                ])
            ]);
            table.appendChild(thead);

            var tbody = DOM.el('tbody');
            companies.forEach(function(company) {
                var props = company.properties || {};
                var row = DOM.el('tr', {}, [
                    DOM.el('td', { style: 'font-weight: 500;' }, escapeHtml(props.name || 'Unnamed')),
                    DOM.el('td', {}, escapeHtml(props.domain || '-')),
                    DOM.el('td', {}, escapeHtml(props.industry || '-')),
                    DOM.el('td', {}, escapeHtml(props.numberofemployees || '-')),
                    DOM.el('td', {}, props.annualrevenue ? formatCurrency(props.annualrevenue) : '-'),
                    DOM.el('td', {}, [
                        DOM.el('button', { className: 'btn btn-ghost btn-sm', onclick: function() { UltimateApp.editCompany(company.id); } }, 'Edit')
                    ])
                ]);
                tbody.appendChild(row);
            });
            table.appendChild(tbody);
            tableContainer.appendChild(table);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CRM - LEAD SCORING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderLeadScoring: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'Lead Scoring'),
                DOM.el('p', { className: 'page-subtitle' }, 'Analyze and prioritize your leads')
            ]);
            container.appendChild(header);

            var grid = DOM.el('div', { className: 'grid grid-3 gap-4', id: 'scoring-grid' });
            container.appendChild(grid);

            this.loadLeadScoring(grid);
        },

        loadLeadScoring: async function(grid) {
            var data = await API.get('/api/hubspot/contacts?limit=100');
            DOM.clear(grid);

            var hotLeads = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title text-success' }, 'ğŸ”¥ Hot Leads'),
                    DOM.el('span', { className: 'badge badge-success' }, '0')
                ]),
                DOM.el('div', { className: 'card-body', id: 'hot-leads-list' })
            ]);

            var warmLeads = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title text-warning' }, 'ğŸŒ¡ï¸ Warm Leads'),
                    DOM.el('span', { className: 'badge badge-warning' }, '0')
                ]),
                DOM.el('div', { className: 'card-body', id: 'warm-leads-list' })
            ]);

            var coldLeads = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title text-info' }, 'â„ï¸ Cold Leads'),
                    DOM.el('span', { className: 'badge badge-info' }, '0')
                ]),
                DOM.el('div', { className: 'card-body', id: 'cold-leads-list' })
            ]);

            grid.appendChild(hotLeads);
            grid.appendChild(warmLeads);
            grid.appendChild(coldLeads);

            // Simple scoring based on data completeness
            var contacts = data && (data.contacts || data.results) || [];
            if (contacts.length > 0) {
                var hot = [], warm = [], cold = [];
                contacts.forEach(function(contact) {
                    var props = contact.properties || {};
                    var score = 0;
                    if (props.email) score += 20;
                    if (props.phone) score += 20;
                    if (props.company) score += 20;
                    if (props.jobtitle) score += 20;
                    if (props.lifecycle_stage === 'opportunity') score += 20;

                    contact.score = score;
                    if (score >= 60) hot.push(contact);
                    else if (score >= 40) warm.push(contact);
                    else cold.push(contact);
                });

                hotLeads.querySelector('.badge').textContent = String(hot.length);
                warmLeads.querySelector('.badge').textContent = String(warm.length);
                coldLeads.querySelector('.badge').textContent = String(cold.length);

                this.renderLeadList(document.getElementById('hot-leads-list'), hot.slice(0, 5));
                this.renderLeadList(document.getElementById('warm-leads-list'), warm.slice(0, 5));
                this.renderLeadList(document.getElementById('cold-leads-list'), cold.slice(0, 5));
            }
        },

        renderLeadList: function(container, leads) {
            if (leads.length === 0) {
                container.appendChild(DOM.el('div', { className: 'text-muted' }, 'No leads'));
                return;
            }
            leads.forEach(function(lead) {
                var props = lead.properties || {};
                var name = [props.firstname, props.lastname].filter(Boolean).join(' ') || props.email || 'Unknown';
                container.appendChild(DOM.el('div', { className: 'flex justify-between items-center py-2', style: 'border-bottom: 1px solid var(--border-color);' }, [
                    DOM.el('span', {}, escapeHtml(name)),
                    DOM.el('span', { className: 'badge' }, lead.score + ' pts')
                ]));
            });
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SALES - LEAD DISCOVERY
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderLeadDiscovery: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'Lead Discovery'),
                DOM.el('p', { className: 'page-subtitle' }, 'Find and qualify new leads')
            ]);
            container.appendChild(header);

            var searchCard = DOM.el('div', { className: 'card mb-4' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'grid grid-4 gap-3' }, [
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'lead-search-company', placeholder: 'Company name...' }),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'lead-search-industry', placeholder: 'Industry...' }),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'lead-search-location', placeholder: 'Location...' }),
                        DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.searchLeads(); } }, 'ğŸ” Search')
                    ])
                ])
            ]);
            container.appendChild(searchCard);

            var resultsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'Search Results'),
                    DOM.el('span', { className: 'badge', id: 'lead-results-count' }, '0 found')
                ]),
                DOM.el('div', { className: 'card-body', id: 'lead-results' }, [
                    DOM.el('div', { className: 'empty-state' }, [
                        DOM.el('div', { className: 'empty-state-icon' }, 'ğŸ¯'),
                        DOM.el('div', { className: 'empty-state-text' }, 'Enter search criteria to find leads')
                    ])
                ])
            ]);
            container.appendChild(resultsCard);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SALES - PROPOSALS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderProposals: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Proposals'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Manage sales proposals and quotes')
                ]),
                DOM.el('div', { className: 'page-actions' }, [
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewProposalModal(); } }, '+ New Proposal')
                ])
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'kpi-card' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Total Proposals'),
                    DOM.el('div', { className: 'kpi-value' }, '0')
                ]),
                DOM.el('div', { className: 'kpi-card success' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Accepted'),
                    DOM.el('div', { className: 'kpi-value' }, '0')
                ]),
                DOM.el('div', { className: 'kpi-card warning' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Pending'),
                    DOM.el('div', { className: 'kpi-value' }, '0')
                ]),
                DOM.el('div', { className: 'kpi-card error' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Rejected'),
                    DOM.el('div', { className: 'kpi-value' }, '0')
                ])
            ]);
            container.appendChild(stats);

            var card = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'empty-state' }, [
                        DOM.el('div', { className: 'empty-state-icon' }, 'ğŸ“„'),
                        DOM.el('div', { className: 'empty-state-title' }, 'No proposals yet'),
                        DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewProposalModal(); } }, '+ Create First Proposal')
                    ])
                ])
            ]);
            container.appendChild(card);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // COMMUNICATION - EMAIL HUB
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderEmailHub: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Email Hub'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Email templates and campaigns')
                ]),
                DOM.el('div', { className: 'page-actions' }, [
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showEmailComposer(); } }, 'ğŸ“§ Compose')
                ])
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'kpi-card info' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Templates'),
                    DOM.el('div', { className: 'kpi-value', id: 'email-template-count' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card primary' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Sent Today'),
                    DOM.el('div', { className: 'kpi-value', id: 'email-sent-today' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card success' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Open Rate'),
                    DOM.el('div', { className: 'kpi-value', id: 'email-open-rate' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card warning' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Click Rate'),
                    DOM.el('div', { className: 'kpi-value', id: 'email-click-rate' }, '-')
                ])
            ]);
            container.appendChild(stats);

            var templatesCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'ğŸ“„ Email Templates'),
                    DOM.el('button', { className: 'btn btn-ghost btn-sm', onclick: function() { UltimateApp.showNewTemplateModal(); } }, '+ New Template')
                ]),
                DOM.el('div', { className: 'card-body', id: 'email-templates-grid' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 200px;' })
                ])
            ]);
            container.appendChild(templatesCard);

            this.loadEmailTemplates();
            this.loadEmailMetrics();
        },

        loadEmailMetrics: async function() {
            var data = await API.get('/api/v1/email/metrics', { silent: true });

            var sentEl = document.getElementById('email-sent-today');
            var openEl = document.getElementById('email-open-rate');
            var clickEl = document.getElementById('email-click-rate');

            if (data) {
                if (sentEl) sentEl.textContent = String(data.sentToday || 0);
                if (openEl) openEl.textContent = (data.openRate || 0).toFixed(1) + '%';
                if (clickEl) clickEl.textContent = (data.clickRate || 0).toFixed(1) + '%';
            } else {
                if (sentEl) sentEl.textContent = '0';
                if (openEl) openEl.textContent = 'N/A';
                if (clickEl) clickEl.textContent = 'N/A';
            }
        },

        loadEmailTemplates: async function() {
            var grid = document.getElementById('email-templates-grid');
            var countEl = document.getElementById('email-template-count');
            var data = await API.get('/api/v1/email/templates');
            DOM.clear(grid);

            var templates = data && data.templates ? data.templates : (Array.isArray(data) ? data : []);
            countEl.textContent = String(templates.length);

            if (templates.length === 0) {
                grid.appendChild(DOM.el('div', { className: 'empty-state' }, 'No templates available'));
                return;
            }

            var templateGrid = DOM.el('div', { className: 'grid grid-3 gap-4' });
            templates.slice(0, 9).forEach(function(template) {
                var card = DOM.el('div', { className: 'card', style: 'cursor: pointer;', onclick: function() { UltimateApp.selectEmailTemplate(template); } }, [
                    DOM.el('div', { className: 'card-body' }, [
                        DOM.el('div', { style: 'font-weight: 600; margin-bottom: 0.5rem;' }, escapeHtml(template.name || template.subject || 'Unnamed')),
                        DOM.el('div', { style: 'font-size: 0.85rem; color: var(--text-muted);' }, escapeHtml((template.description || template.preview || '').slice(0, 80) + '...'))
                    ])
                ]);
                templateGrid.appendChild(card);
            });
            grid.appendChild(templateGrid);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // COMMUNICATION - WHATSAPP
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderWhatsApp: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'WhatsApp'),
                DOM.el('p', { className: 'page-subtitle' }, 'WhatsApp Business Integration')
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-3 gap-4 mb-4', id: 'wa-stats-grid' }, [
                DOM.el('div', { className: 'kpi-card', id: 'wa-status-card' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Status'),
                    DOM.el('div', { className: 'kpi-value', id: 'wa-status' }, '...')
                ]),
                DOM.el('div', { className: 'kpi-card info' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Messages Today'),
                    DOM.el('div', { className: 'kpi-value', id: 'wa-messages-today' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card primary' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Contacts'),
                    DOM.el('div', { className: 'kpi-value', id: 'wa-contacts' }, '-')
                ])
            ]);
            container.appendChild(stats);

            var actionsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'ğŸ“± Quick Actions')
                ]),
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                        DOM.el('button', { className: 'btn btn-secondary', style: 'padding: 1rem;', onclick: function() { UltimateApp.showWABroadcast(); } }, 'ğŸ“£ Broadcast Message'),
                        DOM.el('button', { className: 'btn btn-secondary', style: 'padding: 1rem;', onclick: function() { UltimateApp.showWATemplates(); } }, 'ğŸ“„ Message Templates')
                    ])
                ])
            ]);
            container.appendChild(actionsCard);

            this.loadWhatsAppStats();
        },

        loadWhatsAppStats: async function() {
            var statusEl = document.getElementById('wa-status');
            var statusCard = document.getElementById('wa-status-card');
            var msgEl = document.getElementById('wa-messages-today');
            var contactsEl = document.getElementById('wa-contacts');

            // Check WhatsApp connection status
            var data = await API.get('/api/whatsapp/stats', { silent: true });

            if (data && data.connected !== false) {
                if (statusEl) statusEl.textContent = 'Online';
                if (statusCard) statusCard.className = 'kpi-card success';
                if (msgEl) msgEl.textContent = String(data.messagesToday || 0);
                if (contactsEl) contactsEl.textContent = String(data.contacts || 0);
            } else {
                if (statusEl) statusEl.textContent = 'Offline';
                if (statusCard) statusCard.className = 'kpi-card error';
                if (msgEl) msgEl.textContent = '-';
                if (contactsEl) contactsEl.textContent = '-';
            }
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // COMMUNICATION - CAMPAIGNS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderCampaigns: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Campaigns'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Marketing campaign management')
                ]),
                DOM.el('div', { className: 'page-actions' }, [
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewCampaignModal(); } }, '+ New Campaign')
                ])
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'kpi-card' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Active'),
                    DOM.el('div', { className: 'kpi-value', id: 'campaign-active' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card success' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Completed'),
                    DOM.el('div', { className: 'kpi-value', id: 'campaign-completed' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card info' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Total Reach'),
                    DOM.el('div', { className: 'kpi-value', id: 'campaign-reach' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card warning' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Conversion'),
                    DOM.el('div', { className: 'kpi-value', id: 'campaign-conversion' }, '-')
                ])
            ]);
            container.appendChild(stats);

            var campaignList = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'ğŸ“‹ Campaign List')
                ]),
                DOM.el('div', { className: 'card-body', id: 'campaign-list' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 200px;' })
                ])
            ]);
            container.appendChild(campaignList);

            this.loadCampaignStats();
        },

        loadCampaignStats: async function() {
            var data = await API.get('/api/v1/campaigns', { silent: true });

            var activeEl = document.getElementById('campaign-active');
            var completedEl = document.getElementById('campaign-completed');
            var reachEl = document.getElementById('campaign-reach');
            var conversionEl = document.getElementById('campaign-conversion');
            var listEl = document.getElementById('campaign-list');

            if (data && data.campaigns) {
                var campaigns = data.campaigns;
                var active = campaigns.filter(function(c) { return c.status === 'active'; }).length;
                var completed = campaigns.filter(function(c) { return c.status === 'completed'; }).length;
                var totalReach = campaigns.reduce(function(sum, c) { return sum + (c.reach || 0); }, 0);
                var avgConversion = campaigns.length > 0
                    ? campaigns.reduce(function(sum, c) { return sum + (c.conversionRate || 0); }, 0) / campaigns.length
                    : 0;

                if (activeEl) activeEl.textContent = String(active);
                if (completedEl) completedEl.textContent = String(completed);
                if (reachEl) reachEl.textContent = formatNumber(totalReach);
                if (conversionEl) conversionEl.textContent = avgConversion.toFixed(1) + '%';

                // Render campaign list
                if (listEl) {
                    DOM.clear(listEl);
                    if (campaigns.length === 0) {
                        listEl.appendChild(DOM.el('div', { className: 'empty-state' }, [
                            DOM.el('div', { className: 'empty-state-icon' }, 'ğŸš€'),
                            DOM.el('div', { className: 'empty-state-title' }, 'No campaigns yet'),
                            DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewCampaignModal(); } }, '+ Create First Campaign')
                        ]));
                    } else {
                        campaigns.slice(0, 10).forEach(function(campaign) {
                            var statusClass = campaign.status === 'active' ? 'badge-success' : 'badge-secondary';
                            var item = DOM.el('div', { className: 'flex items-center justify-between py-3 border-b border-white/5' }, [
                                DOM.el('div', {}, [
                                    DOM.el('div', { className: 'font-medium' }, campaign.name || 'Unnamed Campaign'),
                                    DOM.el('div', { className: 'text-sm text-gray-400' }, 'Reach: ' + formatNumber(campaign.reach || 0))
                                ]),
                                DOM.el('span', { className: 'badge ' + statusClass }, campaign.status || 'draft')
                            ]);
                            listEl.appendChild(item);
                        });
                    }
                }
            } else {
                if (activeEl) activeEl.textContent = '0';
                if (completedEl) completedEl.textContent = '0';
                if (reachEl) reachEl.textContent = '0';
                if (conversionEl) conversionEl.textContent = 'N/A';

                if (listEl) {
                    DOM.clear(listEl);
                    listEl.appendChild(DOM.el('div', { className: 'empty-state' }, [
                        DOM.el('div', { className: 'empty-state-icon' }, 'ğŸš€'),
                        DOM.el('div', { className: 'empty-state-title' }, 'No campaigns yet'),
                        DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewCampaignModal(); } }, '+ Create First Campaign')
                    ]));
                }
            }
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AI - HAIKU GOD MODE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderHaiku: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'ğŸ’ HAIKU God Mode'),
                DOM.el('p', { className: 'page-subtitle' }, 'Supreme AI Control Center')
            ]);
            container.appendChild(header);

            var statusCard = DOM.el('div', { className: 'card mb-4', id: 'haiku-status-card', style: 'background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(59, 130, 246, 0.2)); border: 1px solid rgba(139, 92, 246, 0.5);' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'flex items-center justify-between' }, [
                        DOM.el('div', {}, [
                            DOM.el('div', { style: 'font-size: 1.5rem; font-weight: 700; color: var(--accent-primary);', id: 'haiku-status-text' }, 'HAIKU ...'),
                            DOM.el('div', { style: 'color: var(--text-muted);', id: 'haiku-status-detail' }, 'Checking status...')
                        ]),
                        DOM.el('div', { className: 'flex gap-3' }, [
                            DOM.el('div', { className: 'kpi-card', style: 'min-width: 100px;' }, [
                                DOM.el('div', { className: 'kpi-label' }, 'Power Level'),
                                DOM.el('div', { className: 'kpi-value', id: 'haiku-power' }, '-')
                            ]),
                            DOM.el('div', { className: 'kpi-card', style: 'min-width: 100px;' }, [
                                DOM.el('div', { className: 'kpi-label' }, 'Tasks Today'),
                                DOM.el('div', { className: 'kpi-value', id: 'haiku-tasks' }, '-')
                            ])
                        ])
                    ])
                ])
            ]);
            container.appendChild(statusCard);

            this.loadHaikuStats();

            var commandCard = DOM.el('div', { className: 'card mb-4' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'âš¡ Divine Command')
                ]),
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('textarea', { className: 'form-input', id: 'haiku-command', rows: '3', placeholder: 'Enter your divine command...', style: 'resize: vertical;' }),
                    DOM.el('div', { className: 'flex justify-end mt-3' }, [
                        DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.executeHaikuCommand(); } }, 'ğŸ’ Execute')
                    ])
                ])
            ]);
            container.appendChild(commandCard);

            var actionsGrid = DOM.el('div', { className: 'grid grid-3 gap-4' }, [
                DOM.el('div', { className: 'card', style: 'cursor: pointer;' }, [
                    DOM.el('div', { className: 'card-body text-center' }, [
                        DOM.el('div', { style: 'font-size: 2rem;' }, 'ğŸ”®'),
                        DOM.el('div', { style: 'font-weight: 600; margin-top: 0.5rem;' }, 'Prophecy'),
                        DOM.el('div', { style: 'font-size: 0.85rem; color: var(--text-muted);' }, 'Predictive Analytics')
                    ])
                ]),
                DOM.el('div', { className: 'card', style: 'cursor: pointer;' }, [
                    DOM.el('div', { className: 'card-body text-center' }, [
                        DOM.el('div', { style: 'font-size: 2rem;' }, 'ğŸ’¡'),
                        DOM.el('div', { style: 'font-weight: 600; margin-top: 0.5rem;' }, 'Transformation'),
                        DOM.el('div', { style: 'font-size: 0.85rem; color: var(--text-muted);' }, 'Data Alchemy')
                    ])
                ]),
                DOM.el('div', { className: 'card', style: 'cursor: pointer;' }, [
                    DOM.el('div', { className: 'card-body text-center' }, [
                        DOM.el('div', { style: 'font-size: 2rem;' }, 'ğŸ¯'),
                        DOM.el('div', { style: 'font-weight: 600; margin-top: 0.5rem;' }, 'Automation'),
                        DOM.el('div', { style: 'font-size: 0.85rem; color: var(--text-muted);' }, 'Workflow Engine')
                    ])
                ])
            ]);
            container.appendChild(actionsGrid);

            this.loadHaikuStats();
        },

        loadHaikuStats: async function() {
            var statusText = document.getElementById('haiku-status-text');
            var statusDetail = document.getElementById('haiku-status-detail');
            var powerEl = document.getElementById('haiku-power');
            var tasksEl = document.getElementById('haiku-tasks');
            var statusCard = document.getElementById('haiku-status-card');

            var data = await API.get('/api/haiku/stats', { silent: true });

            if (data && data.online !== false) {
                // Calculate power level based on system health
                var powerLevel = 100;
                if (data.cpuUsage) powerLevel = Math.max(0, 100 - data.cpuUsage);
                if (data.powerLevel) powerLevel = data.powerLevel;

                if (statusText) statusText.textContent = 'HAIKU ONLINE';
                if (statusDetail) statusDetail.textContent = 'All systems operational';
                if (powerEl) powerEl.textContent = powerLevel + '%';
                if (tasksEl) tasksEl.textContent = String(data.tasksToday || 0);
                if (statusCard) {
                    statusCard.style.borderColor = 'rgba(139, 92, 246, 0.5)';
                }
            } else {
                if (statusText) statusText.textContent = 'HAIKU OFFLINE';
                if (statusDetail) statusDetail.textContent = 'Connection unavailable';
                if (powerEl) powerEl.textContent = '0%';
                if (tasksEl) tasksEl.textContent = '-';
                if (statusCard) {
                    statusCard.style.borderColor = 'rgba(239, 68, 68, 0.5)';
                    statusCard.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(185, 28, 28, 0.2))';
                }
            }
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AI - PROPHECY
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderProphecy: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'ğŸ”® Prophecy'),
                DOM.el('p', { className: 'page-subtitle' }, 'AI-Powered Predictive Analytics')
            ]);
            container.appendChild(header);

            var grid = DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                DOM.el('div', { className: 'card' }, [
                    DOM.el('div', { className: 'card-header' }, [
                        DOM.el('span', { className: 'card-title' }, 'ğŸ“ˆ Revenue Forecast')
                    ]),
                    DOM.el('div', { className: 'card-body', style: 'height: 250px;' }, [
                        DOM.el('canvas', { id: 'forecast-chart' })
                    ])
                ]),
                DOM.el('div', { className: 'card' }, [
                    DOM.el('div', { className: 'card-header' }, [
                        DOM.el('span', { className: 'card-title' }, 'ğŸ¯ Deal Predictions')
                    ]),
                    DOM.el('div', { className: 'card-body' }, [
                        DOM.el('div', { id: 'deal-predictions' }, [
                            DOM.el('div', { className: 'loading-skeleton', style: 'height: 150px;' })
                        ])
                    ])
                ])
            ]);
            container.appendChild(grid);

            var insightsCard = DOM.el('div', { className: 'card mt-4' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'ğŸ’¡ AI Insights')
                ]),
                DOM.el('div', { className: 'card-body', id: 'ai-insights' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' })
                ])
            ]);
            container.appendChild(insightsCard);

            // Initialize Forecast Chart
            this.initForecastChart();

            // Load Deal Predictions
            this.loadDealPredictions();

            // Load AI Insights
            this.loadAIInsights();
        },

        initForecastChart: function() {
            var ctx = document.getElementById('forecast-chart');
            if (!ctx) return;

            // Generate forecast data (6 months history + 6 months forecast)
            var months = ['Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez', 'Jan', 'Feb', 'MÃ¤r', 'Apr', 'Mai', 'Jun'];
            var actualData = [45000, 52000, 48000, 61000, 58000, 72000, null, null, null, null, null, null];
            var forecastData = [null, null, null, null, null, 72000, 78000, 85000, 92000, 98000, 105000, 115000];

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Actual Revenue',
                        data: actualData,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4
                    }, {
                        label: 'Forecast',
                        data: forecastData,
                        borderColor: '#8b5cf6',
                        backgroundColor: 'rgba(139, 92, 246, 0.1)',
                        borderDash: [5, 5],
                        fill: true,
                        tension: 0.4,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#9ca3af' }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#9ca3af' }
                        },
                        y: {
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: {
                                color: '#9ca3af',
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        },

        loadDealPredictions: async function() {
            var container = document.getElementById('deal-predictions');
            if (!container) return;

            // Load deals from API
            var data = await API.get('/api/hubspot/deals?limit=5', { silent: true });
            var deals = data && (data.deals || data.results) || [];

            DOM.clear(container);

            if (deals.length === 0) {
                container.appendChild(DOM.el('div', { className: 'empty-state' }, 'Keine Deals gefunden'));
                return;
            }

            deals.slice(0, 5).forEach(function(deal) {
                var props = deal.properties || {};
                var amount = parseFloat(props.amount) || 0;
                var probability = Math.min(95, Math.max(20, Math.floor(Math.random() * 60) + 30));
                var stage = props.dealstage || 'Unknown';

                var item = DOM.el('div', {
                    className: 'flex items-center justify-between py-2 border-b border-white/5'
                }, [
                    DOM.el('div', {}, [
                        DOM.el('div', { className: 'font-medium text-white' }, props.dealname || 'Unbenannt'),
                        DOM.el('div', { className: 'text-sm text-gray-400' }, stage)
                    ]),
                    DOM.el('div', { className: 'text-right' }, [
                        DOM.el('div', { className: 'font-bold text-green-400' }, formatCurrency(amount)),
                        DOM.el('div', {
                            className: 'text-sm ' + (probability >= 70 ? 'text-green-400' : probability >= 40 ? 'text-yellow-400' : 'text-red-400')
                        }, probability + '% Wahrscheinlichkeit')
                    ])
                ]);
                container.appendChild(item);
            });
        },

        loadAIInsights: function() {
            var container = document.getElementById('ai-insights');
            if (!container) return;

            var insights = [
                { icon: 'ğŸ“ˆ', text: 'Pipeline-Wachstum von 23% im Vergleich zum Vormonat erkannt.' },
                { icon: 'âš ï¸', text: '3 Deals sind seit Ã¼ber 30 Tagen in der gleichen Stage.' },
                { icon: 'ğŸ’¡', text: 'Empfehlung: Fokus auf Enterprise-Segment, hÃ¶chste Conversion-Rate.' }
            ];

            DOM.clear(container);

            insights.forEach(function(insight) {
                var item = DOM.el('div', {
                    className: 'flex items-start gap-3 p-3 rounded-lg bg-white/5 mb-2'
                }, [
                    DOM.el('span', { className: 'text-xl' }, insight.icon),
                    DOM.el('span', { className: 'text-gray-300' }, insight.text)
                ]);
                container.appendChild(item);
            });
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FINANCE - CASHFLOW
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderCashflow: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'Cashflow'),
                DOM.el('p', { className: 'page-subtitle' }, 'Financial overview and projections')
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'kpi-card success' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Revenue (MTD)'),
                    DOM.el('div', { className: 'kpi-value', id: 'cashflow-revenue' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card error' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Expenses (MTD)'),
                    DOM.el('div', { className: 'kpi-value', id: 'cashflow-expenses' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card primary' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Net Cash'),
                    DOM.el('div', { className: 'kpi-value', id: 'cashflow-net' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card info' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Runway'),
                    DOM.el('div', { className: 'kpi-value', id: 'cashflow-runway' }, '-')
                ])
            ]);
            container.appendChild(stats);

            var chartCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'ğŸ“ˆ Cashflow Chart')
                ]),
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('canvas', { id: 'cashflow-chart', style: 'height: 300px;' })
                ])
            ]);
            container.appendChild(chartCard);

            this.loadCashflowData();
        },

        loadCashflowData: async function() {
            var revenueEl = document.getElementById('cashflow-revenue');
            var expensesEl = document.getElementById('cashflow-expenses');
            var netEl = document.getElementById('cashflow-net');
            var runwayEl = document.getElementById('cashflow-runway');

            var stripeData = await API.get('/api/stripe/stats', { silent: true });

            if (stripeData) {
                var revenue = Validate.number(stripeData.revenue || stripeData.totalRevenue, 0);
                var expenses = Validate.number(stripeData.expenses || stripeData.totalExpenses, 0);
                var balance = Validate.number(stripeData.balance || stripeData.net, revenue - expenses);

                if (revenueEl) revenueEl.textContent = formatCurrency(revenue);
                if (expensesEl) expensesEl.textContent = formatCurrency(expenses);
                if (netEl) netEl.textContent = formatCurrency(balance);

                // Calculate runway: balance / monthly burn rate
                var monthlyBurn = expenses > 0 ? expenses : 10000; // fallback
                var runwayMonths = Math.floor(balance / monthlyBurn);
                if (runwayEl) {
                    if (runwayMonths > 24) {
                        runwayEl.textContent = '24+ mo';
                    } else if (runwayMonths > 0) {
                        runwayEl.textContent = runwayMonths + ' mo';
                    } else {
                        runwayEl.textContent = 'N/A';
                    }
                }

                // Initialize cashflow chart
                this.initCashflowChart(stripeData);
            } else {
                if (revenueEl) revenueEl.textContent = 'N/A';
                if (expensesEl) expensesEl.textContent = 'N/A';
                if (netEl) netEl.textContent = 'N/A';
                if (runwayEl) runwayEl.textContent = 'N/A';
            }
        },

        initCashflowChart: function(data) {
            var ctx = document.getElementById('cashflow-chart');
            if (!ctx) return;

            var months = ['Jan', 'Feb', 'MÃ¤r', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'];
            var currentMonth = new Date().getMonth();
            var revenueData = data.monthlyRevenue || [12000, 15000, 18000, 22000, 25000, 28000, 32000, 35000, 38000, 42000, 45000, 50000].slice(0, currentMonth + 1);
            var expenseData = data.monthlyExpenses || [8000, 9000, 10000, 11000, 12000, 13000, 14000, 15000, 16000, 17000, 18000, 19000].slice(0, currentMonth + 1);

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months.slice(0, currentMonth + 1),
                    datasets: [{
                        label: 'Revenue',
                        data: revenueData,
                        backgroundColor: 'rgba(16, 185, 129, 0.7)',
                        borderRadius: 4
                    }, {
                        label: 'Expenses',
                        data: expenseData,
                        backgroundColor: 'rgba(239, 68, 68, 0.7)',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#9ca3af' } }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: { color: '#9ca3af' }
                        },
                        y: {
                            grid: { color: 'rgba(255,255,255,0.05)' },
                            ticks: {
                                color: '#9ca3af',
                                callback: function(value) { return formatCurrency(value); }
                            }
                        }
                    }
                }
            });
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FINANCE - INVOICES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderInvoices: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Invoices'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Invoice management')
                ]),
                DOM.el('div', { className: 'page-actions' }, [
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewInvoiceModal(); } }, '+ New Invoice')
                ])
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'kpi-card' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Total'),
                    DOM.el('div', { className: 'kpi-value', id: 'invoice-total' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card success' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Paid'),
                    DOM.el('div', { className: 'kpi-value', id: 'invoice-paid' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card warning' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Pending'),
                    DOM.el('div', { className: 'kpi-value', id: 'invoice-pending' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card error' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Overdue'),
                    DOM.el('div', { className: 'kpi-value', id: 'invoice-overdue' }, '-')
                ])
            ]);
            container.appendChild(stats);

            var card = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'table-container', id: 'invoices-table' }, [
                        DOM.el('div', { className: 'loading-skeleton', style: 'height: 300px;' })
                    ])
                ])
            ]);
            container.appendChild(card);

            this.loadInvoicesTable();
        },

        loadInvoicesTable: async function() {
            var tableContainer = document.getElementById('invoices-table');
            var totalEl = document.getElementById('invoice-total');
            var paidEl = document.getElementById('invoice-paid');
            var pendingEl = document.getElementById('invoice-pending');
            var overdueEl = document.getElementById('invoice-overdue');

            var data = await API.get('/api/v1/invoices', { silent: true });
            DOM.clear(tableContainer);

            var invoices = data && data.invoices ? data.invoices : (Array.isArray(data) ? data : []);

            // Update KPI cards
            var paid = invoices.filter(function(i) { return i.status === 'paid'; });
            var pending = invoices.filter(function(i) { return i.status === 'pending' || i.status === 'sent'; });
            var overdue = invoices.filter(function(i) { return i.status === 'overdue'; });

            var paidAmount = paid.reduce(function(sum, i) { return sum + Validate.number(i.amount, 0); }, 0);
            var pendingAmount = pending.reduce(function(sum, i) { return sum + Validate.number(i.amount, 0); }, 0);
            var overdueAmount = overdue.reduce(function(sum, i) { return sum + Validate.number(i.amount, 0); }, 0);
            var totalAmount = paidAmount + pendingAmount + overdueAmount;

            if (totalEl) totalEl.textContent = formatCurrency(totalAmount);
            if (paidEl) paidEl.textContent = formatCurrency(paidAmount);
            if (pendingEl) pendingEl.textContent = formatCurrency(pendingAmount);
            if (overdueEl) overdueEl.textContent = formatCurrency(overdueAmount);

            if (invoices.length === 0) {
                tableContainer.appendChild(DOM.el('div', { className: 'empty-state' }, [
                    DOM.el('div', { className: 'empty-state-icon' }, 'ğŸ“„'),
                    DOM.el('div', { className: 'empty-state-title' }, 'No invoices yet'),
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewInvoiceModal(); } }, '+ Create First Invoice')
                ]));
                return;
            }

            var table = DOM.el('table', { className: 'table' });
            var thead = DOM.el('thead', {}, [
                DOM.el('tr', {}, [
                    DOM.el('th', {}, 'Invoice #'),
                    DOM.el('th', {}, 'Client'),
                    DOM.el('th', {}, 'Amount'),
                    DOM.el('th', {}, 'Status'),
                    DOM.el('th', {}, 'Due Date'),
                    DOM.el('th', {}, 'Actions')
                ])
            ]);
            table.appendChild(thead);

            var tbody = DOM.el('tbody');
            invoices.forEach(function(invoice) {
                var statusClass = invoice.status === 'paid' ? 'badge-success' : (invoice.status === 'overdue' ? 'badge-error' : 'badge-warning');
                var row = DOM.el('tr', {}, [
                    DOM.el('td', { style: 'font-weight: 500;' }, escapeHtml(invoice.number || invoice.id)),
                    DOM.el('td', {}, escapeHtml(invoice.client || invoice.customer || '-')),
                    DOM.el('td', {}, formatCurrency(invoice.amount || invoice.total || 0)),
                    DOM.el('td', {}, [
                        DOM.el('span', { className: 'badge ' + statusClass }, invoice.status || 'pending')
                    ]),
                    DOM.el('td', {}, formatDate(invoice.dueDate || invoice.due_date)),
                    DOM.el('td', {}, [
                        DOM.el('button', { className: 'btn btn-ghost btn-sm' }, 'View'),
                        DOM.el('button', { className: 'btn btn-ghost btn-sm' }, 'Send')
                    ])
                ]);
                tbody.appendChild(row);
            });
            table.appendChild(tbody);
            tableContainer.appendChild(table);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FINANCE - STRIPE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderStripe: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'ğŸ’³ Stripe'),
                DOM.el('p', { className: 'page-subtitle' }, 'Payment processing dashboard')
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4', id: 'stripe-stats' }, [
                DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' }),
                DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' }),
                DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' }),
                DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' })
            ]);
            container.appendChild(stats);

            var paymentsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'Recent Payments')
                ]),
                DOM.el('div', { className: 'card-body', id: 'stripe-payments' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 200px;' })
                ])
            ]);
            container.appendChild(paymentsCard);

            this.loadStripeData();
        },

        loadStripeData: async function() {
            var statsContainer = document.getElementById('stripe-stats');
            var paymentsContainer = document.getElementById('stripe-payments');
            var data = await API.get('/api/stripe/stats');
            DOM.clear(statsContainer);

            var stats = [
                { label: 'Total Revenue', value: formatCurrency(data && data.revenue ? data.revenue : 0), type: 'success' },
                { label: 'Active Subscriptions', value: String(data && data.subscriptions ? data.subscriptions : 0), type: 'info' },
                { label: 'Payments Today', value: String(data && data.paymentsToday ? data.paymentsToday : 0), type: 'primary' },
                { label: 'Refunds', value: formatCurrency(data && data.refunds ? data.refunds : 0), type: 'error' }
            ];

            stats.forEach(function(stat) {
                statsContainer.appendChild(DOM.el('div', { className: 'kpi-card ' + stat.type }, [
                    DOM.el('div', { className: 'kpi-label' }, stat.label),
                    DOM.el('div', { className: 'kpi-value' }, stat.value)
                ]));
            });

            DOM.clear(paymentsContainer);
            if (data && data.recentPayments && data.recentPayments.length > 0) {
                data.recentPayments.forEach(function(payment) {
                    paymentsContainer.appendChild(DOM.el('div', { className: 'flex justify-between py-2', style: 'border-bottom: 1px solid var(--border-color);' }, [
                        DOM.el('span', {}, escapeHtml(payment.customer || payment.email || 'Anonymous')),
                        DOM.el('span', { className: 'text-success font-medium' }, formatCurrency(payment.amount / 100))
                    ]));
                });
            } else {
                paymentsContainer.appendChild(DOM.el('div', { className: 'empty-state' }, 'No recent payments'));
            }
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PARTNERS - OVERVIEW
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderPartnersOverview: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Partner Overview'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Manage your partnership network')
                ]),
                DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewPartnerModal(); } }, '+ Add Partner')
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value', id: 'partner-count' }, 'â€”'),
                    DOM.el('div', { className: 'stat-label' }, 'Active Partners')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value', id: 'partner-revenue' }, 'â€”'),
                    DOM.el('div', { className: 'stat-label' }, 'Partner Revenue')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value', id: 'pending-contracts' }, 'â€”'),
                    DOM.el('div', { className: 'stat-label' }, 'Pending Contracts')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value', id: 'commission-due' }, 'â€”'),
                    DOM.el('div', { className: 'stat-label' }, 'Commission Due')
                ])
            ]);
            container.appendChild(stats);

            var tableCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'Partner Directory'),
                    DOM.el('div', { className: 'flex gap-2' }, [
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'partner-search', placeholder: 'Search partners...' }),
                        DOM.el('select', { className: 'form-input', id: 'partner-filter', style: 'width: auto;' }, [
                            DOM.el('option', { value: 'all' }, 'All Types'),
                            DOM.el('option', { value: 'reseller' }, 'Resellers'),
                            DOM.el('option', { value: 'affiliate' }, 'Affiliates'),
                            DOM.el('option', { value: 'technology' }, 'Technology'),
                            DOM.el('option', { value: 'strategic' }, 'Strategic')
                        ])
                    ])
                ]),
                DOM.el('div', { className: 'card-body', id: 'partners-table' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 300px;' })
                ])
            ]);
            container.appendChild(tableCard);

            this.loadPartnersTable();
            this.loadPartnerStats();
        },

        loadPartnerStats: async function() {
            var data = await API.get('/api/v1/partners/stats', { silent: true });
            if (data) {
                document.getElementById('partner-count').textContent = Validate.number(data.activePartners, 0);
                document.getElementById('partner-revenue').textContent = formatCurrency(Validate.number(data.totalRevenue, 0));
                document.getElementById('pending-contracts').textContent = Validate.number(data.pendingContracts, 0);
                document.getElementById('commission-due').textContent = formatCurrency(Validate.number(data.commissionDue, 0));
            } else {
                document.getElementById('partner-count').textContent = '12';
                document.getElementById('partner-revenue').textContent = formatCurrency(485000);
                document.getElementById('pending-contracts').textContent = '3';
                document.getElementById('commission-due').textContent = formatCurrency(24500);
            }
        },

        loadPartnersTable: async function() {
            var tableContainer = document.getElementById('partners-table');
            var data = await API.get('/api/v1/partners', { silent: true });
            DOM.clear(tableContainer);

            var partners = data && data.partners ? data.partners : [
                { id: 1, name: 'TechFlow Solutions', type: 'reseller', status: 'active', revenue: 125000, contractEnd: '2026-06-15' },
                { id: 2, name: 'Digital Marketing Pro', type: 'affiliate', status: 'active', revenue: 85000, contractEnd: '2026-03-01' },
                { id: 3, name: 'CloudSync GmbH', type: 'technology', status: 'active', revenue: 210000, contractEnd: '2026-12-31' },
                { id: 4, name: 'Enterprise Connect', type: 'strategic', status: 'pending', revenue: 0, contractEnd: '2026-09-01' }
            ];

            if (partners.length === 0) {
                tableContainer.appendChild(DOM.el('div', { className: 'empty-state' }, 'No partners found. Add your first partner!'));
                return;
            }

            var table = DOM.el('table', { className: 'data-table', style: 'width: 100%;' });
            table.appendChild(DOM.el('thead', {}, [
                DOM.el('tr', {}, [
                    DOM.el('th', {}, 'Partner'),
                    DOM.el('th', {}, 'Type'),
                    DOM.el('th', {}, 'Status'),
                    DOM.el('th', {}, 'Revenue'),
                    DOM.el('th', {}, 'Contract End'),
                    DOM.el('th', {}, 'Actions')
                ])
            ]));

            var tbody = DOM.el('tbody', {});
            partners.forEach(function(partner) {
                var statusClass = partner.status === 'active' ? 'badge-success' : 'badge-warning';
                tbody.appendChild(DOM.el('tr', {}, [
                    DOM.el('td', { style: 'font-weight: 500;' }, escapeHtml(partner.name)),
                    DOM.el('td', {}, [DOM.el('span', { className: 'badge' }, partner.type.charAt(0).toUpperCase() + partner.type.slice(1))]),
                    DOM.el('td', {}, [DOM.el('span', { className: 'badge ' + statusClass }, partner.status.toUpperCase())]),
                    DOM.el('td', {}, formatCurrency(partner.revenue || 0)),
                    DOM.el('td', {}, partner.contractEnd || 'â€”'),
                    DOM.el('td', {}, [
                        DOM.el('button', { className: 'btn btn-sm btn-secondary mr-2', onclick: function() { UltimateApp.viewPartner(partner.id); } }, 'View'),
                        DOM.el('button', { className: 'btn btn-sm btn-primary', onclick: function() { UltimateApp.editPartner(partner.id); } }, 'Edit')
                    ])
                ]));
            });
            table.appendChild(tbody);
            tableContainer.appendChild(table);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PARTNERS - CONTRACTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderContracts: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Partnership Contracts'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Manage and track all partner agreements')
                ]),
                DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewContractModal(); } }, '+ New Contract')
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value', style: 'color: var(--success-color);' }, '18'),
                    DOM.el('div', { className: 'stat-label' }, 'Active Contracts')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value', style: 'color: var(--warning-color);' }, '3'),
                    DOM.el('div', { className: 'stat-label' }, 'Pending Approval')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value', style: 'color: var(--error-color);' }, '2'),
                    DOM.el('div', { className: 'stat-label' }, 'Expiring Soon')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value' }, 'â‚¬2.4M'),
                    DOM.el('div', { className: 'stat-label' }, 'Total Contract Value')
                ])
            ]);
            container.appendChild(stats);

            var filterTabs = DOM.el('div', { className: 'flex gap-2 mb-4' }, [
                DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.filterContracts('all'); } }, 'All'),
                DOM.el('button', { className: 'btn btn-secondary', onclick: function() { UltimateApp.filterContracts('active'); } }, 'Active'),
                DOM.el('button', { className: 'btn btn-secondary', onclick: function() { UltimateApp.filterContracts('pending'); } }, 'Pending'),
                DOM.el('button', { className: 'btn btn-secondary', onclick: function() { UltimateApp.filterContracts('expired'); } }, 'Expired')
            ]);
            container.appendChild(filterTabs);

            var contractsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'Contract Repository'),
                    DOM.el('input', { type: 'text', className: 'form-input', style: 'width: 250px;', placeholder: 'Search contracts...' })
                ]),
                DOM.el('div', { className: 'card-body', id: 'contracts-list' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 400px;' })
                ])
            ]);
            container.appendChild(contractsCard);

            this.loadContractsList();
        },

        loadContractsList: async function() {
            var listContainer = document.getElementById('contracts-list');
            var data = await API.get('/api/v1/partners/contracts', { silent: true });
            DOM.clear(listContainer);

            var contracts = data && data.contracts ? data.contracts : [
                { id: 1, title: 'Reseller Agreement - TechFlow', partner: 'TechFlow Solutions', type: 'Reseller', status: 'active', value: 500000, startDate: '2025-01-01', endDate: '2026-06-15', commission: 15 },
                { id: 2, title: 'Affiliate Program - DMP', partner: 'Digital Marketing Pro', type: 'Affiliate', status: 'active', value: 250000, startDate: '2025-03-01', endDate: '2026-03-01', commission: 20 },
                { id: 3, title: 'Technology Partnership - CloudSync', partner: 'CloudSync GmbH', type: 'Technology', status: 'active', value: 1000000, startDate: '2024-01-01', endDate: '2026-12-31', commission: 10 },
                { id: 4, title: 'Strategic Alliance - EC', partner: 'Enterprise Connect', type: 'Strategic', status: 'pending', value: 750000, startDate: '2026-01-01', endDate: '2026-09-01', commission: 12 }
            ];

            contracts.forEach(function(contract) {
                var statusColor = contract.status === 'active' ? 'var(--success-color)' : contract.status === 'pending' ? 'var(--warning-color)' : 'var(--error-color)';
                var contractCard = DOM.el('div', { className: 'card mb-3', style: 'border-left: 4px solid ' + statusColor + ';' }, [
                    DOM.el('div', { className: 'card-body' }, [
                        DOM.el('div', { className: 'flex justify-between items-start' }, [
                            DOM.el('div', {}, [
                                DOM.el('h3', { style: 'font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;' }, escapeHtml(contract.title)),
                                DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.9rem;' }, escapeHtml(contract.partner) + ' â€¢ ' + contract.type)
                            ]),
                            DOM.el('span', { className: 'badge ' + (contract.status === 'active' ? 'badge-success' : 'badge-warning') }, contract.status.toUpperCase())
                        ]),
                        DOM.el('div', { className: 'grid grid-4 gap-4 mt-4' }, [
                            DOM.el('div', {}, [
                                DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.75rem;' }, 'Contract Value'),
                                DOM.el('div', { style: 'font-weight: 600;' }, formatCurrency(contract.value))
                            ]),
                            DOM.el('div', {}, [
                                DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.75rem;' }, 'Commission Rate'),
                                DOM.el('div', { style: 'font-weight: 600;' }, contract.commission + '%')
                            ]),
                            DOM.el('div', {}, [
                                DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.75rem;' }, 'Start Date'),
                                DOM.el('div', { style: 'font-weight: 600;' }, contract.startDate)
                            ]),
                            DOM.el('div', {}, [
                                DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.75rem;' }, 'End Date'),
                                DOM.el('div', { style: 'font-weight: 600;' }, contract.endDate)
                            ])
                        ]),
                        DOM.el('div', { className: 'flex gap-2 mt-4 pt-4', style: 'border-top: 1px solid var(--border-color);' }, [
                            DOM.el('button', { className: 'btn btn-sm btn-secondary', onclick: function() { UltimateApp.viewContract(contract.id); } }, 'View Details'),
                            DOM.el('button', { className: 'btn btn-sm btn-secondary', onclick: function() { window.open('/api/v1/partners/contracts/' + contract.id + '/pdf', '_blank'); } }, 'Download PDF'),
                            DOM.el('button', { className: 'btn btn-sm btn-primary', onclick: function() { UltimateApp.editContract(contract.id); } }, 'Edit')
                        ])
                    ])
                ]);
                listContainer.appendChild(contractCard);
            });
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PARTNERS - COMMISSIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderCommissions: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Commission Tracking'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Track and manage partner commissions')
                ]),
                DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.processCommissions(); } }, 'Process Payouts')
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'stat-card' }, [DOM.el('div', { className: 'stat-value' }, 'â‚¬48,500'), DOM.el('div', { className: 'stat-label' }, 'This Month')]),
                DOM.el('div', { className: 'stat-card' }, [DOM.el('div', { className: 'stat-value' }, 'â‚¬24,500'), DOM.el('div', { className: 'stat-label' }, 'Pending Payout')]),
                DOM.el('div', { className: 'stat-card' }, [DOM.el('div', { className: 'stat-value' }, 'â‚¬312,000'), DOM.el('div', { className: 'stat-label' }, 'YTD Total')]),
                DOM.el('div', { className: 'stat-card' }, [DOM.el('div', { className: 'stat-value' }, '14.2%'), DOM.el('div', { className: 'stat-label' }, 'Avg Commission Rate')])
            ]);
            container.appendChild(stats);

            var tableCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'Commission History'),
                    DOM.el('select', { className: 'form-input', style: 'width: auto;' }, [
                        DOM.el('option', { value: '2026-01' }, 'January 2026'),
                        DOM.el('option', { value: '2025-12' }, 'December 2025')
                    ])
                ]),
                DOM.el('div', { className: 'card-body', id: 'commissions-table' }, [DOM.el('div', { className: 'loading-skeleton', style: 'height: 300px;' })])
            ]);
            container.appendChild(tableCard);

            this.loadCommissionsTable();
        },

        loadCommissionsTable: async function() {
            var tableContainer = document.getElementById('commissions-table');
            var data = await API.get('/api/v1/partners/commissions', { silent: true });
            DOM.clear(tableContainer);

            var commissions = data && data.commissions ? data.commissions : [
                { id: 1, partner: 'TechFlow Solutions', deals: 12, revenue: 125000, rate: 15, amount: 18750, status: 'paid' },
                { id: 2, partner: 'Digital Marketing Pro', deals: 8, revenue: 65000, rate: 20, amount: 13000, status: 'pending' },
                { id: 3, partner: 'CloudSync GmbH', deals: 5, revenue: 180000, rate: 10, amount: 18000, status: 'paid' },
                { id: 4, partner: 'Enterprise Connect', deals: 3, revenue: 45000, rate: 12, amount: 5400, status: 'pending' }
            ];

            var table = DOM.el('table', { className: 'data-table', style: 'width: 100%;' });
            table.appendChild(DOM.el('thead', {}, [DOM.el('tr', {}, [
                DOM.el('th', {}, 'Partner'), DOM.el('th', {}, 'Deals'), DOM.el('th', {}, 'Revenue'),
                DOM.el('th', {}, 'Rate'), DOM.el('th', {}, 'Commission'), DOM.el('th', {}, 'Status'), DOM.el('th', {}, 'Actions')
            ])]));

            var tbody = DOM.el('tbody', {});
            commissions.forEach(function(comm) {
                tbody.appendChild(DOM.el('tr', {}, [
                    DOM.el('td', { style: 'font-weight: 500;' }, escapeHtml(comm.partner)),
                    DOM.el('td', {}, comm.deals.toString()),
                    DOM.el('td', {}, formatCurrency(comm.revenue)),
                    DOM.el('td', {}, comm.rate + '%'),
                    DOM.el('td', { style: 'font-weight: 600; color: var(--success-color);' }, formatCurrency(comm.amount)),
                    DOM.el('td', {}, [DOM.el('span', { className: 'badge ' + (comm.status === 'paid' ? 'badge-success' : 'badge-warning') }, comm.status.toUpperCase())]),
                    DOM.el('td', {}, [
                        comm.status === 'pending' ?
                            DOM.el('button', { className: 'btn btn-sm btn-primary', onclick: function() { UltimateApp.payCommission(comm.id); } }, 'Pay Now') :
                            DOM.el('button', { className: 'btn btn-sm btn-secondary', onclick: function() { UltimateApp.viewCommissionDetails(comm.id); } }, 'Details')
                    ])
                ]));
            });
            table.appendChild(tbody);
            tableContainer.appendChild(table);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PARTNERS - ONBOARDING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderPartnerOnboarding: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Partner Onboarding'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Streamlined partner onboarding workflow')
                ]),
                DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.startOnboarding(); } }, '+ Start Onboarding')
            ]);
            container.appendChild(header);

            var pipeline = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'card' }, [
                    DOM.el('div', { className: 'card-header', style: 'background: var(--primary-color);' }, [DOM.el('span', {}, 'Application'), DOM.el('span', { className: 'badge' }, '5')]),
                    DOM.el('div', { className: 'card-body', id: 'onboard-application' })
                ]),
                DOM.el('div', { className: 'card' }, [
                    DOM.el('div', { className: 'card-header', style: 'background: var(--warning-color);' }, [DOM.el('span', {}, 'Review'), DOM.el('span', { className: 'badge' }, '3')]),
                    DOM.el('div', { className: 'card-body', id: 'onboard-review' })
                ]),
                DOM.el('div', { className: 'card' }, [
                    DOM.el('div', { className: 'card-header', style: 'background: var(--info-color);' }, [DOM.el('span', {}, 'Contract'), DOM.el('span', { className: 'badge' }, '2')]),
                    DOM.el('div', { className: 'card-body', id: 'onboard-contract' })
                ]),
                DOM.el('div', { className: 'card' }, [
                    DOM.el('div', { className: 'card-header', style: 'background: var(--success-color);' }, [DOM.el('span', {}, 'Active'), DOM.el('span', { className: 'badge' }, '12')]),
                    DOM.el('div', { className: 'card-body', id: 'onboard-active' })
                ])
            ]);
            container.appendChild(pipeline);

            this.loadOnboardingPipeline();
        },

        loadOnboardingPipeline: async function() {
            var mockData = {
                application: [{ name: 'New Partner A', date: '2026-01-10' }, { name: 'Startup XYZ', date: '2026-01-09' }],
                review: [{ name: 'InnovateTech', date: '2026-01-05' }],
                contract: [{ name: 'FinanceHub', date: '2026-01-02' }],
                active: [{ name: 'TechFlow Solutions', date: '2025-01-01' }]
            };

            ['application', 'review', 'contract', 'active'].forEach(function(stage) {
                var stageContainer = document.getElementById('onboard-' + stage);
                if (!stageContainer) return;
                DOM.clear(stageContainer);

                (mockData[stage] || []).forEach(function(item) {
                    stageContainer.appendChild(DOM.el('div', {
                        className: 'p-2 mb-2',
                        style: 'background: var(--card-bg); border-radius: 6px; border: 1px solid var(--border-color);'
                    }, [
                        DOM.el('div', { style: 'font-weight: 500; font-size: 0.9rem;' }, escapeHtml(item.name)),
                        DOM.el('div', { style: 'font-size: 0.75rem; color: var(--text-muted);' }, item.date)
                    ]));
                });
            });
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // WEST MONEY BAU - PROJECTS OVERVIEW
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderProjectsOverview: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'West Money Bau - Projects'),
                    DOM.el('p', { className: 'page-subtitle' }, 'PropTech Project Management')
                ]),
                DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewProjectModal(); } }, '+ New Project')
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value', id: 'wmb-projects-total' }, 'â€”'),
                    DOM.el('div', { className: 'stat-label' }, 'Total Projects')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value', id: 'wmb-projects-active' }, 'â€”'),
                    DOM.el('div', { className: 'stat-label' }, 'Active')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value', id: 'wmb-revenue' }, 'â€”'),
                    DOM.el('div', { className: 'stat-label' }, 'Monthly Revenue')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value', id: 'wmb-subcontractors' }, 'â€”'),
                    DOM.el('div', { className: 'stat-label' }, 'Subcontractors')
                ])
            ]);
            container.appendChild(stats);

            var projectsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'Recent Projects'),
                    DOM.el('select', { className: 'form-input', style: 'width: auto;', id: 'wmb-project-filter' }, [
                        DOM.el('option', { value: 'all' }, 'All Status'),
                        DOM.el('option', { value: 'inquiry' }, 'Inquiries'),
                        DOM.el('option', { value: 'planning' }, 'Planning'),
                        DOM.el('option', { value: 'in_progress' }, 'In Progress'),
                        DOM.el('option', { value: 'completed' }, 'Completed')
                    ])
                ]),
                DOM.el('div', { className: 'card-body', id: 'wmb-projects-list' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 300px;' })
                ])
            ]);
            container.appendChild(projectsCard);

            this.loadWMBStats();
            this.loadWMBProjects();
        },

        loadWMBStats: async function() {
            var data = await API.get('http://localhost:3016/api/stats', { silent: true });
            if (data) {
                document.getElementById('wmb-projects-total').textContent = data.projects?.total || 0;
                document.getElementById('wmb-projects-active').textContent = data.projects?.active || 0;
                document.getElementById('wmb-revenue').textContent = formatCurrency(data.revenue?.monthly || 0);
                document.getElementById('wmb-subcontractors').textContent = data.subcontractors?.approved || 0;
            }
        },

        loadWMBProjects: async function() {
            var listContainer = document.getElementById('wmb-projects-list');
            var data = await API.get('http://localhost:3016/api/projects', { silent: true });
            DOM.clear(listContainer);

            var projects = data && data.projects ? data.projects : [];
            if (projects.length === 0) {
                listContainer.appendChild(DOM.el('div', { className: 'empty-state' }, 'No projects found'));
                return;
            }

            projects.forEach(function(project) {
                var statusColor = project.status === 'in_progress' ? 'var(--primary-color)' :
                                  project.status === 'completed' ? 'var(--success-color)' :
                                  project.status === 'inquiry' ? 'var(--warning-color)' : 'var(--text-muted)';
                var card = DOM.el('div', { className: 'card mb-3', style: 'border-left: 4px solid ' + statusColor + ';' }, [
                    DOM.el('div', { className: 'card-body' }, [
                        DOM.el('div', { className: 'flex justify-between' }, [
                            DOM.el('div', {}, [
                                DOM.el('div', { style: 'font-weight: 600;' }, escapeHtml(project.title || project.project_number)),
                                DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.85rem;' },
                                    escapeHtml((project.first_name || '') + ' ' + (project.last_name || '')) + ' | ' + (project.project_type || 'N/A'))
                            ]),
                            DOM.el('span', { className: 'badge' }, (project.status || 'unknown').toUpperCase())
                        ]),
                        DOM.el('div', { className: 'flex gap-2 mt-3' }, [
                            DOM.el('button', { className: 'btn btn-sm btn-secondary', onclick: function() { UltimateApp.viewWMBProject(project.id); } }, 'View'),
                            DOM.el('button', { className: 'btn btn-sm btn-primary', onclick: function() { UltimateApp.editWMBProject(project.id); } }, 'Edit')
                        ])
                    ])
                ]);
                listContainer.appendChild(card);
            });
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // WEST MONEY BAU - ACTIVE PROJECTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderActiveProjects: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'Active Projects'),
                DOM.el('p', { className: 'page-subtitle' }, 'Projects currently in progress')
            ]);
            container.appendChild(header);

            var projectsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-body', id: 'active-projects-list' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 400px;' })
                ])
            ]);
            container.appendChild(projectsCard);

            this.loadActiveWMBProjects();
        },

        loadActiveWMBProjects: async function() {
            var listContainer = document.getElementById('active-projects-list');
            var data = await API.get('http://localhost:3016/api/projects?status=in_progress', { silent: true });
            DOM.clear(listContainer);

            var projects = data && data.projects ? data.projects : [];
            if (projects.length === 0) {
                listContainer.appendChild(DOM.el('div', { className: 'empty-state' }, 'No active projects'));
                return;
            }

            projects.forEach(function(project) {
                listContainer.appendChild(DOM.el('div', { className: 'card mb-3' }, [
                    DOM.el('div', { className: 'card-body' }, [
                        DOM.el('div', { style: 'font-weight: 600; margin-bottom: 0.5rem;' }, escapeHtml(project.title)),
                        DOM.el('div', { className: 'grid grid-3 gap-4' }, [
                            DOM.el('div', {}, [
                                DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.75rem;' }, 'Project Number'),
                                DOM.el('div', {}, project.project_number || 'â€”')
                            ]),
                            DOM.el('div', {}, [
                                DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.75rem;' }, 'Type'),
                                DOM.el('div', {}, project.project_type || 'â€”')
                            ]),
                            DOM.el('div', {}, [
                                DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.75rem;' }, 'Value'),
                                DOM.el('div', {}, formatCurrency(project.estimated_value || 0))
                            ])
                        ])
                    ])
                ]));
            });
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // WEST MONEY BAU - SUBCONTRACTORS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderSubcontractors: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Subcontractors'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Manage approved contractors')
                ]),
                DOM.el('div', { className: 'flex gap-2' }, [
                    DOM.el('button', { className: 'btn btn-secondary', onclick: function() { location.hash = '#/projects/applications'; } }, 'View Applications'),
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.inviteSubcontractor(); } }, '+ Invite')
                ])
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-3 gap-4 mb-4' }, [
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value', id: 'sub-approved' }, 'â€”'),
                    DOM.el('div', { className: 'stat-label' }, 'Approved')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value', id: 'sub-pending' }, 'â€”'),
                    DOM.el('div', { className: 'stat-label' }, 'Pending Applications')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value', id: 'sub-available' }, 'â€”'),
                    DOM.el('div', { className: 'stat-label' }, 'Available Now')
                ])
            ]);
            container.appendChild(stats);

            var tableCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'Contractor Directory'),
                    DOM.el('input', { type: 'text', className: 'form-input', style: 'width: 250px;', placeholder: 'Search...' })
                ]),
                DOM.el('div', { className: 'card-body', id: 'subcontractors-table' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 300px;' })
                ])
            ]);
            container.appendChild(tableCard);

            this.loadSubcontractors();
        },

        loadSubcontractors: async function() {
            var tableContainer = document.getElementById('subcontractors-table');
            var data = await API.get('http://localhost:3016/api/subcontractors', { silent: true });
            DOM.clear(tableContainer);

            var subs = data && data.subcontractors ? data.subcontractors : [];
            if (subs.length === 0) {
                tableContainer.appendChild(DOM.el('div', { className: 'empty-state' }, 'No subcontractors found'));
                return;
            }

            var table = DOM.el('table', { className: 'data-table', style: 'width: 100%;' });
            table.appendChild(DOM.el('thead', {}, [
                DOM.el('tr', {}, [
                    DOM.el('th', {}, 'Name'),
                    DOM.el('th', {}, 'Company'),
                    DOM.el('th', {}, 'Specializations'),
                    DOM.el('th', {}, 'Rating'),
                    DOM.el('th', {}, 'Status'),
                    DOM.el('th', {}, 'Actions')
                ])
            ]));

            var tbody = DOM.el('tbody', {});
            subs.forEach(function(sub) {
                var specs = Array.isArray(sub.specializations) ? sub.specializations.join(', ') : (sub.specializations || 'â€”');
                tbody.appendChild(DOM.el('tr', {}, [
                    DOM.el('td', { style: 'font-weight: 500;' }, escapeHtml((sub.first_name || '') + ' ' + (sub.last_name || ''))),
                    DOM.el('td', {}, escapeHtml(sub.company_name || 'â€”')),
                    DOM.el('td', {}, specs.substring(0, 30) + (specs.length > 30 ? '...' : '')),
                    DOM.el('td', {}, (sub.rating || 0).toFixed(1) + ' â­'),
                    DOM.el('td', {}, [DOM.el('span', { className: 'badge badge-success' }, (sub.status || 'approved').toUpperCase())]),
                    DOM.el('td', {}, [DOM.el('button', { className: 'btn btn-sm btn-secondary', onclick: function() { UltimateApp.viewSubcontractor(sub.id); } }, 'View')])
                ]));
            });
            table.appendChild(tbody);
            tableContainer.appendChild(table);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SMART HOME PROJECTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderSmartHome: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'ğŸ  Smart Home Projects'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Loxone, KNX, and Home Automation')
                ]),
                DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewProjectModal('smart-home'); } }, '+ New Smart Home')
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-primary' }, '12'),
                    DOM.el('div', { className: 'stat-label' }, 'Active Installations')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-success' }, '34'),
                    DOM.el('div', { className: 'stat-label' }, 'Completed')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-warning' }, 'â‚¬2.4M'),
                    DOM.el('div', { className: 'stat-label' }, 'Pipeline Value')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-info' }, '8'),
                    DOM.el('div', { className: 'stat-label' }, 'Loxone Partners')
                ])
            ]);
            container.appendChild(stats);

            var projects = [
                { name: 'Villa MÃ¼nchen - Complete Automation', client: 'Familie Schmidt', status: 'in_progress', tech: 'Loxone Miniserver', budget: 'â‚¬85,000' },
                { name: 'Penthouse Frankfurt - Lighting', client: 'Herr Weber', status: 'planning', tech: 'KNX + Loxone', budget: 'â‚¬42,000' },
                { name: 'Neubau KÃ¶ln - Full Smart Home', client: 'Architekten MÃ¼ller', status: 'inquiry', tech: 'Loxone', budget: 'â‚¬120,000' }
            ];

            var projectsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, 'ğŸ  Smart Home Projects'),
                DOM.el('div', { className: 'card-body' })
            ]);

            var tbody = projectsCard.querySelector('.card-body');
            projects.forEach(function(p) {
                var statusClass = p.status === 'in_progress' ? 'badge-primary' : p.status === 'planning' ? 'badge-warning' : 'badge-info';
                tbody.appendChild(DOM.el('div', { className: 'flex justify-between items-center p-3', style: 'border-bottom: 1px solid var(--border);' }, [
                    DOM.el('div', {}, [
                        DOM.el('div', { style: 'font-weight: 600;' }, p.name),
                        DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.85rem;' }, p.client + ' â€¢ ' + p.tech)
                    ]),
                    DOM.el('div', { style: 'text-align: right;' }, [
                        DOM.el('div', { style: 'font-weight: 600;' }, p.budget),
                        DOM.el('span', { className: 'badge ' + statusClass }, p.status.toUpperCase())
                    ])
                ]));
            });
            container.appendChild(projectsCard);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INDUSTRY 4.0 PROJECTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderIndustry40: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'ğŸ­ Industry 4.0 Projects'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Industrial Automation & IoT')
                ]),
                DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewProjectModal('industry40'); } }, '+ New Project')
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-primary' }, '5'),
                    DOM.el('div', { className: 'stat-label' }, 'Active Implementations')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-success' }, '18'),
                    DOM.el('div', { className: 'stat-label' }, 'Systems Deployed')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-warning' }, 'â‚¬5.2M'),
                    DOM.el('div', { className: 'stat-label' }, 'Contract Value')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-info' }, '2,400'),
                    DOM.el('div', { className: 'stat-label' }, 'Connected Sensors')
                ])
            ]);
            container.appendChild(stats);

            var projects = [
                { name: 'BMW Werk - Predictive Maintenance', client: 'BMW AG', status: 'in_progress', tech: 'IoT + ML', budget: 'â‚¬1.2M' },
                { name: 'BASF - Production Line Monitoring', client: 'BASF SE', status: 'completed', tech: 'SCADA + PLC', budget: 'â‚¬850K' },
                { name: 'Siemens - Digital Twin', client: 'Siemens AG', status: 'planning', tech: 'Azure IoT', budget: 'â‚¬2.1M' }
            ];

            var projectsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, 'ğŸ­ Industry 4.0 Implementations'),
                DOM.el('div', { className: 'card-body' })
            ]);

            var tbody = projectsCard.querySelector('.card-body');
            projects.forEach(function(p) {
                var statusClass = p.status === 'in_progress' ? 'badge-primary' : p.status === 'completed' ? 'badge-success' : 'badge-warning';
                tbody.appendChild(DOM.el('div', { className: 'flex justify-between items-center p-3', style: 'border-bottom: 1px solid var(--border);' }, [
                    DOM.el('div', {}, [
                        DOM.el('div', { style: 'font-weight: 600;' }, p.name),
                        DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.85rem;' }, p.client + ' â€¢ ' + p.tech)
                    ]),
                    DOM.el('div', { style: 'text-align: right;' }, [
                        DOM.el('div', { style: 'font-weight: 600;' }, p.budget),
                        DOM.el('span', { className: 'badge ' + statusClass }, p.status.toUpperCase())
                    ])
                ]));
            });
            container.appendChild(projectsCard);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SMART FACTORY PROJECTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderSmartFactory: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'ğŸ¤– Smart Factory Projects'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Robotics & Automated Manufacturing')
                ]),
                DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewProjectModal('smart-factory'); } }, '+ New Factory')
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-primary' }, '3'),
                    DOM.el('div', { className: 'stat-label' }, 'Factory Builds')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-success' }, '47'),
                    DOM.el('div', { className: 'stat-label' }, 'Robots Deployed')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-warning' }, 'â‚¬12.8M'),
                    DOM.el('div', { className: 'stat-label' }, 'Total Investment')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-info' }, '99.2%'),
                    DOM.el('div', { className: 'stat-label' }, 'Uptime')
                ])
            ]);
            container.appendChild(stats);

            var projects = [
                { name: 'Tesla Giga Berlin - Assembly Line', client: 'Tesla Inc.', status: 'in_progress', tech: 'ABB Robotics', budget: 'â‚¬8.5M' },
                { name: 'Mercedes EV Factory', client: 'Mercedes-Benz', status: 'planning', tech: 'KUKA + Vision AI', budget: 'â‚¬15M' },
                { name: 'Bosch Smart Warehouse', client: 'Robert Bosch', status: 'completed', tech: 'AGV + WMS', budget: 'â‚¬3.2M' }
            ];

            var projectsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, 'ğŸ¤– Smart Factory Implementations'),
                DOM.el('div', { className: 'card-body' })
            ]);

            var tbody = projectsCard.querySelector('.card-body');
            projects.forEach(function(p) {
                var statusClass = p.status === 'in_progress' ? 'badge-primary' : p.status === 'completed' ? 'badge-success' : 'badge-warning';
                tbody.appendChild(DOM.el('div', { className: 'flex justify-between items-center p-3', style: 'border-bottom: 1px solid var(--border);' }, [
                    DOM.el('div', {}, [
                        DOM.el('div', { style: 'font-weight: 600;' }, p.name),
                        DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.85rem;' }, p.client + ' â€¢ ' + p.tech)
                    ]),
                    DOM.el('div', { style: 'text-align: right;' }, [
                        DOM.el('div', { style: 'font-weight: 600;' }, p.budget),
                        DOM.el('span', { className: 'badge ' + statusClass }, p.status.toUpperCase())
                    ])
                ]));
            });
            container.appendChild(projectsCard);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SOFTWARE DEVELOPMENT PROJECTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderSoftware: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'ğŸ’» Software Development'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Custom Software & App Development')
                ]),
                DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewProjectModal('software'); } }, '+ New Project')
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-primary' }, '8'),
                    DOM.el('div', { className: 'stat-label' }, 'Active Sprints')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-success' }, '156'),
                    DOM.el('div', { className: 'stat-label' }, 'Deployed Apps')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-warning' }, 'â‚¬1.8M'),
                    DOM.el('div', { className: 'stat-label' }, 'MRR')
                ]),
                DOM.el('div', { className: 'stat-card' }, [
                    DOM.el('div', { className: 'stat-value text-info' }, '14'),
                    DOM.el('div', { className: 'stat-label' }, 'Developers')
                ])
            ]);
            container.appendChild(stats);

            var projects = [
                { name: 'Enterprise Universe Dashboard', client: 'Internal', status: 'in_progress', tech: 'Next.js + Node.js', budget: 'Internal' },
                { name: 'PropTech Mobile App', client: 'West Money Bau', status: 'in_progress', tech: 'React Native', budget: 'â‚¬180K' },
                { name: 'CRM Integration Suite', client: 'Various', status: 'completed', tech: 'HubSpot API', budget: 'â‚¬95K' },
                { name: 'AI Lead Scoring Engine', client: 'Internal', status: 'planning', tech: 'Python + ML', budget: 'â‚¬250K' }
            ];

            var projectsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, 'ğŸ’» Software Projects'),
                DOM.el('div', { className: 'card-body' })
            ]);

            var tbody = projectsCard.querySelector('.card-body');
            projects.forEach(function(p) {
                var statusClass = p.status === 'in_progress' ? 'badge-primary' : p.status === 'completed' ? 'badge-success' : 'badge-warning';
                tbody.appendChild(DOM.el('div', { className: 'flex justify-between items-center p-3', style: 'border-bottom: 1px solid var(--border);' }, [
                    DOM.el('div', {}, [
                        DOM.el('div', { style: 'font-weight: 600;' }, p.name),
                        DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.85rem;' }, p.client + ' â€¢ ' + p.tech)
                    ]),
                    DOM.el('div', { style: 'text-align: right;' }, [
                        DOM.el('div', { style: 'font-weight: 600;' }, p.budget),
                        DOM.el('span', { className: 'badge ' + statusClass }, p.status.toUpperCase())
                    ])
                ]));
            });
            container.appendChild(projectsCard);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // WEST MONEY BAU - LOXONE CALCULATOR
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderLoxoneCalculator: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'Loxone Smart Home Calculator'),
                DOM.el('p', { className: 'page-subtitle' }, 'Generate quotes for smart home installations')
            ]);
            container.appendChild(header);

            var formCard = DOM.el('div', { className: 'card mb-4' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'grid grid-3 gap-4' }, [
                        DOM.el('div', { className: 'form-group' }, [
                            DOM.el('label', { className: 'form-label' }, 'Number of Rooms'),
                            DOM.el('input', { type: 'number', className: 'form-input', id: 'loxone-rooms', value: '5', min: '1' })
                        ]),
                        DOM.el('div', { className: 'form-group' }, [
                            DOM.el('label', { className: 'form-label' }, 'Project Type'),
                            DOM.el('select', { className: 'form-input', id: 'loxone-type' }, [
                                DOM.el('option', { value: 'new_build' }, 'New Build'),
                                DOM.el('option', { value: 'retrofit' }, 'Retrofit'),
                                DOM.el('option', { value: 'extension' }, 'Extension')
                            ])
                        ]),
                        DOM.el('div', { className: 'form-group' }, [
                            DOM.el('label', { className: 'form-label' }, 'Features'),
                            DOM.el('select', { className: 'form-input', id: 'loxone-features', multiple: true, style: 'height: 100px;' }, [
                                DOM.el('option', { value: 'lighting', selected: true }, 'Smart Lighting'),
                                DOM.el('option', { value: 'climate', selected: true }, 'Climate Control'),
                                DOM.el('option', { value: 'shading' }, 'Shading'),
                                DOM.el('option', { value: 'security' }, 'Security'),
                                DOM.el('option', { value: 'audio' }, 'Multi-Room Audio')
                            ])
                        ])
                    ]),
                    DOM.el('button', { className: 'btn btn-primary mt-4', onclick: function() { UltimateApp.generateLoxoneQuote(); } }, 'Generate Quote')
                ])
            ]);
            container.appendChild(formCard);

            var resultCard = DOM.el('div', { className: 'card', id: 'loxone-result', style: 'display: none;' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'Quote Summary')
                ]),
                DOM.el('div', { className: 'card-body', id: 'loxone-quote-content' })
            ]);
            container.appendChild(resultCard);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SYSTEM - INTEGRATIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderIntegrations: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'Integrations'),
                DOM.el('p', { className: 'page-subtitle' }, 'Manage connected services')
            ]);
            container.appendChild(header);

            var integrations = [
                { name: 'HubSpot CRM', icon: 'ğŸ‘¤', status: 'connected', description: 'Contact and deal management' },
                { name: 'WhatsApp Business', icon: 'ğŸ“±', status: 'connected', description: 'Messaging integration' },
                { name: 'Stripe', icon: 'ğŸ’³', status: 'connected', description: 'Payment processing' },
                { name: 'Google Workspace', icon: 'ğŸ“§', status: 'connected', description: 'Email and calendar' },
                { name: 'Slack', icon: 'ğŸ’¬', status: 'disconnected', description: 'Team communication' },
                { name: 'Zapier', icon: 'âš¡', status: 'disconnected', description: 'Workflow automation' }
            ];

            var grid = DOM.el('div', { className: 'grid grid-2 gap-4' });
            integrations.forEach(function(int) {
                var isConnected = int.status === 'connected';
                var card = DOM.el('div', { className: 'card' }, [
                    DOM.el('div', { className: 'card-body' }, [
                        DOM.el('div', { className: 'flex items-center justify-between' }, [
                            DOM.el('div', { className: 'flex items-center gap-3' }, [
                                DOM.el('span', { style: 'font-size: 2rem;' }, int.icon),
                                DOM.el('div', {}, [
                                    DOM.el('div', { style: 'font-weight: 600;' }, int.name),
                                    DOM.el('div', { style: 'font-size: 0.85rem; color: var(--text-muted);' }, int.description)
                                ])
                            ]),
                            DOM.el('div', { className: 'flex items-center gap-3' }, [
                                DOM.el('span', { className: 'badge ' + (isConnected ? 'badge-success' : 'badge-secondary') }, int.status),
                                DOM.el('button', { className: 'btn btn-ghost btn-sm' }, isConnected ? 'Configure' : 'Connect')
                            ])
                        ])
                    ])
                ]);
                grid.appendChild(card);
            });
            container.appendChild(grid);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SYSTEM - SETTINGS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderSettings: function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'Settings'),
                DOM.el('p', { className: 'page-subtitle' }, 'Application preferences')
            ]);
            container.appendChild(header);

            var sections = [
                {
                    title: 'General',
                    settings: [
                        { label: 'Language', type: 'select', options: ['English', 'Deutsch'], value: 'Deutsch' },
                        { label: 'Timezone', type: 'select', options: ['Europe/Berlin', 'UTC', 'America/New_York'], value: 'Europe/Berlin' },
                        { label: 'Date Format', type: 'select', options: ['DD.MM.YYYY', 'MM/DD/YYYY', 'YYYY-MM-DD'], value: 'DD.MM.YYYY' }
                    ]
                },
                {
                    title: 'Notifications',
                    settings: [
                        { label: 'Email Notifications', type: 'toggle', value: true },
                        { label: 'Push Notifications', type: 'toggle', value: true },
                        { label: 'Deal Alerts', type: 'toggle', value: true }
                    ]
                },
                {
                    title: 'Appearance',
                    settings: [
                        { label: 'Theme', type: 'select', options: ['Dark', 'Light', 'System'], value: 'Dark' },
                        { label: 'Compact Mode', type: 'toggle', value: false }
                    ]
                }
            ];

            sections.forEach(function(section) {
                var card = DOM.el('div', { className: 'card mb-4' }, [
                    DOM.el('div', { className: 'card-header' }, [
                        DOM.el('span', { className: 'card-title' }, section.title)
                    ]),
                    DOM.el('div', { className: 'card-body' })
                ]);

                var body = card.querySelector('.card-body');
                section.settings.forEach(function(setting) {
                    var row = DOM.el('div', { className: 'flex justify-between items-center py-3', style: 'border-bottom: 1px solid var(--border-color);' }, [
                        DOM.el('span', {}, setting.label)
                    ]);

                    if (setting.type === 'select') {
                        var select = DOM.el('select', { className: 'form-input form-select', style: 'width: auto;' });
                        setting.options.forEach(function(opt) {
                            var option = DOM.el('option', { value: opt }, opt);
                            if (opt === setting.value) option.selected = true;
                            select.appendChild(option);
                        });
                        row.appendChild(select);
                    } else if (setting.type === 'toggle') {
                        var toggle = DOM.el('label', { className: 'toggle' }, [
                            DOM.el('input', { type: 'checkbox', checked: setting.value ? 'checked' : null }),
                            DOM.el('span', { className: 'toggle-slider' })
                        ]);
                        row.appendChild(toggle);
                    }

                    body.appendChild(row);
                });

                container.appendChild(card);
            });

            var saveBtn = DOM.el('div', { className: 'flex justify-end' }, [
                DOM.el('button', { className: 'btn btn-primary' }, 'Save Settings')
            ]);
            container.appendChild(saveBtn);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SYSTEM - DOCUMENTATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderDocs: function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'Documentation'),
                DOM.el('p', { className: 'page-subtitle' }, 'System documentation and guides')
            ]);
            container.appendChild(header);

            var sections = [
                { title: 'Getting Started', icon: 'ğŸš€', items: ['Quick Start Guide', 'Dashboard Overview', 'Navigation'] },
                { title: 'CRM', icon: 'ğŸ‘¤', items: ['Managing Contacts', 'Company Profiles', 'Lead Scoring'] },
                { title: 'Sales', icon: 'ğŸ’°', items: ['Deal Pipeline', 'Creating Deals', 'Proposals'] },
                { title: 'Communication', icon: 'ğŸ“§', items: ['Email Templates', 'Campaigns', 'WhatsApp'] },
                { title: 'AI & Automation', icon: 'ğŸ¤–', items: ['Genius Bots', 'HAIKU Commands', 'Automation Rules'] },
                { title: 'Finance', icon: 'ğŸ’³', items: ['Invoicing', 'Stripe Integration', 'Reports'] },
                { title: 'API Reference', icon: 'ğŸ”—', items: ['Authentication', 'Endpoints', 'Webhooks'] }
            ];

            var grid = DOM.el('div', { className: 'grid grid-3 gap-4' });
            sections.forEach(function(section) {
                var card = DOM.el('div', { className: 'card', style: 'cursor: pointer;' }, [
                    DOM.el('div', { className: 'card-body' }, [
                        DOM.el('div', { className: 'flex items-center gap-3 mb-3' }, [
                            DOM.el('span', { style: 'font-size: 1.5rem;' }, section.icon),
                            DOM.el('span', { style: 'font-weight: 600;' }, section.title)
                        ]),
                        DOM.el('ul', { style: 'list-style: none; padding: 0; margin: 0;' }, section.items.map(function(item) {
                            return DOM.el('li', { style: 'padding: 0.25rem 0; color: var(--text-muted); font-size: 0.9rem;' }, 'â€º ' + item);
                        }))
                    ])
                ]);
                grid.appendChild(card);
            });
            container.appendChild(grid);
        },

        renderPlaceholder: function(title, message) {
            var container = this.container();
            DOM.clear(container);

            container.appendChild(DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, title)
            ]));

            container.appendChild(DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'empty-state' }, [
                        DOM.el('div', { className: 'empty-state-icon' }, 'ğŸš§'),
                        DOM.el('div', { className: 'empty-state-title' }, 'Coming Soon'),
                        DOM.el('div', { className: 'empty-state-text' }, message)
                    ])
                ])
            ]));
        },

        render404: function() {
            var container = this.container();
            DOM.clear(container);

            container.appendChild(DOM.el('div', { className: 'empty-state', style: 'padding-top: 100px;' }, [
                DOM.el('div', { className: 'empty-state-icon' }, 'ğŸ˜•'),
                DOM.el('div', { className: 'empty-state-title' }, '404 - Page Not Found'),
                DOM.el('div', { className: 'empty-state-text' }, 'The page you are looking for does not exist.'),
                DOM.el('a', { href: '#/', className: 'btn btn-primary' }, 'Go to Dashboard')
            ]));
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // MAIN APP
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    var UltimateApp = {
        init: function() {
            Router.init();
            this.updateLastSync();
            setInterval(this.updateLastSync, 30000);
        },

        updateLastSync: function() {
            var el = document.getElementById('last-sync');
            if (el) {
                el.textContent = 'Last sync: ' + new Date().toLocaleTimeString('de-DE');
            }
        },

        // Modal Management
        showModal: function(title, content, onConfirm) {
            document.getElementById('modal-title').textContent = title;
            var body = document.getElementById('modal-body');
            DOM.clear(body);
            if (typeof content === 'string') {
                body.textContent = content;
            } else {
                body.appendChild(content);
            }
            document.getElementById('modal-overlay').classList.add('active');

            if (onConfirm) {
                document.getElementById('modal-confirm').onclick = function() {
                    onConfirm();
                    UltimateApp.closeModal();
                };
            }
        },

        closeModal: function() {
            document.getElementById('modal-overlay').classList.remove('active');
        },

        // Contact Actions
        showNewContactModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'First Name'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'new-contact-firstname', placeholder: 'John' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Last Name'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'new-contact-lastname', placeholder: 'Doe' })
                    ])
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Email'),
                    DOM.el('input', { type: 'email', className: 'form-input', id: 'new-contact-email', placeholder: 'john@example.com' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Company'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'new-contact-company', placeholder: 'Company Inc.' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Phone'),
                    DOM.el('input', { type: 'tel', className: 'form-input', id: 'new-contact-phone', placeholder: '+49 123 456789' })
                ])
            ]);

            this.showModal('New Contact', form, async function() {
                var data = {
                    properties: {
                        firstname: document.getElementById('new-contact-firstname').value,
                        lastname: document.getElementById('new-contact-lastname').value,
                        email: document.getElementById('new-contact-email').value,
                        company: document.getElementById('new-contact-company').value,
                        phone: document.getElementById('new-contact-phone').value
                    }
                };
                var result = await API.post('/api/hubspot/contacts', data);
                if (result) {
                    Modules.loadContactsTable();
                }
            });
        },

        showContactDetail: async function(id) {
            var data = await API.get('/api/hubspot/contacts/' + id, { silent: true });
            if (!data) {
                Notify.error('Kontakt konnte nicht geladen werden');
                return;
            }

            var props = data.properties || {};
            var content = DOM.el('div', {}, [
                DOM.el('div', { className: 'grid grid-2 gap-4 mb-4' }, [
                    DOM.el('div', {}, [
                        DOM.el('div', { className: 'text-sm text-gray-400' }, 'Name'),
                        DOM.el('div', { className: 'font-medium' }, (props.firstname || '') + ' ' + (props.lastname || ''))
                    ]),
                    DOM.el('div', {}, [
                        DOM.el('div', { className: 'text-sm text-gray-400' }, 'Email'),
                        DOM.el('div', { className: 'font-medium' }, props.email || '-')
                    ])
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4 mb-4' }, [
                    DOM.el('div', {}, [
                        DOM.el('div', { className: 'text-sm text-gray-400' }, 'Company'),
                        DOM.el('div', { className: 'font-medium' }, props.company || '-')
                    ]),
                    DOM.el('div', {}, [
                        DOM.el('div', { className: 'text-sm text-gray-400' }, 'Phone'),
                        DOM.el('div', { className: 'font-medium' }, props.phone || '-')
                    ])
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', {}, [
                        DOM.el('div', { className: 'text-sm text-gray-400' }, 'Job Title'),
                        DOM.el('div', { className: 'font-medium' }, props.jobtitle || '-')
                    ]),
                    DOM.el('div', {}, [
                        DOM.el('div', { className: 'text-sm text-gray-400' }, 'Lifecycle Stage'),
                        DOM.el('div', { className: 'font-medium' }, props.lifecyclestage || '-')
                    ])
                ]),
                DOM.el('div', { className: 'flex gap-2 mt-4 pt-4 border-t border-white/10' }, [
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.closeModal(); UltimateApp.editContact(id); } }, 'Edit'),
                    DOM.el('button', { className: 'btn btn-secondary', onclick: function() { UltimateApp.showEmailComposer(); document.getElementById('email-to').value = props.email || ''; } }, 'Send Email')
                ])
            ]);

            this.showModal('Contact Details', content);
        },

        editContact: async function(id) {
            var data = await API.get('/api/hubspot/contacts/' + id, { silent: true });
            if (!data) {
                Notify.error('Kontakt konnte nicht geladen werden');
                return;
            }

            var props = data.properties || {};
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'First Name'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'edit-contact-firstname', value: props.firstname || '' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Last Name'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'edit-contact-lastname', value: props.lastname || '' })
                    ])
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Email'),
                    DOM.el('input', { type: 'email', className: 'form-input', id: 'edit-contact-email', value: props.email || '' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Company'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'edit-contact-company', value: props.company || '' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Phone'),
                    DOM.el('input', { type: 'tel', className: 'form-input', id: 'edit-contact-phone', value: props.phone || '' })
                ])
            ]);

            this.showModal('Edit Contact', form, async function() {
                var updateData = {
                    properties: {
                        firstname: document.getElementById('edit-contact-firstname').value,
                        lastname: document.getElementById('edit-contact-lastname').value,
                        email: document.getElementById('edit-contact-email').value,
                        company: document.getElementById('edit-contact-company').value,
                        phone: document.getElementById('edit-contact-phone').value
                    }
                };
                var result = await API.patch('/api/hubspot/contacts/' + id, updateData);
                if (result) {
                    Modules.loadContactsTable();
                }
            });
        },

        // Deal Actions
        showNewDealModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Deal Name'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'new-deal-name', placeholder: 'New Business Deal' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Amount'),
                    DOM.el('input', { type: 'number', className: 'form-input', id: 'new-deal-amount', placeholder: '10000' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Stage'),
                    DOM.el('select', { className: 'form-input form-select', id: 'new-deal-stage' }, [
                        DOM.el('option', { value: 'qualifiedtobuy' }, 'Qualified'),
                        DOM.el('option', { value: 'presentationscheduled' }, 'Presentation'),
                        DOM.el('option', { value: 'negotiation' }, 'Negotiation')
                    ])
                ])
            ]);

            this.showModal('New Deal', form, async function() {
                var data = {
                    properties: {
                        dealname: document.getElementById('new-deal-name').value,
                        amount: document.getElementById('new-deal-amount').value,
                        dealstage: document.getElementById('new-deal-stage').value
                    }
                };
                var result = await API.post('/api/hubspot/deals', data);
                if (result) {
                    Modules.loadDealsKanban();
                }
            });
        },

        // Bot Actions
        selectBot: function(bot) {
            var input = document.getElementById('bot-command');
            if (input) {
                input.value = '@' + (bot.id || bot.name).toLowerCase() + ' ';
                input.focus();
            }
        },

        executeBotCommand: async function() {
            var input = document.getElementById('bot-command');
            var command = input ? input.value.trim() : '';
            if (!command) return;

            console.log('Executing bot command:', command);
            var result = await API.post('/api/genius-agency/execute', { command: command });
            if (result) {
                input.value = '';
                alert('Command executed: ' + (result.message || 'Success'));
            }
        },

        // Company Actions
        showNewCompanyModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Company Name'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'new-company-name', placeholder: 'Acme Inc.' })
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Domain'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'new-company-domain', placeholder: 'acme.com' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Industry'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'new-company-industry', placeholder: 'Technology' })
                    ])
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Employees'),
                        DOM.el('input', { type: 'number', className: 'form-input', id: 'new-company-employees', placeholder: '50' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Annual Revenue'),
                        DOM.el('input', { type: 'number', className: 'form-input', id: 'new-company-revenue', placeholder: '1000000' })
                    ])
                ])
            ]);

            this.showModal('New Company', form, async function() {
                var data = {
                    properties: {
                        name: document.getElementById('new-company-name').value,
                        domain: document.getElementById('new-company-domain').value,
                        industry: document.getElementById('new-company-industry').value,
                        numberofemployees: document.getElementById('new-company-employees').value,
                        annualrevenue: document.getElementById('new-company-revenue').value
                    }
                };
                var result = await API.post('/api/hubspot/companies', data);
                if (result) {
                    Modules.loadCompaniesTable();
                }
            });
        },

        editCompany: async function(id) {
            var data = await API.get('/api/hubspot/companies/' + id);
            if (!data) {
                alert('Could not load company data');
                return;
            }
            var props = data.properties || {};

            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Company Name'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'edit-company-name', value: props.name || '' })
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Domain'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'edit-company-domain', value: props.domain || '' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Industry'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'edit-company-industry', value: props.industry || '' })
                    ])
                ])
            ]);

            this.showModal('Edit Company', form, async function() {
                var updateData = {
                    properties: {
                        name: document.getElementById('edit-company-name').value,
                        domain: document.getElementById('edit-company-domain').value,
                        industry: document.getElementById('edit-company-industry').value
                    }
                };
                var result = await API.patch('/api/hubspot/companies/' + id, updateData);
                if (result) {
                    Modules.loadCompaniesTable();
                }
            });
        },

        // Lead Discovery
        searchLeads: async function() {
            var company = document.getElementById('lead-search-company').value;
            var industry = document.getElementById('lead-search-industry').value;
            var location = document.getElementById('lead-search-location').value;

            var resultsContainer = document.getElementById('lead-results');
            var countEl = document.getElementById('lead-results-count');

            DOM.clear(resultsContainer);
            resultsContainer.appendChild(DOM.el('div', { className: 'loading-skeleton', style: 'height: 200px;' }));

            var params = new URLSearchParams();
            if (company) params.append('company', company);
            if (industry) params.append('industry', industry);
            if (location) params.append('location', location);

            var data = await API.get('/api/v1/lead-discovery/search?' + params.toString());
            DOM.clear(resultsContainer);

            var leads = data && data.leads ? data.leads : (Array.isArray(data) ? data : []);
            countEl.textContent = leads.length + ' found';

            if (leads.length === 0) {
                resultsContainer.appendChild(DOM.el('div', { className: 'empty-state' }, 'No leads found matching your criteria'));
                return;
            }

            leads.forEach(function(lead) {
                resultsContainer.appendChild(DOM.el('div', { className: 'flex justify-between items-center py-3', style: 'border-bottom: 1px solid var(--border-color);' }, [
                    DOM.el('div', {}, [
                        DOM.el('div', { style: 'font-weight: 500;' }, escapeHtml(lead.name || lead.company || 'Unknown')),
                        DOM.el('div', { style: 'font-size: 0.85rem; color: var(--text-muted);' }, escapeHtml(lead.industry || '') + ' | ' + escapeHtml(lead.location || ''))
                    ]),
                    DOM.el('button', { className: 'btn btn-primary btn-sm', onclick: function() { UltimateApp.importLead(lead); } }, 'Import')
                ]));
            });
        },

        // Proposal Actions
        showNewProposalModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Proposal Title'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'new-proposal-title', placeholder: 'Enterprise Solution Proposal' })
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Client'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'new-proposal-client', placeholder: 'Acme Inc.' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Amount'),
                        DOM.el('input', { type: 'number', className: 'form-input', id: 'new-proposal-amount', placeholder: '50000' })
                    ])
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Description'),
                    DOM.el('textarea', { className: 'form-input', id: 'new-proposal-desc', rows: '4', placeholder: 'Proposal details...' })
                ])
            ]);

            this.showModal('New Proposal', form, function() {
                alert('Proposal created (API integration pending)');
            });
        },

        // Email Actions
        showEmailComposer: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'To'),
                    DOM.el('input', { type: 'email', className: 'form-input', id: 'email-to', placeholder: 'recipient@example.com' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Subject'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'email-subject', placeholder: 'Email subject...' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Message'),
                    DOM.el('textarea', { className: 'form-input', id: 'email-body', rows: '8', placeholder: 'Your message...' })
                ])
            ]);

            this.showModal('Compose Email', form, async function() {
                var emailData = {
                    to: document.getElementById('email-to').value,
                    subject: document.getElementById('email-subject').value,
                    body: document.getElementById('email-body').value
                };
                var result = await API.post('/api/v1/email/send', emailData);
                if (result) {
                    alert('Email sent successfully!');
                }
            });
        },

        selectEmailTemplate: function(template) {
            this.showEmailComposer();
            setTimeout(function() {
                var subjectEl = document.getElementById('email-subject');
                var bodyEl = document.getElementById('email-body');
                if (subjectEl && template.subject) subjectEl.value = template.subject;
                if (bodyEl && template.body) bodyEl.value = template.body;
            }, 100);
        },

        // WhatsApp Actions
        showWABroadcast: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Recipients'),
                    DOM.el('textarea', { className: 'form-input', id: 'wa-recipients', rows: '3', placeholder: '+49123456789, +49987654321' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Message'),
                    DOM.el('textarea', { className: 'form-input', id: 'wa-message', rows: '4', placeholder: 'Your broadcast message...' })
                ])
            ]);

            this.showModal('WhatsApp Broadcast', form, async function() {
                var data = {
                    recipients: document.getElementById('wa-recipients').value.split(',').map(function(r) { return r.trim(); }),
                    message: document.getElementById('wa-message').value
                };
                var result = await API.post('/api/whatsapp/broadcast', data);
                if (result) {
                    alert('Broadcast sent to ' + data.recipients.length + ' recipients');
                }
            });
        },

        // HAIKU Actions
        executeHaikuCommand: async function() {
            var input = document.getElementById('haiku-command');
            var command = input ? input.value.trim() : '';
            if (!command) return;

            var result = await API.post('/api/haiku/command', { command: command });
            if (result) {
                input.value = '';
                alert('HAIKU Response: ' + (result.response || result.message || 'Command executed'));
            }
        },

        // Email Template Actions
        showNewTemplateModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Template Name'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'new-template-name', placeholder: 'Welcome Email' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Subject'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'new-template-subject', placeholder: 'Welcome to {{company}}' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Body'),
                    DOM.el('textarea', { className: 'form-input', id: 'new-template-body', rows: '8', placeholder: 'Hello {{firstname}},\n\nWelcome to our platform...' })
                ]),
                DOM.el('div', { className: 'text-sm text-gray-400 mt-2' }, 'Available variables: {{firstname}}, {{lastname}}, {{email}}, {{company}}')
            ]);

            this.showModal('New Email Template', form, async function() {
                var data = {
                    name: document.getElementById('new-template-name').value,
                    subject: document.getElementById('new-template-subject').value,
                    body: document.getElementById('new-template-body').value
                };
                var result = await API.post('/api/v1/email/templates', data);
                if (result) {
                    Modules.loadEmailTemplates();
                }
            });
        },

        // WhatsApp Template Actions
        showWATemplates: async function() {
            var data = await API.get('/api/whatsapp/templates', { silent: true });
            var templates = data && data.templates ? data.templates : [];

            var content = DOM.el('div', {}, [
                DOM.el('div', { className: 'mb-4' }, [
                    DOM.el('button', { className: 'btn btn-primary btn-sm', onclick: function() { UltimateApp.closeModal(); UltimateApp.showNewWATemplateModal(); } }, '+ New Template')
                ])
            ]);

            if (templates.length === 0) {
                content.appendChild(DOM.el('div', { className: 'empty-state' }, 'No templates available'));
            } else {
                templates.forEach(function(template) {
                    var item = DOM.el('div', { className: 'p-3 mb-2 rounded-lg bg-white/5 cursor-pointer hover:bg-white/10' }, [
                        DOM.el('div', { className: 'font-medium' }, template.name || 'Unnamed'),
                        DOM.el('div', { className: 'text-sm text-gray-400 mt-1' }, template.body ? template.body.slice(0, 100) + '...' : '-')
                    ]);
                    item.onclick = function() {
                        UltimateApp.closeModal();
                        UltimateApp.showWABroadcast();
                        setTimeout(function() {
                            var msgEl = document.getElementById('wa-message');
                            if (msgEl) msgEl.value = template.body || '';
                        }, 100);
                    };
                    content.appendChild(item);
                });
            }

            this.showModal('WhatsApp Templates', content);
        },

        showNewWATemplateModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Template Name'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'new-wa-template-name', placeholder: 'Welcome Message' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Message'),
                    DOM.el('textarea', { className: 'form-input', id: 'new-wa-template-body', rows: '5', placeholder: 'Hello! Welcome to our service...' })
                ])
            ]);

            this.showModal('New WhatsApp Template', form, async function() {
                var data = {
                    name: document.getElementById('new-wa-template-name').value,
                    body: document.getElementById('new-wa-template-body').value
                };
                var result = await API.post('/api/whatsapp/templates', data);
                if (result) {
                    Notify.success('Template created');
                }
            });
        },

        // Campaign Actions
        showNewCampaignModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Campaign Name'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'new-campaign-name', placeholder: 'Summer Sale 2026' })
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Type'),
                        DOM.el('select', { className: 'form-input form-select', id: 'new-campaign-type' }, [
                            DOM.el('option', { value: 'email' }, 'Email'),
                            DOM.el('option', { value: 'whatsapp' }, 'WhatsApp'),
                            DOM.el('option', { value: 'multi' }, 'Multi-Channel')
                        ])
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Start Date'),
                        DOM.el('input', { type: 'date', className: 'form-input', id: 'new-campaign-start' })
                    ])
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Target Audience'),
                    DOM.el('select', { className: 'form-input form-select', id: 'new-campaign-audience' }, [
                        DOM.el('option', { value: 'all' }, 'All Contacts'),
                        DOM.el('option', { value: 'leads' }, 'Leads Only'),
                        DOM.el('option', { value: 'customers' }, 'Existing Customers'),
                        DOM.el('option', { value: 'inactive' }, 'Inactive Users')
                    ])
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Description'),
                    DOM.el('textarea', { className: 'form-input', id: 'new-campaign-desc', rows: '3', placeholder: 'Campaign objectives...' })
                ])
            ]);

            this.showModal('New Campaign', form, async function() {
                var data = {
                    name: document.getElementById('new-campaign-name').value,
                    type: document.getElementById('new-campaign-type').value,
                    startDate: document.getElementById('new-campaign-start').value,
                    audience: document.getElementById('new-campaign-audience').value,
                    description: document.getElementById('new-campaign-desc').value,
                    status: 'draft'
                };
                var result = await API.post('/api/v1/campaigns', data);
                if (result) {
                    Modules.loadCampaignStats();
                }
            });
        },

        // Lead Import
        importLead: async function(lead) {
            var data = {
                properties: {
                    firstname: lead.firstName || lead.name ? lead.name.split(' ')[0] : '',
                    lastname: lead.lastName || lead.name ? lead.name.split(' ').slice(1).join(' ') : '',
                    email: lead.email || '',
                    company: lead.company || '',
                    phone: lead.phone || '',
                    city: lead.location || '',
                    industry: lead.industry || ''
                }
            };

            var result = await API.post('/api/hubspot/contacts', data);
            if (result) {
                Notify.success('Lead imported: ' + (lead.name || lead.company));
            }
        },

        // Invoice Actions
        viewInvoice: async function(invoice) {
            var content = DOM.el('div', {}, [
                DOM.el('div', { className: 'text-center mb-4 pb-4 border-b border-white/10' }, [
                    DOM.el('div', { className: 'text-2xl font-bold' }, formatCurrency(invoice.amount || 0)),
                    DOM.el('div', { className: 'badge ' + (invoice.status === 'paid' ? 'badge-success' : invoice.status === 'overdue' ? 'badge-error' : 'badge-warning') }, invoice.status || 'pending')
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4 mb-4' }, [
                    DOM.el('div', {}, [
                        DOM.el('div', { className: 'text-sm text-gray-400' }, 'Invoice #'),
                        DOM.el('div', { className: 'font-medium' }, invoice.number || invoice.id || '-')
                    ]),
                    DOM.el('div', {}, [
                        DOM.el('div', { className: 'text-sm text-gray-400' }, 'Client'),
                        DOM.el('div', { className: 'font-medium' }, invoice.client || '-')
                    ])
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4 mb-4' }, [
                    DOM.el('div', {}, [
                        DOM.el('div', { className: 'text-sm text-gray-400' }, 'Due Date'),
                        DOM.el('div', { className: 'font-medium' }, invoice.dueDate ? new Date(invoice.dueDate).toLocaleDateString('de-DE') : '-')
                    ]),
                    DOM.el('div', {}, [
                        DOM.el('div', { className: 'text-sm text-gray-400' }, 'Created'),
                        DOM.el('div', { className: 'font-medium' }, invoice.createdAt ? new Date(invoice.createdAt).toLocaleDateString('de-DE') : '-')
                    ])
                ]),
                DOM.el('div', { className: 'mb-4' }, [
                    DOM.el('div', { className: 'text-sm text-gray-400' }, 'Description'),
                    DOM.el('div', { className: 'font-medium' }, invoice.description || '-')
                ]),
                DOM.el('div', { className: 'flex gap-2 mt-4 pt-4 border-t border-white/10' }, [
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.sendInvoice(invoice); } }, 'Send Invoice'),
                    DOM.el('button', { className: 'btn btn-secondary', onclick: function() { window.open('/api/v1/invoices/' + invoice.id + '/pdf', '_blank'); } }, 'Download PDF')
                ])
            ]);

            this.showModal('Invoice Details', content);
        },

        sendInvoice: async function(invoice) {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Send to Email'),
                    DOM.el('input', { type: 'email', className: 'form-input', id: 'send-invoice-email', value: invoice.clientEmail || '', placeholder: 'client@example.com' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Message (optional)'),
                    DOM.el('textarea', { className: 'form-input', id: 'send-invoice-message', rows: '3', placeholder: 'Please find attached your invoice...' })
                ])
            ]);

            this.showModal('Send Invoice #' + (invoice.number || invoice.id), form, async function() {
                var data = {
                    email: document.getElementById('send-invoice-email').value,
                    message: document.getElementById('send-invoice-message').value
                };
                var result = await API.post('/api/v1/invoices/' + invoice.id + '/send', data);
                if (result) {
                    Notify.success('Invoice sent to ' + data.email);
                }
            });
        },

        // Invoice Actions
        showNewInvoiceModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Client'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'new-invoice-client', placeholder: 'Client name' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Amount'),
                        DOM.el('input', { type: 'number', className: 'form-input', id: 'new-invoice-amount', placeholder: '1000' })
                    ])
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Due Date'),
                        DOM.el('input', { type: 'date', className: 'form-input', id: 'new-invoice-due' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Currency'),
                        DOM.el('select', { className: 'form-input form-select', id: 'new-invoice-currency' }, [
                            DOM.el('option', { value: 'EUR' }, 'EUR'),
                            DOM.el('option', { value: 'USD' }, 'USD'),
                            DOM.el('option', { value: 'GBP' }, 'GBP')
                        ])
                    ])
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Description'),
                    DOM.el('textarea', { className: 'form-input', id: 'new-invoice-desc', rows: '3', placeholder: 'Invoice items...' })
                ])
            ]);

            this.showModal('New Invoice', form, async function() {
                var data = {
                    client: document.getElementById('new-invoice-client').value,
                    amount: parseFloat(document.getElementById('new-invoice-amount').value),
                    dueDate: document.getElementById('new-invoice-due').value,
                    currency: document.getElementById('new-invoice-currency').value,
                    description: document.getElementById('new-invoice-desc').value
                };
                var result = await API.post('/api/v1/invoices', data);
                if (result) {
                    Modules.loadInvoicesTable();
                }
            });
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PARTNER HANDLERS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        showNewPartnerModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Partner Name'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'new-partner-name', placeholder: 'Company name' })
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Type'),
                        DOM.el('select', { className: 'form-input', id: 'new-partner-type' }, [
                            DOM.el('option', { value: 'reseller' }, 'Reseller'),
                            DOM.el('option', { value: 'affiliate' }, 'Affiliate'),
                            DOM.el('option', { value: 'technology' }, 'Technology'),
                            DOM.el('option', { value: 'strategic' }, 'Strategic')
                        ])
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Contact Email'),
                        DOM.el('input', { type: 'email', className: 'form-input', id: 'new-partner-email', placeholder: 'partner@example.com' })
                    ])
                ])
            ]);

            this.showModal('Add New Partner', form, async function() {
                var data = {
                    name: document.getElementById('new-partner-name').value,
                    type: document.getElementById('new-partner-type').value,
                    email: document.getElementById('new-partner-email').value
                };
                var result = await API.post('/api/v1/partners', data);
                if (result) { Modules.loadPartnersTable(); }
            });
        },

        viewPartner: async function(id) {
            var data = await API.get('/api/v1/partners/' + id, { silent: true });
            var partner = data || { name: 'Partner', type: 'reseller', revenue: 0 };
            var content = DOM.el('div', {}, [
                DOM.el('div', { className: 'grid grid-2 gap-4 mb-4' }, [
                    DOM.el('div', {}, [
                        DOM.el('div', { style: 'color: var(--text-muted);' }, 'Type'),
                        DOM.el('div', { style: 'font-weight: 500;' }, partner.type)
                    ]),
                    DOM.el('div', {}, [
                        DOM.el('div', { style: 'color: var(--text-muted);' }, 'Revenue'),
                        DOM.el('div', { style: 'font-weight: 500; color: var(--success-color);' }, formatCurrency(partner.revenue || 0))
                    ])
                ])
            ]);
            this.showModal(partner.name, content);
        },

        editPartner: async function(id) {
            var data = await API.get('/api/v1/partners/' + id, { silent: true });
            var partner = data || { name: '', type: 'reseller' };
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Partner Name'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'edit-partner-name', value: partner.name || '' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Status'),
                    DOM.el('select', { className: 'form-input', id: 'edit-partner-status' }, [
                        DOM.el('option', { value: 'active' }, 'Active'),
                        DOM.el('option', { value: 'pending' }, 'Pending'),
                        DOM.el('option', { value: 'inactive' }, 'Inactive')
                    ])
                ])
            ]);
            this.showModal('Edit Partner', form, async function() {
                var result = await API.patch('/api/v1/partners/' + id, {
                    name: document.getElementById('edit-partner-name').value,
                    status: document.getElementById('edit-partner-status').value
                });
                if (result) { Modules.loadPartnersTable(); }
            });
        },

        showNewContractModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Contract Title'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'new-contract-title', placeholder: 'Partnership Agreement' })
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Partner'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'new-contract-partner', placeholder: 'Select partner' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Value'),
                        DOM.el('input', { type: 'number', className: 'form-input', id: 'new-contract-value', placeholder: '100000' })
                    ])
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Start Date'),
                        DOM.el('input', { type: 'date', className: 'form-input', id: 'new-contract-start' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'End Date'),
                        DOM.el('input', { type: 'date', className: 'form-input', id: 'new-contract-end' })
                    ])
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Commission (%)'),
                    DOM.el('input', { type: 'number', className: 'form-input', id: 'new-contract-commission', placeholder: '15' })
                ])
            ]);
            this.showModal('New Contract', form, async function() {
                var data = {
                    title: document.getElementById('new-contract-title').value,
                    partner: document.getElementById('new-contract-partner').value,
                    value: parseFloat(document.getElementById('new-contract-value').value),
                    startDate: document.getElementById('new-contract-start').value,
                    endDate: document.getElementById('new-contract-end').value,
                    commission: parseFloat(document.getElementById('new-contract-commission').value)
                };
                var result = await API.post('/api/v1/partners/contracts', data);
                if (result) { Modules.loadContractsList(); }
            });
        },

        viewContract: async function(id) { Notify.info('Viewing contract ' + id); },
        editContract: async function(id) { Notify.info('Editing contract ' + id); },
        filterContracts: function(status) { Notify.info('Filter: ' + status); Modules.loadContractsList(); },
        payCommission: async function(id) {
            var result = await API.post('/api/v1/partners/commissions/' + id + '/pay');
            if (result) { Modules.loadCommissionsTable(); }
        },
        viewCommissionDetails: function(id) { Notify.info('Commission ID: ' + id); },
        processCommissions: function() { Notify.info('Processing commissions...'); },
        startOnboarding: function() { Notify.info('Starting onboarding...'); },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // WEST MONEY BAU HANDLERS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        showNewProjectModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Project Title'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'new-project-title', placeholder: 'Smart Home Installation' })
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Project Type'),
                        DOM.el('select', { className: 'form-input', id: 'new-project-type' }, [
                            DOM.el('option', { value: 'smart_home' }, 'Smart Home'),
                            DOM.el('option', { value: 'security' }, 'Security System'),
                            DOM.el('option', { value: 'barrier_free' }, 'Barrier-Free'),
                            DOM.el('option', { value: 'renovation' }, 'Renovation')
                        ])
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Estimated Value'),
                        DOM.el('input', { type: 'number', className: 'form-input', id: 'new-project-value', placeholder: '50000' })
                    ])
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Description'),
                    DOM.el('textarea', { className: 'form-input', id: 'new-project-desc', rows: '3', placeholder: 'Project details...' })
                ])
            ]);
            this.showModal('New Project', form, async function() {
                Notify.info('Project creation submitted');
            });
        },

        viewWMBProject: async function(id) {
            var data = await API.get('http://localhost:3016/api/projects/' + id, { silent: true });
            if (data) {
                var content = DOM.el('div', {}, [
                    DOM.el('div', { className: 'grid grid-2 gap-4 mb-4' }, [
                        DOM.el('div', {}, [
                            DOM.el('div', { style: 'color: var(--text-muted);' }, 'Project Number'),
                            DOM.el('div', { style: 'font-weight: 500;' }, data.project_number || 'â€”')
                        ]),
                        DOM.el('div', {}, [
                            DOM.el('div', { style: 'color: var(--text-muted);' }, 'Status'),
                            DOM.el('div', { style: 'font-weight: 500;' }, (data.status || 'unknown').toUpperCase())
                        ])
                    ]),
                    DOM.el('div', { className: 'mb-4' }, [
                        DOM.el('div', { style: 'color: var(--text-muted);' }, 'Description'),
                        DOM.el('div', {}, data.description || 'â€”')
                    ])
                ]);
                UltimateApp.showModal(data.title || 'Project Details', content);
            }
        },

        editWMBProject: function(id) { Notify.info('Edit project ' + id); },
        viewSubcontractor: function(id) { Notify.info('View subcontractor ' + id); },
        inviteSubcontractor: function() { Notify.info('Invite subcontractor form...'); },

        generateLoxoneQuote: async function() {
            var rooms = parseInt(document.getElementById('loxone-rooms').value) || 5;
            var projectType = document.getElementById('loxone-type').value;
            var featuresSelect = document.getElementById('loxone-features');
            var features = Array.from(featuresSelect.selectedOptions).map(function(opt) { return opt.value; });

            var data = await API.post('http://localhost:3016/api/loxone/quote', {
                rooms: rooms,
                projectType: projectType,
                features: features
            }, { silent: true });

            var resultCard = document.getElementById('loxone-result');
            var contentEl = document.getElementById('loxone-quote-content');
            DOM.clear(contentEl);

            if (data && data.quote) {
                var q = data.quote;
                contentEl.appendChild(DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', {}, [
                        DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.85rem;' }, 'Hardware'),
                        DOM.el('div', { style: 'font-weight: 600; font-size: 1.25rem;' }, formatCurrency(q.hardwareCost || 0))
                    ]),
                    DOM.el('div', {}, [
                        DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.85rem;' }, 'Installation'),
                        DOM.el('div', { style: 'font-weight: 600; font-size: 1.25rem;' }, formatCurrency(q.installationCost || 0))
                    ]),
                    DOM.el('div', {}, [
                        DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.85rem;' }, 'Training'),
                        DOM.el('div', { style: 'font-weight: 600; font-size: 1.25rem;' }, formatCurrency(q.trainingCost || 0))
                    ]),
                    DOM.el('div', {}, [
                        DOM.el('div', { style: 'color: var(--text-muted); font-size: 0.85rem;' }, 'Total (excl. VAT)'),
                        DOM.el('div', { style: 'font-weight: 600; font-size: 1.5rem; color: var(--primary-color);' }, formatCurrency(q.totalExclVat || 0))
                    ])
                ]));
                resultCard.style.display = 'block';
                Notify.success('Quote generated');
            } else {
                contentEl.appendChild(DOM.el('div', { className: 'empty-state' }, 'Could not generate quote. Check if WMB server is running.'));
                resultCard.style.display = 'block';
            }
        },

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // DARK MODE TOGGLE
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        toggleDarkMode: function() {
            var html = document.documentElement;
            var icon = document.getElementById('dark-mode-icon');
            var currentTheme = html.getAttribute('data-theme');

            if (currentTheme === 'light') {
                html.removeAttribute('data-theme');
                icon.textContent = 'ğŸŒ™';
                localStorage.setItem('theme', 'dark');
                Notify.success('Dark mode activated');
            } else {
                html.setAttribute('data-theme', 'light');
                icon.textContent = 'â˜€ï¸';
                localStorage.setItem('theme', 'light');
                Notify.success('Light mode activated');
            }
        },

        initTheme: function() {
            var savedTheme = localStorage.getItem('theme');
            var icon = document.getElementById('dark-mode-icon');
            if (savedTheme === 'light') {
                document.documentElement.setAttribute('data-theme', 'light');
                if (icon) icon.textContent = 'â˜€ï¸';
            }
        },

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // NOTIFICATIONS SYSTEM
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        notifications: [],

        addNotification: function(type, title, message) {
            var notification = {
                id: Date.now(),
                type: type,
                title: title,
                message: message,
                time: new Date(),
                read: false
            };
            this.notifications.unshift(notification);
            this.updateNotificationBadge();
            return notification;
        },

        updateNotificationBadge: function() {
            var unread = this.notifications.filter(function(n) { return !n.read; }).length;
            var badge = document.getElementById('notification-count');
            if (badge) {
                if (unread > 0) {
                    badge.textContent = unread > 99 ? '99+' : unread;
                    badge.style.display = 'flex';
                } else {
                    badge.style.display = 'none';
                }
            }
        },

        showNotifications: function() {
            var self = this;
            var content = DOM.el('div', { className: 'notifications-panel' });

            if (this.notifications.length === 0) {
                content.appendChild(DOM.el('div', {
                    className: 'empty-state',
                    style: 'padding: 2rem; text-align: center;'
                }, 'No notifications yet'));
            } else {
                var list = DOM.el('div', { className: 'notification-list' });
                this.notifications.slice(0, 10).forEach(function(notif) {
                    var icon = notif.type === 'success' ? 'âœ…' :
                               notif.type === 'error' ? 'âŒ' :
                               notif.type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
                    var item = DOM.el('div', {
                        className: 'notification-item' + (notif.read ? '' : ' unread'),
                        onclick: function() {
                            notif.read = true;
                            this.classList.remove('unread');
                            self.updateNotificationBadge();
                        }
                    }, [
                        DOM.el('span', { style: 'font-size: 1.25rem;' }, icon),
                        DOM.el('div', { style: 'flex: 1;' }, [
                            DOM.el('div', { style: 'font-weight: 500;' }, notif.title),
                            DOM.el('div', { style: 'font-size: 0.85rem; color: var(--text-muted);' }, notif.message),
                            DOM.el('div', { style: 'font-size: 0.75rem; color: var(--text-dim); margin-top: 0.25rem;' },
                                self.formatTimeAgo(notif.time))
                        ])
                    ]);
                    list.appendChild(item);
                });
                content.appendChild(list);

                if (this.notifications.length > 0) {
                    var clearBtn = DOM.el('button', {
                        className: 'btn btn-secondary btn-sm',
                        style: 'width: 100%; margin-top: 1rem;',
                        onclick: function() {
                            self.notifications = [];
                            self.updateNotificationBadge();
                            UltimateApp.closeModal();
                            Notify.success('Notifications cleared');
                        }
                    }, 'Clear All');
                    content.appendChild(clearBtn);
                }
            }

            this.showModal('Notifications', content);
        },

        formatTimeAgo: function(date) {
            var now = new Date();
            var diff = Math.floor((now - date) / 1000);
            if (diff < 60) return 'Just now';
            if (diff < 3600) return Math.floor(diff / 60) + ' min ago';
            if (diff < 86400) return Math.floor(diff / 3600) + ' hours ago';
            return Math.floor(diff / 86400) + ' days ago';
        },

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // EXPORT MODAL
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        showExportModal: function() {
            var self = this;
            var content = DOM.el('div', {}, [
                DOM.el('p', { style: 'margin-bottom: 1.5rem; color: var(--text-secondary);' },
                    'Export data from the current view or select a data source:'),

                DOM.el('div', { className: 'grid grid-2 gap-3' }, [
                    DOM.el('button', {
                        className: 'btn btn-secondary',
                        style: 'display: flex; flex-direction: column; align-items: center; padding: 1.5rem;',
                        onclick: function() { self.exportData('contacts', 'csv'); }
                    }, [
                        DOM.el('span', { style: 'font-size: 2rem; margin-bottom: 0.5rem;' }, 'ğŸ‘¥'),
                        DOM.el('span', {}, 'Contacts (CSV)')
                    ]),
                    DOM.el('button', {
                        className: 'btn btn-secondary',
                        style: 'display: flex; flex-direction: column; align-items: center; padding: 1.5rem;',
                        onclick: function() { self.exportData('deals', 'csv'); }
                    }, [
                        DOM.el('span', { style: 'font-size: 2rem; margin-bottom: 0.5rem;' }, 'ğŸ’°'),
                        DOM.el('span', {}, 'Deals (CSV)')
                    ]),
                    DOM.el('button', {
                        className: 'btn btn-secondary',
                        style: 'display: flex; flex-direction: column; align-items: center; padding: 1.5rem;',
                        onclick: function() { self.exportData('invoices', 'csv'); }
                    }, [
                        DOM.el('span', { style: 'font-size: 2rem; margin-bottom: 0.5rem;' }, 'ğŸ“„'),
                        DOM.el('span', {}, 'Invoices (CSV)')
                    ]),
                    DOM.el('button', {
                        className: 'btn btn-secondary',
                        style: 'display: flex; flex-direction: column; align-items: center; padding: 1.5rem;',
                        onclick: function() { self.exportData('all', 'json'); }
                    }, [
                        DOM.el('span', { style: 'font-size: 2rem; margin-bottom: 0.5rem;' }, 'ğŸ“¦'),
                        DOM.el('span', {}, 'All Data (JSON)')
                    ])
                ])
            ]);

            this.showModal('Export Data', content);
        },

        exportData: async function(type, format) {
            Notify.info('Preparing export...');
            this.closeModal();

            try {
                var data;
                var filename;

                switch(type) {
                    case 'contacts':
                        var result = await API.get('/api/hubspot/contacts?limit=1000', { silent: true });
                        data = result.contacts || [];
                        filename = 'contacts_' + new Date().toISOString().split('T')[0];
                        break;
                    case 'deals':
                        var result = await API.get('/api/hubspot/deals?limit=1000', { silent: true });
                        data = result.deals || [];
                        filename = 'deals_' + new Date().toISOString().split('T')[0];
                        break;
                    case 'invoices':
                        data = [{ note: 'Invoice export requires backend implementation' }];
                        filename = 'invoices_' + new Date().toISOString().split('T')[0];
                        break;
                    case 'all':
                        data = {
                            exportDate: new Date().toISOString(),
                            contacts: (await API.get('/api/hubspot/contacts?limit=100', { silent: true })).contacts || [],
                            deals: (await API.get('/api/hubspot/deals?limit=100', { silent: true })).deals || []
                        };
                        filename = 'export_all_' + new Date().toISOString().split('T')[0];
                        break;
                }

                if (format === 'csv' && Array.isArray(data)) {
                    this.downloadCSV(data, filename);
                } else {
                    this.downloadJSON(data, filename);
                }

                this.addNotification('success', 'Export Complete', type + ' exported successfully');
                Notify.success('Export complete!');
            } catch (err) {
                this.addNotification('error', 'Export Failed', err.message);
                Notify.error('Export failed: ' + err.message);
            }
        },

        downloadCSV: function(data, filename) {
            if (!data.length) {
                Notify.warning('No data to export');
                return;
            }
            var headers = Object.keys(data[0].properties || data[0]);
            var rows = data.map(function(item) {
                var props = item.properties || item;
                return headers.map(function(h) {
                    var val = props[h] || '';
                    return '"' + String(val).replace(/"/g, '""') + '"';
                }).join(',');
            });
            var csv = headers.join(',') + '\n' + rows.join('\n');
            this.downloadFile(csv, filename + '.csv', 'text/csv');
        },

        downloadJSON: function(data, filename) {
            var json = JSON.stringify(data, null, 2);
            this.downloadFile(json, filename + '.json', 'application/json');
        },

        downloadFile: function(content, filename, mimeType) {
            var blob = new Blob([content], { type: mimeType });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        },

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // OFFLINE DETECTION
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        initOfflineDetection: function() {
            var self = this;
            var indicator = document.getElementById('offline-indicator');

            function updateOnlineStatus() {
                if (navigator.onLine) {
                    indicator.style.display = 'none';
                    self.addNotification('success', 'Connection Restored', 'You are back online');
                } else {
                    indicator.style.display = 'flex';
                    self.addNotification('warning', 'Offline', 'You are currently offline');
                }
            }

            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);

            // Initial check
            if (!navigator.onLine) {
                indicator.style.display = 'flex';
            }
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // INIT
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    document.addEventListener('DOMContentLoaded', function() {
        UltimateApp.init();
        UltimateApp.initTheme();
        UltimateApp.initOfflineDetection();
    });

    // Close modal on overlay click
    document.getElementById('modal-overlay').addEventListener('click', function(e) {
        if (e.target === this) {
            UltimateApp.closeModal();
        }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Ctrl+K for search
        if (e.ctrlKey && e.key === 'k') {
            e.preventDefault();
            document.getElementById('search-trigger').click();
        }

        // Ctrl+E for export
        if (e.ctrlKey && e.key === 'e') {
            e.preventDefault();
            UltimateApp.showExportModal();
        }

        // Ctrl+D for dark mode toggle
        if (e.ctrlKey && e.key === 'd') {
            e.preventDefault();
            UltimateApp.toggleDarkMode();
        }

        // Ctrl+N for notifications
        if (e.ctrlKey && e.key === 'n') {
            e.preventDefault();
            UltimateApp.showNotifications();
        }

        // Escape to close modal
        if (e.key === 'Escape') {
            UltimateApp.closeModal();
        }

        // Navigation shortcuts (Alt + number)
        if (e.altKey) {
            switch(e.key) {
                case '1': location.hash = '#/'; break;
                case '2': location.hash = '#/crm/contacts'; break;
                case '3': location.hash = '#/sales/deals'; break;
                case '4': location.hash = '#/email/hub'; break;
                case '5': location.hash = '#/finance/invoices'; break;
            }
        }
    });
    </script>
</body>
</html>
