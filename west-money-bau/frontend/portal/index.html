<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kundenportal | West Money Bau</title>
    <meta name="description" content="West Money Bau Kundenportal - Verwalten Sie Ihre Projekte, Dokumente und Rechnungen.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bau-primary: #00c853;
            --bau-secondary: #ff6d00;
            --bau-accent: #00b0ff;
            --bau-dark: #0a1628;
            --bau-surface: #112240;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bau-dark);
            color: #fff;
            min-height: 100vh;
        }

        .gradient-text {
            background: linear-gradient(135deg, #00c853, #00b0ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-gradient {
            background: radial-gradient(ellipse at top, rgba(0, 200, 83, 0.1) 0%, transparent 50%),
                        radial-gradient(ellipse at bottom right, rgba(0, 176, 255, 0.08) 0%, transparent 50%);
        }

        .glass {
            background: rgba(17, 34, 64, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--bau-primary), #00e676);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 200, 83, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .input-field {
            background: rgba(17, 34, 64, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .input-field:focus {
            border-color: var(--bau-primary);
            box-shadow: 0 0 0 3px rgba(0, 200, 83, 0.1);
            outline: none;
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 30px rgba(0, 200, 83, 0.15);
            border-color: rgba(0, 200, 83, 0.3);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-inquiry { background: rgba(0, 176, 255, 0.2); color: #00b0ff; }
        .status-quoted { background: rgba(255, 171, 0, 0.2); color: #ffab00; }
        .status-approved { background: rgba(0, 200, 83, 0.2); color: #00c853; }
        .status-in_progress { background: rgba(156, 39, 176, 0.2); color: #ab47bc; }
        .status-completed { background: rgba(0, 200, 83, 0.3); color: #69f0ae; }

        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--bau-primary);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .project-card {
            background: rgba(255, 255, 255, 0.05);
            transition: background 0.3s ease;
        }

        .project-card:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Hide sections by default */
        #login-section, #dashboard-section { display: none; }
        #login-section.active, #dashboard-section.active { display: block; }
    </style>
</head>
<body class="hero-gradient">
    <!-- Navigation -->
    <nav class="glass sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <a href="/" class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-green-500 to-blue-500 flex items-center justify-center font-bold text-lg">
                        WMB
                    </div>
                    <div>
                        <span class="font-semibold text-white">West Money Bau</span>
                        <span class="text-xs text-green-400 block">Kundenportal</span>
                    </div>
                </a>
                <div class="flex items-center gap-4">
                    <a href="/" class="text-gray-400 hover:text-white transition text-sm">Zur Startseite</a>
                    <button id="logout-btn" class="hidden text-gray-400 hover:text-white transition text-sm">Abmelden</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Login Section -->
    <section id="login-section" class="active min-h-[calc(100vh-64px)] flex items-center justify-center px-4 py-12">
        <div class="w-full max-w-md">
            <div class="glass rounded-2xl p-8 fade-in">
                <div class="text-center mb-8">
                    <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-green-500 to-blue-500 flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold mb-2">Willkommen zurueck</h1>
                    <p class="text-gray-400">Melden Sie sich an, um Ihre Projekte zu verwalten</p>
                </div>

                <form id="login-form" class="space-y-5">
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">E-Mail Adresse</label>
                        <input type="email" id="login-email" required
                            class="input-field w-full px-4 py-3 rounded-xl text-white placeholder-gray-500"
                            placeholder="ihre.email@beispiel.de">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-300 mb-2">Passwort</label>
                        <input type="password" id="login-password" required
                            class="input-field w-full px-4 py-3 rounded-xl text-white placeholder-gray-500"
                            placeholder="Ihr Passwort">
                    </div>
                    <div class="flex items-center justify-between text-sm">
                        <label class="flex items-center gap-2 text-gray-400">
                            <input type="checkbox" class="rounded border-gray-600">
                            <span>Angemeldet bleiben</span>
                        </label>
                        <a href="#" class="text-green-400 hover:text-green-300 transition">Passwort vergessen?</a>
                    </div>
                    <div id="login-error" class="hidden text-red-400 text-sm text-center py-2 px-4 bg-red-900/20 rounded-lg"></div>
                    <button type="submit" id="login-submit" class="btn-primary w-full py-3 rounded-xl font-semibold text-white flex items-center justify-center gap-2">
                        <span>Anmelden</span>
                        <div id="login-spinner" class="loading-spinner hidden"></div>
                    </button>
                </form>

                <div class="mt-8 pt-6 border-t border-white/10 text-center">
                    <p class="text-gray-400 text-sm">
                        Noch kein Kunde?
                        <a href="/#contact" class="text-green-400 hover:text-green-300 transition">Projekt anfragen</a>
                    </p>
                </div>
            </div>

            <!-- Demo Login Info -->
            <div class="mt-6 glass rounded-xl p-4 text-center text-sm">
                <p class="text-gray-400 mb-2">Demo-Zugang:</p>
                <p class="text-gray-300">E-Mail: <span class="text-green-400">demo@west-money-bau.de</span></p>
                <p class="text-gray-300">Passwort: <span class="text-green-400">demo2024</span></p>
            </div>
        </div>
    </section>

    <!-- Dashboard Section -->
    <section id="dashboard-section" class="min-h-[calc(100vh-64px)] px-4 py-8">
        <div class="max-w-7xl mx-auto">
            <!-- Welcome Header -->
            <div class="mb-8 fade-in">
                <h1 class="text-3xl font-bold mb-2">Guten Tag, <span id="user-name" class="gradient-text">Kunde</span></h1>
                <p class="text-gray-400">Hier finden Sie eine Uebersicht Ihrer Projekte und Dokumente.</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="glass rounded-xl p-5 card-hover fade-in" style="animation-delay: 0.1s">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center">
                            <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                            </svg>
                        </div>
                        <div>
                            <p class="text-2xl font-bold" id="stat-projects">0</p>
                            <p class="text-gray-400 text-sm">Projekte</p>
                        </div>
                    </div>
                </div>
                <div class="glass rounded-xl p-5 card-hover fade-in" style="animation-delay: 0.2s">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-xl bg-green-500/20 flex items-center justify-center">
                            <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div>
                            <p class="text-2xl font-bold" id="stat-completed">0</p>
                            <p class="text-gray-400 text-sm">Abgeschlossen</p>
                        </div>
                    </div>
                </div>
                <div class="glass rounded-xl p-5 card-hover fade-in" style="animation-delay: 0.3s">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center">
                            <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                        </div>
                        <div>
                            <p class="text-2xl font-bold" id="stat-in-progress">0</p>
                            <p class="text-gray-400 text-sm">In Bearbeitung</p>
                        </div>
                    </div>
                </div>
                <div class="glass rounded-xl p-5 card-hover fade-in" style="animation-delay: 0.4s">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-xl bg-yellow-500/20 flex items-center justify-center">
                            <svg class="w-6 h-6 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                        <div>
                            <p class="text-2xl font-bold" id="stat-documents">0</p>
                            <p class="text-gray-400 text-sm">Dokumente</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Projects List -->
            <div class="glass rounded-2xl p-6 mb-8 fade-in" style="animation-delay: 0.5s">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold">Meine Projekte</h2>
                    <a href="/#contact" class="text-sm text-green-400 hover:text-green-300 transition flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                        </svg>
                        Neues Projekt
                    </a>
                </div>
                <div id="projects-list" class="space-y-4">
                    <!-- Projects will be loaded here via DOM manipulation -->
                </div>
                <div id="no-projects" class="hidden text-center py-12">
                    <div class="w-16 h-16 rounded-full bg-gray-800 flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                    </div>
                    <h3 class="text-lg font-semibold mb-2">Noch keine Projekte</h3>
                    <p class="text-gray-400 mb-4">Starten Sie Ihr erstes Projekt mit uns!</p>
                    <a href="/#contact" class="btn-primary inline-block px-6 py-2 rounded-lg text-sm font-semibold">
                        Projekt anfragen
                    </a>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 fade-in" style="animation-delay: 0.6s">
                <a href="/#contact" class="glass rounded-xl p-5 card-hover flex items-center gap-4">
                    <div class="w-12 h-12 rounded-xl bg-green-500/20 flex items-center justify-center">
                        <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                    </div>
                    <div>
                        <h3 class="font-semibold">Kontakt aufnehmen</h3>
                        <p class="text-gray-400 text-sm">Fragen zu Ihrem Projekt?</p>
                    </div>
                </a>
                <a href="tel:+4922112345678" class="glass rounded-xl p-5 card-hover flex items-center gap-4">
                    <div class="w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center">
                        <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                    </div>
                    <div>
                        <h3 class="font-semibold">Anrufen</h3>
                        <p class="text-gray-400 text-sm">+49 221 123 456 78</p>
                    </div>
                </a>
                <a href="mailto:info@west-money-bau.de" class="glass rounded-xl p-5 card-hover flex items-center gap-4">
                    <div class="w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center">
                        <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <div>
                        <h3 class="font-semibold">E-Mail senden</h3>
                        <p class="text-gray-400 text-sm">info@west-money-bau.de</p>
                    </div>
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="glass mt-12 py-6">
        <div class="max-w-7xl mx-auto px-4 text-center text-gray-400 text-sm">
            <p>&copy; 2024-2026 West Money Bau GmbH. Alle Rechte vorbehalten.</p>
            <div class="flex justify-center gap-4 mt-2">
                <a href="/impressum" class="hover:text-white transition">Impressum</a>
                <a href="/datenschutz" class="hover:text-white transition">Datenschutz</a>
                <a href="/agb" class="hover:text-white transition">AGB</a>
            </div>
        </div>
    </footer>

    <script>
        // State management
        let currentUser = null;
        let userProjects = [];

        // DOM Elements
        const loginSection = document.getElementById('login-section');
        const dashboardSection = document.getElementById('dashboard-section');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const loginSpinner = document.getElementById('login-spinner');
        const loginSubmit = document.getElementById('login-submit');
        const logoutBtn = document.getElementById('logout-btn');

        // Check for existing session
        function checkSession() {
            const session = localStorage.getItem('wmb_session');
            if (session) {
                try {
                    currentUser = JSON.parse(session);
                    showDashboard();
                } catch (e) {
                    localStorage.removeItem('wmb_session');
                }
            }
        }

        // Login handler
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            // Show loading state
            loginSpinner.classList.remove('hidden');
            loginSubmit.disabled = true;
            loginError.classList.add('hidden');

            try {
                // Simulate API call - in production, call /api/auth/login
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Demo login check
                if (email === 'demo@west-money-bau.de' && password === 'demo2024') {
                    currentUser = {
                        id: 'demo-user',
                        name: 'Max Mustermann',
                        email: email,
                        company: 'Mustermann GmbH'
                    };

                    // Demo projects
                    userProjects = [
                        {
                            id: 1,
                            name: 'Smart Home Installation',
                            type: 'smart_home',
                            status: 'in_progress',
                            created_at: '2024-11-15',
                            description: 'LOXONE Miniserver mit Lichtsteuerung und Klimaautomation',
                            estimated_value: 24500
                        },
                        {
                            id: 2,
                            name: 'Sicherheitssystem Erweiterung',
                            type: 'security',
                            status: 'quoted',
                            created_at: '2024-12-01',
                            description: 'Videoueberwachung und Zutrittskontrolle',
                            estimated_value: 8900
                        },
                        {
                            id: 3,
                            name: 'Barrierefreier Badumbau',
                            type: 'barrier_free',
                            status: 'completed',
                            created_at: '2024-08-20',
                            description: 'Kompletter Badumbau nach DIN 18040',
                            estimated_value: 32000
                        }
                    ];

                    localStorage.setItem('wmb_session', JSON.stringify(currentUser));
                    showDashboard();
                } else {
                    // Try real API login
                    const response = await fetch('/api/customers/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        currentUser = data.customer;
                        userProjects = data.projects || [];
                        localStorage.setItem('wmb_session', JSON.stringify(currentUser));
                        showDashboard();
                    } else {
                        throw new Error('Ungueltige Anmeldedaten');
                    }
                }
            } catch (error) {
                loginError.textContent = error.message || 'Anmeldung fehlgeschlagen. Bitte pruefen Sie Ihre Daten.';
                loginError.classList.remove('hidden');
            } finally {
                loginSpinner.classList.add('hidden');
                loginSubmit.disabled = false;
            }
        });

        // Logout handler
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('wmb_session');
            currentUser = null;
            userProjects = [];
            showLogin();
        });

        // Show login section
        function showLogin() {
            loginSection.classList.add('active');
            dashboardSection.classList.remove('active');
            logoutBtn.classList.add('hidden');
            document.getElementById('login-email').value = '';
            document.getElementById('login-password').value = '';
        }

        // Show dashboard section
        function showDashboard() {
            loginSection.classList.remove('active');
            dashboardSection.classList.add('active');
            logoutBtn.classList.remove('hidden');

            // Update user name using textContent (safe)
            document.getElementById('user-name').textContent = currentUser.name || 'Kunde';

            // Load projects
            renderProjects();
            updateStats();
        }

        // Create a project card element using safe DOM methods
        function createProjectCard(project) {
            const card = document.createElement('div');
            card.className = 'project-card rounded-xl p-5 cursor-pointer';

            const wrapper = document.createElement('div');
            wrapper.className = 'flex items-start justify-between';

            const content = document.createElement('div');
            content.className = 'flex-1';

            // Header row with name and status
            const headerRow = document.createElement('div');
            headerRow.className = 'flex items-center gap-3 mb-2';

            const nameEl = document.createElement('h3');
            nameEl.className = 'font-semibold';
            nameEl.textContent = project.name;

            const statusBadge = document.createElement('span');
            statusBadge.className = 'status-badge status-' + project.status;
            statusBadge.textContent = getStatusLabel(project.status);

            headerRow.appendChild(nameEl);
            headerRow.appendChild(statusBadge);

            // Description
            const descEl = document.createElement('p');
            descEl.className = 'text-gray-400 text-sm mb-2';
            descEl.textContent = project.description;

            // Meta info
            const metaRow = document.createElement('div');
            metaRow.className = 'flex items-center gap-4 text-xs text-gray-500';

            const typeSpan = document.createElement('span');
            typeSpan.textContent = getTypeLabel(project.type);
            metaRow.appendChild(typeSpan);

            const dateSpan = document.createElement('span');
            dateSpan.textContent = 'Erstellt: ' + formatDate(project.created_at);
            metaRow.appendChild(dateSpan);

            if (project.estimated_value) {
                const valueSpan = document.createElement('span');
                valueSpan.className = 'text-green-400';
                valueSpan.textContent = '~' + formatCurrency(project.estimated_value);
                metaRow.appendChild(valueSpan);
            }

            content.appendChild(headerRow);
            content.appendChild(descEl);
            content.appendChild(metaRow);

            // Arrow icon
            const arrowSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            arrowSvg.setAttribute('class', 'w-5 h-5 text-gray-500');
            arrowSvg.setAttribute('fill', 'none');
            arrowSvg.setAttribute('stroke', 'currentColor');
            arrowSvg.setAttribute('viewBox', '0 0 24 24');
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('stroke-linecap', 'round');
            path.setAttribute('stroke-linejoin', 'round');
            path.setAttribute('stroke-width', '2');
            path.setAttribute('d', 'M9 5l7 7-7 7');
            arrowSvg.appendChild(path);

            wrapper.appendChild(content);
            wrapper.appendChild(arrowSvg);
            card.appendChild(wrapper);

            return card;
        }

        // Render projects list using safe DOM manipulation
        function renderProjects() {
            const projectsList = document.getElementById('projects-list');
            const noProjects = document.getElementById('no-projects');

            // Clear existing content
            projectsList.replaceChildren();

            if (userProjects.length === 0) {
                noProjects.classList.remove('hidden');
                return;
            }

            noProjects.classList.add('hidden');

            // Create and append project cards using safe DOM methods
            userProjects.forEach(project => {
                const card = createProjectCard(project);
                projectsList.appendChild(card);
            });
        }

        // Update statistics
        function updateStats() {
            const completed = userProjects.filter(p => p.status === 'completed').length;
            const inProgress = userProjects.filter(p => ['in_progress', 'approved'].includes(p.status)).length;

            document.getElementById('stat-projects').textContent = userProjects.length;
            document.getElementById('stat-completed').textContent = completed;
            document.getElementById('stat-in-progress').textContent = inProgress;
            document.getElementById('stat-documents').textContent = userProjects.length * 2; // Estimate
        }

        // Helper functions
        function getStatusLabel(status) {
            const labels = {
                'inquiry': 'Anfrage',
                'quoted': 'Angebot',
                'approved': 'Genehmigt',
                'in_progress': 'In Bearbeitung',
                'completed': 'Abgeschlossen'
            };
            return labels[status] || status;
        }

        function getTypeLabel(type) {
            const labels = {
                'smart_home': 'Smart Home',
                'barrier_free': 'Barrierefreies Bauen',
                'security': 'Sicherheitssystem',
                'combination': 'Kombination'
            };
            return labels[type] || type;
        }

        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('de-DE', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('de-DE', {
                style: 'currency',
                currency: 'EUR'
            }).format(value);
        }

        // Initialize
        checkSession();
    </script>
</body>
</html>
