<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Enterprise Universe - Ultimate Dashboard - Complete Business Management System">
    <meta name="theme-color" content="#0a0a0f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="robots" content="noindex, nofollow">
    <title>ULTIMATE DASHBOARD | Enterprise Universe</title>

    <!-- Auth Guard -->
    <!-- Auth disabled for demo: <script src="/js/auth-guard.js"></script> -->

    <!-- External Resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Ultimate Dashboard Styles -->
    <link href="/styles/ultimate.css" rel="stylesheet">
</head>
<body>
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MEGA MENU HEADER
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <header class="header">
        <!-- Brand -->
        <a href="#/" class="header-brand">
            <div class="header-logo">U</div>
            <div>
                <div class="header-title">ULTIMATE</div>
                <div class="header-subtitle">Command Center</div>
            </div>
        </a>

        <!-- Mega Menu Navigation -->
        <nav class="mega-menu" id="mega-menu">
            <!-- Dashboard -->
            <div class="menu-item">
                <a href="#/" class="menu-trigger" data-route="/">
                    <span class="icon">ğŸ </span>
                    <span>Dashboard</span>
                </a>
            </div>

            <!-- CRM -->
            <div class="menu-item">
                <button class="menu-trigger">
                    <span class="icon">ğŸ‘¤</span>
                    <span>CRM</span>
                    <span class="arrow">â–¼</span>
                </button>
                <div class="menu-dropdown">
                    <a href="#/crm/contacts" class="dropdown-item">
                        <span class="icon">ğŸ‘¥</span>
                        <span>Contacts</span>
                    </a>
                    <a href="#/crm/companies" class="dropdown-item">
                        <span class="icon">ğŸ¢</span>
                        <span>Companies</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#/crm/scoring" class="dropdown-item">
                        <span class="icon">â­</span>
                        <span>Lead Scoring</span>
                    </a>
                </div>
            </div>

            <!-- Sales -->
            <div class="menu-item">
                <button class="menu-trigger">
                    <span class="icon">ğŸ’°</span>
                    <span>Sales</span>
                    <span class="arrow">â–¼</span>
                </button>
                <div class="menu-dropdown">
                    <a href="#/sales/deals" class="dropdown-item">
                        <span class="icon">ğŸ“Š</span>
                        <span>Deals Pipeline</span>
                    </a>
                    <a href="#/sales/leads" class="dropdown-item">
                        <span class="icon">ğŸ¯</span>
                        <span>Lead Discovery</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#/sales/proposals" class="dropdown-item">
                        <span class="icon">ğŸ“„</span>
                        <span>Proposals</span>
                    </a>
                </div>
            </div>

            <!-- Communication -->
            <div class="menu-item">
                <button class="menu-trigger">
                    <span class="icon">ğŸ“§</span>
                    <span>Communication</span>
                    <span class="arrow">â–¼</span>
                </button>
                <div class="menu-dropdown">
                    <a href="#/email" class="dropdown-item">
                        <span class="icon">ğŸ“§</span>
                        <span>Email Hub</span>
                    </a>
                    <a href="#/whatsapp" class="dropdown-item">
                        <span class="icon">ğŸ“±</span>
                        <span>WhatsApp</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#/campaigns" class="dropdown-item">
                        <span class="icon">ğŸš€</span>
                        <span>Campaigns</span>
                    </a>
                </div>
            </div>

            <!-- AI -->
            <div class="menu-item">
                <button class="menu-trigger">
                    <span class="icon">ğŸ¤–</span>
                    <span>AI</span>
                    <span class="arrow">â–¼</span>
                </button>
                <div class="menu-dropdown">
                    <a href="#/ai/bots" class="dropdown-item">
                        <span class="icon">ğŸ¤–</span>
                        <span>Genius Bots</span>
                    </a>
                    <a href="#/ai/haiku" class="dropdown-item">
                        <span class="icon">ğŸ’</span>
                        <span>HAIKU God Mode</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#/ai/prophecy" class="dropdown-item">
                        <span class="icon">ğŸ”®</span>
                        <span>Prophecy</span>
                    </a>
                </div>
            </div>

            <!-- Finance -->
            <div class="menu-item">
                <button class="menu-trigger">
                    <span class="icon">ğŸ’³</span>
                    <span>Finance</span>
                    <span class="arrow">â–¼</span>
                </button>
                <div class="menu-dropdown">
                    <a href="#/finance/cashflow" class="dropdown-item">
                        <span class="icon">ğŸ“ˆ</span>
                        <span>Cashflow</span>
                    </a>
                    <a href="#/finance/invoices" class="dropdown-item">
                        <span class="icon">ğŸ“„</span>
                        <span>Invoices</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#/finance/stripe" class="dropdown-item">
                        <span class="icon">ğŸ’³</span>
                        <span>Stripe</span>
                    </a>
                </div>
            </div>

            <!-- System -->
            <div class="menu-item">
                <button class="menu-trigger">
                    <span class="icon">âš™ï¸</span>
                    <span>System</span>
                    <span class="arrow">â–¼</span>
                </button>
                <div class="menu-dropdown">
                    <a href="#/integrations" class="dropdown-item">
                        <span class="icon">ğŸ”—</span>
                        <span>Integrations</span>
                    </a>
                    <a href="#/settings" class="dropdown-item">
                        <span class="icon">âš™ï¸</span>
                        <span>Settings</span>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#/docs" class="dropdown-item">
                        <span class="icon">ğŸ“š</span>
                        <span>Documentation</span>
                    </a>
                </div>
            </div>
        </nav>

        <!-- Header Actions -->
        <div class="header-actions">
            <div class="header-search" id="search-trigger">
                <span>ğŸ”</span>
                <span>Search...</span>
                <kbd>Ctrl+K</kbd>
            </div>
            <div class="header-status">
                <span class="status-dot"></span>
                <span id="haiku-status-text">HAIKU ONLINE</span>
            </div>
            <button class="btn-god-mode" onclick="location.hash='#/ai/haiku'">
                GOD MODE
            </button>
        </div>
    </header>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MAIN CONTENT AREA (SPA Router Target)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <main class="main-content">
        <div class="content-wrapper" id="app-content">
            <!-- Content loaded dynamically by router -->
            <div class="loading-skeleton" style="height: 200px;"></div>
        </div>
    </main>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         STATUS BAR
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <footer class="status-bar">
        <div class="status-bar-left">
            <span class="status-item connected" id="status-hubspot">
                <span class="status-dot"></span> HubSpot
            </span>
            <span class="status-item connected" id="status-whatsapp">
                <span class="status-dot"></span> WhatsApp
            </span>
            <span class="status-item connected" id="status-stripe">
                <span class="status-dot"></span> Stripe
            </span>
        </div>
        <div class="status-bar-right">
            <span id="last-sync">Last sync: --</span>
            <span id="current-user">User: Admin</span>
        </div>
    </footer>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MODAL CONTAINER
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal" id="modal-container">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Modal</h3>
                <button class="modal-close" onclick="UltimateApp.closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Modal content loaded dynamically -->
            </div>
            <div class="modal-footer" id="modal-footer">
                <button class="btn btn-secondary" onclick="UltimateApp.closeModal()">Cancel</button>
                <button class="btn btn-primary" id="modal-confirm">Confirm</button>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         JAVASCRIPT - SPA Core
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script>
    /**
     * ULTIMATE DASHBOARD - Main Application
     * Single Page Application with Mega Menu Navigation
     */

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // UTILITY FUNCTIONS
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    function escapeHtml(text) {
        if (!text) return '';
        var div = document.createElement('div');
        div.textContent = String(text);
        return div.innerHTML;
    }

    function formatCurrency(value, currency) {
        if (value === null || value === undefined) return '-';
        currency = currency || 'EUR';
        return new Intl.NumberFormat('de-DE', {
            style: 'currency',
            currency: currency,
            minimumFractionDigits: 0,
            maximumFractionDigits: 0
        }).format(value);
    }

    function formatNumber(value) {
        if (value === null || value === undefined) return '-';
        return new Intl.NumberFormat('de-DE').format(value);
    }

    function formatDate(dateStr) {
        if (!dateStr) return '-';
        return new Date(dateStr).toLocaleDateString('de-DE');
    }

    function formatDateTime(dateStr) {
        if (!dateStr) return '-';
        return new Date(dateStr).toLocaleString('de-DE');
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // API SERVICE
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    var API = {
        baseUrl: '',

        async get(endpoint) {
            try {
                var response = await fetch(this.baseUrl + endpoint);
                if (!response.ok) throw new Error('API Error: ' + response.status);
                return await response.json();
            } catch (error) {
                console.error('API GET Error:', endpoint, error);
                return null;
            }
        },

        async post(endpoint, data) {
            try {
                var response = await fetch(this.baseUrl + endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) throw new Error('API Error: ' + response.status);
                return await response.json();
            } catch (error) {
                console.error('API POST Error:', endpoint, error);
                return null;
            }
        },

        async patch(endpoint, data) {
            try {
                var response = await fetch(this.baseUrl + endpoint, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (!response.ok) throw new Error('API Error: ' + response.status);
                return await response.json();
            } catch (error) {
                console.error('API PATCH Error:', endpoint, error);
                return null;
            }
        },

        async delete(endpoint) {
            try {
                var response = await fetch(this.baseUrl + endpoint, {
                    method: 'DELETE'
                });
                if (!response.ok) throw new Error('API Error: ' + response.status);
                return true;
            } catch (error) {
                console.error('API DELETE Error:', endpoint, error);
                return false;
            }
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // DOM HELPER
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    var DOM = {
        el: function(tag, attrs, children) {
            var element = document.createElement(tag);
            if (attrs) {
                Object.keys(attrs).forEach(function(key) {
                    if (key === 'className') {
                        element.className = attrs[key];
                    } else if (key === 'onclick' || key === 'onchange') {
                        element[key] = attrs[key];
                    } else if (key === 'dataset') {
                        Object.keys(attrs[key]).forEach(function(dataKey) {
                            element.dataset[dataKey] = attrs[key][dataKey];
                        });
                    } else {
                        element.setAttribute(key, attrs[key]);
                    }
                });
            }
            if (children) {
                if (typeof children === 'string') {
                    element.textContent = children;
                } else if (Array.isArray(children)) {
                    children.forEach(function(child) {
                        if (child) element.appendChild(child);
                    });
                } else {
                    element.appendChild(children);
                }
            }
            return element;
        },

        clear: function(container) {
            while (container.firstChild) {
                container.removeChild(container.firstChild);
            }
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ROUTER
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    var Router = {
        routes: {
            '/': 'renderDashboard',
            '/crm/contacts': 'renderContacts',
            '/crm/companies': 'renderCompanies',
            '/crm/scoring': 'renderLeadScoring',
            '/sales/deals': 'renderDeals',
            '/sales/leads': 'renderLeadDiscovery',
            '/sales/proposals': 'renderProposals',
            '/email': 'renderEmailHub',
            '/whatsapp': 'renderWhatsApp',
            '/campaigns': 'renderCampaigns',
            '/ai/bots': 'renderBots',
            '/ai/haiku': 'renderHaiku',
            '/ai/prophecy': 'renderProphecy',
            '/finance/cashflow': 'renderCashflow',
            '/finance/invoices': 'renderInvoices',
            '/finance/stripe': 'renderStripe',
            '/integrations': 'renderIntegrations',
            '/settings': 'renderSettings',
            '/docs': 'renderDocs'
        },

        init: function() {
            var self = this;
            window.addEventListener('hashchange', function() {
                self.navigate();
            });
            this.navigate();
        },

        navigate: function() {
            var hash = window.location.hash || '#/';
            var path = hash.replace('#', '') || '/';

            // Update active menu item
            this.updateActiveMenu(path);

            // Find matching route
            var handler = this.routes[path];
            if (handler && typeof Modules[handler] === 'function') {
                Modules[handler]();
            } else {
                Modules.render404();
            }

            // Scroll to top
            window.scrollTo(0, 0);
        },

        updateActiveMenu: function(path) {
            // Remove all active states
            document.querySelectorAll('.menu-trigger, .dropdown-item').forEach(function(el) {
                el.classList.remove('active');
            });

            // Add active to current
            var selector = '[href="#' + path + '"]';
            var activeEl = document.querySelector(selector);
            if (activeEl) {
                activeEl.classList.add('active');
                // Also highlight parent menu trigger
                var menuItem = activeEl.closest('.menu-item');
                if (menuItem) {
                    var trigger = menuItem.querySelector('.menu-trigger');
                    if (trigger) trigger.classList.add('active');
                }
            }
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // MODULES (Page Renderers)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    var Modules = {
        container: function() {
            return document.getElementById('app-content');
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // DASHBOARD
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderDashboard: async function() {
            var container = this.container();
            DOM.clear(container);

            // Page Header
            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Dashboard'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Business Overview')
                ]),
                DOM.el('div', { className: 'page-actions' }, [
                    DOM.el('button', { className: 'btn btn-secondary', onclick: function() { location.reload(); } }, 'Refresh'),
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { location.hash = '#/sales/deals'; } }, '+ New Deal')
                ])
            ]);
            container.appendChild(header);

            // KPI Grid
            var kpiGrid = DOM.el('div', { className: 'grid grid-4 mb-4', id: 'kpi-grid' });
            container.appendChild(kpiGrid);

            // Load KPI data
            this.loadDashboardKPIs(kpiGrid);

            // Two Column Layout
            var twoCol = DOM.el('div', { className: 'grid grid-2', style: 'margin-top: 1.5rem;' });
            container.appendChild(twoCol);

            // Recent Contacts Card
            var contactsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'ğŸ‘¥ Recent Contacts'),
                    DOM.el('a', { href: '#/crm/contacts', className: 'btn btn-ghost btn-sm' }, 'View All')
                ]),
                DOM.el('div', { className: 'card-body', id: 'recent-contacts' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 200px;' })
                ])
            ]);
            twoCol.appendChild(contactsCard);

            // Pipeline Overview Card
            var pipelineCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'ğŸ“Š Pipeline Overview'),
                    DOM.el('a', { href: '#/sales/deals', className: 'btn btn-ghost btn-sm' }, 'View Pipeline')
                ]),
                DOM.el('div', { className: 'card-body', id: 'pipeline-overview' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 200px;' })
                ])
            ]);
            twoCol.appendChild(pipelineCard);

            // Load data
            this.loadRecentContacts();
            this.loadPipelineOverview();

            // Quick Actions
            var quickActions = DOM.el('div', { className: 'card', style: 'margin-top: 1.5rem;' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'âš¡ Quick Actions')
                ]),
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'grid grid-6' }, [
                        DOM.el('a', { href: '#/crm/contacts', className: 'btn btn-secondary' }, 'ğŸ‘¤ Contacts'),
                        DOM.el('a', { href: '#/sales/deals', className: 'btn btn-secondary' }, 'ğŸ’° Deals'),
                        DOM.el('a', { href: '#/email', className: 'btn btn-secondary' }, 'ğŸ“§ Email'),
                        DOM.el('a', { href: '#/ai/bots', className: 'btn btn-secondary' }, 'ğŸ¤– Bots'),
                        DOM.el('a', { href: '#/finance/invoices', className: 'btn btn-secondary' }, 'ğŸ“„ Invoices'),
                        DOM.el('a', { href: '#/ai/haiku', className: 'btn btn-secondary' }, 'ğŸ’ God Mode')
                    ])
                ])
            ]);
            container.appendChild(quickActions);
        },

        loadDashboardKPIs: async function(grid) {
            var data = await API.get('/api/overview');
            DOM.clear(grid);

            var metrics = data && data.metrics ? data.metrics : {};

            var kpis = [
                { label: 'Revenue', value: metrics.revenue ? metrics.revenue.value : '-', change: metrics.revenue ? metrics.revenue.change : '', type: 'primary', icon: 'ğŸ’°' },
                { label: 'Pipeline', value: metrics.pipeline ? metrics.pipeline.value : '-', change: metrics.pipeline ? metrics.pipeline.change : '', type: 'success', icon: 'ğŸ“ˆ' },
                { label: 'Contacts', value: metrics.contacts ? formatNumber(metrics.contacts.value) : '-', change: metrics.contacts ? '+' + metrics.contacts.change : '', type: 'info', icon: 'ğŸ‘¥' },
                { label: 'Tasks Today', value: metrics.tasksToday || '0', change: 'active', type: 'warning', icon: 'âœ…' }
            ];

            kpis.forEach(function(kpi) {
                var card = DOM.el('div', { className: 'kpi-card ' + kpi.type + ' animate-slide-up' }, [
                    DOM.el('div', { className: 'kpi-header' }, [
                        DOM.el('span', { className: 'kpi-label' }, kpi.label),
                        DOM.el('span', { className: 'kpi-icon' }, kpi.icon)
                    ]),
                    DOM.el('div', { className: 'kpi-value' }, kpi.value),
                    DOM.el('div', { className: 'kpi-change positive' }, kpi.change)
                ]);
                grid.appendChild(card);
            });
        },

        loadRecentContacts: async function() {
            var container = document.getElementById('recent-contacts');
            var data = await API.get('/api/hubspot/contacts?limit=5');
            DOM.clear(container);

            if (!data || !data.results || data.results.length === 0) {
                container.appendChild(DOM.el('div', { className: 'empty-state' }, [
                    DOM.el('div', { className: 'empty-state-icon' }, 'ğŸ‘¤'),
                    DOM.el('div', { className: 'empty-state-title' }, 'No contacts yet'),
                    DOM.el('div', { className: 'empty-state-text' }, 'Add your first contact to get started')
                ]));
                return;
            }

            var list = DOM.el('div', { className: 'flex flex-col gap-2' });
            data.results.forEach(function(contact) {
                var props = contact.properties || {};
                var name = [props.firstname, props.lastname].filter(Boolean).join(' ') || 'Unknown';
                var initials = name.split(' ').map(function(n) { return n[0]; }).join('').toUpperCase().slice(0, 2);

                var row = DOM.el('div', { className: 'flex items-center gap-3', style: 'padding: 0.5rem; border-radius: 8px; cursor: pointer;', onclick: function() { UltimateApp.showContactDetail(contact.id); } }, [
                    DOM.el('div', { className: 'contact-avatar', style: 'width: 36px; height: 36px; border-radius: 50%; background: linear-gradient(135deg, #8b5cf6, #3b82f6); display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 600;' }, initials),
                    DOM.el('div', { className: 'flex-1' }, [
                        DOM.el('div', { style: 'font-weight: 500;' }, escapeHtml(name)),
                        DOM.el('div', { style: 'font-size: 0.8rem; color: var(--text-muted);' }, escapeHtml(props.email || ''))
                    ]),
                    DOM.el('div', { style: 'font-size: 0.8rem; color: var(--text-muted);' }, escapeHtml(props.company || ''))
                ]);
                list.appendChild(row);
            });
            container.appendChild(list);
        },

        loadPipelineOverview: async function() {
            var container = document.getElementById('pipeline-overview');
            var data = await API.get('/api/hubspot/deals');
            DOM.clear(container);

            if (!data || !data.results) {
                container.textContent = 'Could not load pipeline data';
                return;
            }

            // Group by stage
            var stages = {};
            var stageNames = {
                'qualifiedtobuy': 'Qualified',
                'presentationscheduled': 'Presentation',
                'decisionmakerboughtin': 'Decision',
                'negotiation': 'Negotiation',
                'closedwon': 'Won',
                'closedlost': 'Lost'
            };

            data.results.forEach(function(deal) {
                var stage = deal.properties && deal.properties.dealstage ? deal.properties.dealstage : 'unknown';
                if (!stages[stage]) stages[stage] = { count: 0, value: 0 };
                stages[stage].count++;
                stages[stage].value += parseFloat(deal.properties && deal.properties.amount ? deal.properties.amount : 0);
            });

            var grid = DOM.el('div', { className: 'grid grid-3 gap-3' });
            Object.keys(stages).slice(0, 6).forEach(function(stage) {
                var stageName = stageNames[stage] || stage;
                var stageData = stages[stage];
                var colorClass = stage === 'closedwon' ? 'text-success' : (stage === 'closedlost' ? 'text-error' : 'text-info');

                var stageCard = DOM.el('div', { style: 'background: var(--bg-elevated); border-radius: 12px; padding: 1rem;' }, [
                    DOM.el('div', { className: 'flex justify-between items-center mb-2' }, [
                        DOM.el('span', { className: colorClass, style: 'font-weight: 500; font-size: 0.9rem;' }, stageName),
                        DOM.el('span', { style: 'font-size: 0.8rem; color: var(--text-muted);' }, String(stageData.count))
                    ]),
                    DOM.el('div', { style: 'font-size: 1.25rem; font-weight: 700;' }, formatCurrency(stageData.value))
                ]);
                grid.appendChild(stageCard);
            });
            container.appendChild(grid);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CRM - CONTACTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderContacts: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Contacts'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Manage your CRM contacts')
                ]),
                DOM.el('div', { className: 'page-actions' }, [
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewContactModal(); } }, '+ New Contact')
                ])
            ]);
            container.appendChild(header);

            // Table Card
            var card = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'table-container', id: 'contacts-table' }, [
                        DOM.el('div', { className: 'loading-skeleton', style: 'height: 300px;' })
                    ])
                ])
            ]);
            container.appendChild(card);

            this.loadContactsTable();
        },

        loadContactsTable: async function() {
            var tableContainer = document.getElementById('contacts-table');
            var data = await API.get('/api/hubspot/contacts?limit=50');
            DOM.clear(tableContainer);

            if (!data || !data.results || data.results.length === 0) {
                tableContainer.appendChild(DOM.el('div', { className: 'empty-state' }, [
                    DOM.el('div', { className: 'empty-state-icon' }, 'ğŸ‘¤'),
                    DOM.el('div', { className: 'empty-state-title' }, 'No contacts yet'),
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewContactModal(); } }, '+ Add First Contact')
                ]));
                return;
            }

            var table = DOM.el('table', { className: 'table' });

            // Header
            var thead = DOM.el('thead', {}, [
                DOM.el('tr', {}, [
                    DOM.el('th', {}, 'Name'),
                    DOM.el('th', {}, 'Email'),
                    DOM.el('th', {}, 'Company'),
                    DOM.el('th', {}, 'Phone'),
                    DOM.el('th', {}, 'Created'),
                    DOM.el('th', {}, 'Actions')
                ])
            ]);
            table.appendChild(thead);

            // Body
            var tbody = DOM.el('tbody');
            data.results.forEach(function(contact) {
                var props = contact.properties || {};
                var name = [props.firstname, props.lastname].filter(Boolean).join(' ') || 'Unknown';

                var row = DOM.el('tr', {}, [
                    DOM.el('td', { style: 'font-weight: 500;' }, escapeHtml(name)),
                    DOM.el('td', {}, escapeHtml(props.email || '-')),
                    DOM.el('td', {}, escapeHtml(props.company || '-')),
                    DOM.el('td', {}, escapeHtml(props.phone || '-')),
                    DOM.el('td', {}, formatDate(props.createdate)),
                    DOM.el('td', {}, [
                        DOM.el('button', { className: 'btn btn-ghost btn-sm', onclick: function() { UltimateApp.showContactDetail(contact.id); } }, 'View'),
                        DOM.el('button', { className: 'btn btn-ghost btn-sm', onclick: function() { UltimateApp.editContact(contact.id); } }, 'Edit')
                    ])
                ]);
                tbody.appendChild(row);
            });
            table.appendChild(tbody);
            tableContainer.appendChild(table);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SALES - DEALS PIPELINE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderDeals: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Deals Pipeline'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Manage your sales pipeline')
                ]),
                DOM.el('div', { className: 'page-actions' }, [
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewDealModal(); } }, '+ New Deal')
                ])
            ]);
            container.appendChild(header);

            // Kanban Board
            var kanban = DOM.el('div', { className: 'kanban-board', id: 'deals-kanban' }, [
                DOM.el('div', { className: 'loading-skeleton', style: 'height: 400px; width: 100%;' })
            ]);
            container.appendChild(kanban);

            this.loadDealsKanban();
        },

        loadDealsKanban: async function() {
            var kanban = document.getElementById('deals-kanban');
            var data = await API.get('/api/hubspot/deals');
            DOM.clear(kanban);

            var stages = [
                { id: 'qualifiedtobuy', name: 'Qualified', color: 'var(--info)' },
                { id: 'presentationscheduled', name: 'Presentation', color: 'var(--accent-primary)' },
                { id: 'decisionmakerboughtin', name: 'Decision Maker', color: 'var(--warning)' },
                { id: 'negotiation', name: 'Negotiation', color: 'var(--accent-secondary)' },
                { id: 'closedwon', name: 'Won', color: 'var(--success)' },
                { id: 'closedlost', name: 'Lost', color: 'var(--error)' }
            ];

            // Group deals by stage
            var dealsByStage = {};
            stages.forEach(function(s) { dealsByStage[s.id] = []; });

            if (data && data.results) {
                data.results.forEach(function(deal) {
                    var stage = deal.properties && deal.properties.dealstage ? deal.properties.dealstage : 'qualifiedtobuy';
                    if (dealsByStage[stage]) {
                        dealsByStage[stage].push(deal);
                    }
                });
            }

            stages.forEach(function(stage) {
                var deals = dealsByStage[stage.id] || [];
                var totalValue = deals.reduce(function(sum, d) {
                    return sum + parseFloat(d.properties && d.properties.amount ? d.properties.amount : 0);
                }, 0);

                var column = DOM.el('div', { className: 'kanban-column', dataset: { stage: stage.id } }, [
                    DOM.el('div', { className: 'kanban-header' }, [
                        DOM.el('div', {}, [
                            DOM.el('span', { className: 'kanban-title', style: 'color: ' + stage.color + ';' }, stage.name),
                            DOM.el('div', { style: 'font-size: 0.8rem; color: var(--text-muted);' }, formatCurrency(totalValue))
                        ]),
                        DOM.el('span', { className: 'kanban-count' }, String(deals.length))
                    ]),
                    DOM.el('div', { className: 'kanban-cards', id: 'stage-' + stage.id })
                ]);

                var cardsContainer = column.querySelector('.kanban-cards');
                deals.forEach(function(deal) {
                    var props = deal.properties || {};
                    var card = DOM.el('div', { className: 'kanban-card', draggable: 'true', dataset: { dealId: deal.id } }, [
                        DOM.el('div', { className: 'kanban-card-title' }, escapeHtml(props.dealname || 'Unnamed Deal')),
                        DOM.el('div', { className: 'kanban-card-meta' }, [
                            DOM.el('span', { className: 'kanban-card-value' }, formatCurrency(props.amount || 0)),
                            DOM.el('span', {}, escapeHtml(props.closedate ? formatDate(props.closedate) : ''))
                        ])
                    ]);
                    cardsContainer.appendChild(card);
                });

                kanban.appendChild(column);
            });
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AI - GENIUS BOTS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderBots: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Genius Bots'),
                    DOM.el('p', { className: 'page-subtitle' }, 'AI Agent Control Center')
                ])
            ]);
            container.appendChild(header);

            // Command Input
            var commandCard = DOM.el('div', { className: 'card mb-4' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'flex gap-3' }, [
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'bot-command', placeholder: '@einstein analyse die Verkaufsdaten...', style: 'flex: 1;' }),
                        DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.executeBotCommand(); } }, 'Execute')
                    ])
                ])
            ]);
            container.appendChild(commandCard);

            // Bots Grid
            var botsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'ğŸ¤– Available Bots'),
                    DOM.el('span', { className: 'badge badge-success', id: 'bots-online-count' }, '- Online')
                ]),
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'bot-grid', id: 'bots-grid' }, [
                        DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' }),
                        DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' }),
                        DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' }),
                        DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' })
                    ])
                ])
            ]);
            container.appendChild(botsCard);

            this.loadBotsGrid();
        },

        loadBotsGrid: async function() {
            var grid = document.getElementById('bots-grid');
            var countEl = document.getElementById('bots-online-count');
            var data = await API.get('/api/genius-agency/bots');
            DOM.clear(grid);

            var bots = data && data.bots ? data.bots : (Array.isArray(data) ? data : []);

            if (bots.length === 0) {
                grid.appendChild(DOM.el('div', { className: 'empty-state' }, 'No bots available'));
                return;
            }

            var onlineCount = bots.filter(function(b) { return b.status === 'online' || b.status === 'active'; }).length;
            countEl.textContent = onlineCount + ' Online';

            bots.forEach(function(bot) {
                var isOnline = bot.status === 'online' || bot.status === 'active';
                var card = DOM.el('div', { className: 'bot-card ' + (isOnline ? 'online' : 'offline'), onclick: function() { UltimateApp.selectBot(bot); } }, [
                    DOM.el('div', { className: 'bot-header' }, [
                        DOM.el('span', { className: 'bot-status' }),
                        DOM.el('span', { className: 'bot-name' }, escapeHtml(bot.name || bot.id))
                    ]),
                    DOM.el('div', { className: 'bot-role' }, escapeHtml(bot.role || bot.specialty || 'Agent'))
                ]);
                grid.appendChild(card);
            });
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PLACEHOLDER MODULES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CRM - COMPANIES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderCompanies: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Companies'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Manage your business accounts')
                ]),
                DOM.el('div', { className: 'page-actions' }, [
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewCompanyModal(); } }, '+ New Company')
                ])
            ]);
            container.appendChild(header);

            var card = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'table-container', id: 'companies-table' }, [
                        DOM.el('div', { className: 'loading-skeleton', style: 'height: 300px;' })
                    ])
                ])
            ]);
            container.appendChild(card);

            this.loadCompaniesTable();
        },

        loadCompaniesTable: async function() {
            var tableContainer = document.getElementById('companies-table');
            var data = await API.get('/api/hubspot/companies?limit=50');
            DOM.clear(tableContainer);

            if (!data || !data.results || data.results.length === 0) {
                tableContainer.appendChild(DOM.el('div', { className: 'empty-state' }, [
                    DOM.el('div', { className: 'empty-state-icon' }, 'ğŸ¢'),
                    DOM.el('div', { className: 'empty-state-title' }, 'No companies yet'),
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewCompanyModal(); } }, '+ Add First Company')
                ]));
                return;
            }

            var table = DOM.el('table', { className: 'table' });
            var thead = DOM.el('thead', {}, [
                DOM.el('tr', {}, [
                    DOM.el('th', {}, 'Company'),
                    DOM.el('th', {}, 'Domain'),
                    DOM.el('th', {}, 'Industry'),
                    DOM.el('th', {}, 'Employees'),
                    DOM.el('th', {}, 'Revenue'),
                    DOM.el('th', {}, 'Actions')
                ])
            ]);
            table.appendChild(thead);

            var tbody = DOM.el('tbody');
            data.results.forEach(function(company) {
                var props = company.properties || {};
                var row = DOM.el('tr', {}, [
                    DOM.el('td', { style: 'font-weight: 500;' }, escapeHtml(props.name || 'Unnamed')),
                    DOM.el('td', {}, escapeHtml(props.domain || '-')),
                    DOM.el('td', {}, escapeHtml(props.industry || '-')),
                    DOM.el('td', {}, escapeHtml(props.numberofemployees || '-')),
                    DOM.el('td', {}, props.annualrevenue ? formatCurrency(props.annualrevenue) : '-'),
                    DOM.el('td', {}, [
                        DOM.el('button', { className: 'btn btn-ghost btn-sm', onclick: function() { UltimateApp.editCompany(company.id); } }, 'Edit')
                    ])
                ]);
                tbody.appendChild(row);
            });
            table.appendChild(tbody);
            tableContainer.appendChild(table);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CRM - LEAD SCORING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderLeadScoring: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'Lead Scoring'),
                DOM.el('p', { className: 'page-subtitle' }, 'Analyze and prioritize your leads')
            ]);
            container.appendChild(header);

            var grid = DOM.el('div', { className: 'grid grid-3 gap-4', id: 'scoring-grid' });
            container.appendChild(grid);

            this.loadLeadScoring(grid);
        },

        loadLeadScoring: async function(grid) {
            var data = await API.get('/api/hubspot/contacts?limit=100');
            DOM.clear(grid);

            var hotLeads = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title text-success' }, 'ğŸ”¥ Hot Leads'),
                    DOM.el('span', { className: 'badge badge-success' }, '0')
                ]),
                DOM.el('div', { className: 'card-body', id: 'hot-leads-list' })
            ]);

            var warmLeads = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title text-warning' }, 'ğŸŒ¡ï¸ Warm Leads'),
                    DOM.el('span', { className: 'badge badge-warning' }, '0')
                ]),
                DOM.el('div', { className: 'card-body', id: 'warm-leads-list' })
            ]);

            var coldLeads = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title text-info' }, 'â„ï¸ Cold Leads'),
                    DOM.el('span', { className: 'badge badge-info' }, '0')
                ]),
                DOM.el('div', { className: 'card-body', id: 'cold-leads-list' })
            ]);

            grid.appendChild(hotLeads);
            grid.appendChild(warmLeads);
            grid.appendChild(coldLeads);

            // Simple scoring based on data completeness
            if (data && data.results) {
                var hot = [], warm = [], cold = [];
                data.results.forEach(function(contact) {
                    var props = contact.properties || {};
                    var score = 0;
                    if (props.email) score += 20;
                    if (props.phone) score += 20;
                    if (props.company) score += 20;
                    if (props.jobtitle) score += 20;
                    if (props.lifecycle_stage === 'opportunity') score += 20;

                    contact.score = score;
                    if (score >= 60) hot.push(contact);
                    else if (score >= 40) warm.push(contact);
                    else cold.push(contact);
                });

                hotLeads.querySelector('.badge').textContent = String(hot.length);
                warmLeads.querySelector('.badge').textContent = String(warm.length);
                coldLeads.querySelector('.badge').textContent = String(cold.length);

                this.renderLeadList(document.getElementById('hot-leads-list'), hot.slice(0, 5));
                this.renderLeadList(document.getElementById('warm-leads-list'), warm.slice(0, 5));
                this.renderLeadList(document.getElementById('cold-leads-list'), cold.slice(0, 5));
            }
        },

        renderLeadList: function(container, leads) {
            if (leads.length === 0) {
                container.appendChild(DOM.el('div', { className: 'text-muted' }, 'No leads'));
                return;
            }
            leads.forEach(function(lead) {
                var props = lead.properties || {};
                var name = [props.firstname, props.lastname].filter(Boolean).join(' ') || props.email || 'Unknown';
                container.appendChild(DOM.el('div', { className: 'flex justify-between items-center py-2', style: 'border-bottom: 1px solid var(--border-color);' }, [
                    DOM.el('span', {}, escapeHtml(name)),
                    DOM.el('span', { className: 'badge' }, lead.score + ' pts')
                ]));
            });
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SALES - LEAD DISCOVERY
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderLeadDiscovery: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'Lead Discovery'),
                DOM.el('p', { className: 'page-subtitle' }, 'Find and qualify new leads')
            ]);
            container.appendChild(header);

            var searchCard = DOM.el('div', { className: 'card mb-4' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'grid grid-4 gap-3' }, [
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'lead-search-company', placeholder: 'Company name...' }),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'lead-search-industry', placeholder: 'Industry...' }),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'lead-search-location', placeholder: 'Location...' }),
                        DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.searchLeads(); } }, 'ğŸ” Search')
                    ])
                ])
            ]);
            container.appendChild(searchCard);

            var resultsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'Search Results'),
                    DOM.el('span', { className: 'badge', id: 'lead-results-count' }, '0 found')
                ]),
                DOM.el('div', { className: 'card-body', id: 'lead-results' }, [
                    DOM.el('div', { className: 'empty-state' }, [
                        DOM.el('div', { className: 'empty-state-icon' }, 'ğŸ¯'),
                        DOM.el('div', { className: 'empty-state-text' }, 'Enter search criteria to find leads')
                    ])
                ])
            ]);
            container.appendChild(resultsCard);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SALES - PROPOSALS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderProposals: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Proposals'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Manage sales proposals and quotes')
                ]),
                DOM.el('div', { className: 'page-actions' }, [
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewProposalModal(); } }, '+ New Proposal')
                ])
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'kpi-card' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Total Proposals'),
                    DOM.el('div', { className: 'kpi-value' }, '0')
                ]),
                DOM.el('div', { className: 'kpi-card success' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Accepted'),
                    DOM.el('div', { className: 'kpi-value' }, '0')
                ]),
                DOM.el('div', { className: 'kpi-card warning' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Pending'),
                    DOM.el('div', { className: 'kpi-value' }, '0')
                ]),
                DOM.el('div', { className: 'kpi-card error' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Rejected'),
                    DOM.el('div', { className: 'kpi-value' }, '0')
                ])
            ]);
            container.appendChild(stats);

            var card = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'empty-state' }, [
                        DOM.el('div', { className: 'empty-state-icon' }, 'ğŸ“„'),
                        DOM.el('div', { className: 'empty-state-title' }, 'No proposals yet'),
                        DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewProposalModal(); } }, '+ Create First Proposal')
                    ])
                ])
            ]);
            container.appendChild(card);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // COMMUNICATION - EMAIL HUB
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderEmailHub: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Email Hub'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Email templates and campaigns')
                ]),
                DOM.el('div', { className: 'page-actions' }, [
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showEmailComposer(); } }, 'ğŸ“§ Compose')
                ])
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'kpi-card info' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Templates'),
                    DOM.el('div', { className: 'kpi-value', id: 'email-template-count' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card primary' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Sent Today'),
                    DOM.el('div', { className: 'kpi-value' }, '0')
                ]),
                DOM.el('div', { className: 'kpi-card success' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Open Rate'),
                    DOM.el('div', { className: 'kpi-value' }, '--%')
                ]),
                DOM.el('div', { className: 'kpi-card warning' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Click Rate'),
                    DOM.el('div', { className: 'kpi-value' }, '--%')
                ])
            ]);
            container.appendChild(stats);

            var templatesCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'ğŸ“„ Email Templates'),
                    DOM.el('button', { className: 'btn btn-ghost btn-sm' }, '+ New Template')
                ]),
                DOM.el('div', { className: 'card-body', id: 'email-templates-grid' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 200px;' })
                ])
            ]);
            container.appendChild(templatesCard);

            this.loadEmailTemplates();
        },

        loadEmailTemplates: async function() {
            var grid = document.getElementById('email-templates-grid');
            var countEl = document.getElementById('email-template-count');
            var data = await API.get('/api/v1/email/templates');
            DOM.clear(grid);

            var templates = data && data.templates ? data.templates : (Array.isArray(data) ? data : []);
            countEl.textContent = String(templates.length);

            if (templates.length === 0) {
                grid.appendChild(DOM.el('div', { className: 'empty-state' }, 'No templates available'));
                return;
            }

            var templateGrid = DOM.el('div', { className: 'grid grid-3 gap-4' });
            templates.slice(0, 9).forEach(function(template) {
                var card = DOM.el('div', { className: 'card', style: 'cursor: pointer;', onclick: function() { UltimateApp.selectEmailTemplate(template); } }, [
                    DOM.el('div', { className: 'card-body' }, [
                        DOM.el('div', { style: 'font-weight: 600; margin-bottom: 0.5rem;' }, escapeHtml(template.name || template.subject || 'Unnamed')),
                        DOM.el('div', { style: 'font-size: 0.85rem; color: var(--text-muted);' }, escapeHtml((template.description || template.preview || '').slice(0, 80) + '...'))
                    ])
                ]);
                templateGrid.appendChild(card);
            });
            grid.appendChild(templateGrid);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // COMMUNICATION - WHATSAPP
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderWhatsApp: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'WhatsApp'),
                DOM.el('p', { className: 'page-subtitle' }, 'WhatsApp Business Integration')
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-3 gap-4 mb-4' }, [
                DOM.el('div', { className: 'kpi-card success' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Connected'),
                    DOM.el('div', { className: 'kpi-value' }, 'âœ…')
                ]),
                DOM.el('div', { className: 'kpi-card info' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Messages Today'),
                    DOM.el('div', { className: 'kpi-value', id: 'wa-messages-today' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card primary' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Contacts'),
                    DOM.el('div', { className: 'kpi-value', id: 'wa-contacts' }, '-')
                ])
            ]);
            container.appendChild(stats);

            var actionsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'ğŸ“± Quick Actions')
                ]),
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                        DOM.el('button', { className: 'btn btn-secondary', style: 'padding: 1rem;', onclick: function() { UltimateApp.showWABroadcast(); } }, 'ğŸ“£ Broadcast Message'),
                        DOM.el('button', { className: 'btn btn-secondary', style: 'padding: 1rem;' }, 'ğŸ“„ Message Templates')
                    ])
                ])
            ]);
            container.appendChild(actionsCard);

            this.loadWhatsAppStats();
        },

        loadWhatsAppStats: async function() {
            var data = await API.get('/api/whatsapp/stats');
            if (data) {
                var msgEl = document.getElementById('wa-messages-today');
                var contactsEl = document.getElementById('wa-contacts');
                if (msgEl) msgEl.textContent = String(data.messagesToday || 0);
                if (contactsEl) contactsEl.textContent = String(data.contacts || 0);
            }
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // COMMUNICATION - CAMPAIGNS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderCampaigns: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Campaigns'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Marketing campaign management')
                ]),
                DOM.el('div', { className: 'page-actions' }, [
                    DOM.el('button', { className: 'btn btn-primary' }, '+ New Campaign')
                ])
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'kpi-card' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Active'),
                    DOM.el('div', { className: 'kpi-value' }, '0')
                ]),
                DOM.el('div', { className: 'kpi-card success' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Completed'),
                    DOM.el('div', { className: 'kpi-value' }, '0')
                ]),
                DOM.el('div', { className: 'kpi-card info' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Total Reach'),
                    DOM.el('div', { className: 'kpi-value' }, '0')
                ]),
                DOM.el('div', { className: 'kpi-card warning' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Conversion'),
                    DOM.el('div', { className: 'kpi-value' }, '--%')
                ])
            ]);
            container.appendChild(stats);

            var card = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'empty-state' }, [
                        DOM.el('div', { className: 'empty-state-icon' }, 'ğŸš€'),
                        DOM.el('div', { className: 'empty-state-title' }, 'No campaigns yet'),
                        DOM.el('button', { className: 'btn btn-primary' }, '+ Create First Campaign')
                    ])
                ])
            ]);
            container.appendChild(card);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AI - HAIKU GOD MODE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderHaiku: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'ğŸ’ HAIKU God Mode'),
                DOM.el('p', { className: 'page-subtitle' }, 'Supreme AI Control Center')
            ]);
            container.appendChild(header);

            var statusCard = DOM.el('div', { className: 'card mb-4', style: 'background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(59, 130, 246, 0.2)); border: 1px solid rgba(139, 92, 246, 0.5);' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'flex items-center justify-between' }, [
                        DOM.el('div', {}, [
                            DOM.el('div', { style: 'font-size: 1.5rem; font-weight: 700; color: var(--accent-primary);' }, 'HAIKU ONLINE'),
                            DOM.el('div', { style: 'color: var(--text-muted);' }, 'All systems operational')
                        ]),
                        DOM.el('div', { className: 'flex gap-3' }, [
                            DOM.el('div', { className: 'kpi-card', style: 'min-width: 100px;' }, [
                                DOM.el('div', { className: 'kpi-label' }, 'Power Level'),
                                DOM.el('div', { className: 'kpi-value' }, '100%')
                            ]),
                            DOM.el('div', { className: 'kpi-card', style: 'min-width: 100px;' }, [
                                DOM.el('div', { className: 'kpi-label' }, 'Tasks Today'),
                                DOM.el('div', { className: 'kpi-value', id: 'haiku-tasks' }, '-')
                            ])
                        ])
                    ])
                ])
            ]);
            container.appendChild(statusCard);

            var commandCard = DOM.el('div', { className: 'card mb-4' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'âš¡ Divine Command')
                ]),
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('textarea', { className: 'form-input', id: 'haiku-command', rows: '3', placeholder: 'Enter your divine command...', style: 'resize: vertical;' }),
                    DOM.el('div', { className: 'flex justify-end mt-3' }, [
                        DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.executeHaikuCommand(); } }, 'ğŸ’ Execute')
                    ])
                ])
            ]);
            container.appendChild(commandCard);

            var actionsGrid = DOM.el('div', { className: 'grid grid-3 gap-4' }, [
                DOM.el('div', { className: 'card', style: 'cursor: pointer;' }, [
                    DOM.el('div', { className: 'card-body text-center' }, [
                        DOM.el('div', { style: 'font-size: 2rem;' }, 'ğŸ”®'),
                        DOM.el('div', { style: 'font-weight: 600; margin-top: 0.5rem;' }, 'Prophecy'),
                        DOM.el('div', { style: 'font-size: 0.85rem; color: var(--text-muted);' }, 'Predictive Analytics')
                    ])
                ]),
                DOM.el('div', { className: 'card', style: 'cursor: pointer;' }, [
                    DOM.el('div', { className: 'card-body text-center' }, [
                        DOM.el('div', { style: 'font-size: 2rem;' }, 'ğŸ’¡'),
                        DOM.el('div', { style: 'font-weight: 600; margin-top: 0.5rem;' }, 'Transformation'),
                        DOM.el('div', { style: 'font-size: 0.85rem; color: var(--text-muted);' }, 'Data Alchemy')
                    ])
                ]),
                DOM.el('div', { className: 'card', style: 'cursor: pointer;' }, [
                    DOM.el('div', { className: 'card-body text-center' }, [
                        DOM.el('div', { style: 'font-size: 2rem;' }, 'ğŸ¯'),
                        DOM.el('div', { style: 'font-weight: 600; margin-top: 0.5rem;' }, 'Automation'),
                        DOM.el('div', { style: 'font-size: 0.85rem; color: var(--text-muted);' }, 'Workflow Engine')
                    ])
                ])
            ]);
            container.appendChild(actionsGrid);

            this.loadHaikuStats();
        },

        loadHaikuStats: async function() {
            var data = await API.get('/api/haiku/stats');
            if (data) {
                var tasksEl = document.getElementById('haiku-tasks');
                if (tasksEl) tasksEl.textContent = String(data.tasksToday || 0);
            }
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AI - PROPHECY
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderProphecy: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'ğŸ”® Prophecy'),
                DOM.el('p', { className: 'page-subtitle' }, 'AI-Powered Predictive Analytics')
            ]);
            container.appendChild(header);

            var grid = DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                DOM.el('div', { className: 'card' }, [
                    DOM.el('div', { className: 'card-header' }, [
                        DOM.el('span', { className: 'card-title' }, 'ğŸ“ˆ Revenue Forecast')
                    ]),
                    DOM.el('div', { className: 'card-body', style: 'height: 250px;' }, [
                        DOM.el('div', { id: 'forecast-chart', style: 'height: 100%;' }, [
                            DOM.el('div', { className: 'empty-state' }, 'Loading forecast...')
                        ])
                    ])
                ]),
                DOM.el('div', { className: 'card' }, [
                    DOM.el('div', { className: 'card-header' }, [
                        DOM.el('span', { className: 'card-title' }, 'ğŸ¯ Deal Predictions')
                    ]),
                    DOM.el('div', { className: 'card-body' }, [
                        DOM.el('div', { id: 'deal-predictions' }, [
                            DOM.el('div', { className: 'empty-state' }, 'Analyzing deals...')
                        ])
                    ])
                ])
            ]);
            container.appendChild(grid);

            var insightsCard = DOM.el('div', { className: 'card mt-4' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'ğŸ’¡ AI Insights')
                ]),
                DOM.el('div', { className: 'card-body', id: 'ai-insights' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' })
                ])
            ]);
            container.appendChild(insightsCard);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FINANCE - CASHFLOW
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderCashflow: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'Cashflow'),
                DOM.el('p', { className: 'page-subtitle' }, 'Financial overview and projections')
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'kpi-card success' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Revenue (MTD)'),
                    DOM.el('div', { className: 'kpi-value', id: 'cashflow-revenue' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card error' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Expenses (MTD)'),
                    DOM.el('div', { className: 'kpi-value', id: 'cashflow-expenses' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card primary' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Net Cash'),
                    DOM.el('div', { className: 'kpi-value', id: 'cashflow-net' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card info' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Runway'),
                    DOM.el('div', { className: 'kpi-value' }, '12 mo')
                ])
            ]);
            container.appendChild(stats);

            var chartCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'ğŸ“ˆ Cashflow Chart')
                ]),
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('canvas', { id: 'cashflow-chart', style: 'height: 300px;' })
                ])
            ]);
            container.appendChild(chartCard);

            this.loadCashflowData();
        },

        loadCashflowData: async function() {
            var stripeData = await API.get('/api/stripe/stats');
            if (stripeData) {
                var revenueEl = document.getElementById('cashflow-revenue');
                var netEl = document.getElementById('cashflow-net');
                if (revenueEl) revenueEl.textContent = formatCurrency(stripeData.revenue || stripeData.totalRevenue || 0);
                if (netEl) netEl.textContent = formatCurrency(stripeData.net || stripeData.revenue || 0);
            }
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FINANCE - INVOICES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderInvoices: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('div', {}, [
                    DOM.el('h1', { className: 'page-title' }, 'Invoices'),
                    DOM.el('p', { className: 'page-subtitle' }, 'Invoice management')
                ]),
                DOM.el('div', { className: 'page-actions' }, [
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewInvoiceModal(); } }, '+ New Invoice')
                ])
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4' }, [
                DOM.el('div', { className: 'kpi-card' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Total'),
                    DOM.el('div', { className: 'kpi-value', id: 'invoice-total' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card success' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Paid'),
                    DOM.el('div', { className: 'kpi-value', id: 'invoice-paid' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card warning' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Pending'),
                    DOM.el('div', { className: 'kpi-value', id: 'invoice-pending' }, '-')
                ]),
                DOM.el('div', { className: 'kpi-card error' }, [
                    DOM.el('div', { className: 'kpi-label' }, 'Overdue'),
                    DOM.el('div', { className: 'kpi-value', id: 'invoice-overdue' }, '-')
                ])
            ]);
            container.appendChild(stats);

            var card = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'table-container', id: 'invoices-table' }, [
                        DOM.el('div', { className: 'loading-skeleton', style: 'height: 300px;' })
                    ])
                ])
            ]);
            container.appendChild(card);

            this.loadInvoicesTable();
        },

        loadInvoicesTable: async function() {
            var tableContainer = document.getElementById('invoices-table');
            var data = await API.get('/api/v1/invoices');
            DOM.clear(tableContainer);

            var invoices = data && data.invoices ? data.invoices : (Array.isArray(data) ? data : []);

            if (invoices.length === 0) {
                tableContainer.appendChild(DOM.el('div', { className: 'empty-state' }, [
                    DOM.el('div', { className: 'empty-state-icon' }, 'ğŸ“„'),
                    DOM.el('div', { className: 'empty-state-title' }, 'No invoices yet'),
                    DOM.el('button', { className: 'btn btn-primary', onclick: function() { UltimateApp.showNewInvoiceModal(); } }, '+ Create First Invoice')
                ]));
                return;
            }

            var table = DOM.el('table', { className: 'table' });
            var thead = DOM.el('thead', {}, [
                DOM.el('tr', {}, [
                    DOM.el('th', {}, 'Invoice #'),
                    DOM.el('th', {}, 'Client'),
                    DOM.el('th', {}, 'Amount'),
                    DOM.el('th', {}, 'Status'),
                    DOM.el('th', {}, 'Due Date'),
                    DOM.el('th', {}, 'Actions')
                ])
            ]);
            table.appendChild(thead);

            var tbody = DOM.el('tbody');
            invoices.forEach(function(invoice) {
                var statusClass = invoice.status === 'paid' ? 'badge-success' : (invoice.status === 'overdue' ? 'badge-error' : 'badge-warning');
                var row = DOM.el('tr', {}, [
                    DOM.el('td', { style: 'font-weight: 500;' }, escapeHtml(invoice.number || invoice.id)),
                    DOM.el('td', {}, escapeHtml(invoice.client || invoice.customer || '-')),
                    DOM.el('td', {}, formatCurrency(invoice.amount || invoice.total || 0)),
                    DOM.el('td', {}, [
                        DOM.el('span', { className: 'badge ' + statusClass }, invoice.status || 'pending')
                    ]),
                    DOM.el('td', {}, formatDate(invoice.dueDate || invoice.due_date)),
                    DOM.el('td', {}, [
                        DOM.el('button', { className: 'btn btn-ghost btn-sm' }, 'View'),
                        DOM.el('button', { className: 'btn btn-ghost btn-sm' }, 'Send')
                    ])
                ]);
                tbody.appendChild(row);
            });
            table.appendChild(tbody);
            tableContainer.appendChild(table);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // FINANCE - STRIPE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderStripe: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'ğŸ’³ Stripe'),
                DOM.el('p', { className: 'page-subtitle' }, 'Payment processing dashboard')
            ]);
            container.appendChild(header);

            var stats = DOM.el('div', { className: 'grid grid-4 gap-4 mb-4', id: 'stripe-stats' }, [
                DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' }),
                DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' }),
                DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' }),
                DOM.el('div', { className: 'loading-skeleton', style: 'height: 100px;' })
            ]);
            container.appendChild(stats);

            var paymentsCard = DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-header' }, [
                    DOM.el('span', { className: 'card-title' }, 'Recent Payments')
                ]),
                DOM.el('div', { className: 'card-body', id: 'stripe-payments' }, [
                    DOM.el('div', { className: 'loading-skeleton', style: 'height: 200px;' })
                ])
            ]);
            container.appendChild(paymentsCard);

            this.loadStripeData();
        },

        loadStripeData: async function() {
            var statsContainer = document.getElementById('stripe-stats');
            var paymentsContainer = document.getElementById('stripe-payments');
            var data = await API.get('/api/stripe/stats');
            DOM.clear(statsContainer);

            var stats = [
                { label: 'Total Revenue', value: formatCurrency(data && data.revenue ? data.revenue : 0), type: 'success' },
                { label: 'Active Subscriptions', value: String(data && data.subscriptions ? data.subscriptions : 0), type: 'info' },
                { label: 'Payments Today', value: String(data && data.paymentsToday ? data.paymentsToday : 0), type: 'primary' },
                { label: 'Refunds', value: formatCurrency(data && data.refunds ? data.refunds : 0), type: 'error' }
            ];

            stats.forEach(function(stat) {
                statsContainer.appendChild(DOM.el('div', { className: 'kpi-card ' + stat.type }, [
                    DOM.el('div', { className: 'kpi-label' }, stat.label),
                    DOM.el('div', { className: 'kpi-value' }, stat.value)
                ]));
            });

            DOM.clear(paymentsContainer);
            if (data && data.recentPayments && data.recentPayments.length > 0) {
                data.recentPayments.forEach(function(payment) {
                    paymentsContainer.appendChild(DOM.el('div', { className: 'flex justify-between py-2', style: 'border-bottom: 1px solid var(--border-color);' }, [
                        DOM.el('span', {}, escapeHtml(payment.customer || payment.email || 'Anonymous')),
                        DOM.el('span', { className: 'text-success font-medium' }, formatCurrency(payment.amount / 100))
                    ]));
                });
            } else {
                paymentsContainer.appendChild(DOM.el('div', { className: 'empty-state' }, 'No recent payments'));
            }
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SYSTEM - INTEGRATIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderIntegrations: async function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'Integrations'),
                DOM.el('p', { className: 'page-subtitle' }, 'Manage connected services')
            ]);
            container.appendChild(header);

            var integrations = [
                { name: 'HubSpot CRM', icon: 'ğŸ‘¤', status: 'connected', description: 'Contact and deal management' },
                { name: 'WhatsApp Business', icon: 'ğŸ“±', status: 'connected', description: 'Messaging integration' },
                { name: 'Stripe', icon: 'ğŸ’³', status: 'connected', description: 'Payment processing' },
                { name: 'Google Workspace', icon: 'ğŸ“§', status: 'connected', description: 'Email and calendar' },
                { name: 'Slack', icon: 'ğŸ’¬', status: 'disconnected', description: 'Team communication' },
                { name: 'Zapier', icon: 'âš¡', status: 'disconnected', description: 'Workflow automation' }
            ];

            var grid = DOM.el('div', { className: 'grid grid-2 gap-4' });
            integrations.forEach(function(int) {
                var isConnected = int.status === 'connected';
                var card = DOM.el('div', { className: 'card' }, [
                    DOM.el('div', { className: 'card-body' }, [
                        DOM.el('div', { className: 'flex items-center justify-between' }, [
                            DOM.el('div', { className: 'flex items-center gap-3' }, [
                                DOM.el('span', { style: 'font-size: 2rem;' }, int.icon),
                                DOM.el('div', {}, [
                                    DOM.el('div', { style: 'font-weight: 600;' }, int.name),
                                    DOM.el('div', { style: 'font-size: 0.85rem; color: var(--text-muted);' }, int.description)
                                ])
                            ]),
                            DOM.el('div', { className: 'flex items-center gap-3' }, [
                                DOM.el('span', { className: 'badge ' + (isConnected ? 'badge-success' : 'badge-secondary') }, int.status),
                                DOM.el('button', { className: 'btn btn-ghost btn-sm' }, isConnected ? 'Configure' : 'Connect')
                            ])
                        ])
                    ])
                ]);
                grid.appendChild(card);
            });
            container.appendChild(grid);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SYSTEM - SETTINGS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderSettings: function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'Settings'),
                DOM.el('p', { className: 'page-subtitle' }, 'Application preferences')
            ]);
            container.appendChild(header);

            var sections = [
                {
                    title: 'General',
                    settings: [
                        { label: 'Language', type: 'select', options: ['English', 'Deutsch'], value: 'Deutsch' },
                        { label: 'Timezone', type: 'select', options: ['Europe/Berlin', 'UTC', 'America/New_York'], value: 'Europe/Berlin' },
                        { label: 'Date Format', type: 'select', options: ['DD.MM.YYYY', 'MM/DD/YYYY', 'YYYY-MM-DD'], value: 'DD.MM.YYYY' }
                    ]
                },
                {
                    title: 'Notifications',
                    settings: [
                        { label: 'Email Notifications', type: 'toggle', value: true },
                        { label: 'Push Notifications', type: 'toggle', value: true },
                        { label: 'Deal Alerts', type: 'toggle', value: true }
                    ]
                },
                {
                    title: 'Appearance',
                    settings: [
                        { label: 'Theme', type: 'select', options: ['Dark', 'Light', 'System'], value: 'Dark' },
                        { label: 'Compact Mode', type: 'toggle', value: false }
                    ]
                }
            ];

            sections.forEach(function(section) {
                var card = DOM.el('div', { className: 'card mb-4' }, [
                    DOM.el('div', { className: 'card-header' }, [
                        DOM.el('span', { className: 'card-title' }, section.title)
                    ]),
                    DOM.el('div', { className: 'card-body' })
                ]);

                var body = card.querySelector('.card-body');
                section.settings.forEach(function(setting) {
                    var row = DOM.el('div', { className: 'flex justify-between items-center py-3', style: 'border-bottom: 1px solid var(--border-color);' }, [
                        DOM.el('span', {}, setting.label)
                    ]);

                    if (setting.type === 'select') {
                        var select = DOM.el('select', { className: 'form-input form-select', style: 'width: auto;' });
                        setting.options.forEach(function(opt) {
                            var option = DOM.el('option', { value: opt }, opt);
                            if (opt === setting.value) option.selected = true;
                            select.appendChild(option);
                        });
                        row.appendChild(select);
                    } else if (setting.type === 'toggle') {
                        var toggle = DOM.el('label', { className: 'toggle' }, [
                            DOM.el('input', { type: 'checkbox', checked: setting.value ? 'checked' : null }),
                            DOM.el('span', { className: 'toggle-slider' })
                        ]);
                        row.appendChild(toggle);
                    }

                    body.appendChild(row);
                });

                container.appendChild(card);
            });

            var saveBtn = DOM.el('div', { className: 'flex justify-end' }, [
                DOM.el('button', { className: 'btn btn-primary' }, 'Save Settings')
            ]);
            container.appendChild(saveBtn);
        },

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SYSTEM - DOCUMENTATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        renderDocs: function() {
            var container = this.container();
            DOM.clear(container);

            var header = DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, 'Documentation'),
                DOM.el('p', { className: 'page-subtitle' }, 'System documentation and guides')
            ]);
            container.appendChild(header);

            var sections = [
                { title: 'Getting Started', icon: 'ğŸš€', items: ['Quick Start Guide', 'Dashboard Overview', 'Navigation'] },
                { title: 'CRM', icon: 'ğŸ‘¤', items: ['Managing Contacts', 'Company Profiles', 'Lead Scoring'] },
                { title: 'Sales', icon: 'ğŸ’°', items: ['Deal Pipeline', 'Creating Deals', 'Proposals'] },
                { title: 'Communication', icon: 'ğŸ“§', items: ['Email Templates', 'Campaigns', 'WhatsApp'] },
                { title: 'AI & Automation', icon: 'ğŸ¤–', items: ['Genius Bots', 'HAIKU Commands', 'Automation Rules'] },
                { title: 'Finance', icon: 'ğŸ’³', items: ['Invoicing', 'Stripe Integration', 'Reports'] },
                { title: 'API Reference', icon: 'ğŸ”—', items: ['Authentication', 'Endpoints', 'Webhooks'] }
            ];

            var grid = DOM.el('div', { className: 'grid grid-3 gap-4' });
            sections.forEach(function(section) {
                var card = DOM.el('div', { className: 'card', style: 'cursor: pointer;' }, [
                    DOM.el('div', { className: 'card-body' }, [
                        DOM.el('div', { className: 'flex items-center gap-3 mb-3' }, [
                            DOM.el('span', { style: 'font-size: 1.5rem;' }, section.icon),
                            DOM.el('span', { style: 'font-weight: 600;' }, section.title)
                        ]),
                        DOM.el('ul', { style: 'list-style: none; padding: 0; margin: 0;' }, section.items.map(function(item) {
                            return DOM.el('li', { style: 'padding: 0.25rem 0; color: var(--text-muted); font-size: 0.9rem;' }, 'â€º ' + item);
                        }))
                    ])
                ]);
                grid.appendChild(card);
            });
            container.appendChild(grid);
        },

        renderPlaceholder: function(title, message) {
            var container = this.container();
            DOM.clear(container);

            container.appendChild(DOM.el('div', { className: 'page-header' }, [
                DOM.el('h1', { className: 'page-title' }, title)
            ]));

            container.appendChild(DOM.el('div', { className: 'card' }, [
                DOM.el('div', { className: 'card-body' }, [
                    DOM.el('div', { className: 'empty-state' }, [
                        DOM.el('div', { className: 'empty-state-icon' }, 'ğŸš§'),
                        DOM.el('div', { className: 'empty-state-title' }, 'Coming Soon'),
                        DOM.el('div', { className: 'empty-state-text' }, message)
                    ])
                ])
            ]));
        },

        render404: function() {
            var container = this.container();
            DOM.clear(container);

            container.appendChild(DOM.el('div', { className: 'empty-state', style: 'padding-top: 100px;' }, [
                DOM.el('div', { className: 'empty-state-icon' }, 'ğŸ˜•'),
                DOM.el('div', { className: 'empty-state-title' }, '404 - Page Not Found'),
                DOM.el('div', { className: 'empty-state-text' }, 'The page you are looking for does not exist.'),
                DOM.el('a', { href: '#/', className: 'btn btn-primary' }, 'Go to Dashboard')
            ]));
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // MAIN APP
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    var UltimateApp = {
        init: function() {
            Router.init();
            this.updateLastSync();
            setInterval(this.updateLastSync, 30000);
        },

        updateLastSync: function() {
            var el = document.getElementById('last-sync');
            if (el) {
                el.textContent = 'Last sync: ' + new Date().toLocaleTimeString('de-DE');
            }
        },

        // Modal Management
        showModal: function(title, content, onConfirm) {
            document.getElementById('modal-title').textContent = title;
            var body = document.getElementById('modal-body');
            DOM.clear(body);
            if (typeof content === 'string') {
                body.textContent = content;
            } else {
                body.appendChild(content);
            }
            document.getElementById('modal-overlay').classList.add('active');

            if (onConfirm) {
                document.getElementById('modal-confirm').onclick = function() {
                    onConfirm();
                    UltimateApp.closeModal();
                };
            }
        },

        closeModal: function() {
            document.getElementById('modal-overlay').classList.remove('active');
        },

        // Contact Actions
        showNewContactModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'First Name'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'new-contact-firstname', placeholder: 'John' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Last Name'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'new-contact-lastname', placeholder: 'Doe' })
                    ])
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Email'),
                    DOM.el('input', { type: 'email', className: 'form-input', id: 'new-contact-email', placeholder: 'john@example.com' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Company'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'new-contact-company', placeholder: 'Company Inc.' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Phone'),
                    DOM.el('input', { type: 'tel', className: 'form-input', id: 'new-contact-phone', placeholder: '+49 123 456789' })
                ])
            ]);

            this.showModal('New Contact', form, async function() {
                var data = {
                    properties: {
                        firstname: document.getElementById('new-contact-firstname').value,
                        lastname: document.getElementById('new-contact-lastname').value,
                        email: document.getElementById('new-contact-email').value,
                        company: document.getElementById('new-contact-company').value,
                        phone: document.getElementById('new-contact-phone').value
                    }
                };
                var result = await API.post('/api/hubspot/contacts', data);
                if (result) {
                    Modules.loadContactsTable();
                }
            });
        },

        showContactDetail: function(id) {
            console.log('Show contact:', id);
            // TODO: Implement contact detail view
        },

        editContact: function(id) {
            console.log('Edit contact:', id);
            // TODO: Implement contact edit
        },

        // Deal Actions
        showNewDealModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Deal Name'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'new-deal-name', placeholder: 'New Business Deal' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Amount'),
                    DOM.el('input', { type: 'number', className: 'form-input', id: 'new-deal-amount', placeholder: '10000' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Stage'),
                    DOM.el('select', { className: 'form-input form-select', id: 'new-deal-stage' }, [
                        DOM.el('option', { value: 'qualifiedtobuy' }, 'Qualified'),
                        DOM.el('option', { value: 'presentationscheduled' }, 'Presentation'),
                        DOM.el('option', { value: 'negotiation' }, 'Negotiation')
                    ])
                ])
            ]);

            this.showModal('New Deal', form, async function() {
                var data = {
                    properties: {
                        dealname: document.getElementById('new-deal-name').value,
                        amount: document.getElementById('new-deal-amount').value,
                        dealstage: document.getElementById('new-deal-stage').value
                    }
                };
                var result = await API.post('/api/hubspot/deals', data);
                if (result) {
                    Modules.loadDealsKanban();
                }
            });
        },

        // Bot Actions
        selectBot: function(bot) {
            var input = document.getElementById('bot-command');
            if (input) {
                input.value = '@' + (bot.id || bot.name).toLowerCase() + ' ';
                input.focus();
            }
        },

        executeBotCommand: async function() {
            var input = document.getElementById('bot-command');
            var command = input ? input.value.trim() : '';
            if (!command) return;

            console.log('Executing bot command:', command);
            var result = await API.post('/api/genius-agency/execute', { command: command });
            if (result) {
                input.value = '';
                alert('Command executed: ' + (result.message || 'Success'));
            }
        },

        // Company Actions
        showNewCompanyModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Company Name'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'new-company-name', placeholder: 'Acme Inc.' })
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Domain'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'new-company-domain', placeholder: 'acme.com' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Industry'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'new-company-industry', placeholder: 'Technology' })
                    ])
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Employees'),
                        DOM.el('input', { type: 'number', className: 'form-input', id: 'new-company-employees', placeholder: '50' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Annual Revenue'),
                        DOM.el('input', { type: 'number', className: 'form-input', id: 'new-company-revenue', placeholder: '1000000' })
                    ])
                ])
            ]);

            this.showModal('New Company', form, async function() {
                var data = {
                    properties: {
                        name: document.getElementById('new-company-name').value,
                        domain: document.getElementById('new-company-domain').value,
                        industry: document.getElementById('new-company-industry').value,
                        numberofemployees: document.getElementById('new-company-employees').value,
                        annualrevenue: document.getElementById('new-company-revenue').value
                    }
                };
                var result = await API.post('/api/hubspot/companies', data);
                if (result) {
                    Modules.loadCompaniesTable();
                }
            });
        },

        editCompany: async function(id) {
            var data = await API.get('/api/hubspot/companies/' + id);
            if (!data) {
                alert('Could not load company data');
                return;
            }
            var props = data.properties || {};

            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Company Name'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'edit-company-name', value: props.name || '' })
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Domain'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'edit-company-domain', value: props.domain || '' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Industry'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'edit-company-industry', value: props.industry || '' })
                    ])
                ])
            ]);

            this.showModal('Edit Company', form, async function() {
                var updateData = {
                    properties: {
                        name: document.getElementById('edit-company-name').value,
                        domain: document.getElementById('edit-company-domain').value,
                        industry: document.getElementById('edit-company-industry').value
                    }
                };
                var result = await API.patch('/api/hubspot/companies/' + id, updateData);
                if (result) {
                    Modules.loadCompaniesTable();
                }
            });
        },

        // Lead Discovery
        searchLeads: async function() {
            var company = document.getElementById('lead-search-company').value;
            var industry = document.getElementById('lead-search-industry').value;
            var location = document.getElementById('lead-search-location').value;

            var resultsContainer = document.getElementById('lead-results');
            var countEl = document.getElementById('lead-results-count');

            DOM.clear(resultsContainer);
            resultsContainer.appendChild(DOM.el('div', { className: 'loading-skeleton', style: 'height: 200px;' }));

            var params = new URLSearchParams();
            if (company) params.append('company', company);
            if (industry) params.append('industry', industry);
            if (location) params.append('location', location);

            var data = await API.get('/api/v1/lead-discovery/search?' + params.toString());
            DOM.clear(resultsContainer);

            var leads = data && data.leads ? data.leads : (Array.isArray(data) ? data : []);
            countEl.textContent = leads.length + ' found';

            if (leads.length === 0) {
                resultsContainer.appendChild(DOM.el('div', { className: 'empty-state' }, 'No leads found matching your criteria'));
                return;
            }

            leads.forEach(function(lead) {
                resultsContainer.appendChild(DOM.el('div', { className: 'flex justify-between items-center py-3', style: 'border-bottom: 1px solid var(--border-color);' }, [
                    DOM.el('div', {}, [
                        DOM.el('div', { style: 'font-weight: 500;' }, escapeHtml(lead.name || lead.company || 'Unknown')),
                        DOM.el('div', { style: 'font-size: 0.85rem; color: var(--text-muted);' }, escapeHtml(lead.industry || '') + ' | ' + escapeHtml(lead.location || ''))
                    ]),
                    DOM.el('button', { className: 'btn btn-primary btn-sm' }, 'Import')
                ]));
            });
        },

        // Proposal Actions
        showNewProposalModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Proposal Title'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'new-proposal-title', placeholder: 'Enterprise Solution Proposal' })
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Client'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'new-proposal-client', placeholder: 'Acme Inc.' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Amount'),
                        DOM.el('input', { type: 'number', className: 'form-input', id: 'new-proposal-amount', placeholder: '50000' })
                    ])
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Description'),
                    DOM.el('textarea', { className: 'form-input', id: 'new-proposal-desc', rows: '4', placeholder: 'Proposal details...' })
                ])
            ]);

            this.showModal('New Proposal', form, function() {
                alert('Proposal created (API integration pending)');
            });
        },

        // Email Actions
        showEmailComposer: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'To'),
                    DOM.el('input', { type: 'email', className: 'form-input', id: 'email-to', placeholder: 'recipient@example.com' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Subject'),
                    DOM.el('input', { type: 'text', className: 'form-input', id: 'email-subject', placeholder: 'Email subject...' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Message'),
                    DOM.el('textarea', { className: 'form-input', id: 'email-body', rows: '8', placeholder: 'Your message...' })
                ])
            ]);

            this.showModal('Compose Email', form, async function() {
                var emailData = {
                    to: document.getElementById('email-to').value,
                    subject: document.getElementById('email-subject').value,
                    body: document.getElementById('email-body').value
                };
                var result = await API.post('/api/v1/email/send', emailData);
                if (result) {
                    alert('Email sent successfully!');
                }
            });
        },

        selectEmailTemplate: function(template) {
            this.showEmailComposer();
            setTimeout(function() {
                var subjectEl = document.getElementById('email-subject');
                var bodyEl = document.getElementById('email-body');
                if (subjectEl && template.subject) subjectEl.value = template.subject;
                if (bodyEl && template.body) bodyEl.value = template.body;
            }, 100);
        },

        // WhatsApp Actions
        showWABroadcast: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Recipients'),
                    DOM.el('textarea', { className: 'form-input', id: 'wa-recipients', rows: '3', placeholder: '+49123456789, +49987654321' })
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Message'),
                    DOM.el('textarea', { className: 'form-input', id: 'wa-message', rows: '4', placeholder: 'Your broadcast message...' })
                ])
            ]);

            this.showModal('WhatsApp Broadcast', form, async function() {
                var data = {
                    recipients: document.getElementById('wa-recipients').value.split(',').map(function(r) { return r.trim(); }),
                    message: document.getElementById('wa-message').value
                };
                var result = await API.post('/api/whatsapp/broadcast', data);
                if (result) {
                    alert('Broadcast sent to ' + data.recipients.length + ' recipients');
                }
            });
        },

        // HAIKU Actions
        executeHaikuCommand: async function() {
            var input = document.getElementById('haiku-command');
            var command = input ? input.value.trim() : '';
            if (!command) return;

            var result = await API.post('/api/haiku/command', { command: command });
            if (result) {
                input.value = '';
                alert('HAIKU Response: ' + (result.response || result.message || 'Command executed'));
            }
        },

        // Invoice Actions
        showNewInvoiceModal: function() {
            var form = DOM.el('div', {}, [
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Client'),
                        DOM.el('input', { type: 'text', className: 'form-input', id: 'new-invoice-client', placeholder: 'Client name' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Amount'),
                        DOM.el('input', { type: 'number', className: 'form-input', id: 'new-invoice-amount', placeholder: '1000' })
                    ])
                ]),
                DOM.el('div', { className: 'grid grid-2 gap-4' }, [
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Due Date'),
                        DOM.el('input', { type: 'date', className: 'form-input', id: 'new-invoice-due' })
                    ]),
                    DOM.el('div', { className: 'form-group' }, [
                        DOM.el('label', { className: 'form-label' }, 'Currency'),
                        DOM.el('select', { className: 'form-input form-select', id: 'new-invoice-currency' }, [
                            DOM.el('option', { value: 'EUR' }, 'EUR'),
                            DOM.el('option', { value: 'USD' }, 'USD'),
                            DOM.el('option', { value: 'GBP' }, 'GBP')
                        ])
                    ])
                ]),
                DOM.el('div', { className: 'form-group' }, [
                    DOM.el('label', { className: 'form-label' }, 'Description'),
                    DOM.el('textarea', { className: 'form-input', id: 'new-invoice-desc', rows: '3', placeholder: 'Invoice items...' })
                ])
            ]);

            this.showModal('New Invoice', form, async function() {
                var data = {
                    client: document.getElementById('new-invoice-client').value,
                    amount: parseFloat(document.getElementById('new-invoice-amount').value),
                    dueDate: document.getElementById('new-invoice-due').value,
                    currency: document.getElementById('new-invoice-currency').value,
                    description: document.getElementById('new-invoice-desc').value
                };
                var result = await API.post('/api/v1/invoices', data);
                if (result) {
                    Modules.loadInvoicesTable();
                }
            });
        }
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // INIT
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    document.addEventListener('DOMContentLoaded', function() {
        UltimateApp.init();
    });

    // Close modal on overlay click
    document.getElementById('modal-overlay').addEventListener('click', function(e) {
        if (e.target === this) {
            UltimateApp.closeModal();
        }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        // Ctrl+K for search
        if (e.ctrlKey && e.key === 'k') {
            e.preventDefault();
            document.getElementById('search-trigger').click();
        }
        // Escape to close modal
        if (e.key === 'Escape') {
            UltimateApp.closeModal();
        }
    });
    </script>
</body>
</html>
