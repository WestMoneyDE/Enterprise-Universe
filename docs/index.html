<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>West Money OS | Business Operating System</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-0: #09090b; --bg-1: #0c0c0f; --bg-2: #131316; --bg-3: #1a1a1f; --bg-4: #222228;
            --text-0: #fafafa; --text-1: #d4d4d8; --text-2: #a1a1aa; --text-3: #71717a;
            --primary: #6366f1; --primary-hover: #818cf8; --primary-glow: rgba(99,102,241,0.15);
            --emerald: #10b981; --amber: #f59e0b; --rose: #f43f5e; --cyan: #06b6d4; --violet: #8b5cf6;
            --border: rgba(255,255,255,0.06); --border-hover: rgba(255,255,255,0.12);
            --whatsapp: #25d366; --email: #ea4335;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; background: var(--bg-0); color: var(--text-0); font-size: 14px; line-height: 1.5; min-height: 100vh; }
        
        /* LOGIN */
        .login-screen { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--bg-0) 0%, #0f0f1a 50%, #1a0a2e 100%); }
        .login-container { width: 100%; max-width: 420px; padding: 20px; }
        .login-logo { text-align: center; margin-bottom: 32px; }
        .login-logo-icon { width: 72px; height: 72px; background: linear-gradient(135deg, var(--primary), var(--violet)); border-radius: 18px; display: inline-flex; align-items: center; justify-content: center; font-size: 32px; margin-bottom: 16px; box-shadow: 0 8px 32px rgba(99,102,241,0.3); }
        .login-logo h1 { font-size: 28px; font-weight: 700; margin-bottom: 4px; background: linear-gradient(135deg, var(--text-0), var(--primary-hover)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .login-logo p { color: var(--text-3); font-size: 14px; }
        .login-box { background: var(--bg-2); border: 1px solid var(--border); border-radius: 16px; padding: 32px; box-shadow: 0 16px 64px rgba(0,0,0,0.4); }
        .login-box h2 { font-size: 18px; margin-bottom: 24px; text-align: center; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-size: 13px; font-weight: 500; margin-bottom: 8px; color: var(--text-1); }
        .form-input, .form-control { width: 100%; padding: 12px 14px; background: var(--bg-3); border: 1px solid var(--border); border-radius: 8px; color: var(--text-0); font-size: 14px; transition: all 0.2s; }
        .form-input:focus, .form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-glow); }
        .form-input::placeholder, .form-control::placeholder { color: var(--text-3); }
        .login-btn { width: 100%; padding: 14px; background: linear-gradient(135deg, var(--primary), var(--violet)); color: white; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(99,102,241,0.4); }
        .login-error { background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3); color: #ef4444; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 13px; text-align: center; display: none; }
        .login-error.show { display: block; }
        .login-footer { text-align: center; margin-top: 24px; color: var(--text-3); font-size: 12px; }
        
        /* APP */
        .app { display: none; min-height: 100vh; }
        .app.active { display: flex; }
        
        /* SIDEBAR */
        .sidebar { width: 260px; background: var(--bg-1); border-right: 1px solid var(--border); position: fixed; height: 100vh; display: flex; flex-direction: column; z-index: 100; }
        .sidebar-header { padding: 16px; border-bottom: 1px solid var(--border); }
        .logo { display: flex; align-items: center; gap: 10px; }
        .logo-icon { width: 36px; height: 36px; background: linear-gradient(135deg, var(--primary), var(--violet)); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .logo h1 { font-size: 15px; font-weight: 600; }
        .logo span { font-size: 10px; color: var(--text-3); display: block; }
        .sidebar-nav { flex: 1; padding: 8px; overflow-y: auto; }
        .nav-group { margin-bottom: 16px; }
        .nav-label { font-size: 10px; font-weight: 600; color: var(--text-3); text-transform: uppercase; letter-spacing: 0.5px; padding: 8px 12px 6px; }
        .nav-item { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 8px; cursor: pointer; color: var(--text-2); font-size: 13px; transition: all 0.15s; margin-bottom: 2px; }
        .nav-item:hover { background: var(--bg-3); color: var(--text-0); }
        .nav-item.active { background: var(--primary-glow); color: var(--primary-hover); border: 1px solid rgba(99,102,241,0.3); }
        .nav-item .icon { width: 20px; text-align: center; font-size: 15px; }
        .nav-item .label { flex: 1; }
        .nav-item .badge { background: var(--primary); color: white; font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: 600; }
        .nav-item .badge.hot { background: var(--rose); }
        .nav-item .badge.new { background: var(--emerald); }
        .nav-item .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--emerald); }
        .sidebar-footer { padding: 12px; border-top: 1px solid var(--border); }
        .user-box { display: flex; align-items: center; gap: 10px; padding: 10px; background: var(--bg-2); border-radius: 8px; cursor: pointer; }
        .user-box:hover { background: var(--bg-3); }
        .user-avatar { width: 36px; height: 36px; border-radius: 8px; background: linear-gradient(135deg, var(--emerald), var(--cyan)); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; }
        .user-info { flex: 1; }
        .user-info div { font-size: 13px; font-weight: 500; }
        .user-info span { color: var(--text-3); font-size: 11px; }
        .logout-btn { background: none; border: none; color: var(--text-3); cursor: pointer; padding: 6px; font-size: 16px; border-radius: 6px; }
        .logout-btn:hover { color: var(--rose); background: rgba(244,63,94,0.1); }
        
        /* MAIN */
        .main { flex: 1; margin-left: 260px; display: flex; flex-direction: column; min-height: 100vh; }
        .topbar { height: 56px; background: var(--bg-1); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 24px; position: sticky; top: 0; z-index: 50; }
        .topbar-left { display: flex; align-items: center; gap: 16px; }
        .breadcrumb { font-size: 13px; color: var(--text-2); }
        .breadcrumb strong { color: var(--text-0); }
        .status-badge { display: flex; align-items: center; gap: 6px; background: rgba(16,185,129,0.1); color: var(--emerald); padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; }
        .status-badge .pulse { width: 6px; height: 6px; background: var(--emerald); border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .topbar-right { display: flex; align-items: center; gap: 10px; }
        .search-box { display: flex; align-items: center; gap: 8px; background: var(--bg-2); border: 1px solid var(--border); border-radius: 8px; padding: 8px 14px; width: 220px; }
        .search-box input { background: none; border: none; outline: none; color: var(--text-0); font-size: 13px; width: 100%; }
        .topbar-btn { width: 36px; height: 36px; background: var(--bg-2); border: 1px solid var(--border); border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; position: relative; transition: all 0.15s; }
        .topbar-btn:hover { border-color: var(--primary); background: var(--primary-glow); }
        .topbar-btn .notif-dot { position: absolute; top: 6px; right: 6px; width: 8px; height: 8px; background: var(--rose); border-radius: 50%; border: 2px solid var(--bg-1); }
        
        /* CONTENT */
        .content { padding: 24px; flex: 1; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.2s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .page-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; }
        .page-header h1 { font-size: 24px; font-weight: 600; margin-bottom: 4px; }
        .page-header p { color: var(--text-2); font-size: 13px; }
        .page-actions { display: flex; gap: 10px; }
        
        /* BUTTONS */
        .btn { display: inline-flex; align-items: center; gap: 6px; padding: 10px 16px; border-radius: 8px; font-size: 13px; font-weight: 500; cursor: pointer; border: none; transition: all 0.15s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-1px); }
        .btn-secondary { background: var(--bg-3); color: var(--text-0); border: 1px solid var(--border); }
        .btn-secondary:hover { background: var(--bg-4); border-color: var(--border-hover); }
        .btn-danger { background: var(--rose); color: white; }
        .btn-success { background: var(--emerald); color: white; }
        .btn-gradient { background: linear-gradient(135deg, var(--primary), var(--violet)); color: white; }
        .btn-gradient:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(99,102,241,0.3); }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .btn-lg { padding: 12px 24px; font-size: 14px; }
        .btn-icon { width: 36px; height: 36px; padding: 0; justify-content: center; }
        
        /* STATS */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
        .stat-card { background: var(--bg-2); border: 1px solid var(--border); border-radius: 12px; padding: 20px; transition: all 0.2s; }
        .stat-card:hover { border-color: var(--border-hover); transform: translateY(-2px); }
        .stat-card.highlight { background: linear-gradient(135deg, rgba(99,102,241,0.1), rgba(139,92,246,0.1)); border-color: rgba(99,102,241,0.3); }
        .stat-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .stat-icon { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .stat-icon.primary { background: var(--primary-glow); }
        .stat-icon.cyan { background: rgba(6,182,212,0.15); }
        .stat-icon.emerald { background: rgba(16,185,129,0.15); }
        .stat-icon.amber { background: rgba(245,158,11,0.15); }
        .stat-icon.rose { background: rgba(244,63,94,0.15); }
        .stat-icon.violet { background: rgba(139,92,246,0.15); }
        .stat-trend { font-size: 11px; padding: 4px 8px; border-radius: 6px; font-weight: 600; }
        .stat-trend.up { background: rgba(16,185,129,0.15); color: var(--emerald); }
        .stat-trend.down { background: rgba(244,63,94,0.15); color: var(--rose); }
        .stat-value { font-size: 28px; font-weight: 700; margin-bottom: 4px; }
        .stat-label { font-size: 13px; color: var(--text-2); }
        
        /* CARDS */
        .card { background: var(--bg-2); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; margin-bottom: 16px; }
        .card-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .card-header h3 { font-size: 15px; font-weight: 600; }
        .card-body { padding: 20px; }
        .card-footer { padding: 12px 20px; border-top: 1px solid var(--border); background: var(--bg-3); }
        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        
        /* TABLE */
        .table-wrapper { overflow-x: auto; }
        .data-table { width: 100%; border-collapse: collapse; min-width: 600px; }
        .data-table th { text-align: left; padding: 12px 16px; font-size: 11px; font-weight: 600; color: var(--text-3); text-transform: uppercase; background: var(--bg-3); border-bottom: 1px solid var(--border); }
        .data-table td { padding: 14px 16px; font-size: 13px; border-bottom: 1px solid var(--border); vertical-align: middle; }
        .data-table tbody tr { transition: all 0.15s; }
        .data-table tbody tr:hover { background: var(--bg-3); }
        .data-table tbody tr.selected { background: var(--primary-glow); }
        
        /* STATUS */
        .status { display: inline-flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
        .status.active, .status.paid, .status.won, .status.hot { background: rgba(16,185,129,0.15); color: var(--emerald); }
        .status.pending, .status.new, .status.warm { background: rgba(245,158,11,0.15); color: var(--amber); }
        .status.overdue, .status.inactive, .status.cold { background: rgba(244,63,94,0.15); color: var(--rose); }
        .status.qualified { background: rgba(6,182,212,0.15); color: var(--cyan); }
        .status.proposal { background: rgba(139,92,246,0.15); color: var(--violet); }
        
        /* LEAD GENERATOR SPECIFIC */
        .search-panel { background: var(--bg-2); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 24px; }
        .search-panel h3 { font-size: 16px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .search-filters { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 16px; }
        .filter-group { }
        .filter-group label { display: block; font-size: 11px; font-weight: 600; color: var(--text-3); text-transform: uppercase; margin-bottom: 6px; }
        .filter-group select, .filter-group input { width: 100%; padding: 10px 12px; background: var(--bg-3); border: 1px solid var(--border); border-radius: 8px; color: var(--text-0); font-size: 13px; }
        .filter-group select:focus, .filter-group input:focus { outline: none; border-color: var(--primary); }
        .search-actions { display: flex; gap: 12px; justify-content: flex-end; padding-top: 16px; border-top: 1px solid var(--border); }
        
        .database-sources { display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
        .db-source { display: flex; align-items: center; gap: 8px; padding: 8px 14px; background: var(--bg-3); border: 1px solid var(--border); border-radius: 8px; font-size: 12px; cursor: pointer; transition: all 0.15s; }
        .db-source:hover { border-color: var(--primary); }
        .db-source.active { background: var(--primary-glow); border-color: var(--primary); color: var(--primary-hover); }
        .db-source .db-icon { font-size: 16px; }
        .db-source .db-count { background: var(--bg-4); padding: 2px 6px; border-radius: 4px; font-size: 10px; color: var(--text-3); }
        
        .lead-card { background: var(--bg-3); border: 1px solid var(--border); border-radius: 10px; padding: 16px; margin-bottom: 12px; cursor: pointer; transition: all 0.15s; }
        .lead-card:hover { border-color: var(--primary); transform: translateX(4px); }
        .lead-card.selected { border-color: var(--primary); background: var(--primary-glow); }
        .lead-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .lead-card-company { font-size: 15px; font-weight: 600; margin-bottom: 4px; }
        .lead-card-industry { font-size: 12px; color: var(--text-3); }
        .lead-card-score { display: flex; flex-direction: column; align-items: flex-end; }
        .score-value { font-size: 20px; font-weight: 700; }
        .score-value.high { color: var(--emerald); }
        .score-value.medium { color: var(--amber); }
        .score-value.low { color: var(--rose); }
        .score-label { font-size: 10px; color: var(--text-3); text-transform: uppercase; }
        .lead-card-meta { display: flex; gap: 16px; flex-wrap: wrap; }
        .lead-meta-item { display: flex; align-items: center; gap: 6px; font-size: 12px; color: var(--text-2); }
        .lead-card-actions { display: flex; gap: 8px; margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border); }
        
        .lead-detail-panel { background: var(--bg-2); border: 1px solid var(--border); border-radius: 12px; padding: 24px; position: sticky; top: 80px; }
        .lead-detail-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border); }
        .lead-detail-company { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
        .lead-detail-subtitle { font-size: 13px; color: var(--text-2); }
        .lead-detail-score { text-align: right; }
        .lead-detail-score .score-circle { width: 64px; height: 64px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: 700; margin-bottom: 4px; }
        .lead-detail-score .score-circle.high { background: rgba(16,185,129,0.15); color: var(--emerald); border: 3px solid var(--emerald); }
        .lead-detail-score .score-circle.medium { background: rgba(245,158,11,0.15); color: var(--amber); border: 3px solid var(--amber); }
        .lead-detail-score .score-circle.low { background: rgba(244,63,94,0.15); color: var(--rose); border: 3px solid var(--rose); }
        .lead-detail-section { margin-bottom: 20px; }
        .lead-detail-section h4 { font-size: 12px; font-weight: 600; color: var(--text-3); text-transform: uppercase; margin-bottom: 12px; }
        .lead-detail-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .detail-item { }
        .detail-item label { font-size: 11px; color: var(--text-3); display: block; margin-bottom: 2px; }
        .detail-item value { font-size: 13px; font-weight: 500; }
        .score-factors { }
        .score-factor { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid var(--border); }
        .score-factor:last-child { border-bottom: none; }
        .score-factor-icon { width: 28px; height: 28px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; }
        .score-factor-icon.positive { background: rgba(16,185,129,0.15); }
        .score-factor-icon.negative { background: rgba(244,63,94,0.15); }
        .score-factor-icon.neutral { background: rgba(245,158,11,0.15); }
        .score-factor-text { flex: 1; font-size: 12px; }
        .score-factor-value { font-size: 12px; font-weight: 600; }
        .score-factor-value.positive { color: var(--emerald); }
        .score-factor-value.negative { color: var(--rose); }
        
        .progress-bar { height: 6px; background: var(--bg-4); border-radius: 3px; overflow: hidden; }
        .progress-bar-fill { height: 100%; border-radius: 3px; transition: width 0.3s; }
        .progress-bar-fill.high { background: var(--emerald); }
        .progress-bar-fill.medium { background: var(--amber); }
        .progress-bar-fill.low { background: var(--rose); }
        
        .enrichment-badge { display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; background: var(--bg-4); border-radius: 4px; font-size: 10px; color: var(--text-2); }
        .enrichment-badge.verified { background: rgba(16,185,129,0.15); color: var(--emerald); }
        
        /* ACTIVITY & PIPELINE */
        .activity-item { display: flex; gap: 12px; padding: 14px 0; border-bottom: 1px solid var(--border); align-items: center; }
        .activity-item:last-child { border-bottom: none; }
        .activity-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; }
        .activity-content { flex: 1; }
        .activity-text { font-size: 13px; margin-bottom: 2px; }
        .activity-time { font-size: 11px; color: var(--text-3); }
        
        .pipeline { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
        .pipeline-stage { background: var(--bg-2); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
        .pipeline-header { padding: 14px 16px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .pipeline-header h4 { font-size: 13px; font-weight: 600; }
        .pipeline-header span { font-size: 12px; color: var(--text-3); }
        .pipeline-body { padding: 12px; min-height: 200px; }
        .pipeline-card { background: var(--bg-3); border: 1px solid var(--border); border-radius: 8px; padding: 12px; margin-bottom: 8px; cursor: pointer; transition: all 0.15s; }
        .pipeline-card:hover { border-color: var(--primary); }
        .pipeline-card h5 { font-size: 13px; font-weight: 500; margin-bottom: 4px; }
        .pipeline-card p { font-size: 11px; color: var(--text-3); }
        .pipeline-card .value { font-size: 14px; font-weight: 700; color: var(--emerald); margin-top: 8px; }
        
        /* API CARDS */
        .api-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .api-card { background: var(--bg-2); border: 1px solid var(--border); border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s; }
        .api-card:hover { border-color: var(--primary); transform: translateY(-2px); }
        .api-top { display: flex; align-items: center; gap: 12px; }
        .api-logo { width: 44px; height: 44px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
        .api-info h4 { font-size: 14px; font-weight: 600; }
        .api-info span { font-size: 11px; color: var(--text-3); }
        .api-status { margin-left: auto; font-size: 11px; }
        .api-status.connected { color: var(--emerald); }
        .api-status.pending { color: var(--amber); }
        
        /* FORMS */
        .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px; }
        select.form-control { cursor: pointer; }
        textarea.form-control { resize: vertical; min-height: 100px; font-family: inherit; }
        
        /* INBOX */
        .inbox-layout { display: grid; grid-template-columns: 350px 1fr; gap: 20px; height: calc(100vh - 180px); min-height: 500px; }
        .inbox-sidebar { background: var(--bg-2); border: 1px solid var(--border); border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; }
        .inbox-sidebar-header { padding: 16px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .inbox-sidebar-header h3 { font-size: 14px; font-weight: 600; }
        .inbox-tabs { display: flex; gap: 8px; padding: 12px 16px; border-bottom: 1px solid var(--border); }
        .inbox-tab { padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer; background: var(--bg-3); color: var(--text-2); transition: all 0.15s; display: flex; align-items: center; gap: 6px; }
        .inbox-tab:hover { color: var(--text-0); }
        .inbox-tab.active { background: var(--primary); color: white; }
        .inbox-tab .count { background: rgba(255,255,255,0.2); padding: 1px 6px; border-radius: 10px; font-size: 10px; }
        .inbox-list { flex: 1; overflow-y: auto; }
        .inbox-item { padding: 14px 16px; border-bottom: 1px solid var(--border); cursor: pointer; transition: all 0.15s; display: flex; gap: 12px; }
        .inbox-item:hover { background: var(--bg-3); }
        .inbox-item.active { background: var(--primary-glow); border-left: 3px solid var(--primary); }
        .inbox-item.unread { background: var(--bg-3); }
        .inbox-item.unread .inbox-item-name { font-weight: 600; }
        .inbox-item-avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
        .inbox-item-avatar.whatsapp { background: rgba(37, 211, 102, 0.15); color: var(--whatsapp); }
        .inbox-item-avatar.email { background: rgba(234, 67, 53, 0.15); color: var(--email); }
        .inbox-item-content { flex: 1; min-width: 0; }
        .inbox-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
        .inbox-item-name { font-size: 13px; font-weight: 500; }
        .inbox-item-time { font-size: 11px; color: var(--text-3); }
        .inbox-item-preview { font-size: 12px; color: var(--text-2); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .inbox-item-badge { width: 8px; height: 8px; background: var(--primary); border-radius: 50%; flex-shrink: 0; margin-top: 6px; }
        .inbox-main { background: var(--bg-2); border: 1px solid var(--border); border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; }
        .inbox-main-header { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .inbox-contact { display: flex; align-items: center; gap: 12px; }
        .inbox-contact-avatar { width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .inbox-contact-avatar.whatsapp { background: rgba(37, 211, 102, 0.15); color: var(--whatsapp); }
        .inbox-contact-avatar.email { background: rgba(234, 67, 53, 0.15); color: var(--email); }
        .inbox-contact-info h4 { font-size: 15px; font-weight: 600; margin-bottom: 2px; }
        .inbox-contact-info span { font-size: 12px; color: var(--text-3); }
        .inbox-actions { display: flex; gap: 8px; }
        .inbox-messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 16px; }
        .message { max-width: 70%; padding: 12px 16px; border-radius: 16px; position: relative; }
        .message.incoming { background: var(--bg-3); border: 1px solid var(--border); align-self: flex-start; border-bottom-left-radius: 4px; }
        .message.outgoing { background: var(--primary); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        .message-text { font-size: 13px; line-height: 1.5; }
        .message-time { font-size: 10px; color: var(--text-3); margin-top: 6px; text-align: right; }
        .message.outgoing .message-time { color: rgba(255,255,255,0.7); }
        .inbox-compose { padding: 16px 20px; border-top: 1px solid var(--border); background: var(--bg-3); }
        .compose-form { display: flex; gap: 12px; align-items: flex-end; }
        .compose-input { flex: 1; }
        .compose-input textarea { width: 100%; padding: 12px 14px; background: var(--bg-2); border: 1px solid var(--border); border-radius: 8px; color: var(--text-0); font-size: 13px; resize: none; min-height: 44px; max-height: 120px; font-family: inherit; }
        .compose-input textarea:focus { outline: none; border-color: var(--primary); }
        .compose-actions { display: flex; gap: 8px; }
        .inbox-empty { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-3); }
        .inbox-empty-icon { font-size: 48px; margin-bottom: 16px; }
        .inbox-empty h3 { font-size: 16px; color: var(--text-0); margin-bottom: 8px; }
        .inbox-empty p { font-size: 13px; }
        
        /* MODALS */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--bg-2); border: 1px solid var(--border); border-radius: 16px; width: 100%; max-width: 500px; max-height: 90vh; overflow: hidden; display: none; }
        .modal.active { display: block; }
        .modal-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { font-size: 16px; font-weight: 600; }
        .modal-close { background: none; border: none; color: var(--text-3); cursor: pointer; font-size: 24px; line-height: 1; }
        .modal-close:hover { color: var(--text-0); }
        .modal-body { padding: 24px; overflow-y: auto; max-height: 60vh; }
        .modal-footer { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 8px; }
        
        /* TOAST */
        .toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 2000; }
        .toast { background: var(--bg-2); border: 1px solid var(--border); border-radius: 10px; padding: 14px 20px; margin-top: 10px; display: flex; align-items: center; gap: 12px; min-width: 300px; box-shadow: 0 8px 32px rgba(0,0,0,0.4); animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(100%); } to { opacity: 1; transform: translateX(0); } }
        .toast.success { border-left: 3px solid var(--emerald); }
        .toast.error { border-left: 3px solid var(--rose); }
        .toast.info { border-left: 3px solid var(--primary); }
        .toast-icon { font-size: 18px; }
        .toast-content { flex: 1; }
        .toast-title { font-size: 13px; font-weight: 600; margin-bottom: 2px; }
        .toast-message { font-size: 12px; color: var(--text-2); }
        
        .chart-placeholder { height: 200px; background: var(--bg-3); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--text-3); font-size: 14px; }
        
        /* Loading */
        .loading-spinner { display: inline-block; width: 20px; height: 20px; border: 2px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* RESPONSIVE */
        @media (max-width: 1400px) { .search-filters { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 1200px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } .api-grid { grid-template-columns: repeat(2, 1fr); } .pipeline { grid-template-columns: repeat(2, 1fr); } .inbox-layout { grid-template-columns: 280px 1fr; } }
        @media (max-width: 768px) { .sidebar { display: none; } .main { margin-left: 0; } .stats-grid, .api-grid, .quick-actions, .search-filters { grid-template-columns: 1fr; } .grid-2, .grid-3, .pipeline, .form-row { grid-template-columns: 1fr; } .inbox-layout { grid-template-columns: 1fr; } .inbox-main { display: none; } }
    </style>
</head>
<body>

<!-- LOGIN -->
<div class="login-screen" id="loginScreen">
    <div class="login-container">
        <div class="login-logo">
            <div class="login-logo-icon">‚ö°</div>
            <h1>West Money OS</h1>
            <p>Business Operating System</p>
        </div>
        <div class="login-box">
            <h2>Anmelden</h2>
            <div class="login-error" id="loginError">Ung√ºltige Anmeldedaten. Bitte versuchen Sie es erneut.</div>
            <form id="loginForm">
                <div class="form-group">
                    <label>Benutzername</label>
                    <input type="text" id="username" class="form-input" placeholder="Benutzername eingeben" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label>Passwort</label>
                    <input type="password" id="password" class="form-input" placeholder="Passwort eingeben" required autocomplete="current-password">
                </div>
                <button type="submit" class="login-btn">üîê Anmelden</button>
            </form>
        </div>
        <div class="login-footer">¬© 2025 West Money OS ¬∑ Enterprise Universe GmbH</div>
    </div>
</div>

<!-- APP -->
<div class="app" id="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">‚ö°</div>
                <div><h1>West Money OS</h1><span>Business Operating System</span></div>
            </div>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-group">
                <div class="nav-label">√úbersicht</div>
                <div class="nav-item active" data-page="home"><span class="icon">üè†</span><span class="label">Home</span></div>
                <div class="nav-item" data-page="dashboard"><span class="icon">üìä</span><span class="label">Dashboard</span></div>
            </div>
            <div class="nav-group">
                <div class="nav-label">Lead Generation</div>
                <div class="nav-item" data-page="leadgen"><span class="icon">üîç</span><span class="label">Lead Generator</span><span class="badge new">NEU</span></div>
                <div class="nav-item" data-page="b2b"><span class="icon">üè¢</span><span class="label">B2B Datenbank</span><span class="badge" id="navB2B">0</span></div>
            </div>
            <div class="nav-group">
                <div class="nav-label">CRM & Sales</div>
                <div class="nav-item" data-page="contacts"><span class="icon">üë•</span><span class="label">Kontakte</span><span class="badge" id="navContacts">0</span></div>
                <div class="nav-item" data-page="leads"><span class="icon">üéØ</span><span class="label">Leads</span><span class="badge" id="navLeads">0</span></div>
                <div class="nav-item" data-page="pipeline"><span class="icon">üìà</span><span class="label">Pipeline</span></div>
            </div>
            <div class="nav-group">
                <div class="nav-label">Finance</div>
                <div class="nav-item" data-page="invoices"><span class="icon">üìÑ</span><span class="label">Rechnungen</span></div>
            </div>
            <div class="nav-group">
                <div class="nav-label">Communication</div>
                <div class="nav-item" data-page="inbox"><span class="icon">üì•</span><span class="label">Inbox</span><span class="badge hot" id="navUnread">0</span></div>
            </div>
            <div class="nav-group">
                <div class="nav-label">Platform</div>
                <div class="nav-item" data-page="integrations"><span class="icon">üîå</span><span class="label">Integrationen</span></div>
                <div class="nav-item" data-page="settings"><span class="icon">‚öôÔ∏è</span><span class="label">Einstellungen</span></div>
            </div>
        </nav>
        <div class="sidebar-footer">
            <div class="user-box">
                <div class="user-avatar" id="userAvatar">√ñC</div>
                <div class="user-info"><div id="userName">√ñmer Co≈ükun</div><span id="userRole">Administrator</span></div>
                <button class="logout-btn" onclick="logout()" title="Abmelden">üö™</button>
            </div>
        </div>
    </aside>
    
    <!-- MAIN -->
    <main class="main">
        <header class="topbar">
            <div class="topbar-left">
                <div class="breadcrumb">West Money OS / <strong id="currentPage">Home</strong></div>
                <div class="status-badge"><span class="pulse"></span>System Online</div>
            </div>
            <div class="topbar-right">
                <div class="search-box"><span>üîç</span><input type="text" placeholder="Suchen..."></div>
                <div class="topbar-btn" onclick="showPage('inbox')"><span>üîî</span><span class="notif-dot"></span></div>
            </div>
        </header>
        
        <div class="content" id="pageContent"></div>
    </main>
</div>

<!-- MODALS -->
<div class="modal-overlay" id="modalOverlay">
    <div class="modal" id="modalContact">
        <div class="modal-header"><h2>Neuer Kontakt</h2><button class="modal-close" onclick="closeModal()">√ó</button></div>
        <div class="modal-body">
            <div class="form-row">
                <div class="form-group"><label>Vorname *</label><input type="text" class="form-control" id="cFirst" placeholder="Max"></div>
                <div class="form-group"><label>Nachname *</label><input type="text" class="form-control" id="cLast" placeholder="Mustermann"></div>
            </div>
            <div class="form-group"><label>E-Mail *</label><input type="email" class="form-control" id="cEmail" placeholder="max@beispiel.de"></div>
            <div class="form-group"><label>Telefon</label><input type="tel" class="form-control" id="cPhone" placeholder="+49 123 456789"></div>
            <div class="form-group"><label>Firma</label><input type="text" class="form-control" id="cCompany" placeholder="Firma GmbH"></div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button>
            <button class="btn btn-primary" onclick="saveContact()">Speichern</button>
        </div>
    </div>
    
    <div class="modal" id="modalLead">
        <div class="modal-header"><h2>Neuer Lead</h2><button class="modal-close" onclick="closeModal()">√ó</button></div>
        <div class="modal-body">
            <div class="form-group"><label>Name *</label><input type="text" class="form-control" id="lName" placeholder="Lead Name"></div>
            <div class="form-group"><label>Firma</label><input type="text" class="form-control" id="lCompany" placeholder="Firma GmbH"></div>
            <div class="form-group"><label>Wert (‚Ç¨)</label><input type="number" class="form-control" id="lValue" placeholder="25000"></div>
            <div class="form-group"><label>Quelle</label>
                <select class="form-control" id="lSource">
                    <option value="Lead Generator">Lead Generator</option>
                    <option value="Website">Website</option>
                    <option value="Referral">Empfehlung</option>
                    <option value="Ads">Werbung</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button>
            <button class="btn btn-primary" onclick="saveLead()">Speichern</button>
        </div>
    </div>
    
    <div class="modal" id="modalInvoice">
        <div class="modal-header"><h2>Neue Rechnung</h2><button class="modal-close" onclick="closeModal()">√ó</button></div>
        <div class="modal-body">
            <div class="form-group"><label>Kunde *</label><input type="text" class="form-control" id="iCustomer" placeholder="Kundenname"></div>
            <div class="form-group"><label>Betrag (‚Ç¨) *</label><input type="number" class="form-control" id="iAmount" placeholder="1000"></div>
            <div class="form-group"><label>Beschreibung</label><textarea class="form-control" id="iDesc" placeholder="Leistungsbeschreibung"></textarea></div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button>
            <button class="btn btn-primary" onclick="saveInvoice()">Erstellen</button>
        </div>
    </div>
    
    <div class="modal" id="modalMessage">
        <div class="modal-header"><h2>Neue Nachricht</h2><button class="modal-close" onclick="closeModal()">√ó</button></div>
        <div class="modal-body">
            <div class="form-group">
                <label>Kanal</label>
                <select class="form-control" id="msgChannel">
                    <option value="whatsapp">üí¨ WhatsApp</option>
                    <option value="email">üìß E-Mail</option>
                </select>
            </div>
            <div class="form-group"><label>Empf√§nger *</label><input type="text" class="form-control" id="msgTo" placeholder="Name oder Telefon/E-Mail"></div>
            <div class="form-group"><label>Nachricht *</label><textarea class="form-control" id="msgText" placeholder="Ihre Nachricht..." rows="4"></textarea></div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button>
            <button class="btn btn-primary" onclick="sendNewMessage()">üì§ Senden</button>
        </div>
    </div>
    
    <!-- Campaign Modal -->
    <div class="modal" id="modalCampaign" style="max-width:600px">
        <div class="modal-header"><h2>üìß Neue Kampagne erstellen</h2><button class="modal-close" onclick="closeModal()">√ó</button></div>
        <div class="modal-body">
            <div class="form-group"><label>Kampagnen-Name *</label><input type="text" class="form-control" id="campName" placeholder="z.B. Q1 2026 Outreach"></div>
            <div class="form-row">
                <div class="form-group"><label>Kampagnen-Typ</label>
                    <select class="form-control" id="campType">
                        <option value="email">üìß E-Mail Kampagne</option>
                        <option value="whatsapp">üí¨ WhatsApp Kampagne</option>
                        <option value="multi">üîÑ Multi-Channel</option>
                    </select>
                </div>
                <div class="form-group"><label>Zielgruppe</label>
                    <select class="form-control" id="campTarget">
                        <option value="all">Alle Leads</option>
                        <option value="new">Nur neue Leads</option>
                        <option value="qualified">Qualifizierte Leads</option>
                        <option value="cold">Kalte Leads reaktivieren</option>
                        <option value="b2b">B2B Datenbank</option>
                    </select>
                </div>
            </div>
            <div class="form-group"><label>Betreff (E-Mail)</label><input type="text" class="form-control" id="campSubject" placeholder="Betreffzeile f√ºr E-Mails"></div>
            <div class="form-group"><label>Nachricht *</label><textarea class="form-control" id="campMessage" rows="5" placeholder="Hallo {name},

wir von West Money Bau m√∂chten Ihnen unsere Smart Home L√∂sungen vorstellen...

Mit freundlichen Gr√º√üen
√ñmer Co≈ükun"></textarea></div>
            <div style="background:var(--bg-3);border-radius:8px;padding:12px;margin-top:12px">
                <div style="font-size:12px;font-weight:600;margin-bottom:8px">üìä Variablen verf√ºgbar:</div>
                <div style="display:flex;flex-wrap:wrap;gap:8px">
                    <code style="background:var(--bg-4);padding:2px 8px;border-radius:4px;font-size:11px">{name}</code>
                    <code style="background:var(--bg-4);padding:2px 8px;border-radius:4px;font-size:11px">{company}</code>
                    <code style="background:var(--bg-4);padding:2px 8px;border-radius:4px;font-size:11px">{industry}</code>
                    <code style="background:var(--bg-4);padding:2px 8px;border-radius:4px;font-size:11px">{city}</code>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button>
            <button class="btn btn-secondary" onclick="saveCampaignDraft()">üíæ Als Entwurf</button>
            <button class="btn btn-gradient" onclick="startCampaign()">üöÄ Kampagne starten</button>
        </div>
    </div>
    
    <!-- Outreach Modal -->
    <div class="modal" id="modalOutreach" style="max-width:550px">
        <div class="modal-header"><h2>üìû Anfrage starten</h2><button class="modal-close" onclick="closeModal()">√ó</button></div>
        <div class="modal-body">
            <div class="form-group"><label>Lead ausw√§hlen *</label>
                <select class="form-control" id="outreachLead">
                    <option value="">-- Lead ausw√§hlen --</option>
                    ${data.leads.map(l => `<option value="${l.id}">${l.company} - ${l.name}</option>`).join('')}
                </select>
            </div>
            <div class="form-row">
                <div class="form-group"><label>Kontakt-Art</label>
                    <select class="form-control" id="outreachType">
                        <option value="call">üìû Telefonanruf</option>
                        <option value="email">üìß E-Mail</option>
                        <option value="whatsapp">üí¨ WhatsApp</option>
                        <option value="meeting">üìÖ Meeting</option>
                        <option value="linkedin">üíº LinkedIn</option>
                    </select>
                </div>
                <div class="form-group"><label>Priorit√§t</label>
                    <select class="form-control" id="outreachPriority">
                        <option value="high">üî¥ Hoch</option>
                        <option value="medium">üü° Mittel</option>
                        <option value="low">üü¢ Niedrig</option>
                    </select>
                </div>
            </div>
            <div class="form-group"><label>Notizen</label><textarea class="form-control" id="outreachNotes" rows="3" placeholder="Gespr√§chsnotizen, Ziele, etc."></textarea></div>
            <div class="form-group"><label>Follow-up Datum</label><input type="datetime-local" class="form-control" id="outreachFollowup"></div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button>
            <button class="btn btn-primary" onclick="saveOutreach()">üìû Anfrage speichern</button>
        </div>
    </div>
    
    <!-- Sequence Modal -->
    <div class="modal" id="modalSequence" style="max-width:650px">
        <div class="modal-header"><h2>‚ö° Automatisierte Sequenz erstellen</h2><button class="modal-close" onclick="closeModal()">√ó</button></div>
        <div class="modal-body">
            <div class="form-group"><label>Sequenz-Name *</label><input type="text" class="form-control" id="seqName" placeholder="z.B. Neue Lead Nurturing"></div>
            <div class="form-group"><label>Trigger</label>
                <select class="form-control" id="seqTrigger">
                    <option value="new_lead">üÜï Neuer Lead erstellt</option>
                    <option value="status_change">üìä Status-√Ñnderung</option>
                    <option value="no_response">‚è∞ Keine Antwort nach X Tagen</option>
                    <option value="manual">üëÜ Manuell einschreiben</option>
                </select>
            </div>
            
            <div style="margin:20px 0">
                <div style="font-size:13px;font-weight:600;margin-bottom:12px">üìã Sequenz-Schritte</div>
                <div id="sequenceSteps">
                    <div class="sequence-step" style="background:var(--bg-3);border:1px solid var(--border);border-radius:8px;padding:12px;margin-bottom:8px">
                        <div style="display:flex;align-items:center;gap:12px">
                            <span style="background:var(--primary);color:white;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600">1</span>
                            <select class="form-control" style="width:auto">
                                <option value="email">üìß E-Mail senden</option>
                                <option value="whatsapp">üí¨ WhatsApp senden</option>
                                <option value="task">üìã Aufgabe erstellen</option>
                                <option value="wait">‚è∞ Warten</option>
                            </select>
                            <span style="color:var(--text-3)">nach</span>
                            <input type="number" class="form-control" style="width:60px" value="0">
                            <select class="form-control" style="width:auto">
                                <option value="minutes">Minuten</option>
                                <option value="hours">Stunden</option>
                                <option value="days" selected>Tagen</option>
                            </select>
                        </div>
                    </div>
                    <div class="sequence-step" style="background:var(--bg-3);border:1px solid var(--border);border-radius:8px;padding:12px;margin-bottom:8px">
                        <div style="display:flex;align-items:center;gap:12px">
                            <span style="background:var(--primary);color:white;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600">2</span>
                            <select class="form-control" style="width:auto">
                                <option value="email">üìß E-Mail senden</option>
                                <option value="whatsapp">üí¨ WhatsApp senden</option>
                                <option value="task" selected>üìã Aufgabe erstellen</option>
                                <option value="wait">‚è∞ Warten</option>
                            </select>
                            <span style="color:var(--text-3)">nach</span>
                            <input type="number" class="form-control" style="width:60px" value="3">
                            <select class="form-control" style="width:auto">
                                <option value="days" selected>Tagen</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button class="btn btn-sm btn-secondary" onclick="addSequenceStep()" style="width:100%;margin-top:8px">+ Schritt hinzuf√ºgen</button>
            </div>
            
            <div class="form-group">
                <label><input type="checkbox" id="seqAutoEnroll" checked> Leads automatisch einschreiben</label>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button>
            <button class="btn btn-gradient" onclick="saveSequence()">‚ö° Sequenz erstellen</button>
        </div>
    </div>
    
    <!-- Lead Status Modal -->
    <div class="modal" id="modalLeadStatus" style="max-width:400px">
        <div class="modal-header"><h2>üìä Lead Status √§ndern</h2><button class="modal-close" onclick="closeModal()">√ó</button></div>
        <div class="modal-body">
            <div id="leadStatusContent"></div>
        </div>
    </div>
</div>

<div class="toast-container" id="toastContainer"></div>

<script>
// ==================== DATA ====================
const defaultData = {
    contacts: [
        { id: 1, firstName: 'Max', lastName: 'M√ºller', email: 'max@mueller.de', phone: '+49 221 1234567', company: 'M√ºller Bau GmbH', status: 'active' },
        { id: 2, firstName: 'Anna', lastName: 'Schmidt', email: 'anna@schmidt.de', phone: '+49 221 7654321', company: 'Schmidt Immobilien', status: 'active' },
        { id: 3, firstName: 'Thomas', lastName: 'Weber', email: 'thomas@weber.de', phone: '+49 221 9876543', company: 'Weber Haus', status: 'pending' },
        { id: 4, firstName: 'Lisa', lastName: 'Fischer', email: 'lisa@fischer.de', phone: '+49 221 5432167', company: 'Fischer GmbH', status: 'active' },
        { id: 5, firstName: 'Michael', lastName: 'Bauer', email: 'michael@bauer.de', phone: '+49 221 6789012', company: 'Bauer Gruppe', status: 'active' }
    ],
    leads: [
        { id: 1, name: 'Smart Home Projekt', company: 'M√ºller GmbH', value: 45000, status: 'qualified', source: 'Website' },
        { id: 2, name: 'Barrierefreies Bauen', company: 'Weber Bau', value: 28000, status: 'new', source: 'Lead Generator' },
        { id: 3, name: 'Komplettsanierung', company: 'Schmidt Haus', value: 62000, status: 'won', source: 'Ads' },
        { id: 4, name: 'LOXONE Installation', company: 'Fischer Immo', value: 18000, status: 'proposal', source: 'Website' },
        { id: 5, name: 'Neubau EFH', company: 'Becker Familie', value: 85000, status: 'new', source: 'Lead Generator' }
    ],
    invoices: [
        { id: 'RE-2025-001', customer: 'M√ºller GmbH', amount: 45000, status: 'paid', date: '2025-12-01' },
        { id: 'RE-2025-002', customer: 'Weber Bau', amount: 28000, status: 'pending', date: '2025-12-10' },
        { id: 'RE-2025-003', customer: 'Schmidt Haus', amount: 62000, status: 'paid', date: '2025-11-25' },
        { id: 'RE-2025-004', customer: 'Fischer GmbH', amount: 18000, status: 'overdue', date: '2025-11-01' }
    ],
    activities: [
        { icon: 'üîç', text: '12 neue B2B Leads gefunden', time: '5 Min.' },
        { icon: 'üéØ', text: 'Lead qualifiziert: M√ºller Bau', time: '12 Min.' },
        { icon: 'üí∞', text: 'Zahlung eingegangen: ‚Ç¨45,000', time: '1 Std.' },
        { icon: 'üìß', text: 'E-Mail Kampagne gesendet', time: '2 Std.' },
        { icon: 'üéâ', text: 'Deal gewonnen: ‚Ç¨62,000', time: '3 Std.' }
    ],
    conversations: [
        { id: 1, contact: 'Max M√ºller', phone: '+49 221 1234567', type: 'whatsapp', unread: true, messages: [
            { id: 1, text: 'Guten Tag, hier ist das Angebot.', time: '10:30', outgoing: true },
            { id: 2, text: 'Vielen Dank! Ich schaue es mir an.', time: '10:45', outgoing: false }
        ]},
        { id: 2, contact: 'Anna Schmidt', phone: '+49 221 7654321', type: 'whatsapp', unread: false, messages: [
            { id: 1, text: 'Termin best√§tigt f√ºr Freitag.', time: '09:15', outgoing: true }
        ]},
        { id: 3, contact: 'Lisa Fischer', email: 'lisa@fischer.de', type: 'email', subject: 'Anfrage', unread: true, messages: [
            { id: 1, text: 'Interesse an LOXONE Installation.', time: '08:15', outgoing: false }
        ]}
    ],
    b2bDatabase: [
        { id: 1, company: 'Bauhaus K√∂ln GmbH', industry: 'Baugewerbe', employees: '50-100', revenue: '‚Ç¨10-25M', city: 'K√∂ln', website: 'bauhaus-koeln.de', phone: '+49 221 9876543', email: 'info@bauhaus-koeln.de', score: 87, status: 'hot', decisionMaker: 'Thomas Bauer', position: 'Gesch√§ftsf√ºhrer', founded: 2008, verified: true },
        { id: 2, company: 'Rhein Immobilien AG', industry: 'Immobilien', employees: '100-250', revenue: '‚Ç¨25-50M', city: 'D√ºsseldorf', website: 'rhein-immo.de', phone: '+49 211 1234567', email: 'kontakt@rhein-immo.de', score: 92, status: 'hot', decisionMaker: 'Maria Weber', position: 'Vorstand', founded: 1995, verified: true },
        { id: 3, company: 'NRW Elektrotechnik', industry: 'Elektro', employees: '25-50', revenue: '‚Ç¨5-10M', city: 'Essen', website: 'nrw-elektro.de', phone: '+49 201 5678901', email: 'info@nrw-elektro.de', score: 74, status: 'warm', decisionMaker: 'Klaus Fischer', position: 'Inhaber', founded: 2012, verified: true },
        { id: 4, company: 'Smart Home Solutions', industry: 'Technologie', employees: '10-25', revenue: '‚Ç¨1-5M', city: 'Bonn', website: 'smarthome-sol.de', phone: '+49 228 3456789', email: 'hello@smarthome-sol.de', score: 81, status: 'warm', decisionMaker: 'Sarah Klein', position: 'CEO', founded: 2018, verified: false },
        { id: 5, company: 'Facility Management Plus', industry: 'Dienstleistung', employees: '100-250', revenue: '‚Ç¨10-25M', city: 'K√∂ln', website: 'fm-plus.de', phone: '+49 221 7654321', email: 'info@fm-plus.de', score: 68, status: 'cold', decisionMaker: 'Michael Braun', position: 'Gesch√§ftsleitung', founded: 2005, verified: true },
        { id: 6, company: 'Architekten Meier & Partner', industry: 'Architektur', employees: '10-25', revenue: '‚Ç¨1-5M', city: 'K√∂ln', website: 'meier-architekten.de', phone: '+49 221 2345678', email: 'buero@meier-architekten.de', score: 79, status: 'warm', decisionMaker: 'Dr. Hans Meier', position: 'Partner', founded: 2001, verified: true },
        { id: 7, company: 'K√∂lner Wohnbau GmbH', industry: 'Baugewerbe', employees: '50-100', revenue: '‚Ç¨25-50M', city: 'K√∂ln', website: 'koelner-wohnbau.de', phone: '+49 221 8765432', email: 'kontakt@koelner-wohnbau.de', score: 95, status: 'hot', decisionMaker: 'Peter Schmidt', position: 'Gesch√§ftsf√ºhrer', founded: 1990, verified: true },
        { id: 8, company: 'Energie Consulting West', industry: 'Beratung', employees: '10-25', revenue: '‚Ç¨1-5M', city: 'Aachen', website: 'energie-west.de', phone: '+49 241 9876543', email: 'info@energie-west.de', score: 71, status: 'warm', decisionMaker: 'Julia Hoffmann', position: 'Inhaberin', founded: 2015, verified: false },
        { id: 9, company: 'Premium Hausbau AG', industry: 'Baugewerbe', employees: '250-500', revenue: '‚Ç¨50-100M', city: 'D√ºsseldorf', website: 'premium-hausbau.de', phone: '+49 211 5432109', email: 'info@premium-hausbau.de', score: 89, status: 'hot', decisionMaker: 'Frank Richter', position: 'Vorstandsvorsitzender', founded: 1985, verified: true },
        { id: 10, company: 'TechBau Innovation', industry: 'Technologie', employees: '25-50', revenue: '‚Ç¨5-10M', city: 'K√∂ln', website: 'techbau-innovation.de', phone: '+49 221 1357924', email: 'kontakt@techbau-innovation.de', score: 83, status: 'warm', decisionMaker: 'Anna Krause', position: 'Gesch√§ftsf√ºhrerin', founded: 2019, verified: true }
    ],
    integrations: [
        { name: 'HubSpot', type: 'CRM', logo: 'hubspot', status: 'connected' },
        { name: 'WhatsApp', type: 'Messaging', logo: 'whatsapp', status: 'connected' },
        { name: 'Handelsregister', type: 'Datenbank', logo: 'database', status: 'connected' },
        { name: 'Bundesanzeiger', type: 'Datenbank', logo: 'database', status: 'connected' },
        { name: 'LinkedIn', type: 'Social', logo: 'linkedin', status: 'pending' },
        { name: 'XING', type: 'Social', logo: 'xing', status: 'pending' }
    ],
    campaigns: [
        { id: 1, name: 'Smart Home Q1 2026', type: 'email', sent: 45, total: 120, openRate: 42, status: 'active' },
        { id: 2, name: 'B2B Baugewerbe NRW', type: 'email', sent: 89, total: 89, openRate: 38, status: 'completed' },
        { id: 3, name: 'WhatsApp Follow-up', type: 'whatsapp', sent: 23, total: 50, openRate: 67, status: 'active' }
    ],
    outreach: [
        { id: 1, lead: 'M√ºller GmbH', type: 'call', date: '23.12.2025', result: 'positive', notes: 'Interesse an Smart Home' },
        { id: 2, lead: 'Weber Bau', type: 'email', date: '22.12.2025', result: 'callback', notes: 'R√ºckruf am Montag' },
        { id: 3, lead: 'Schmidt Haus', type: 'whatsapp', date: '22.12.2025', result: 'positive', notes: 'Termin vereinbart' },
        { id: 4, lead: 'Fischer Immo', type: 'call', date: '21.12.2025', result: 'noAnswer', notes: '' },
        { id: 5, lead: 'Bauer Gruppe', type: 'email', date: '21.12.2025', result: 'pending', notes: 'Angebot gesendet' }
    ],
    sequences: [
        { id: 1, name: 'Neuer Lead Welcome', steps: 4, enrolled: 12, progress: 75, active: true },
        { id: 2, name: 'Cold Lead Reaktivierung', steps: 6, enrolled: 34, progress: 45, active: true },
        { id: 3, name: 'Post-Meeting Follow-up', steps: 3, enrolled: 8, progress: 90, active: false }
    ]
};

let data = JSON.parse(localStorage.getItem('wmos_data_v2')) || JSON.parse(JSON.stringify(defaultData));
let currentUser = JSON.parse(localStorage.getItem('wmos_user'));
let currentPage = localStorage.getItem('wmos_page') || 'home';
let selectedConversation = null;
let selectedB2BLead = null;

function saveData() { localStorage.setItem('wmos_data_v2', JSON.stringify(data)); }
function statusLabel(s) { return { new: 'Neu', qualified: 'Qualifiziert', proposal: 'Angebot', won: 'Gewonnen', active: 'Aktiv', pending: 'Ausstehend', paid: 'Bezahlt', overdue: '√úberf√§llig', hot: 'Hot üî•', warm: 'Warm', cold: 'Cold' }[s] || s; }
function showToast(type, title, message) {
    const c = document.getElementById('toastContainer'), t = document.createElement('div');
    t.className = 'toast ' + type;
    t.innerHTML = `<span class="toast-icon">${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span><div class="toast-content"><div class="toast-title">${title}</div><div class="toast-message">${message}</div></div>`;
    c.appendChild(t);
    setTimeout(() => { t.style.opacity = '0'; setTimeout(() => t.remove(), 300); }, 4000);
}

// ==================== AUTH ====================
function handleLogin(e) {
    e.preventDefault();
    const u = document.getElementById('username').value, p = document.getElementById('password').value;
    if ((u === 'admin' && p === '663724') || (u === 'admin' && p === 'admin') || (u === 'demo' && p === 'demo')) {
        currentUser = { name: u === 'admin' && p === '663724' ? '√ñmer Co≈ükun' : 'Demo User', role: p === '663724' ? 'Administrator' : 'Demo' };
        localStorage.setItem('wmos_user', JSON.stringify(currentUser));
        showApp();
    } else {
        document.getElementById('loginError').classList.add('show');
    }
}

function logout() {
    localStorage.removeItem('wmos_user');
    currentUser = null;
    document.getElementById('loginScreen').style.display = 'flex';
    document.getElementById('app').classList.remove('active');
    document.getElementById('username').value = '';
    document.getElementById('password').value = '';
    document.getElementById('loginError').classList.remove('show');
}

function showApp() {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('app').classList.add('active');
    document.getElementById('userName').textContent = currentUser.name;
    document.getElementById('userRole').textContent = currentUser.role;
    document.getElementById('userAvatar').textContent = currentUser.name.substring(0, 2).toUpperCase();
    showPage(currentPage);
    showToast('success', 'Willkommen!', `Angemeldet als ${currentUser.name}`);
}

// ==================== PAGES ====================
const pageNames = { home: 'Home', dashboard: 'Dashboard', leadgen: 'Lead Generator', b2b: 'B2B Datenbank', contacts: 'Kontakte', leads: 'Leads', pipeline: 'Pipeline', invoices: 'Rechnungen', inbox: 'Inbox', integrations: 'Integrationen', settings: 'Einstellungen' };

function showPage(pageId) {
    currentPage = pageId;
    localStorage.setItem('wmos_page', pageId);
    document.getElementById('currentPage').textContent = pageNames[pageId] || pageId;
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    const nav = document.querySelector(`.nav-item[data-page="${pageId}"]`);
    if (nav) nav.classList.add('active');
    renderPage(pageId);
    updateStats();
}

function updateStats() {
    document.getElementById('navContacts').textContent = data.contacts.length;
    document.getElementById('navLeads').textContent = data.leads.length;
    document.getElementById('navB2B').textContent = data.b2bDatabase.length;
    document.getElementById('navUnread').textContent = data.conversations.filter(c => c.unread).length;
}

function renderPage(pageId) {
    const content = document.getElementById('pageContent');
    const renderers = { home: renderHome, dashboard: renderDashboard, leadgen: renderLeadGenerator, b2b: renderB2BDatabase, contacts: renderContacts, leads: renderLeads, pipeline: renderPipeline, invoices: renderInvoices, inbox: renderInbox, integrations: renderIntegrations, settings: renderSettings };
    content.innerHTML = (renderers[pageId] || (() => '<p>Seite nicht gefunden</p>'))();
    if (pageId === 'inbox') initInbox();
    if (pageId === 'leadgen' || pageId === 'b2b') initLeadGen();
}

function renderHome() {
    const hotLeads = data.b2bDatabase.filter(l => l.status === 'hot').length;
    return `<div class="page active">
        <div class="page-header"><div><h1>Willkommen zur√ºck! üëã</h1><p>Business-√úberblick f√ºr heute</p></div><div class="page-actions"><button class="btn btn-gradient" onclick="showPage('leadgen')">üîç Lead Generator</button></div></div>
        <div class="stats-grid">
            <div class="stat-card highlight"><div class="stat-top"><div class="stat-icon violet">üî•</div><div class="stat-trend up">‚Üë ${hotLeads}</div></div><div class="stat-value">${data.b2bDatabase.length}</div><div class="stat-label">B2B Leads</div></div>
            <div class="stat-card"><div class="stat-top"><div class="stat-icon primary">üí∞</div><div class="stat-trend up">‚Üë 23.5%</div></div><div class="stat-value">‚Ç¨847K</div><div class="stat-label">Umsatz</div></div>
            <div class="stat-card"><div class="stat-top"><div class="stat-icon cyan">üë•</div></div><div class="stat-value">${data.contacts.length}</div><div class="stat-label">Kontakte</div></div>
            <div class="stat-card"><div class="stat-top"><div class="stat-icon emerald">üéØ</div></div><div class="stat-value">${data.leads.length}</div><div class="stat-label">Leads</div></div>
        </div>
        <div class="grid-2">
            <div class="card"><div class="card-header"><h3>üìä Aktivit√§ten</h3></div><div class="card-body">${data.activities.map(a => `<div class="activity-item"><div class="activity-icon" style="background:var(--primary-glow)">${a.icon}</div><div class="activity-content"><div class="activity-text">${a.text}</div><div class="activity-time">${a.time}</div></div></div>`).join('')}</div></div>
            <div class="card"><div class="card-header"><h3>üî• Hot B2B Leads</h3><button class="btn btn-sm btn-secondary" onclick="showPage('b2b')">Alle anzeigen</button></div><div class="card-body">${data.b2bDatabase.filter(l => l.status === 'hot').slice(0, 4).map(l => `<div class="activity-item" style="cursor:pointer" onclick="showPage('b2b')"><div class="activity-icon" style="background:rgba(16,185,129,0.15)">üè¢</div><div class="activity-content"><div class="activity-text"><strong>${l.company}</strong></div><div class="activity-time">${l.industry} ¬∑ ${l.city}</div></div><span class="status hot">${l.score}%</span></div>`).join('')}</div></div>
        </div>
    </div>`;
}

function renderDashboard() {
    const hotLeads = data.b2bDatabase.filter(l => l.status === 'hot').length;
    const warmLeads = data.b2bDatabase.filter(l => l.status === 'warm').length;
    return `<div class="page active">
        <div class="page-header"><div><h1>Dashboard</h1><p>KPIs & Analytics</p></div></div>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-value">‚Ç¨847K</div><div class="stat-label">Umsatz YTD</div></div>
            <div class="stat-card"><div class="stat-value">${data.b2bDatabase.length}</div><div class="stat-label">B2B Leads</div></div>
            <div class="stat-card"><div class="stat-value">${hotLeads}</div><div class="stat-label">Hot Leads üî•</div></div>
            <div class="stat-card"><div class="stat-value">29%</div><div class="stat-label">Conversion</div></div>
        </div>
        <div class="grid-2">
            <div class="card"><div class="card-header"><h3>üìà Lead Score Verteilung</h3></div><div class="card-body"><div class="chart-placeholder">Hot: ${hotLeads} | Warm: ${warmLeads} | Cold: ${data.b2bDatabase.length - hotLeads - warmLeads}</div></div></div>
            <div class="card"><div class="card-header"><h3>üè¢ Branchen</h3></div><div class="card-body"><div class="chart-placeholder">Bau: 40% | Immo: 25% | Tech: 20% | Andere: 15%</div></div></div>
        </div>
    </div>`;
}

function renderLeadGenerator() {
    return `<div class="page active">
        <div class="page-header"><div><h1>üîç Lead Generator</h1><p>B2B Leads aus √∂ffentlichen Datenbanken qualifizieren</p></div></div>
        
        <div class="search-panel">
            <h3>üóÑÔ∏è Datenquellen</h3>
            <div class="database-sources">
                <div class="db-source active"><span class="db-icon">üìã</span>Handelsregister<span class="db-count">2.5M</span></div>
                <div class="db-source active"><span class="db-icon">üì∞</span>Bundesanzeiger<span class="db-count">1.8M</span></div>
                <div class="db-source"><span class="db-icon">üíº</span>LinkedIn<span class="db-count">850K</span></div>
                <div class="db-source"><span class="db-icon">üîó</span>XING<span class="db-count">620K</span></div>
                <div class="db-source active"><span class="db-icon">üåê</span>Web Scraping<span class="db-count">‚àû</span></div>
                <div class="db-source"><span class="db-icon">üìä</span>Creditreform<span class="db-count">450K</span></div>
            </div>
            
            <h3 style="margin-top:20px">üéØ Suchfilter</h3>
            <div class="search-filters">
                <div class="filter-group">
                    <label>Branche</label>
                    <select id="filterIndustry">
                        <option value="">Alle Branchen</option>
                        <option value="Baugewerbe">Baugewerbe</option>
                        <option value="Immobilien">Immobilien</option>
                        <option value="Technologie">Technologie</option>
                        <option value="Elektro">Elektrotechnik</option>
                        <option value="Architektur">Architektur</option>
                        <option value="Beratung">Beratung</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Region</label>
                    <select id="filterRegion">
                        <option value="">Alle Regionen</option>
                        <option value="K√∂ln">K√∂ln</option>
                        <option value="D√ºsseldorf">D√ºsseldorf</option>
                        <option value="Bonn">Bonn</option>
                        <option value="Essen">Essen</option>
                        <option value="Aachen">Aachen</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Mitarbeiter</label>
                    <select id="filterSize">
                        <option value="">Alle Gr√∂√üen</option>
                        <option value="1-10">1-10</option>
                        <option value="10-25">10-25</option>
                        <option value="25-50">25-50</option>
                        <option value="50-100">50-100</option>
                        <option value="100-250">100-250</option>
                        <option value="250+">250+</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Min. Lead Score</label>
                    <select id="filterScore">
                        <option value="0">Alle Scores</option>
                        <option value="80">80+ (Hot)</option>
                        <option value="60">60+ (Warm)</option>
                        <option value="40">40+ </option>
                    </select>
                </div>
            </div>
            <div class="search-actions">
                <button class="btn btn-secondary" onclick="resetFilters()">üîÑ Filter zur√ºcksetzen</button>
                <button class="btn btn-gradient" onclick="searchLeads()">üîç Leads suchen</button>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card highlight"><div class="stat-top"><div class="stat-icon emerald">üî•</div></div><div class="stat-value" id="statHot">${data.b2bDatabase.filter(l => l.status === 'hot').length}</div><div class="stat-label">Hot Leads</div></div>
            <div class="stat-card"><div class="stat-top"><div class="stat-icon amber">‚òÄÔ∏è</div></div><div class="stat-value" id="statWarm">${data.b2bDatabase.filter(l => l.status === 'warm').length}</div><div class="stat-label">Warm Leads</div></div>
            <div class="stat-card"><div class="stat-top"><div class="stat-icon cyan">‚ùÑÔ∏è</div></div><div class="stat-value" id="statCold">${data.b2bDatabase.filter(l => l.status === 'cold').length}</div><div class="stat-label">Cold Leads</div></div>
            <div class="stat-card"><div class="stat-top"><div class="stat-icon primary">üìä</div></div><div class="stat-value" id="statTotal">${data.b2bDatabase.length}</div><div class="stat-label">Gesamt</div></div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h3>üìã Gefundene Leads</h3>
                <div style="display:flex;gap:8px">
                    <button class="btn btn-sm btn-secondary" onclick="exportLeads()">üì• Exportieren</button>
                    <button class="btn btn-sm btn-primary" onclick="addAllToB2B()">‚ûï Alle zur Datenbank</button>
                </div>
            </div>
            <div class="card-body" style="padding:0">
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead><tr><th>Firma</th><th>Branche</th><th>Stadt</th><th>Mitarbeiter</th><th>Score</th><th>Entscheider</th><th>Aktionen</th></tr></thead>
                        <tbody id="leadGenResults"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>`;
}

function renderB2BDatabase() {
    return `<div class="page active">
        <div class="page-header"><div><h1>üè¢ B2B Datenbank</h1><p>${data.b2bDatabase.length} qualifizierte Unternehmen</p></div><div class="page-actions"><button class="btn btn-gradient" onclick="showPage('leadgen')">üîç Neue Leads finden</button></div></div>
        
        <div class="stats-grid">
            <div class="stat-card highlight"><div class="stat-value">${data.b2bDatabase.filter(l => l.status === 'hot').length}</div><div class="stat-label">Hot üî•</div></div>
            <div class="stat-card"><div class="stat-value">${data.b2bDatabase.filter(l => l.status === 'warm').length}</div><div class="stat-label">Warm ‚òÄÔ∏è</div></div>
            <div class="stat-card"><div class="stat-value">${data.b2bDatabase.filter(l => l.status === 'cold').length}</div><div class="stat-label">Cold ‚ùÑÔ∏è</div></div>
            <div class="stat-card"><div class="stat-value">${data.b2bDatabase.filter(l => l.verified).length}</div><div class="stat-label">Verifiziert ‚úì</div></div>
        </div>
        
        <div style="display:grid;grid-template-columns:1fr 400px;gap:20px">
            <div class="card">
                <div class="card-header"><h3>üìã Unternehmen</h3></div>
                <div class="card-body" style="padding:12px;max-height:600px;overflow-y:auto" id="b2bList"></div>
            </div>
            <div id="b2bDetail">
                <div class="lead-detail-panel">
                    <div class="inbox-empty" style="padding:40px"><div class="inbox-empty-icon">üè¢</div><h3>Unternehmen ausw√§hlen</h3><p>Klicke auf ein Unternehmen f√ºr Details</p></div>
                </div>
            </div>
        </div>
    </div>`;
}

function initLeadGen() {
    renderLeadGenResults();
    renderB2BList();
}

function renderLeadGenResults() {
    const tbody = document.getElementById('leadGenResults');
    if (!tbody) return;
    tbody.innerHTML = data.b2bDatabase.map(l => `
        <tr>
            <td><strong>${l.company}</strong><br><span style="font-size:11px;color:var(--text-3)">${l.website}</span></td>
            <td>${l.industry}</td>
            <td>${l.city}</td>
            <td>${l.employees}</td>
            <td><span class="status ${l.status}">${l.score}%</span></td>
            <td>${l.decisionMaker}<br><span style="font-size:11px;color:var(--text-3)">${l.position}</span></td>
            <td>
                <button class="btn btn-sm btn-secondary" onclick="viewB2BDetail(${l.id})">üëÅÔ∏è</button>
                <button class="btn btn-sm btn-primary" onclick="convertToLead(${l.id})">‚ûï</button>
            </td>
        </tr>
    `).join('');
}

function renderB2BList() {
    const list = document.getElementById('b2bList');
    if (!list) return;
    list.innerHTML = data.b2bDatabase.map(l => `
        <div class="lead-card ${selectedB2BLead === l.id ? 'selected' : ''}" onclick="selectB2BLead(${l.id})">
            <div class="lead-card-header">
                <div>
                    <div class="lead-card-company">${l.company}</div>
                    <div class="lead-card-industry">${l.industry} ¬∑ ${l.city}</div>
                </div>
                <div class="lead-card-score">
                    <div class="score-value ${l.score >= 80 ? 'high' : l.score >= 60 ? 'medium' : 'low'}">${l.score}</div>
                    <div class="score-label">Score</div>
                </div>
            </div>
            <div class="lead-card-meta">
                <div class="lead-meta-item">üë• ${l.employees}</div>
                <div class="lead-meta-item">üí∞ ${l.revenue}</div>
                <div class="lead-meta-item">${l.verified ? '<span class="enrichment-badge verified">‚úì Verifiziert</span>' : '<span class="enrichment-badge">Nicht verifiziert</span>'}</div>
            </div>
        </div>
    `).join('');
}

function selectB2BLead(id) {
    selectedB2BLead = id;
    renderB2BList();
    const l = data.b2bDatabase.find(x => x.id === id);
    if (!l) return;
    
    const scoreClass = l.score >= 80 ? 'high' : l.score >= 60 ? 'medium' : 'low';
    const detail = document.getElementById('b2bDetail');
    detail.innerHTML = `
        <div class="lead-detail-panel">
            <div class="lead-detail-header">
                <div>
                    <div class="lead-detail-company">${l.company}</div>
                    <div class="lead-detail-subtitle">${l.industry} ¬∑ Gegr√ºndet ${l.founded}</div>
                </div>
                <div class="lead-detail-score">
                    <div class="score-circle ${scoreClass}">${l.score}</div>
                    <div style="font-size:11px;color:var(--text-3)">Lead Score</div>
                </div>
            </div>
            
            <div class="lead-detail-section">
                <h4>üìä Unternehmensdaten</h4>
                <div class="lead-detail-grid">
                    <div class="detail-item"><label>Mitarbeiter</label><value>${l.employees}</value></div>
                    <div class="detail-item"><label>Umsatz</label><value>${l.revenue}</value></div>
                    <div class="detail-item"><label>Stadt</label><value>${l.city}</value></div>
                    <div class="detail-item"><label>Website</label><value>${l.website}</value></div>
                </div>
            </div>
            
            <div class="lead-detail-section">
                <h4>üë§ Entscheider</h4>
                <div class="lead-detail-grid">
                    <div class="detail-item"><label>Name</label><value>${l.decisionMaker}</value></div>
                    <div class="detail-item"><label>Position</label><value>${l.position}</value></div>
                    <div class="detail-item"><label>E-Mail</label><value>${l.email}</value></div>
                    <div class="detail-item"><label>Telefon</label><value>${l.phone}</value></div>
                </div>
            </div>
            
            <div class="lead-detail-section">
                <h4>üìà Score Faktoren</h4>
                <div class="score-factors">
                    <div class="score-factor"><div class="score-factor-icon positive">‚úì</div><div class="score-factor-text">Unternehmensgr√∂√üe passt zum ICP</div><div class="score-factor-value positive">+15</div></div>
                    <div class="score-factor"><div class="score-factor-icon positive">‚úì</div><div class="score-factor-text">Branche: ${l.industry}</div><div class="score-factor-value positive">+20</div></div>
                    <div class="score-factor"><div class="score-factor-icon ${l.verified ? 'positive' : 'negative'}">‚úì</div><div class="score-factor-text">Kontaktdaten ${l.verified ? 'verifiziert' : 'nicht verifiziert'}</div><div class="score-factor-value ${l.verified ? 'positive' : 'negative'}">${l.verified ? '+10' : '-5'}</div></div>
                    <div class="score-factor"><div class="score-factor-icon positive">‚úì</div><div class="score-factor-text">Region: NRW (Zielmarkt)</div><div class="score-factor-value positive">+25</div></div>
                    <div class="score-factor"><div class="score-factor-icon neutral">‚óã</div><div class="score-factor-text">Entscheider identifiziert</div><div class="score-factor-value positive">+${l.decisionMaker ? '15' : '0'}</div></div>
                </div>
            </div>
            
            <div style="display:flex;gap:10px;margin-top:20px">
                <button class="btn btn-gradient" style="flex:1" onclick="convertToLead(${l.id})">‚ûï Als Lead speichern</button>
                <button class="btn btn-secondary" onclick="contactB2BLead(${l.id})">üìß Kontaktieren</button>
            </div>
        </div>
    `;
}

function viewB2BDetail(id) { showPage('b2b'); setTimeout(() => selectB2BLead(id), 100); }

function convertToLead(id) {
    const l = data.b2bDatabase.find(x => x.id === id);
    if (!l) return;
    const exists = data.leads.find(x => x.company === l.company);
    if (exists) return showToast('info', 'Bereits vorhanden', `${l.company} ist bereits als Lead gespeichert`);
    
    data.leads.unshift({ id: Date.now(), name: `B2B Anfrage - ${l.company}`, company: l.company, value: parseInt(l.revenue.replace(/[^0-9]/g, '')) * 1000 || 25000, status: 'new', source: 'Lead Generator' });
    data.contacts.unshift({ id: Date.now(), firstName: l.decisionMaker.split(' ')[0], lastName: l.decisionMaker.split(' ').slice(1).join(' '), email: l.email, phone: l.phone, company: l.company, status: 'active' });
    data.activities.unshift({ icon: 'üéØ', text: `Lead konvertiert: ${l.company}`, time: 'Gerade' });
    saveData(); updateStats();
    showToast('success', 'Lead erstellt', `${l.company} wurde als Lead und Kontakt gespeichert`);
}

function contactB2BLead(id) {
    const l = data.b2bDatabase.find(x => x.id === id);
    if (!l) return;
    openModal('message');
    document.getElementById('msgTo').value = l.email;
    document.getElementById('msgChannel').value = 'email';
}

function searchLeads() {
    showToast('info', 'Suche l√§uft...', 'Durchsuche Datenbanken...');
    setTimeout(() => {
        const industry = document.getElementById('filterIndustry').value;
        const region = document.getElementById('filterRegion').value;
        const score = parseInt(document.getElementById('filterScore').value) || 0;
        
        let results = data.b2bDatabase;
        if (industry) results = results.filter(l => l.industry === industry);
        if (region) results = results.filter(l => l.city === region);
        if (score) results = results.filter(l => l.score >= score);
        
        showToast('success', 'Suche abgeschlossen', `${results.length} Leads gefunden`);
        renderLeadGenResults();
    }, 1500);
}

function resetFilters() {
    document.getElementById('filterIndustry').value = '';
    document.getElementById('filterRegion').value = '';
    document.getElementById('filterSize').value = '';
    document.getElementById('filterScore').value = '0';
    renderLeadGenResults();
}

function exportLeads() { showToast('success', 'Export gestartet', 'CSV wird heruntergeladen...'); }
function addAllToB2B() { showToast('success', 'Hinzugef√ºgt', `${data.b2bDatabase.length} Leads zur Datenbank hinzugef√ºgt`); }

function renderContacts() {
    return `<div class="page active">
        <div class="page-header"><div><h1>Kontakte</h1><p>${data.contacts.length} Kontakte</p></div><div class="page-actions"><button class="btn btn-primary" onclick="openModal('contact')">+ Neuer Kontakt</button></div></div>
        <div class="card"><div class="card-body" style="padding:0"><div class="table-wrapper"><table class="data-table"><thead><tr><th>Name</th><th>E-Mail</th><th>Telefon</th><th>Firma</th><th>Status</th><th>Aktionen</th></tr></thead><tbody>${data.contacts.map(c => `<tr><td><strong>${c.firstName} ${c.lastName}</strong></td><td>${c.email}</td><td>${c.phone}</td><td>${c.company}</td><td><span class="status ${c.status}">${statusLabel(c.status)}</span></td><td><button class="btn btn-sm btn-danger" onclick="deleteContact(${c.id})">üóëÔ∏è</button></td></tr>`).join('')}</tbody></table></div></div></div>
    </div>`;
}

function renderLeads() {
    const stats = { new: 0, qualified: 0, proposal: 0, won: 0 };
    data.leads.forEach(l => stats[l.status]++);
    const totalValue = data.leads.reduce((s, l) => s + l.value, 0);
    return `<div class="page active">
        <div class="page-header"><div><h1>Leads</h1><p>${data.leads.length} Leads ¬∑ ‚Ç¨${totalValue.toLocaleString()} Pipeline-Wert</p></div>
        <div class="page-actions">
            <button class="btn btn-secondary" onclick="openModal('campaign')">üìß Kampagne starten</button>
            <button class="btn btn-secondary" onclick="openModal('outreach')">üìû Anfrage starten</button>
            <button class="btn btn-primary" onclick="openModal('lead')">+ Neuer Lead</button>
        </div></div>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-top"><div class="stat-icon amber">üÜï</div></div><div class="stat-value">${stats.new}</div><div class="stat-label">Neu</div></div>
            <div class="stat-card"><div class="stat-top"><div class="stat-icon cyan">‚úì</div></div><div class="stat-value">${stats.qualified}</div><div class="stat-label">Qualifiziert</div></div>
            <div class="stat-card"><div class="stat-top"><div class="stat-icon violet">üìã</div></div><div class="stat-value">${stats.proposal}</div><div class="stat-label">Angebot</div></div>
            <div class="stat-card highlight"><div class="stat-top"><div class="stat-icon emerald">üéâ</div></div><div class="stat-value">${stats.won}</div><div class="stat-label">Gewonnen</div></div>
        </div>
        
        <div class="grid-2" style="margin-bottom:20px">
            <div class="card">
                <div class="card-header"><h3>üìß Aktive Kampagnen</h3><button class="btn btn-sm btn-primary" onclick="openModal('campaign')">+ Neu</button></div>
                <div class="card-body" style="padding:0">
                    <table class="data-table">
                        <thead><tr><th>Kampagne</th><th>Typ</th><th>Gesendet</th><th>√ñffnungsrate</th><th>Status</th></tr></thead>
                        <tbody>
                            ${(data.campaigns || []).map(c => `<tr>
                                <td><strong>${c.name}</strong></td>
                                <td>${c.type === 'email' ? 'üìß E-Mail' : 'üí¨ WhatsApp'}</td>
                                <td>${c.sent}/${c.total}</td>
                                <td><div class="progress-bar" style="width:80px"><div class="progress-bar-fill ${c.openRate > 40 ? 'high' : c.openRate > 20 ? 'medium' : 'low'}" style="width:${c.openRate}%"></div></div> ${c.openRate}%</td>
                                <td><span class="status ${c.status}">${c.status === 'active' ? 'üü¢ Aktiv' : c.status === 'paused' ? '‚è∏Ô∏è Pausiert' : '‚úÖ Fertig'}</span></td>
                            </tr>`).join('') || '<tr><td colspan="5" style="text-align:center;color:var(--text-3)">Keine aktiven Kampagnen</td></tr>'}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card">
                <div class="card-header"><h3>üìû Outreach Aktivit√§ten</h3><button class="btn btn-sm btn-primary" onclick="openModal('outreach')">+ Neu</button></div>
                <div class="card-body" style="padding:0">
                    <table class="data-table">
                        <thead><tr><th>Lead</th><th>Typ</th><th>Datum</th><th>Ergebnis</th></tr></thead>
                        <tbody>
                            ${(data.outreach || []).slice(0, 5).map(o => `<tr>
                                <td><strong>${o.lead}</strong></td>
                                <td>${o.type === 'call' ? 'üìû Anruf' : o.type === 'email' ? 'üìß E-Mail' : 'üí¨ WhatsApp'}</td>
                                <td>${o.date}</td>
                                <td><span class="status ${o.result}">${o.result === 'positive' ? '‚úÖ Positiv' : o.result === 'callback' ? 'üìÖ R√ºckruf' : o.result === 'noAnswer' ? '‚ùå K.A.' : '‚è≥ Offen'}</span></td>
                            </tr>`).join('') || '<tr><td colspan="4" style="text-align:center;color:var(--text-3)">Keine Aktivit√§ten</td></tr>'}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h3>üìã Alle Leads</h3>
                <div style="display:flex;gap:8px">
                    <button class="btn btn-sm btn-secondary" onclick="bulkAction('email')">üìß Alle kontaktieren</button>
                    <button class="btn btn-sm btn-secondary" onclick="bulkAction('export')">üì• Exportieren</button>
                </div>
            </div>
            <div class="card-body" style="padding:0">
                <div class="table-wrapper">
                    <table class="data-table">
                        <thead><tr><th><input type="checkbox" onclick="toggleAllLeads(this)"></th><th>Lead</th><th>Firma</th><th>Wert</th><th>Status</th><th>Quelle</th><th>Letzter Kontakt</th><th>Aktionen</th></tr></thead>
                        <tbody>${data.leads.map(l => `<tr>
                            <td><input type="checkbox" class="lead-checkbox" data-id="${l.id}"></td>
                            <td><strong>${l.name}</strong></td>
                            <td>${l.company}</td>
                            <td>‚Ç¨${l.value.toLocaleString()}</td>
                            <td><span class="status ${l.status}">${statusLabel(l.status)}</span></td>
                            <td>${l.source}</td>
                            <td>${l.lastContact || 'Nie'}</td>
                            <td>
                                <button class="btn btn-sm btn-secondary" onclick="quickOutreach(${l.id}, 'email')" title="E-Mail">üìß</button>
                                <button class="btn btn-sm btn-secondary" onclick="quickOutreach(${l.id}, 'call')" title="Anrufen">üìû</button>
                                <button class="btn btn-sm btn-secondary" onclick="quickOutreach(${l.id}, 'whatsapp')" title="WhatsApp">üí¨</button>
                                <button class="btn btn-sm btn-secondary" onclick="changeLeadStatus(${l.id})" title="Status">üìä</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteLead(${l.id})" title="L√∂schen">üóëÔ∏è</button>
                            </td>
                        </tr>`).join('')}</tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>`;
}

function renderPipeline() {
    const stages = [
        { id: 'new', name: 'üÜï Neu', color: 'amber', items: [] }, 
        { id: 'qualified', name: '‚úì Qualifiziert', color: 'cyan', items: [] }, 
        { id: 'proposal', name: 'üìã Angebot', color: 'violet', items: [] }, 
        { id: 'won', name: 'üéâ Gewonnen', color: 'emerald', items: [] }
    ];
    data.leads.forEach(l => { const s = stages.find(x => x.id === l.status); if (s) s.items.push(l); });
    const totalValue = data.leads.reduce((s, l) => s + l.value, 0);
    const wonValue = stages.find(s => s.id === 'won').items.reduce((s, l) => s + l.value, 0);
    
    return `<div class="page active">
        <div class="page-header">
            <div><h1>Sales Pipeline</h1><p>‚Ç¨${totalValue.toLocaleString()} Gesamtwert ¬∑ ‚Ç¨${wonValue.toLocaleString()} gewonnen</p></div>
            <div class="page-actions">
                <button class="btn btn-secondary" onclick="openModal('sequence')">‚ö° Sequenz erstellen</button>
                <button class="btn btn-primary" onclick="openModal('lead')">+ Neuer Lead</button>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-value">‚Ç¨${totalValue.toLocaleString()}</div><div class="stat-label">Pipeline-Wert</div></div>
            <div class="stat-card highlight"><div class="stat-value">‚Ç¨${wonValue.toLocaleString()}</div><div class="stat-label">Gewonnen</div></div>
            <div class="stat-card"><div class="stat-value">${data.leads.length > 0 ? Math.round((stages.find(s => s.id === 'won').items.length / data.leads.length) * 100) : 0}%</div><div class="stat-label">Win-Rate</div></div>
            <div class="stat-card"><div class="stat-value">${Math.round(totalValue / Math.max(data.leads.length, 1)).toLocaleString()}</div><div class="stat-label">√ò Deal-Gr√∂√üe</div></div>
        </div>
        
        <div class="card" style="margin-bottom:20px">
            <div class="card-header"><h3>‚ö° Automatisierte Sequenzen</h3><button class="btn btn-sm btn-primary" onclick="openModal('sequence')">+ Neue Sequenz</button></div>
            <div class="card-body">
                <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px">
                    ${(data.sequences || []).map(s => `
                        <div style="background:var(--bg-3);border:1px solid var(--border);border-radius:10px;padding:16px">
                            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                                <strong>${s.name}</strong>
                                <span class="status ${s.active ? 'active' : 'inactive'}">${s.active ? 'üü¢ Aktiv' : '‚è∏Ô∏è Pausiert'}</span>
                            </div>
                            <div style="font-size:12px;color:var(--text-2);margin-bottom:8px">${s.steps} Schritte ¬∑ ${s.enrolled} Leads eingeschrieben</div>
                            <div class="progress-bar"><div class="progress-bar-fill high" style="width:${s.progress}%"></div></div>
                            <div style="display:flex;gap:8px;margin-top:12px">
                                <button class="btn btn-sm btn-secondary" style="flex:1" onclick="toggleSequence(${s.id})">${s.active ? '‚è∏Ô∏è Pause' : '‚ñ∂Ô∏è Start'}</button>
                                <button class="btn btn-sm btn-secondary" onclick="editSequence(${s.id})">‚úèÔ∏è</button>
                            </div>
                        </div>
                    `).join('') || '<div style="grid-column:1/-1;text-align:center;color:var(--text-3);padding:20px">Keine Sequenzen erstellt. <a href="#" onclick="openModal(\'sequence\')" style="color:var(--primary)">Erste Sequenz erstellen</a></div>'}
                </div>
            </div>
        </div>
        
        <div class="pipeline">${stages.map(s => {
            const stageValue = s.items.reduce((a, l) => a + l.value, 0);
            return `
            <div class="pipeline-stage" style="border-top:3px solid var(--${s.color})">
                <div class="pipeline-header">
                    <h4>${s.name} <span style="background:var(--bg-4);padding:2px 8px;border-radius:10px;font-size:11px">${s.items.length}</span></h4>
                    <span>‚Ç¨${stageValue.toLocaleString()}</span>
                </div>
                <div class="pipeline-body" style="min-height:300px">
                    ${s.items.map(l => `
                        <div class="pipeline-card" onclick="openLeadDetail(${l.id})">
                            <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px">
                                <h5>${l.company}</h5>
                                <div style="display:flex;gap:4px">
                                    <button class="btn btn-sm btn-icon" style="width:24px;height:24px;font-size:10px" onclick="event.stopPropagation();quickOutreach(${l.id},'email')">üìß</button>
                                    <button class="btn btn-sm btn-icon" style="width:24px;height:24px;font-size:10px" onclick="event.stopPropagation();quickOutreach(${l.id},'call')">üìû</button>
                                </div>
                            </div>
                            <p>${l.name}</p>
                            <div class="value">‚Ç¨${l.value.toLocaleString()}</div>
                            <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px;padding-top:8px;border-top:1px solid var(--border)">
                                <span style="font-size:10px;color:var(--text-3)">${l.source}</span>
                                ${s.id !== 'won' ? `<select style="font-size:10px;padding:2px 4px;background:var(--bg-4);border:1px solid var(--border);border-radius:4px;color:var(--text-0)" onchange="event.stopPropagation();moveLeadToStage(${l.id}, this.value)">
                                    <option value="">Verschieben ‚Üí</option>
                                    ${stages.filter(st => st.id !== s.id).map(st => `<option value="${st.id}">${st.name}</option>`).join('')}
                                </select>` : '<span style="font-size:10px;color:var(--emerald)">‚úì Abgeschlossen</span>'}
                            </div>
                        </div>
                    `).join('') || '<div style="text-align:center;color:var(--text-3);padding:40px 20px;font-size:12px">Keine Leads</div>'}
                </div>
            </div>`;
        }).join('')}</div>
    </div>`;
}

function renderInvoices() {
    return `<div class="page active">
        <div class="page-header"><div><h1>Rechnungen</h1><p>Verwalten</p></div><div class="page-actions"><button class="btn btn-primary" onclick="openModal('invoice')">+ Neue Rechnung</button></div></div>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-value">‚Ç¨847K</div><div class="stat-label">Umsatz</div></div>
            <div class="stat-card"><div class="stat-value">${data.invoices.length}</div><div class="stat-label">Rechnungen</div></div>
            <div class="stat-card"><div class="stat-value">‚Ç¨${Math.round(data.invoices.filter(i => i.status === 'pending').reduce((s, i) => s + i.amount, 0)/1000)}K</div><div class="stat-label">Offen</div></div>
            <div class="stat-card"><div class="stat-value">${data.invoices.filter(i => i.status === 'overdue').length}</div><div class="stat-label">√úberf√§llig</div></div>
        </div>
        <div class="card"><div class="card-body" style="padding:0"><div class="table-wrapper"><table class="data-table"><thead><tr><th>Nr.</th><th>Kunde</th><th>Betrag</th><th>Status</th><th>Datum</th><th>Aktionen</th></tr></thead><tbody>${data.invoices.map(i => `<tr><td><strong>${i.id}</strong></td><td>${i.customer}</td><td>‚Ç¨${i.amount.toLocaleString()}</td><td><span class="status ${i.status}">${statusLabel(i.status)}</span></td><td>${i.date}</td><td><button class="btn btn-sm btn-secondary">üì• PDF</button></td></tr>`).join('')}</tbody></table></div></div></div>
    </div>`;
}

function renderInbox() {
    return `<div class="page active">
        <div class="page-header"><div><h1>Inbox</h1><p>Nachrichten</p></div><div class="page-actions"><button class="btn btn-primary" onclick="openModal('message')">‚úâÔ∏è Neue Nachricht</button></div></div>
        <div class="inbox-layout">
            <div class="inbox-sidebar">
                <div class="inbox-sidebar-header"><h3>Nachrichten</h3></div>
                <div class="inbox-list" id="inboxList"></div>
            </div>
            <div class="inbox-main" id="inboxMain"><div class="inbox-empty"><div class="inbox-empty-icon">üì•</div><h3>W√§hle eine Konversation</h3></div></div>
        </div>
    </div>`;
}

function initInbox() {
    const list = document.getElementById('inboxList');
    if (!list) return;
    list.innerHTML = data.conversations.map(c => `
        <div class="inbox-item ${c.unread ? 'unread' : ''}" onclick="selectConversation(${c.id})">
            <div class="inbox-item-avatar ${c.type}">${c.type === 'whatsapp' ? 'üí¨' : 'üìß'}</div>
            <div class="inbox-item-content">
                <div class="inbox-item-header"><span class="inbox-item-name">${c.contact}</span><span class="inbox-item-time">${c.messages[c.messages.length-1].time}</span></div>
                <div class="inbox-item-preview">${c.messages[c.messages.length-1].text.substring(0, 40)}...</div>
            </div>
        </div>
    `).join('');
}

function selectConversation(id) {
    const c = data.conversations.find(x => x.id === id);
    if (!c) return;
    c.unread = false; saveData(); updateStats(); initInbox();
    document.getElementById('inboxMain').innerHTML = `
        <div class="inbox-main-header"><div class="inbox-contact"><div class="inbox-contact-avatar ${c.type}">${c.type === 'whatsapp' ? 'üí¨' : 'üìß'}</div><div class="inbox-contact-info"><h4>${c.contact}</h4><span>${c.phone || c.email}</span></div></div></div>
        <div class="inbox-messages">${c.messages.map(m => `<div class="message ${m.outgoing ? 'outgoing' : 'incoming'}"><div class="message-text">${m.text}</div><div class="message-time">${m.time}</div></div>`).join('')}</div>
        <div class="inbox-compose"><div class="compose-form"><div class="compose-input"><textarea id="replyText" placeholder="Nachricht..." onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendReply(${id})}"></textarea></div><button class="btn btn-primary" onclick="sendReply(${id})">üì§</button></div></div>
    `;
}

function sendReply(id) {
    const text = document.getElementById('replyText').value.trim();
    if (!text) return;
    const c = data.conversations.find(x => x.id === id);
    c.messages.push({ id: Date.now(), text, time: new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' }), outgoing: true });
    saveData(); selectConversation(id);
    showToast('success', 'Gesendet', `Nachricht an ${c.contact}`);
}

function renderIntegrations() {
    return `<div class="page active">
        <div class="page-header"><div><h1>Integrationen</h1><p>Verbundene Dienste</p></div></div>
        <div class="api-grid">${data.integrations.map(i => `<div class="api-card"><div class="api-top"><div class="api-logo" style="background:var(--primary-glow)">üîå</div><div class="api-info"><h4>${i.name}</h4><span>${i.type}</span></div><div class="api-status ${i.status}">‚óè ${i.status === 'connected' ? 'Verbunden' : 'Setup'}</div></div></div>`).join('')}</div>
    </div>`;
}

function renderSettings() {
    return `<div class="page active">
        <div class="page-header"><div><h1>Einstellungen</h1><p>System</p></div><button class="btn btn-primary" onclick="showToast('success', 'Gespeichert', 'OK')">üíæ Speichern</button></div>
        <div class="grid-2">
            <div class="card"><div class="card-header"><h3>üë§ Profil</h3></div><div class="card-body">
                <div class="form-group"><label>Name</label><input type="text" class="form-control" value="√ñmer H√ºseyin Co≈ükun"></div>
                <div class="form-group"><label>E-Mail</label><input type="email" class="form-control" value="info@west-money-bau.de"></div>
            </div></div>
            <div class="card"><div class="card-header"><h3>üè¢ Unternehmen</h3></div><div class="card-body">
                <div class="form-group"><label>Firma</label><input type="text" class="form-control" value="West Money Bau GmbH"></div>
                <div class="form-group"><label>IBAN</label><input type="text" class="form-control" value="DE42 1001 0178 9758 7887 93"></div>
            </div></div>
        </div>
    </div>`;
}

// ==================== MODALS ====================
function openModal(type) {
    document.getElementById('modalOverlay').classList.add('active');
    document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
    const map = { contact: 'modalContact', lead: 'modalLead', invoice: 'modalInvoice', message: 'modalMessage', campaign: 'modalCampaign', outreach: 'modalOutreach', sequence: 'modalSequence', leadStatus: 'modalLeadStatus' };
    if (map[type]) document.getElementById(map[type]).classList.add('active');
    
    // Update outreach lead dropdown
    if (type === 'outreach') {
        const select = document.getElementById('outreachLead');
        select.innerHTML = '<option value="">-- Lead ausw√§hlen --</option>' + data.leads.map(l => `<option value="${l.id}">${l.company} - ${l.name}</option>`).join('');
    }
}

function closeModal() {
    document.getElementById('modalOverlay').classList.remove('active');
    document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
}

function saveContact() {
    const f = document.getElementById('cFirst').value.trim(), l = document.getElementById('cLast').value.trim(), e = document.getElementById('cEmail').value.trim();
    if (!f || !l || !e) return showToast('error', 'Fehler', 'Pflichtfelder ausf√ºllen');
    data.contacts.unshift({ id: Date.now(), firstName: f, lastName: l, email: e, phone: document.getElementById('cPhone').value, company: document.getElementById('cCompany').value, status: 'active' });
    saveData(); closeModal(); showPage(currentPage); showToast('success', 'Erstellt', `${f} ${l}`);
}

function saveLead() {
    const n = document.getElementById('lName').value.trim();
    if (!n) return showToast('error', 'Fehler', 'Name eingeben');
    data.leads.unshift({ id: Date.now(), name: n, company: document.getElementById('lCompany').value, value: parseInt(document.getElementById('lValue').value) || 0, source: document.getElementById('lSource').value, status: 'new' });
    saveData(); closeModal(); showPage(currentPage); showToast('success', 'Erstellt', n);
}

function saveInvoice() {
    const c = document.getElementById('iCustomer').value.trim(), a = parseInt(document.getElementById('iAmount').value);
    if (!c || !a) return showToast('error', 'Fehler', 'Pflichtfelder ausf√ºllen');
    data.invoices.unshift({ id: `RE-2025-${String(data.invoices.length + 1).padStart(3, '0')}`, customer: c, amount: a, status: 'pending', date: new Date().toISOString().split('T')[0] });
    saveData(); closeModal(); showPage(currentPage); showToast('success', 'Erstellt', `Rechnung f√ºr ‚Ç¨${a}`);
}

function sendNewMessage() {
    const to = document.getElementById('msgTo').value.trim(), text = document.getElementById('msgText').value.trim();
    if (!to || !text) return showToast('error', 'Fehler', 'Felder ausf√ºllen');
    data.conversations.unshift({ id: Date.now(), contact: to, type: document.getElementById('msgChannel').value, unread: false, messages: [{ id: 1, text, time: new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' }), outgoing: true }] });
    saveData(); closeModal(); showToast('success', 'Gesendet', `Nachricht an ${to}`);
}

function deleteContact(id) { if (confirm('L√∂schen?')) { data.contacts = data.contacts.filter(c => c.id !== id); saveData(); showPage(currentPage); } }
function deleteLead(id) { if (confirm('L√∂schen?')) { data.leads = data.leads.filter(l => l.id !== id); saveData(); showPage(currentPage); } }

// ==================== CAMPAIGN FUNCTIONS ====================
function startCampaign() {
    const name = document.getElementById('campName').value.trim();
    const type = document.getElementById('campType').value;
    const target = document.getElementById('campTarget').value;
    const message = document.getElementById('campMessage').value.trim();
    
    if (!name || !message) return showToast('error', 'Fehler', 'Name und Nachricht erforderlich');
    
    let targetCount = data.leads.length;
    if (target === 'new') targetCount = data.leads.filter(l => l.status === 'new').length;
    if (target === 'qualified') targetCount = data.leads.filter(l => l.status === 'qualified').length;
    if (target === 'b2b') targetCount = data.b2bDatabase.length;
    
    if (!data.campaigns) data.campaigns = [];
    data.campaigns.unshift({
        id: Date.now(),
        name: name,
        type: type,
        sent: 0,
        total: targetCount,
        openRate: 0,
        status: 'active',
        message: message,
        target: target,
        createdAt: new Date().toISOString()
    });
    
    data.activities.unshift({ icon: 'üìß', text: `Kampagne gestartet: ${name}`, time: 'Gerade' });
    saveData();
    closeModal();
    showToast('success', 'Kampagne gestartet', `"${name}" wird an ${targetCount} Empf√§nger gesendet`);
    
    // Simulate sending
    simulateCampaignSending(data.campaigns[0].id);
    showPage(currentPage);
}

function simulateCampaignSending(campId) {
    const interval = setInterval(() => {
        const camp = data.campaigns.find(c => c.id === campId);
        if (!camp || camp.sent >= camp.total) {
            clearInterval(interval);
            if (camp) {
                camp.status = 'completed';
                camp.openRate = Math.floor(Math.random() * 30) + 25;
                saveData();
            }
            return;
        }
        camp.sent += Math.min(5, camp.total - camp.sent);
        camp.openRate = Math.floor(Math.random() * 20) + 30;
        saveData();
    }, 2000);
}

function saveCampaignDraft() {
    showToast('success', 'Entwurf gespeichert', 'Kampagne als Entwurf gespeichert');
    closeModal();
}

// ==================== OUTREACH FUNCTIONS ====================
function saveOutreach() {
    const leadId = document.getElementById('outreachLead').value;
    const type = document.getElementById('outreachType').value;
    const priority = document.getElementById('outreachPriority').value;
    const notes = document.getElementById('outreachNotes').value;
    const followup = document.getElementById('outreachFollowup').value;
    
    if (!leadId) return showToast('error', 'Fehler', 'Bitte Lead ausw√§hlen');
    
    const lead = data.leads.find(l => l.id == leadId);
    if (!lead) return;
    
    if (!data.outreach) data.outreach = [];
    data.outreach.unshift({
        id: Date.now(),
        leadId: leadId,
        lead: lead.company,
        type: type,
        priority: priority,
        date: new Date().toLocaleDateString('de-DE'),
        result: 'pending',
        notes: notes,
        followup: followup
    });
    
    lead.lastContact = new Date().toLocaleDateString('de-DE');
    data.activities.unshift({ icon: type === 'call' ? 'üìû' : type === 'email' ? 'üìß' : 'üí¨', text: `Outreach: ${lead.company}`, time: 'Gerade' });
    
    saveData();
    closeModal();
    showToast('success', 'Anfrage gespeichert', `${type === 'call' ? 'Anruf' : type === 'email' ? 'E-Mail' : 'Nachricht'} f√ºr ${lead.company} geplant`);
    showPage(currentPage);
}

function quickOutreach(leadId, type) {
    const lead = data.leads.find(l => l.id === leadId);
    if (!lead) return;
    
    if (!data.outreach) data.outreach = [];
    data.outreach.unshift({
        id: Date.now(),
        leadId: leadId,
        lead: lead.company,
        type: type,
        date: new Date().toLocaleDateString('de-DE'),
        result: 'pending',
        notes: ''
    });
    
    lead.lastContact = new Date().toLocaleDateString('de-DE');
    saveData();
    
    const typeLabel = type === 'call' ? 'Anruf' : type === 'email' ? 'E-Mail' : 'WhatsApp';
    showToast('success', `${typeLabel} gestartet`, `Kontaktiert: ${lead.company}`);
    
    if (type === 'email' || type === 'whatsapp') {
        openModal('message');
        document.getElementById('msgTo').value = lead.company;
        document.getElementById('msgChannel').value = type === 'whatsapp' ? 'whatsapp' : 'email';
    }
}

// ==================== SEQUENCE FUNCTIONS ====================
function saveSequence() {
    const name = document.getElementById('seqName').value.trim();
    const trigger = document.getElementById('seqTrigger').value;
    
    if (!name) return showToast('error', 'Fehler', 'Name erforderlich');
    
    const steps = document.querySelectorAll('.sequence-step').length;
    
    if (!data.sequences) data.sequences = [];
    data.sequences.unshift({
        id: Date.now(),
        name: name,
        trigger: trigger,
        steps: steps,
        enrolled: 0,
        progress: 0,
        active: true
    });
    
    data.activities.unshift({ icon: '‚ö°', text: `Sequenz erstellt: ${name}`, time: 'Gerade' });
    saveData();
    closeModal();
    showToast('success', 'Sequenz erstellt', `"${name}" mit ${steps} Schritten aktiviert`);
    showPage(currentPage);
}

function addSequenceStep() {
    const container = document.getElementById('sequenceSteps');
    const stepNum = container.children.length + 1;
    const step = document.createElement('div');
    step.className = 'sequence-step';
    step.style.cssText = 'background:var(--bg-3);border:1px solid var(--border);border-radius:8px;padding:12px;margin-bottom:8px';
    step.innerHTML = `
        <div style="display:flex;align-items:center;gap:12px">
            <span style="background:var(--primary);color:white;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600">${stepNum}</span>
            <select class="form-control" style="width:auto">
                <option value="email">üìß E-Mail senden</option>
                <option value="whatsapp">üí¨ WhatsApp senden</option>
                <option value="task">üìã Aufgabe erstellen</option>
                <option value="wait">‚è∞ Warten</option>
            </select>
            <span style="color:var(--text-3)">nach</span>
            <input type="number" class="form-control" style="width:60px" value="${stepNum}">
            <select class="form-control" style="width:auto">
                <option value="days" selected>Tagen</option>
            </select>
            <button class="btn btn-sm btn-danger" onclick="this.parentElement.parentElement.remove()">üóëÔ∏è</button>
        </div>
    `;
    container.appendChild(step);
}

function toggleSequence(id) {
    const seq = data.sequences.find(s => s.id === id);
    if (seq) {
        seq.active = !seq.active;
        saveData();
        showToast('info', seq.active ? 'Sequenz aktiviert' : 'Sequenz pausiert', seq.name);
        showPage(currentPage);
    }
}

function editSequence(id) {
    showToast('info', 'Bearbeiten', 'Sequenz-Editor wird geladen...');
}

// ==================== LEAD PIPELINE FUNCTIONS ====================
function moveLeadToStage(leadId, newStatus) {
    if (!newStatus) return;
    const lead = data.leads.find(l => l.id === leadId);
    if (lead) {
        const oldStatus = lead.status;
        lead.status = newStatus;
        data.activities.unshift({ icon: 'üìä', text: `${lead.company}: ${statusLabel(oldStatus)} ‚Üí ${statusLabel(newStatus)}`, time: 'Gerade' });
        saveData();
        showToast('success', 'Status ge√§ndert', `${lead.company} ‚Üí ${statusLabel(newStatus)}`);
        showPage(currentPage);
    }
}

function changeLeadStatus(leadId) {
    const lead = data.leads.find(l => l.id === leadId);
    if (!lead) return;
    
    document.getElementById('leadStatusContent').innerHTML = `
        <div style="text-align:center;margin-bottom:20px">
            <strong>${lead.company}</strong><br>
            <span style="color:var(--text-3)">${lead.name}</span>
        </div>
        <div style="display:grid;gap:10px">
            <button class="btn ${lead.status === 'new' ? 'btn-primary' : 'btn-secondary'}" style="justify-content:flex-start" onclick="updateLeadStatus(${leadId}, 'new')">üÜï Neu</button>
            <button class="btn ${lead.status === 'qualified' ? 'btn-primary' : 'btn-secondary'}" style="justify-content:flex-start" onclick="updateLeadStatus(${leadId}, 'qualified')">‚úì Qualifiziert</button>
            <button class="btn ${lead.status === 'proposal' ? 'btn-primary' : 'btn-secondary'}" style="justify-content:flex-start" onclick="updateLeadStatus(${leadId}, 'proposal')">üìã Angebot</button>
            <button class="btn ${lead.status === 'won' ? 'btn-primary' : 'btn-secondary'}" style="justify-content:flex-start" onclick="updateLeadStatus(${leadId}, 'won')">üéâ Gewonnen</button>
        </div>
    `;
    openModal('leadStatus');
}

function updateLeadStatus(leadId, newStatus) {
    moveLeadToStage(leadId, newStatus);
    closeModal();
}

function openLeadDetail(leadId) {
    const lead = data.leads.find(l => l.id === leadId);
    if (!lead) return;
    changeLeadStatus(leadId);
}

function toggleAllLeads(checkbox) {
    document.querySelectorAll('.lead-checkbox').forEach(cb => cb.checked = checkbox.checked);
}

function bulkAction(action) {
    const selected = Array.from(document.querySelectorAll('.lead-checkbox:checked')).map(cb => cb.dataset.id);
    if (selected.length === 0) {
        return showToast('info', 'Keine Auswahl', 'Bitte Leads ausw√§hlen');
    }
    
    if (action === 'email') {
        showToast('success', 'Kampagne', `E-Mail an ${selected.length} Leads wird vorbereitet...`);
        openModal('campaign');
    } else if (action === 'export') {
        showToast('success', 'Export', `${selected.length} Leads werden exportiert...`);
    }
}

// ==================== INIT ====================
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('loginForm').addEventListener('submit', handleLogin);
    document.querySelectorAll('.nav-item').forEach(item => item.addEventListener('click', function() { const page = this.getAttribute('data-page'); if (page) showPage(page); }));
    document.getElementById('modalOverlay').addEventListener('click', function(e) { if (e.target === this) closeModal(); });
    document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
    
    if (currentUser) showApp();
});

console.log('‚ö° West Money OS v3.0 - Lead Generator Edition');
</script>

</body>
</html>
