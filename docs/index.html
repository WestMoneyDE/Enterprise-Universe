<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>West Money OS v4.0 | Ultimate Business Platform</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚ö°</text></svg>">
    <link rel="manifest" href="data:application/json,{'name':'West Money OS','short_name':'WMOS','start_url':'.','display':'standalone','background_color':'%2309090b','theme_color':'%236366f1'}">
    <meta name="theme-color" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--bg-0:#09090b;--bg-1:#0c0c0f;--bg-2:#131316;--bg-3:#1a1a1f;--bg-4:#222228;--bg-5:#2a2a32;--text-0:#fafafa;--text-1:#d4d4d8;--text-2:#a1a1aa;--text-3:#71717a;--primary:#6366f1;--primary-hover:#818cf8;--primary-glow:rgba(99,102,241,0.15);--emerald:#10b981;--amber:#f59e0b;--rose:#f43f5e;--cyan:#06b6d4;--violet:#8b5cf6;--orange:#f97316;--pink:#ec4899;--lime:#84cc16;--border:rgba(255,255,255,0.06);--border-hover:rgba(255,255,255,0.12);--whatsapp:#25d366;--email:#ea4335;--radius:8px;--radius-lg:12px;--radius-xl:16px;--shadow:0 4px 24px rgba(0,0,0,0.4);--shadow-lg:0 8px 32px rgba(0,0,0,0.5)}
        [data-theme="light"]{--bg-0:#f8fafc;--bg-1:#f1f5f9;--bg-2:#e2e8f0;--bg-3:#cbd5e1;--bg-4:#94a3b8;--bg-5:#64748b;--text-0:#0f172a;--text-1:#1e293b;--text-2:#475569;--text-3:#64748b;--border:rgba(0,0,0,0.1);--border-hover:rgba(0,0,0,0.2)}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',system-ui,sans-serif;background:var(--bg-0);color:var(--text-0);font-size:14px;line-height:1.5;min-height:100vh;transition:all 0.3s}
        ::-webkit-scrollbar{width:6px;height:6px}::-webkit-scrollbar-track{background:var(--bg-2)}::-webkit-scrollbar-thumb{background:var(--bg-4);border-radius:3px}::-webkit-scrollbar-thumb:hover{background:var(--bg-5)}
        
        /* LOGIN */
        .login-screen{min-height:100vh;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--bg-0) 0%,#0f0f1a 50%,#1a0a2e 100%);position:relative;overflow:hidden}
        .login-screen::before{content:'';position:absolute;width:600px;height:600px;background:radial-gradient(circle,rgba(99,102,241,0.15) 0%,transparent 70%);top:-200px;right:-200px;animation:float 15s infinite}
        .login-screen::after{content:'';position:absolute;width:400px;height:400px;background:radial-gradient(circle,rgba(139,92,246,0.1) 0%,transparent 70%);bottom:-100px;left:-100px;animation:float 20s infinite reverse}
        @keyframes float{0%,100%{transform:translate(0,0)}50%{transform:translate(30px,30px)}}
        .login-container{width:100%;max-width:420px;padding:20px;position:relative;z-index:1}
        .login-logo{text-align:center;margin-bottom:32px}
        .login-logo-icon{width:80px;height:80px;background:linear-gradient(135deg,var(--primary),var(--violet));border-radius:20px;display:inline-flex;align-items:center;justify-content:center;font-size:36px;margin-bottom:16px;box-shadow:0 8px 32px rgba(99,102,241,0.4);animation:glow 3s infinite}
        @keyframes glow{0%,100%{box-shadow:0 8px 32px rgba(99,102,241,0.4)}50%{box-shadow:0 8px 48px rgba(99,102,241,0.6)}}
        .login-logo h1{font-size:32px;font-weight:700;margin-bottom:4px;background:linear-gradient(135deg,var(--text-0),var(--primary-hover));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .login-logo p{color:var(--text-3);font-size:14px}
        .login-logo .version{display:inline-block;background:var(--primary-glow);color:var(--primary);padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600;margin-top:8px}
        .login-box{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-xl);padding:32px;box-shadow:var(--shadow-lg);backdrop-filter:blur(10px)}
        .login-box h2{font-size:20px;margin-bottom:24px;text-align:center}
        .form-group{margin-bottom:20px}
        .form-group label{display:block;font-size:13px;font-weight:500;margin-bottom:8px;color:var(--text-1)}
        .form-input,.form-control{width:100%;padding:12px 14px;background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius);color:var(--text-0);font-size:14px;transition:all 0.2s}
        .form-input:focus,.form-control:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px var(--primary-glow)}
        .form-input::placeholder,.form-control::placeholder{color:var(--text-3)}
        .login-btn{width:100%;padding:14px;background:linear-gradient(135deg,var(--primary),var(--violet));color:white;border:none;border-radius:var(--radius);font-size:14px;font-weight:600;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;gap:8px}
        .login-btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(99,102,241,0.4)}
        .login-btn:active{transform:translateY(0)}
        .login-error{background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);color:#ef4444;padding:12px;border-radius:var(--radius);margin-bottom:20px;font-size:13px;text-align:center;display:none}
        .login-error.show{display:block;animation:shake 0.5s}
        @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
        .login-footer{text-align:center;margin-top:24px;color:var(--text-3);font-size:12px}
        .login-2fa{margin-top:16px;padding-top:16px;border-top:1px solid var(--border)}
        .login-2fa label{display:flex;align-items:center;gap:8px;cursor:pointer;font-size:13px;color:var(--text-2)}
        .login-2fa input[type="checkbox"]{width:16px;height:16px;accent-color:var(--primary)}
        
        /* APP LAYOUT */
        .app{display:none;min-height:100vh}
        .app.active{display:flex}
        
        /* SIDEBAR */
        .sidebar{width:260px;background:var(--bg-1);border-right:1px solid var(--border);position:fixed;height:100vh;display:flex;flex-direction:column;z-index:100;transition:transform 0.3s}
        .sidebar.collapsed{transform:translateX(-260px)}
        .sidebar-header{padding:16px;border-bottom:1px solid var(--border)}
        .logo{display:flex;align-items:center;gap:10px}
        .logo-icon{width:40px;height:40px;background:linear-gradient(135deg,var(--primary),var(--violet));border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px}
        .logo h1{font-size:16px;font-weight:600}
        .logo span{font-size:10px;color:var(--text-3);display:block}
        .logo .v-badge{background:var(--emerald);color:white;font-size:9px;padding:2px 6px;border-radius:4px;margin-left:4px}
        .sidebar-nav{flex:1;padding:8px;overflow-y:auto}
        .nav-group{margin-bottom:8px}
        .nav-label{font-size:10px;font-weight:600;color:var(--text-3);text-transform:uppercase;letter-spacing:0.5px;padding:12px 12px 6px}
        .nav-item{display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:var(--radius);cursor:pointer;color:var(--text-2);font-size:13px;transition:all 0.15s;margin-bottom:2px;position:relative}
        .nav-item:hover{background:var(--bg-3);color:var(--text-0)}
        .nav-item.active{background:var(--primary-glow);color:var(--primary-hover);border:1px solid rgba(99,102,241,0.3)}
        .nav-item .icon{width:20px;text-align:center;font-size:15px}
        .nav-item .label{flex:1}
        .nav-item .badge{background:var(--primary);color:white;font-size:10px;padding:2px 6px;border-radius:4px;font-weight:600}
        .nav-item .badge.hot{background:var(--rose)}
        .nav-item .badge.new{background:var(--emerald)}
        .nav-item .badge.warn{background:var(--amber)}
        .nav-item .dot{width:6px;height:6px;border-radius:50%;background:var(--emerald);animation:pulse 2s infinite}
        .nav-item .shortcut{font-size:10px;color:var(--text-3);background:var(--bg-4);padding:2px 6px;border-radius:4px}
        .sidebar-footer{padding:12px;border-top:1px solid var(--border)}
        .user-box{display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg-2);border-radius:var(--radius);cursor:pointer;transition:all 0.15s}
        .user-box:hover{background:var(--bg-3)}
        .user-avatar{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,var(--emerald),var(--cyan));display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;position:relative}
        .user-avatar .online{position:absolute;bottom:-2px;right:-2px;width:12px;height:12px;background:var(--emerald);border:2px solid var(--bg-1);border-radius:50%}
        .user-info{flex:1}
        .user-info div{font-size:13px;font-weight:500}
        .user-info span{color:var(--text-3);font-size:11px}
        .logout-btn{background:none;border:none;color:var(--text-3);cursor:pointer;padding:8px;font-size:16px;border-radius:var(--radius);transition:all 0.15s}
        .logout-btn:hover{color:var(--rose);background:rgba(244,63,94,0.1)}
        
        /* MAIN */
        .main{flex:1;margin-left:260px;display:flex;flex-direction:column;min-height:100vh;transition:margin 0.3s}
        .main.expanded{margin-left:0}
        
        /* TOPBAR */
        .topbar{height:60px;background:var(--bg-1);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 24px;position:sticky;top:0;z-index:50}
        .topbar-left{display:flex;align-items:center;gap:16px}
        .menu-toggle{display:none;background:none;border:none;color:var(--text-0);font-size:20px;cursor:pointer;padding:8px}
        .breadcrumb{font-size:13px;color:var(--text-2)}
        .breadcrumb strong{color:var(--text-0)}
        .topbar-center{flex:1;max-width:500px;margin:0 24px}
        .global-search{display:flex;align-items:center;gap:10px;background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius);padding:8px 16px;width:100%;transition:all 0.2s}
        .global-search:focus-within{border-color:var(--primary);box-shadow:0 0 0 3px var(--primary-glow)}
        .global-search input{background:none;border:none;outline:none;color:var(--text-0);font-size:13px;width:100%}
        .global-search kbd{background:var(--bg-4);padding:2px 6px;border-radius:4px;font-size:10px;color:var(--text-3)}
        .topbar-right{display:flex;align-items:center;gap:10px}
        .topbar-btn{width:40px;height:40px;background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:16px;position:relative;transition:all 0.15s}
        .topbar-btn:hover{border-color:var(--primary);background:var(--primary-glow)}
        .topbar-btn .notif-dot{position:absolute;top:8px;right:8px;width:8px;height:8px;background:var(--rose);border-radius:50%;border:2px solid var(--bg-1)}
        .topbar-btn .count{position:absolute;top:4px;right:4px;background:var(--rose);color:white;font-size:9px;padding:1px 5px;border-radius:10px;font-weight:600}
        .theme-toggle{background:var(--bg-3);border:1px solid var(--border);border-radius:20px;padding:4px;display:flex;gap:4px}
        .theme-toggle button{width:28px;height:28px;border:none;border-radius:50%;background:transparent;cursor:pointer;font-size:14px;transition:all 0.2s}
        .theme-toggle button.active{background:var(--primary);box-shadow:0 2px 8px rgba(99,102,241,0.4)}
        
        /* CONTENT */
        .content{padding:24px;flex:1}
        .page{display:none}
        .page.active{display:block;animation:fadeIn 0.3s}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .page-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:24px;flex-wrap:wrap;gap:16px}
        .page-header h1{font-size:26px;font-weight:700;margin-bottom:4px;display:flex;align-items:center;gap:12px}
        .page-header h1 .icon{font-size:28px}
        .page-header p{color:var(--text-2);font-size:13px}
        .page-actions{display:flex;gap:10px;flex-wrap:wrap}
        
        /* BUTTONS */
        .btn{display:inline-flex;align-items:center;gap:6px;padding:10px 16px;border-radius:var(--radius);font-size:13px;font-weight:500;cursor:pointer;border:none;transition:all 0.15s;white-space:nowrap}
        .btn:disabled{opacity:0.5;cursor:not-allowed}
        .btn-primary{background:var(--primary);color:white}
        .btn-primary:hover:not(:disabled){background:var(--primary-hover);transform:translateY(-1px)}
        .btn-secondary{background:var(--bg-3);color:var(--text-0);border:1px solid var(--border)}
        .btn-secondary:hover:not(:disabled){background:var(--bg-4);border-color:var(--border-hover)}
        .btn-danger{background:var(--rose);color:white}
        .btn-danger:hover:not(:disabled){background:#e11d48}
        .btn-success{background:var(--emerald);color:white}
        .btn-success:hover:not(:disabled){background:#059669}
        .btn-warning{background:var(--amber);color:white}
        .btn-ghost{background:transparent;color:var(--text-1)}
        .btn-ghost:hover{background:var(--bg-3)}
        .btn-gradient{background:linear-gradient(135deg,var(--primary),var(--violet));color:white}
        .btn-gradient:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 4px 16px rgba(99,102,241,0.3)}
        .btn-outline{background:transparent;border:1px solid var(--primary);color:var(--primary)}
        .btn-outline:hover{background:var(--primary-glow)}
        .btn-sm{padding:6px 12px;font-size:12px}
        .btn-lg{padding:14px 24px;font-size:15px}
        .btn-xl{padding:16px 32px;font-size:16px}
        .btn-icon{width:36px;height:36px;padding:0;justify-content:center}
        .btn-icon.sm{width:28px;height:28px;font-size:12px}
        .btn-group{display:flex;gap:0}
        .btn-group .btn{border-radius:0}
        .btn-group .btn:first-child{border-radius:var(--radius) 0 0 var(--radius)}
        .btn-group .btn:last-child{border-radius:0 var(--radius) var(--radius) 0}
        
        /* STATS */
        .stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px}
        .stat-card{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-lg);padding:20px;transition:all 0.2s;position:relative;overflow:hidden}
        .stat-card:hover{border-color:var(--border-hover);transform:translateY(-2px);box-shadow:var(--shadow)}
        .stat-card.highlight{background:linear-gradient(135deg,rgba(99,102,241,0.1),rgba(139,92,246,0.1));border-color:rgba(99,102,241,0.3)}
        .stat-card.success{border-left:3px solid var(--emerald)}
        .stat-card.warning{border-left:3px solid var(--amber)}
        .stat-card.danger{border-left:3px solid var(--rose)}
        .stat-card.info{border-left:3px solid var(--cyan)}
        .stat-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
        .stat-icon{width:48px;height:48px;border-radius:var(--radius-lg);display:flex;align-items:center;justify-content:center;font-size:22px}
        .stat-icon.primary{background:var(--primary-glow);color:var(--primary)}
        .stat-icon.cyan{background:rgba(6,182,212,0.15);color:var(--cyan)}
        .stat-icon.emerald{background:rgba(16,185,129,0.15);color:var(--emerald)}
        .stat-icon.amber{background:rgba(245,158,11,0.15);color:var(--amber)}
        .stat-icon.rose{background:rgba(244,63,94,0.15);color:var(--rose)}
        .stat-icon.violet{background:rgba(139,92,246,0.15);color:var(--violet)}
        .stat-trend{font-size:11px;padding:4px 10px;border-radius:20px;font-weight:600;display:flex;align-items:center;gap:4px}
        .stat-trend.up{background:rgba(16,185,129,0.15);color:var(--emerald)}
        .stat-trend.down{background:rgba(244,63,94,0.15);color:var(--rose)}
        .stat-trend.neutral{background:var(--bg-4);color:var(--text-3)}
        .stat-value{font-size:32px;font-weight:700;margin-bottom:4px;line-height:1.2}
        .stat-label{font-size:13px;color:var(--text-2)}
        .stat-chart{position:absolute;bottom:0;right:0;width:100px;height:50px;opacity:0.3}
        .stat-progress{margin-top:12px}
        .stat-progress-label{display:flex;justify-content:space-between;font-size:11px;color:var(--text-3);margin-bottom:4px}
        
        /* CARDS */
        .card{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;margin-bottom:16px;transition:all 0.2s}
        .card:hover{border-color:var(--border-hover)}
        .card-header{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px}
        .card-header h3{font-size:15px;font-weight:600;display:flex;align-items:center;gap:8px}
        .card-header .actions{display:flex;gap:8px}
        .card-body{padding:20px}
        .card-body.no-padding{padding:0}
        .card-footer{padding:12px 20px;border-top:1px solid var(--border);background:var(--bg-3)}
        
        /* GRIDS */
        .grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:16px}
        .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
        .grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
        .grid-auto{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px}
        
        /* TABLE */
        .table-wrapper{overflow-x:auto}
        .data-table{width:100%;border-collapse:collapse;min-width:600px}
        .data-table th{text-align:left;padding:12px 16px;font-size:11px;font-weight:600;color:var(--text-3);text-transform:uppercase;background:var(--bg-3);border-bottom:1px solid var(--border);position:sticky;top:0}
        .data-table td{padding:14px 16px;font-size:13px;border-bottom:1px solid var(--border);vertical-align:middle}
        .data-table tbody tr{transition:all 0.15s}
        .data-table tbody tr:hover{background:var(--bg-3)}
        .data-table tbody tr.selected{background:var(--primary-glow)}
        .data-table .actions{display:flex;gap:6px}
        
        /* STATUS */
        .status{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:600}
        .status.active,.status.paid,.status.won,.status.hot,.status.completed,.status.positive{background:rgba(16,185,129,0.15);color:var(--emerald)}
        .status.pending,.status.new,.status.warm,.status.callback,.status.in-progress{background:rgba(245,158,11,0.15);color:var(--amber)}
        .status.overdue,.status.inactive,.status.cold,.status.noAnswer,.status.failed{background:rgba(244,63,94,0.15);color:var(--rose)}
        .status.qualified,.status.info{background:rgba(6,182,212,0.15);color:var(--cyan)}
        .status.proposal,.status.draft{background:rgba(139,92,246,0.15);color:var(--violet)}
        
        /* PROGRESS */
        .progress-bar{height:6px;background:var(--bg-4);border-radius:3px;overflow:hidden}
        .progress-bar.lg{height:10px;border-radius:5px}
        .progress-bar-fill{height:100%;border-radius:3px;transition:width 0.5s ease}
        .progress-bar-fill.high,.progress-bar-fill.emerald{background:var(--emerald)}
        .progress-bar-fill.medium,.progress-bar-fill.amber{background:var(--amber)}
        .progress-bar-fill.low,.progress-bar-fill.rose{background:var(--rose)}
        .progress-bar-fill.primary{background:var(--primary)}
        .progress-bar-fill.gradient{background:linear-gradient(90deg,var(--primary),var(--violet))}
        
        /* TABS */
        .tabs{display:flex;gap:4px;background:var(--bg-3);padding:4px;border-radius:var(--radius);margin-bottom:20px}
        .tab{padding:10px 20px;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;color:var(--text-2);transition:all 0.15s;display:flex;align-items:center;gap:8px}
        .tab:hover{color:var(--text-0)}
        .tab.active{background:var(--bg-1);color:var(--text-0);box-shadow:0 2px 8px rgba(0,0,0,0.2)}
        .tab .count{background:var(--bg-4);padding:2px 8px;border-radius:10px;font-size:11px}
        .tab.active .count{background:var(--primary);color:white}
        
        /* AVATARS */
        .avatar{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:14px;flex-shrink:0}
        .avatar.sm{width:32px;height:32px;font-size:12px}
        .avatar.lg{width:56px;height:56px;font-size:20px}
        .avatar.xl{width:80px;height:80px;font-size:28px}
        .avatar-group{display:flex}
        .avatar-group .avatar{margin-left:-10px;border:2px solid var(--bg-2)}
        .avatar-group .avatar:first-child{margin-left:0}
        
        /* TAGS */
        .tag{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;background:var(--bg-4);border-radius:20px;font-size:11px;color:var(--text-1)}
        .tag.primary{background:var(--primary-glow);color:var(--primary)}
        .tag.success{background:rgba(16,185,129,0.15);color:var(--emerald)}
        .tag.warning{background:rgba(245,158,11,0.15);color:var(--amber)}
        .tag.danger{background:rgba(244,63,94,0.15);color:var(--rose)}
        
        /* TOOLTIPS */
        [data-tooltip]{position:relative}
        [data-tooltip]:hover::after{content:attr(data-tooltip);position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:var(--bg-4);color:var(--text-0);padding:6px 12px;border-radius:6px;font-size:12px;white-space:nowrap;z-index:1000;margin-bottom:8px;box-shadow:var(--shadow)}
        
        /* EMPTY STATE */
        .empty-state{text-align:center;padding:60px 20px;color:var(--text-3)}
        .empty-state-icon{font-size:64px;margin-bottom:16px;opacity:0.5}
        .empty-state h3{font-size:18px;color:var(--text-0);margin-bottom:8px}
        .empty-state p{font-size:14px;margin-bottom:20px}
        
        /* LOADING */
        .loading-spinner{display:inline-block;width:20px;height:20px;border:2px solid var(--border);border-top-color:var(--primary);border-radius:50%;animation:spin 0.8s linear infinite}
        .loading-spinner.lg{width:40px;height:40px;border-width:3px}
        @keyframes spin{to{transform:rotate(360deg)}}
        .skeleton{background:linear-gradient(90deg,var(--bg-3) 25%,var(--bg-4) 50%,var(--bg-3) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:var(--radius)}
        @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
        
        /* MODALS */
        .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:1000;padding:20px;backdrop-filter:blur(4px)}
        .modal-overlay.active{display:flex;animation:fadeIn 0.2s}
        .modal{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-xl);width:100%;max-width:500px;max-height:90vh;overflow:hidden;display:none;box-shadow:var(--shadow-lg)}
        .modal.active{display:block;animation:slideUp 0.3s}
        .modal.lg{max-width:700px}
        .modal.xl{max-width:900px}
        @keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        .modal-header{padding:20px 24px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
        .modal-header h2{font-size:18px;font-weight:600;display:flex;align-items:center;gap:10px}
        .modal-close{background:none;border:none;color:var(--text-3);cursor:pointer;font-size:24px;line-height:1;padding:4px;border-radius:var(--radius);transition:all 0.15s}
        .modal-close:hover{color:var(--text-0);background:var(--bg-3)}
        .modal-body{padding:24px;overflow-y:auto;max-height:60vh}
        .modal-footer{padding:16px 24px;border-top:1px solid var(--border);display:flex;justify-content:flex-end;gap:10px;background:var(--bg-3)}
        
        /* TOAST */
        .toast-container{position:fixed;bottom:24px;right:24px;z-index:2000;display:flex;flex-direction:column;gap:10px}
        .toast{background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius-lg);padding:16px 20px;display:flex;align-items:flex-start;gap:12px;min-width:320px;max-width:420px;box-shadow:var(--shadow-lg);animation:slideIn 0.3s ease}
        @keyframes slideIn{from{opacity:0;transform:translateX(100%)}to{opacity:1;transform:translateX(0)}}
        .toast.success{border-left:4px solid var(--emerald)}
        .toast.error{border-left:4px solid var(--rose)}
        .toast.info{border-left:4px solid var(--primary)}
        .toast.warning{border-left:4px solid var(--amber)}
        .toast-icon{font-size:20px;flex-shrink:0}
        .toast-content{flex:1}
        .toast-title{font-size:14px;font-weight:600;margin-bottom:2px}
        .toast-message{font-size:13px;color:var(--text-2)}
        .toast-close{background:none;border:none;color:var(--text-3);cursor:pointer;font-size:18px;padding:0}
        .toast-progress{position:absolute;bottom:0;left:0;height:3px;background:var(--primary);border-radius:0 0 var(--radius-lg) var(--radius-lg);animation:progress 4s linear forwards}
        @keyframes progress{from{width:100%}to{width:0%}}
        
        /* DROPDOWN */
        .dropdown{position:relative}
        .dropdown-menu{position:absolute;top:100%;right:0;background:var(--bg-2);border:1px solid var(--border);border-radius:var(--radius);min-width:180px;box-shadow:var(--shadow-lg);z-index:100;display:none;padding:6px}
        .dropdown-menu.active{display:block;animation:fadeIn 0.15s}
        .dropdown-item{padding:10px 14px;font-size:13px;color:var(--text-1);cursor:pointer;border-radius:6px;display:flex;align-items:center;gap:10px;transition:all 0.1s}
        .dropdown-item:hover{background:var(--bg-3);color:var(--text-0)}
        .dropdown-item.danger{color:var(--rose)}
        .dropdown-divider{height:1px;background:var(--border);margin:6px 0}
        
        /* FORMS */
        .form-row{display:grid;grid-template-columns:repeat(2,1fr);gap:16px;margin-bottom:16px}
        .form-row.cols-3{grid-template-columns:repeat(3,1fr)}
        .form-group{margin-bottom:16px}
        .form-group:last-child{margin-bottom:0}
        .form-group.inline{display:flex;align-items:center;gap:12px}
        .form-group label{display:block;font-size:13px;font-weight:500;margin-bottom:8px;color:var(--text-1)}
        .form-group .hint{font-size:11px;color:var(--text-3);margin-top:6px}
        .form-group .error{font-size:11px;color:var(--rose);margin-top:6px}
        select.form-control{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2371717a' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center}
        textarea.form-control{resize:vertical;min-height:100px;font-family:inherit}
        .form-control.error{border-color:var(--rose)}
        .input-group{display:flex}
        .input-group .form-control{border-radius:0}
        .input-group .form-control:first-child{border-radius:var(--radius) 0 0 var(--radius)}
        .input-group .form-control:last-child{border-radius:0 var(--radius) var(--radius) 0}
        .input-group .btn{border-radius:0 var(--radius) var(--radius) 0}
        .input-icon{position:relative}
        .input-icon .icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--text-3)}
        .input-icon .form-control{padding-left:40px}
        .checkbox-group,.radio-group{display:flex;flex-direction:column;gap:10px}
        .checkbox-item,.radio-item{display:flex;align-items:center;gap:10px;cursor:pointer}
        .checkbox-item input,.radio-item input{width:18px;height:18px;accent-color:var(--primary)}
        .switch{position:relative;width:44px;height:24px;background:var(--bg-4);border-radius:12px;cursor:pointer;transition:all 0.2s}
        .switch.active{background:var(--primary)}
        .switch::after{content:'';position:absolute;width:20px;height:20px;background:white;border-radius:50%;top:2px;left:2px;transition:all 0.2s}
        .switch.active::after{left:22px}
        
        /* CHARTS */
        .chart-container{position:relative;height:300px}
        .chart-placeholder{height:100%;background:var(--bg-3);border-radius:var(--radius);display:flex;align-items:center;justify-content:center;color:var(--text-3);font-size:14px}
        
        /* RESPONSIVE */
        @media (max-width:1400px){.stats-grid{grid-template-columns:repeat(2,1fr)}.grid-4{grid-template-columns:repeat(2,1fr)}}
        @media (max-width:1200px){.grid-3{grid-template-columns:repeat(2,1fr)}}
        @media (max-width:992px){.sidebar{transform:translateX(-260px)}.sidebar.open{transform:translateX(0)}.main{margin-left:0}.menu-toggle{display:block}}
        @media (max-width:768px){.stats-grid,.grid-2,.grid-3,.grid-4,.form-row{grid-template-columns:1fr}.topbar-center{display:none}.page-header{flex-direction:column}.page-actions{width:100%}.page-actions .btn{flex:1}}
        @media (max-width:480px){.content{padding:16px}.toast{min-width:auto;max-width:calc(100vw - 48px)}}
        
        /* PRINT */
        @media print{.sidebar,.topbar,.page-actions,.btn{display:none!important}.main{margin:0!important}.content{padding:0!important}}
    </style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div class="login-screen" id="loginScreen">
    <div class="login-container">
        <div class="login-logo">
            <div class="login-logo-icon">‚ö°</div>
            <h1>West Money OS</h1>
            <p>Ultimate Business Platform</p>
            <span class="version">v4.0 Ultimate</span>
        </div>
        <div class="login-box">
            <h2>üîê Anmelden</h2>
            <div class="login-error" id="loginError">Ung√ºltige Anmeldedaten</div>
            <form id="loginForm">
                <div class="form-group">
                    <label>Benutzername</label>
                    <input type="text" id="username" class="form-input" placeholder="Benutzername" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label>Passwort</label>
                    <input type="password" id="password" class="form-input" placeholder="Passwort" required autocomplete="current-password">
                </div>
                <div class="login-2fa">
                    <label><input type="checkbox" id="enable2fa"> üîí Zwei-Faktor-Authentifizierung aktivieren</label>
                </div>
                <button type="submit" class="login-btn" style="margin-top:20px">
                    <span>Anmelden</span>
                    <span>‚Üí</span>
                </button>
            </form>
        </div>
        <div class="login-footer">¬© 2025 West Money OS ¬∑ Enterprise Universe GmbH ¬∑ v4.0</div>
    </div>
</div>

<!-- APP -->
<div class="app" id="app">
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">‚ö°</div>
                <div>
                    <h1>West Money OS <span class="v-badge">4.0</span></h1>
                    <span>Ultimate Business Platform</span>
                </div>
            </div>
        </div>
        <nav class="sidebar-nav" id="sidebarNav"></nav>
        <div class="sidebar-footer">
            <div class="user-box" onclick="showPage('profile')">
                <div class="user-avatar" id="userAvatar">√ñC<span class="online"></span></div>
                <div class="user-info"><div id="userName">√ñmer Co≈ükun</div><span id="userRole">Administrator</span></div>
                <button class="logout-btn" onclick="event.stopPropagation();logout()" title="Abmelden">üö™</button>
            </div>
        </div>
    </aside>
    
    <!-- MAIN -->
    <main class="main" id="mainContent">
        <header class="topbar">
            <div class="topbar-left">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <div class="breadcrumb">West Money OS / <strong id="currentPage">Dashboard</strong></div>
            </div>
            <div class="topbar-center">
                <div class="global-search">
                    <span>üîç</span>
                    <input type="text" id="globalSearch" placeholder="Suchen... (Strg+K)" onkeyup="handleGlobalSearch(event)">
                    <kbd>‚åòK</kbd>
                </div>
            </div>
            <div class="topbar-right">
                <div class="theme-toggle">
                    <button onclick="setTheme('dark')" class="active" id="themeDark">üåô</button>
                    <button onclick="setTheme('light')" id="themeLight">‚òÄÔ∏è</button>
                </div>
                <div class="topbar-btn" onclick="showPage('tasks')" data-tooltip="Aufgaben">
                    üìã<span class="count" id="taskCount">0</span>
                </div>
                <div class="topbar-btn" onclick="showPage('inbox')" data-tooltip="Nachrichten">
                    üí¨<span class="count" id="inboxCount">0</span>
                </div>
                <div class="topbar-btn" onclick="toggleNotifications()" data-tooltip="Benachrichtigungen">
                    üîî<span class="notif-dot"></span>
                </div>
            </div>
        </header>
        
        <div class="content" id="pageContent"></div>
    </main>
</div>

<!-- MODAL OVERLAY -->
<div class="modal-overlay" id="modalOverlay"></div>

<!-- TOAST CONTAINER -->
<div class="toast-container" id="toastContainer"></div>

<!-- COMMAND PALETTE -->
<div class="modal-overlay" id="commandPalette" style="background:rgba(0,0,0,0.8)">
    <div class="modal active" style="max-width:600px;margin-top:-100px">
        <div class="modal-body" style="padding:0">
            <div style="padding:16px;border-bottom:1px solid var(--border)">
                <input type="text" class="form-control" id="commandInput" placeholder="Befehl eingeben..." style="font-size:16px" onkeyup="filterCommands(event)">
            </div>
            <div id="commandList" style="max-height:400px;overflow-y:auto"></div>
        </div>
    </div>
</div>

<script>
// ============================================================
// WEST MONEY OS v4.0 - ULTIMATE BUSINESS PLATFORM
// ============================================================

// ==================== NAVIGATION CONFIG ====================
const navigationConfig = [
    { group: '√úbersicht', items: [
        { id: 'dashboard', icon: 'üìä', label: 'Dashboard', shortcut: 'D' },
        { id: 'analytics', icon: 'üìà', label: 'Analytics', badge: 'new' },
        { id: 'reports', icon: 'üìë', label: 'Reports' }
    ]},
    { group: 'Lead Generation', items: [
        { id: 'leadgen', icon: 'üîç', label: 'Lead Generator', badge: 'new' },
        { id: 'b2b', icon: 'üè¢', label: 'B2B Datenbank', countKey: 'b2b' },
        { id: 'scoring', icon: 'üéØ', label: 'AI Lead Scoring', badge: 'AI' }
    ]},
    { group: 'CRM & Sales', items: [
        { id: 'contacts', icon: 'üë•', label: 'Kontakte', countKey: 'contacts' },
        { id: 'leads', icon: 'üéØ', label: 'Leads', countKey: 'leads' },
        { id: 'pipeline', icon: 'üìà', label: 'Pipeline' },
        { id: 'deals', icon: 'ü§ù', label: 'Deals' }
    ]},
    { group: 'Kommunikation', items: [
        { id: 'inbox', icon: 'üì•', label: 'Unified Inbox', countKey: 'unread', hot: true },
        { id: 'campaigns', icon: 'üìß', label: 'Kampagnen' },
        { id: 'templates', icon: 'üìù', label: 'Vorlagen' },
        { id: 'scheduler', icon: 'üìÖ', label: 'Meeting Scheduler' }
    ]},
    { group: 'Finanzen', items: [
        { id: 'invoices', icon: 'üìÑ', label: 'Rechnungen' },
        { id: 'quotes', icon: 'üìã', label: 'Angebote' },
        { id: 'expenses', icon: 'üí≥', label: 'Ausgaben' },
        { id: 'banking', icon: 'üè¶', label: 'Banking' }
    ]},
    { group: 'Projekte', items: [
        { id: 'projects', icon: 'üìÅ', label: 'Projekte' },
        { id: 'tasks', icon: '‚úÖ', label: 'Aufgaben', countKey: 'tasks' },
        { id: 'calendar', icon: 'üìÖ', label: 'Kalender' },
        { id: 'timetracking', icon: '‚è±Ô∏è', label: 'Zeiterfassung' }
    ]},
    { group: 'Produkte', items: [
        { id: 'products', icon: 'üì¶', label: 'Produktkatalog' },
        { id: 'configurator', icon: 'üõ†Ô∏è', label: 'Smart Home Konfigurator', badge: 'new' }
    ]},
    { group: 'Team', items: [
        { id: 'team', icon: 'üë•', label: 'Team' },
        { id: 'activity', icon: 'üìä', label: 'Aktivit√§ten' },
        { id: 'chat', icon: 'üí¨', label: 'Team Chat' }
    ]},
    { group: 'Platform', items: [
        { id: 'integrations', icon: 'üîå', label: 'Integrationen' },
        { id: 'automations', icon: '‚ö°', label: 'Automatisierungen' },
        { id: 'api', icon: 'üîó', label: 'API Hub' },
        { id: 'settings', icon: '‚öôÔ∏è', label: 'Einstellungen' },
        { id: 'audit', icon: 'üìã', label: 'Audit Log' }
    ]}
];

// ==================== DEFAULT DATA ====================
const defaultData = {
    contacts: [
        { id: 1, firstName: 'Max', lastName: 'M√ºller', email: 'max@mueller.de', phone: '+49 221 1234567', company: 'M√ºller Bau GmbH', position: 'Gesch√§ftsf√ºhrer', status: 'active', tags: ['VIP', 'Baugewerbe'], score: 85, lastContact: '2025-12-20', created: '2025-01-15' },
        { id: 2, firstName: 'Anna', lastName: 'Schmidt', email: 'anna@schmidt.de', phone: '+49 221 7654321', company: 'Schmidt Immobilien', position: 'CEO', status: 'active', tags: ['Immobilien'], score: 72, lastContact: '2025-12-18', created: '2025-02-20' },
        { id: 3, firstName: 'Thomas', lastName: 'Weber', email: 'thomas@weber.de', phone: '+49 221 9876543', company: 'Weber Haus', position: 'Inhaber', status: 'pending', tags: ['Neubau'], score: 68, lastContact: '2025-12-15', created: '2025-03-10' },
        { id: 4, firstName: 'Lisa', lastName: 'Fischer', email: 'lisa@fischer.de', phone: '+49 221 5432167', company: 'Fischer GmbH', position: 'Projektleiterin', status: 'active', tags: ['Smart Home'], score: 91, lastContact: '2025-12-22', created: '2025-04-05' },
        { id: 5, firstName: 'Michael', lastName: 'Bauer', email: 'michael@bauer.de', phone: '+49 221 6789012', company: 'Bauer Gruppe', position: 'Vorstand', status: 'active', tags: ['VIP', 'Enterprise'], score: 95, lastContact: '2025-12-21', created: '2025-05-12' }
    ],
    leads: [
        { id: 1, name: 'Smart Home Projekt K√∂ln', company: 'M√ºller GmbH', value: 85000, status: 'qualified', source: 'Website', probability: 75, assignee: '√ñmer', lastContact: '2025-12-22', nextAction: 'Angebot senden', dueDate: '2025-12-28' },
        { id: 2, name: 'Barrierefreies Bauen D√ºsseldorf', company: 'Weber Bau', value: 45000, status: 'new', source: 'Lead Generator', probability: 40, assignee: '√ñmer', lastContact: '2025-12-20', nextAction: 'Erstgespr√§ch', dueDate: '2025-12-26' },
        { id: 3, name: 'Komplettsanierung EFH', company: 'Schmidt Haus', value: 125000, status: 'won', source: 'Empfehlung', probability: 100, assignee: '√ñmer', lastContact: '2025-12-15', nextAction: 'Projektstart', dueDate: '2026-01-05' },
        { id: 4, name: 'LOXONE Installation Office', company: 'Fischer Immo', value: 32000, status: 'proposal', source: 'Website', probability: 60, assignee: '√ñmer', lastContact: '2025-12-19', nextAction: 'Follow-up Anruf', dueDate: '2025-12-27' },
        { id: 5, name: 'Neubau Villa Rodenkirchen', company: 'Becker Familie', value: 280000, status: 'new', source: 'Lead Generator', probability: 35, assignee: '√ñmer', lastContact: '2025-12-21', nextAction: 'Besichtigung', dueDate: '2025-12-30' },
        { id: 6, name: 'B√ºrogeb√§ude Automation', company: 'TechCorp GmbH', value: 156000, status: 'qualified', source: 'LinkedIn', probability: 55, assignee: '√ñmer', lastContact: '2025-12-18', nextAction: 'Demo', dueDate: '2025-12-29' }
    ],
    invoices: [
        { id: 'RE-2025-001', customer: 'M√ºller GmbH', amount: 45000, status: 'paid', date: '2025-12-01', dueDate: '2025-12-15', paidDate: '2025-12-10', items: [{desc: 'Smart Home Installation', qty: 1, price: 45000}] },
        { id: 'RE-2025-002', customer: 'Weber Bau', amount: 28000, status: 'pending', date: '2025-12-10', dueDate: '2025-12-24', items: [{desc: 'LOXONE System', qty: 1, price: 28000}] },
        { id: 'RE-2025-003', customer: 'Schmidt Haus', amount: 62000, status: 'paid', date: '2025-11-25', dueDate: '2025-12-09', paidDate: '2025-12-05', items: [{desc: 'Komplettsanierung Phase 1', qty: 1, price: 62000}] },
        { id: 'RE-2025-004', customer: 'Fischer GmbH', amount: 18000, status: 'overdue', date: '2025-11-01', dueDate: '2025-11-15', items: [{desc: 'Beratung & Planung', qty: 1, price: 18000}] }
    ],
    quotes: [
        { id: 'AN-2025-001', customer: 'M√ºller GmbH', amount: 85000, status: 'sent', date: '2025-12-20', validUntil: '2026-01-20', items: [{desc: 'Smart Home Komplettsystem', qty: 1, price: 85000}] },
        { id: 'AN-2025-002', customer: 'Fischer Immo', amount: 32000, status: 'draft', date: '2025-12-22', validUntil: '2026-01-22', items: [{desc: 'LOXONE Office Installation', qty: 1, price: 32000}] }
    ],
    tasks: [
        { id: 1, title: 'Angebot f√ºr M√ºller GmbH erstellen', description: 'Smart Home Angebot mit LOXONE Konfigurator', status: 'in-progress', priority: 'high', dueDate: '2025-12-24', assignee: '√ñmer', project: 'Smart Home K√∂ln', tags: ['Angebot', 'Dringend'] },
        { id: 2, title: 'Follow-up Anruf Weber Bau', description: 'Nachfassen zum Angebot', status: 'pending', priority: 'medium', dueDate: '2025-12-26', assignee: '√ñmer', project: null, tags: ['Anruf'] },
        { id: 3, title: 'Rechnung RE-2025-004 mahnen', description: '18.000‚Ç¨ √ºberf√§llig seit 38 Tagen', status: 'pending', priority: 'high', dueDate: '2025-12-23', assignee: '√ñmer', project: null, tags: ['Finanzen', 'Dringend'] },
        { id: 4, title: 'DATEV Export vorbereiten', description: 'Monatsabschluss Dezember', status: 'pending', priority: 'low', dueDate: '2025-12-31', assignee: '√ñmer', project: null, tags: ['Finanzen'] },
        { id: 5, title: 'Demo f√ºr TechCorp', description: 'LOXONE Showroom Demo vorbereiten', status: 'pending', priority: 'medium', dueDate: '2025-12-29', assignee: '√ñmer', project: 'B√ºro Automation', tags: ['Demo'] }
    ],
    projects: [
        { id: 1, name: 'Smart Home Villa K√∂ln', customer: 'M√ºller GmbH', status: 'active', progress: 65, budget: 85000, spent: 45000, startDate: '2025-10-01', endDate: '2026-02-28', team: ['√ñmer'], milestones: [{name: 'Planung', done: true}, {name: 'Installation', done: false}, {name: 'Abnahme', done: false}] },
        { id: 2, name: 'Sanierung Schmidt', customer: 'Schmidt Haus', status: 'active', progress: 35, budget: 125000, spent: 62000, startDate: '2025-11-15', endDate: '2026-04-30', team: ['√ñmer'], milestones: [{name: 'Phase 1', done: true}, {name: 'Phase 2', done: false}, {name: 'Phase 3', done: false}] },
        { id: 3, name: 'Office Automation', customer: 'TechCorp GmbH', status: 'planning', progress: 10, budget: 156000, spent: 0, startDate: '2026-01-15', endDate: '2026-06-30', team: ['√ñmer'], milestones: [{name: 'Kick-off', done: false}] }
    ],
    conversations: [
        { id: 1, contact: 'Max M√ºller', phone: '+49 221 1234567', type: 'whatsapp', unread: true, messages: [{id: 1, text: 'Guten Tag, hier ist das aktualisierte Angebot.', time: '10:30', outgoing: true}, {id: 2, text: 'Vielen Dank! Ich schaue es mir heute noch an.', time: '10:45', outgoing: false}, {id: 3, text: 'K√∂nnen wir morgen telefonieren?', time: '11:00', outgoing: false}] },
        { id: 2, contact: 'Anna Schmidt', phone: '+49 221 7654321', type: 'whatsapp', unread: false, messages: [{id: 1, text: 'Termin best√§tigt f√ºr Freitag 14:00 Uhr.', time: '09:15', outgoing: true}] },
        { id: 3, contact: 'Lisa Fischer', email: 'lisa@fischer.de', type: 'email', subject: 'LOXONE Installation Anfrage', unread: true, messages: [{id: 1, text: 'Sehr geehrter Herr Co≈ükun, wir haben gro√ües Interesse an einer LOXONE Installation f√ºr unser neues B√ºrogeb√§ude. Bitte senden Sie uns ein Angebot.', time: '08:15', outgoing: false}] },
        { id: 4, contact: 'Thomas Weber', phone: '+49 221 9876543', type: 'whatsapp', unread: true, messages: [{id: 1, text: 'Wie ist der aktuelle Stand beim Projekt?', time: '14:30', outgoing: false}] }
    ],
    campaigns: [
        { id: 1, name: 'Smart Home Q1 2026', type: 'email', status: 'active', sent: 145, total: 320, opened: 67, clicked: 23, replied: 8, startDate: '2025-12-15' },
        { id: 2, name: 'B2B Baugewerbe NRW', type: 'email', status: 'completed', sent: 89, total: 89, opened: 34, clicked: 12, replied: 5, startDate: '2025-12-01' },
        { id: 3, name: 'WhatsApp Follow-up', type: 'whatsapp', status: 'active', sent: 23, total: 50, opened: 23, clicked: 0, replied: 15, startDate: '2025-12-18' },
        { id: 4, name: 'Neujahrs-Newsletter', type: 'email', status: 'draft', sent: 0, total: 500, opened: 0, clicked: 0, replied: 0, startDate: null }
    ],
    templates: [
        { id: 1, name: 'Erstanfrage Antwort', type: 'email', subject: 'Vielen Dank f√ºr Ihre Anfrage', body: 'Sehr geehrte/r {name},\n\nvielen Dank f√ºr Ihr Interesse an unseren Smart Home L√∂sungen...' },
        { id: 2, name: 'Angebots-Follow-up', type: 'email', subject: 'R√ºckfrage zu unserem Angebot', body: 'Sehr geehrte/r {name},\n\nwir m√∂chten nachfragen, ob Sie unser Angebot bereits pr√ºfen konnten...' },
        { id: 3, name: 'WhatsApp Termin', type: 'whatsapp', subject: '', body: 'Hallo {name}, ich wollte kurz nachfragen ob der Termin am {date} noch passt? LG √ñmer' },
        { id: 4, name: 'Zahlungserinnerung', type: 'email', subject: 'Freundliche Zahlungserinnerung', body: 'Sehr geehrte/r {name},\n\nwir m√∂chten Sie freundlich an die offene Rechnung {invoice} erinnern...' }
    ],
    products: [
        { id: 1, name: 'LOXONE Miniserver', sku: 'LOX-MINI-01', category: 'Steuerung', price: 890, cost: 650, stock: 15, image: 'üéõÔ∏è', description: 'Das Herzst√ºck jeder LOXONE Installation' },
        { id: 2, name: 'LOXONE Touch', sku: 'LOX-TOUCH-01', category: 'Bedienung', price: 290, cost: 180, stock: 42, image: 'üì±', description: 'Elegantes Touch-Bedienfeld' },
        { id: 3, name: 'LOXONE Dimmer', sku: 'LOX-DIM-01', category: 'Licht', price: 190, cost: 120, stock: 67, image: 'üí°', description: 'LED Dimmer f√ºr stufenlose Lichtsteuerung' },
        { id: 4, name: 'LOXONE Jalousie-Aktor', sku: 'LOX-JAL-01', category: 'Beschattung', price: 240, cost: 150, stock: 28, image: 'ü™ü', description: '4-Kanal Jalousie-Steuerung' },
        { id: 5, name: 'LOXONE Raumklima-Sensor', sku: 'LOX-KLIMA-01', category: 'Sensoren', price: 180, cost: 110, stock: 35, image: 'üå°Ô∏è', description: 'Temperatur, Feuchte & CO2' },
        { id: 6, name: 'Verisure Alarmanlage', sku: 'VER-ALARM-01', category: 'Sicherheit', price: 1200, cost: 800, stock: 8, image: 'üö®', description: 'Professionelles Alarmsystem' }
    ],
    b2bDatabase: [
        { id: 1, company: 'Bauhaus K√∂ln GmbH', industry: 'Baugewerbe', employees: '50-100', revenue: '‚Ç¨10-25M', city: 'K√∂ln', website: 'bauhaus-koeln.de', phone: '+49 221 9876543', email: 'info@bauhaus-koeln.de', score: 87, status: 'hot', decisionMaker: 'Thomas Bauer', position: 'Gesch√§ftsf√ºhrer', founded: 2008, verified: true },
        { id: 2, company: 'Rhein Immobilien AG', industry: 'Immobilien', employees: '100-250', revenue: '‚Ç¨25-50M', city: 'D√ºsseldorf', website: 'rhein-immo.de', phone: '+49 211 1234567', email: 'kontakt@rhein-immo.de', score: 92, status: 'hot', decisionMaker: 'Maria Weber', position: 'Vorstand', founded: 1995, verified: true },
        { id: 3, company: 'NRW Elektrotechnik', industry: 'Elektro', employees: '25-50', revenue: '‚Ç¨5-10M', city: 'Essen', website: 'nrw-elektro.de', phone: '+49 201 5678901', email: 'info@nrw-elektro.de', score: 74, status: 'warm', decisionMaker: 'Klaus Fischer', position: 'Inhaber', founded: 2012, verified: true },
        { id: 4, company: 'Smart Home Solutions', industry: 'Technologie', employees: '10-25', revenue: '‚Ç¨1-5M', city: 'Bonn', website: 'smarthome-sol.de', phone: '+49 228 3456789', email: 'hello@smarthome-sol.de', score: 81, status: 'warm', decisionMaker: 'Sarah Klein', position: 'CEO', founded: 2018, verified: false },
        { id: 5, company: 'Facility Management Plus', industry: 'Dienstleistung', employees: '100-250', revenue: '‚Ç¨10-25M', city: 'K√∂ln', website: 'fm-plus.de', phone: '+49 221 7654321', email: 'info@fm-plus.de', score: 68, status: 'cold', decisionMaker: 'Michael Braun', position: 'Gesch√§ftsleitung', founded: 2005, verified: true },
        { id: 6, company: 'Architekten Meier & Partner', industry: 'Architektur', employees: '10-25', revenue: '‚Ç¨1-5M', city: 'K√∂ln', website: 'meier-architekten.de', phone: '+49 221 2345678', email: 'buero@meier-architekten.de', score: 79, status: 'warm', decisionMaker: 'Dr. Hans Meier', position: 'Partner', founded: 2001, verified: true },
        { id: 7, company: 'K√∂lner Wohnbau GmbH', industry: 'Baugewerbe', employees: '50-100', revenue: '‚Ç¨25-50M', city: 'K√∂ln', website: 'koelner-wohnbau.de', phone: '+49 221 8765432', email: 'kontakt@koelner-wohnbau.de', score: 95, status: 'hot', decisionMaker: 'Peter Schmidt', position: 'Gesch√§ftsf√ºhrer', founded: 1990, verified: true },
        { id: 8, company: 'Energie Consulting West', industry: 'Beratung', employees: '10-25', revenue: '‚Ç¨1-5M', city: 'Aachen', website: 'energie-west.de', phone: '+49 241 9876543', email: 'info@energie-west.de', score: 71, status: 'warm', decisionMaker: 'Julia Hoffmann', position: 'Inhaberin', founded: 2015, verified: false },
        { id: 9, company: 'Premium Hausbau AG', industry: 'Baugewerbe', employees: '250-500', revenue: '‚Ç¨50-100M', city: 'D√ºsseldorf', website: 'premium-hausbau.de', phone: '+49 211 5432109', email: 'info@premium-hausbau.de', score: 89, status: 'hot', decisionMaker: 'Frank Richter', position: 'Vorstand', founded: 1985, verified: true },
        { id: 10, company: 'TechBau Innovation', industry: 'Technologie', employees: '25-50', revenue: '‚Ç¨5-10M', city: 'K√∂ln', website: 'techbau-innovation.de', phone: '+49 221 1357924', email: 'kontakt@techbau-innovation.de', score: 83, status: 'warm', decisionMaker: 'Anna Krause', position: 'Gesch√§ftsf√ºhrerin', founded: 2019, verified: true }
    ],
    sequences: [
        { id: 1, name: 'Neuer Lead Welcome', trigger: 'new_lead', steps: 4, enrolled: 12, completed: 8, active: true },
        { id: 2, name: 'Cold Lead Reaktivierung', trigger: 'no_response', steps: 6, enrolled: 34, completed: 15, active: true },
        { id: 3, name: 'Post-Meeting Follow-up', trigger: 'manual', steps: 3, enrolled: 8, completed: 6, active: false }
    ],
    activities: [
        { id: 1, type: 'lead', icon: 'üéØ', text: 'Neuer Lead: Villa Rodenkirchen ‚Ç¨280K', time: '5 Min.', user: 'System' },
        { id: 2, type: 'email', icon: 'üìß', text: 'E-Mail ge√∂ffnet: Max M√ºller', time: '12 Min.', user: 'System' },
        { id: 3, type: 'payment', icon: 'üí∞', text: 'Zahlung eingegangen: ‚Ç¨45,000', time: '1 Std.', user: 'System' },
        { id: 4, type: 'call', icon: 'üìû', text: 'Anruf mit Lisa Fischer (15 Min)', time: '2 Std.', user: '√ñmer' },
        { id: 5, type: 'deal', icon: 'üéâ', text: 'Deal gewonnen: Schmidt Haus ‚Ç¨125K', time: '3 Std.', user: '√ñmer' },
        { id: 6, type: 'task', icon: '‚úÖ', text: 'Aufgabe erledigt: Angebot gesendet', time: '4 Std.', user: '√ñmer' }
    ],
    auditLog: [
        { id: 1, action: 'login', user: '√ñmer Co≈ükun', ip: '192.168.1.100', timestamp: '2025-12-23 09:00:00', details: 'Erfolgreiche Anmeldung' },
        { id: 2, action: 'create', user: '√ñmer Co≈ükun', ip: '192.168.1.100', timestamp: '2025-12-23 09:15:00', details: 'Lead erstellt: Villa Rodenkirchen' },
        { id: 3, action: 'update', user: '√ñmer Co≈ükun', ip: '192.168.1.100', timestamp: '2025-12-23 10:30:00', details: 'Kontakt aktualisiert: Max M√ºller' },
        { id: 4, action: 'export', user: '√ñmer Co≈ükun', ip: '192.168.1.100', timestamp: '2025-12-22 16:00:00', details: 'DATEV Export durchgef√ºhrt' }
    ],
    integrations: [
        { id: 'hubspot', name: 'HubSpot CRM', category: 'CRM', status: 'connected', icon: 'üß°', lastSync: '2025-12-23 08:00' },
        { id: 'whatsapp', name: 'WhatsApp Business', category: 'Messaging', status: 'connected', icon: 'üí¨', lastSync: '2025-12-23 09:30' },
        { id: 'gmail', name: 'Gmail / Google', category: 'Email', status: 'connected', icon: 'üìß', lastSync: '2025-12-23 09:45' },
        { id: 'calendar', name: 'Google Calendar', category: 'Kalender', status: 'connected', icon: 'üìÖ', lastSync: '2025-12-23 09:00' },
        { id: 'zapier', name: 'Zapier', category: 'Automation', status: 'connected', icon: '‚ö°', lastSync: '2025-12-23 08:30' },
        { id: 'linkedin', name: 'LinkedIn', category: 'Social', status: 'pending', icon: 'üíº', lastSync: null },
        { id: 'xing', name: 'XING', category: 'Social', status: 'pending', icon: 'üîó', lastSync: null },
        { id: 'datev', name: 'DATEV', category: 'Buchhaltung', status: 'connected', icon: 'üìä', lastSync: '2025-12-22 18:00' },
        { id: 'stripe', name: 'Stripe', category: 'Payment', status: 'pending', icon: 'üí≥', lastSync: null },
        { id: 'slack', name: 'Slack', category: 'Team', status: 'pending', icon: 'üí¨', lastSync: null }
    ],
    team: [
        { id: 1, name: '√ñmer Co≈ükun', email: 'oemer@west-money-bau.de', role: 'admin', position: 'Gesch√§ftsf√ºhrer', avatar: '√ñC', status: 'online', lastActive: 'Jetzt' },
        { id: 2, name: 'Demo User', email: 'demo@west-money-bau.de', role: 'sales', position: 'Sales Manager', avatar: 'DU', status: 'offline', lastActive: '2 Std.' }
    ],
    settings: {
        company: { name: 'West Money Bau GmbH', address: 'Ehrenstra√üe 1, 50672 K√∂ln', phone: '+49 221 12345678', email: 'info@west-money-bau.de', website: 'west-money-bau.de', taxId: 'DE123456789', iban: 'DE42 1001 0178 9758 7887 93' },
        notifications: { email: true, push: true, sms: false, slack: true },
        privacy: { gdprMode: true, dataRetention: 365, cookieConsent: true }
    },
    expenses: [
        { id: 1, description: 'LOXONE Materialbestellung', amount: 12500, category: 'Material', date: '2025-12-20', vendor: 'LOXONE GmbH', status: 'paid' },
        { id: 2, description: 'B√ºroausstattung', amount: 3200, category: 'B√ºro', date: '2025-12-15', vendor: 'IKEA', status: 'paid' },
        { id: 3, description: 'Google Ads Dezember', amount: 1500, category: 'Marketing', date: '2025-12-01', vendor: 'Google', status: 'paid' },
        { id: 4, description: 'Fahrzeug Leasing', amount: 890, category: 'Fahrzeuge', date: '2025-12-01', vendor: 'BMW Leasing', status: 'recurring' }
    ],
    timeEntries: [
        { id: 1, project: 'Smart Home Villa K√∂ln', task: 'Installation', date: '2025-12-23', hours: 6.5, user: '√ñmer', billable: true },
        { id: 2, project: 'Sanierung Schmidt', task: 'Planung', date: '2025-12-22', hours: 4, user: '√ñmer', billable: true },
        { id: 3, project: 'Admin', task: 'Buchhaltung', date: '2025-12-22', hours: 2, user: '√ñmer', billable: false }
    ],
    calendar: [
        { id: 1, title: 'Demo TechCorp', start: '2025-12-29T10:00', end: '2025-12-29T11:30', type: 'meeting', attendees: ['√ñmer', 'Anna Krause'] },
        { id: 2, title: 'Projektbesprechung M√ºller', start: '2025-12-27T14:00', end: '2025-12-27T15:00', type: 'meeting', attendees: ['√ñmer', 'Max M√ºller'] },
        { id: 3, title: 'DATEV Monatsabschluss', start: '2025-12-31T09:00', end: '2025-12-31T12:00', type: 'task', attendees: ['√ñmer'] }
    ]
};

let data = JSON.parse(localStorage.getItem('wmos_data_v4')) || JSON.parse(JSON.stringify(defaultData));
let currentUser = JSON.parse(localStorage.getItem('wmos_user'));
let currentPage = localStorage.getItem('wmos_page') || 'dashboard';
let currentTheme = localStorage.getItem('wmos_theme') || 'dark';

// ==================== UTILITY FUNCTIONS ====================
function saveData() { localStorage.setItem('wmos_data_v4', JSON.stringify(data)); }
function generateId() { return Date.now() + Math.random().toString(36).substr(2, 9); }
function formatCurrency(n) { return '‚Ç¨' + (n || 0).toLocaleString('de-DE'); }
function formatDate(d) { return d ? new Date(d).toLocaleDateString('de-DE') : '-'; }
function formatDateTime(d) { return d ? new Date(d).toLocaleString('de-DE') : '-'; }
function formatTime(d) { return d ? new Date(d).toLocaleTimeString('de-DE', {hour: '2-digit', minute: '2-digit'}) : '-'; }
function daysSince(d) { return d ? Math.floor((new Date() - new Date(d)) / (1000*60*60*24)) : 0; }
function getInitials(name) { return name ? name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2) : '??'; }
function statusLabel(s) { 
    const labels = {new:'Neu',qualified:'Qualifiziert',proposal:'Angebot',won:'Gewonnen',lost:'Verloren',active:'Aktiv',pending:'Ausstehend',paid:'Bezahlt',overdue:'√úberf√§llig',hot:'Hot üî•',warm:'Warm',cold:'Cold','in-progress':'In Arbeit',completed:'Abgeschlossen',draft:'Entwurf',sent:'Gesendet',connected:'Verbunden',planning:'Planung'};
    return labels[s] || s;
}

// ==================== TOAST NOTIFICATIONS ====================
function showToast(type, title, message, duration = 4000) {
    const container = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    const icons = {success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è', warning: '‚ö†Ô∏è'};
    toast.innerHTML = `
        <span class="toast-icon">${icons[type] || '‚ÑπÔ∏è'}</span>
        <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-message">${message}</div>
        </div>
        <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
    `;
    container.appendChild(toast);
    setTimeout(() => { 
        toast.style.opacity = '0'; 
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => toast.remove(), 300); 
    }, duration);
}

// ==================== THEME ====================
function setTheme(theme) {
    currentTheme = theme;
    localStorage.setItem('wmos_theme', theme);
    document.body.setAttribute('data-theme', theme);
    document.getElementById('themeDark').classList.toggle('active', theme === 'dark');
    document.getElementById('themeLight').classList.toggle('active', theme === 'light');
}

// ==================== AUTH ====================
function handleLogin(e) {
    e.preventDefault();
    const u = document.getElementById('username').value;
    const p = document.getElementById('password').value;
    if ((u === 'admin' && p === '663724') || (u === 'admin' && p === 'admin') || (u === 'demo' && p === 'demo')) {
        currentUser = { 
            id: u === 'admin' && p === '663724' ? 1 : 2,
            name: u === 'admin' && p === '663724' ? '√ñmer Co≈ükun' : 'Demo User', 
            role: p === '663724' ? 'admin' : 'user',
            email: u === 'admin' && p === '663724' ? 'oemer@west-money-bau.de' : 'demo@example.de'
        };
        localStorage.setItem('wmos_user', JSON.stringify(currentUser));
        // Log to audit
        data.auditLog.unshift({id: generateId(), action: 'login', user: currentUser.name, ip: '192.168.1.100', timestamp: new Date().toISOString(), details: 'Erfolgreiche Anmeldung'});
        saveData();
        showApp();
    } else {
        document.getElementById('loginError').classList.add('show');
        setTimeout(() => document.getElementById('loginError').classList.remove('show'), 3000);
    }
}

function logout() {
    localStorage.removeItem('wmos_user');
    currentUser = null;
    document.getElementById('loginScreen').style.display = 'flex';
    document.getElementById('app').classList.remove('active');
    document.getElementById('username').value = '';
    document.getElementById('password').value = '';
}

function showApp() {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('app').classList.add('active');
    document.getElementById('userName').textContent = currentUser.name;
    document.getElementById('userRole').textContent = currentUser.role === 'admin' ? 'Administrator' : 'Benutzer';
    document.getElementById('userAvatar').innerHTML = getInitials(currentUser.name) + '<span class="online"></span>';
    setTheme(currentTheme);
    renderNavigation();
    showPage(currentPage);
    updateAllCounts();
    showToast('success', 'Willkommen!', `Angemeldet als ${currentUser.name}`);
}

// ==================== NAVIGATION ====================
function renderNavigation() {
    const nav = document.getElementById('sidebarNav');
    nav.innerHTML = navigationConfig.map(group => `
        <div class="nav-group">
            <div class="nav-label">${group.group}</div>
            ${group.items.map(item => `
                <div class="nav-item ${currentPage === item.id ? 'active' : ''}" data-page="${item.id}" onclick="showPage('${item.id}')">
                    <span class="icon">${item.icon}</span>
                    <span class="label">${item.label}</span>
                    ${item.badge ? `<span class="badge ${item.badge === 'new' ? 'new' : item.badge === 'AI' ? 'hot' : ''}">${item.badge}</span>` : ''}
                    ${item.countKey ? `<span class="badge" id="nav_${item.countKey}">0</span>` : ''}
                    ${item.hot ? `<span class="badge hot" id="nav_${item.id}_count">0</span>` : ''}
                    ${item.shortcut ? `<span class="shortcut">${item.shortcut}</span>` : ''}
                </div>
            `).join('')}
        </div>
    `).join('');
}

function toggleSidebar() {
    document.getElementById('sidebar').classList.toggle('open');
}

// ==================== PAGE RENDERING ====================
const pageNames = {
    dashboard: 'Dashboard', analytics: 'Analytics', reports: 'Reports',
    leadgen: 'Lead Generator', b2b: 'B2B Datenbank', scoring: 'AI Lead Scoring',
    contacts: 'Kontakte', leads: 'Leads', pipeline: 'Pipeline', deals: 'Deals',
    inbox: 'Unified Inbox', campaigns: 'Kampagnen', templates: 'Vorlagen', scheduler: 'Meeting Scheduler',
    invoices: 'Rechnungen', quotes: 'Angebote', expenses: 'Ausgaben', banking: 'Banking',
    projects: 'Projekte', tasks: 'Aufgaben', calendar: 'Kalender', timetracking: 'Zeiterfassung',
    products: 'Produktkatalog', configurator: 'Smart Home Konfigurator',
    team: 'Team', activity: 'Aktivit√§ten', chat: 'Team Chat',
    integrations: 'Integrationen', automations: 'Automatisierungen', api: 'API Hub', 
    settings: 'Einstellungen', audit: 'Audit Log', profile: 'Mein Profil'
};

function showPage(pageId) {
    currentPage = pageId;
    localStorage.setItem('wmos_page', pageId);
    document.getElementById('currentPage').textContent = pageNames[pageId] || pageId;
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    const navItem = document.querySelector(`.nav-item[data-page="${pageId}"]`);
    if (navItem) navItem.classList.add('active');
    renderPage(pageId);
    updateAllCounts();
    // Close mobile sidebar
    document.getElementById('sidebar').classList.remove('open');
}

function updateAllCounts() {
    // Navigation counts
    const counts = {
        contacts: data.contacts.length,
        leads: data.leads.length,
        b2b: data.b2bDatabase.length,
        unread: data.conversations.filter(c => c.unread).length,
        tasks: data.tasks.filter(t => t.status !== 'completed').length
    };
    Object.entries(counts).forEach(([key, val]) => {
        const el = document.getElementById(`nav_${key}`);
        if (el) el.textContent = val;
    });
    // Topbar counts
    document.getElementById('taskCount').textContent = counts.tasks;
    document.getElementById('inboxCount').textContent = counts.unread;
}

function renderPage(pageId) {
    const content = document.getElementById('pageContent');
    const renderers = {
        dashboard: renderDashboard,
        analytics: renderAnalytics,
        reports: renderReports,
        leadgen: renderLeadGenerator,
        b2b: renderB2BDatabase,
        scoring: renderAIScoring,
        contacts: renderContacts,
        leads: renderLeads,
        pipeline: renderPipeline,
        deals: renderDeals,
        inbox: renderInbox,
        campaigns: renderCampaigns,
        templates: renderTemplates,
        scheduler: renderScheduler,
        invoices: renderInvoices,
        quotes: renderQuotes,
        expenses: renderExpenses,
        banking: renderBanking,
        projects: renderProjects,
        tasks: renderTasks,
        calendar: renderCalendar,
        timetracking: renderTimeTracking,
        products: renderProducts,
        configurator: renderConfigurator,
        team: renderTeam,
        activity: renderActivity,
        chat: renderChat,
        integrations: renderIntegrations,
        automations: renderAutomations,
        api: renderAPI,
        settings: renderSettings,
        audit: renderAudit,
        profile: renderProfile
    };
    content.innerHTML = (renderers[pageId] || renderNotFound)();
    // Post-render initialization
    if (pageId === 'dashboard') initDashboardCharts();
    if (pageId === 'analytics') initAnalyticsCharts();
    if (pageId === 'inbox') initInbox();
}

function renderNotFound() {
    return `<div class="page active"><div class="empty-state"><div class="empty-state-icon">üîç</div><h3>Seite nicht gefunden</h3><p>Diese Seite existiert nicht oder ist noch in Entwicklung.</p><button class="btn btn-primary" onclick="showPage('dashboard')">Zum Dashboard</button></div></div>`;
}

// ==================== DASHBOARD ====================
function renderDashboard() {
    const totalRevenue = data.invoices.filter(i => i.status === 'paid').reduce((s, i) => s + i.amount, 0);
    const pipelineValue = data.leads.reduce((s, l) => s + l.value, 0);
    const wonValue = data.leads.filter(l => l.status === 'won').reduce((s, l) => s + l.value, 0);
    const hotLeads = data.b2bDatabase.filter(l => l.status === 'hot').length;
    const openTasks = data.tasks.filter(t => t.status !== 'completed').length;
    const unreadMessages = data.conversations.filter(c => c.unread).length;
    const overdueInvoices = data.invoices.filter(i => i.status === 'overdue');

    return `<div class="page active">
        <div class="page-header">
            <div>
                <h1><span class="icon">üìä</span> Dashboard</h1>
                <p>Willkommen zur√ºck, ${currentUser.name}! Hier ist dein Business-√úberblick.</p>
            </div>
            <div class="page-actions">
                <button class="btn btn-secondary" onclick="exportDashboard()">üì• Export</button>
                <button class="btn btn-gradient" onclick="showPage('leadgen')">üîç Lead Generator</button>
            </div>
        </div>
        
        <!-- KPI Cards -->
        <div class="stats-grid">
            <div class="stat-card success">
                <div class="stat-top">
                    <div class="stat-icon emerald">üí∞</div>
                    <div class="stat-trend up">‚Üë 23.5%</div>
                </div>
                <div class="stat-value">${formatCurrency(totalRevenue)}</div>
                <div class="stat-label">Umsatz 2025</div>
                <div class="stat-progress">
                    <div class="stat-progress-label"><span>Ziel: ‚Ç¨1M</span><span>${Math.round(totalRevenue/10000)}%</span></div>
                    <div class="progress-bar"><div class="progress-bar-fill gradient" style="width:${Math.min(totalRevenue/10000, 100)}%"></div></div>
                </div>
            </div>
            <div class="stat-card info">
                <div class="stat-top">
                    <div class="stat-icon primary">üìà</div>
                    <div class="stat-trend up">‚Üë ${data.leads.length}</div>
                </div>
                <div class="stat-value">${formatCurrency(pipelineValue)}</div>
                <div class="stat-label">Pipeline-Wert</div>
            </div>
            <div class="stat-card highlight">
                <div class="stat-top">
                    <div class="stat-icon violet">üî•</div>
                    <div class="stat-trend neutral">${hotLeads} Hot</div>
                </div>
                <div class="stat-value">${data.b2bDatabase.length}</div>
                <div class="stat-label">B2B Leads</div>
            </div>
            <div class="stat-card ${overdueInvoices.length > 0 ? 'danger' : ''}">
                <div class="stat-top">
                    <div class="stat-icon ${overdueInvoices.length > 0 ? 'rose' : 'cyan'}">üìÑ</div>
                    ${overdueInvoices.length > 0 ? `<div class="stat-trend down">${overdueInvoices.length} √ºberf√§llig</div>` : '<div class="stat-trend up">Alles bezahlt</div>'}
                </div>
                <div class="stat-value">${data.invoices.length}</div>
                <div class="stat-label">Rechnungen</div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="card" style="margin-bottom:20px">
            <div class="card-body" style="padding:16px">
                <div style="display:flex;gap:12px;flex-wrap:wrap">
                    <button class="btn btn-primary" onclick="openModal('lead')">‚ûï Neuer Lead</button>
                    <button class="btn btn-secondary" onclick="openModal('contact')">üë§ Neuer Kontakt</button>
                    <button class="btn btn-secondary" onclick="openModal('task')">‚úÖ Neue Aufgabe</button>
                    <button class="btn btn-secondary" onclick="openModal('invoice')">üìÑ Neue Rechnung</button>
                    <button class="btn btn-secondary" onclick="openModal('quote')">üìã Neues Angebot</button>
                    <button class="btn btn-ghost" onclick="showPage('campaigns')">üìß Kampagne starten</button>
                </div>
            </div>
        </div>
        
        <!-- Main Grid -->
        <div class="grid-3">
            <!-- Revenue Chart -->
            <div class="card" style="grid-column:span 2">
                <div class="card-header">
                    <h3>üìà Umsatz & Pipeline</h3>
                    <div class="tabs" style="margin:0;background:transparent;padding:0">
                        <div class="tab active" style="padding:6px 12px">Monat</div>
                        <div class="tab" style="padding:6px 12px">Quartal</div>
                        <div class="tab" style="padding:6px 12px">Jahr</div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-container"><canvas id="revenueChart"></canvas></div>
                </div>
            </div>
            
            <!-- Tasks & Reminders -->
            <div class="card">
                <div class="card-header">
                    <h3>‚úÖ Aufgaben <span class="badge ${openTasks > 0 ? 'hot' : ''}">${openTasks}</span></h3>
                    <button class="btn btn-sm btn-ghost" onclick="showPage('tasks')">Alle ‚Üí</button>
                </div>
                <div class="card-body" style="padding:0;max-height:300px;overflow-y:auto">
                    ${data.tasks.filter(t => t.status !== 'completed').slice(0, 5).map(t => `
                        <div style="padding:12px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px">
                            <input type="checkbox" onclick="completeTask(${t.id})" style="width:18px;height:18px;accent-color:var(--primary)">
                            <div style="flex:1;min-width:0">
                                <div style="font-size:13px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${t.title}</div>
                                <div style="font-size:11px;color:var(--text-3)">${t.dueDate ? formatDate(t.dueDate) : 'Kein Datum'} ${t.priority === 'high' ? 'üî¥' : t.priority === 'medium' ? 'üü°' : 'üü¢'}</div>
                            </div>
                        </div>
                    `).join('') || '<div style="padding:40px;text-align:center;color:var(--text-3)">Keine offenen Aufgaben üéâ</div>'}
                </div>
            </div>
        </div>
        
        <div class="grid-2" style="margin-top:16px">
            <!-- Recent Activity -->
            <div class="card">
                <div class="card-header">
                    <h3>üìä Aktivit√§ten</h3>
                    <button class="btn btn-sm btn-ghost" onclick="showPage('activity')">Alle ‚Üí</button>
                </div>
                <div class="card-body" style="padding:0">
                    ${data.activities.slice(0, 6).map(a => `
                        <div style="padding:12px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px">
                            <div style="width:36px;height:36px;background:var(--primary-glow);border-radius:8px;display:flex;align-items:center;justify-content:center">${a.icon}</div>
                            <div style="flex:1">
                                <div style="font-size:13px">${a.text}</div>
                                <div style="font-size:11px;color:var(--text-3)">${a.time} ¬∑ ${a.user}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <!-- Hot Leads -->
            <div class="card">
                <div class="card-header">
                    <h3>üî• Hot B2B Leads</h3>
                    <button class="btn btn-sm btn-ghost" onclick="showPage('b2b')">Alle ‚Üí</button>
                </div>
                <div class="card-body" style="padding:0">
                    ${data.b2bDatabase.filter(l => l.status === 'hot').slice(0, 5).map(l => `
                        <div style="padding:12px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;cursor:pointer" onclick="showPage('b2b')">
                            <div style="width:36px;height:36px;background:rgba(16,185,129,0.15);border-radius:8px;display:flex;align-items:center;justify-content:center">üè¢</div>
                            <div style="flex:1">
                                <div style="font-size:13px;font-weight:500">${l.company}</div>
                                <div style="font-size:11px;color:var(--text-3)">${l.industry} ¬∑ ${l.city}</div>
                            </div>
                            <span class="status hot">${l.score}%</span>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
        
        <!-- Upcoming -->
        <div class="grid-2" style="margin-top:16px">
            <div class="card">
                <div class="card-header">
                    <h3>üìÖ Anstehende Termine</h3>
                    <button class="btn btn-sm btn-ghost" onclick="showPage('calendar')">Kalender ‚Üí</button>
                </div>
                <div class="card-body" style="padding:0">
                    ${data.calendar.slice(0, 3).map(e => `
                        <div style="padding:12px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px">
                            <div style="text-align:center;min-width:45px">
                                <div style="font-size:20px;font-weight:700;color:var(--primary)">${new Date(e.start).getDate()}</div>
                                <div style="font-size:10px;color:var(--text-3)">${new Date(e.start).toLocaleDateString('de-DE', {month: 'short'})}</div>
                            </div>
                            <div style="flex:1">
                                <div style="font-size:13px;font-weight:500">${e.title}</div>
                                <div style="font-size:11px;color:var(--text-3)">${formatTime(e.start)} - ${formatTime(e.end)}</div>
                            </div>
                            <span class="tag ${e.type === 'meeting' ? 'primary' : ''}">${e.type === 'meeting' ? 'üìÖ Meeting' : 'üìã Aufgabe'}</span>
                        </div>
                    `).join('') || '<div style="padding:40px;text-align:center;color:var(--text-3)">Keine Termine</div>'}
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3>üí¨ Neue Nachrichten <span class="badge hot">${unreadMessages}</span></h3>
                    <button class="btn btn-sm btn-ghost" onclick="showPage('inbox')">Inbox ‚Üí</button>
                </div>
                <div class="card-body" style="padding:0">
                    ${data.conversations.filter(c => c.unread).slice(0, 3).map(c => `
                        <div style="padding:12px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;cursor:pointer" onclick="showPage('inbox')">
                            <div style="width:36px;height:36px;background:${c.type === 'whatsapp' ? 'rgba(37,211,102,0.15)' : 'rgba(234,67,53,0.15)'};border-radius:50%;display:flex;align-items:center;justify-content:center">${c.type === 'whatsapp' ? 'üí¨' : 'üìß'}</div>
                            <div style="flex:1;min-width:0">
                                <div style="font-size:13px;font-weight:600">${c.contact}</div>
                                <div style="font-size:12px;color:var(--text-3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${c.messages[c.messages.length-1].text}</div>
                            </div>
                            <div style="width:8px;height:8px;background:var(--primary);border-radius:50%"></div>
                        </div>
                    `).join('') || '<div style="padding:40px;text-align:center;color:var(--text-3)">Keine neuen Nachrichten</div>'}
                </div>
            </div>
        </div>
    </div>`;
}

function initDashboardCharts() {
    const ctx = document.getElementById('revenueChart');
    if (!ctx) return;
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'M√§r', 'Apr', 'Mai', 'Jun', 'Jul', 'Aug', 'Sep', 'Okt', 'Nov', 'Dez'],
            datasets: [{
                label: 'Umsatz',
                data: [45000, 62000, 58000, 71000, 68000, 85000, 92000, 78000, 95000, 110000, 125000, 135000],
                borderColor: '#6366f1',
                backgroundColor: 'rgba(99, 102, 241, 0.1)',
                fill: true,
                tension: 0.4
            }, {
                label: 'Pipeline',
                data: [120000, 150000, 180000, 200000, 220000, 250000, 280000, 300000, 350000, 400000, 450000, 500000],
                borderColor: '#8b5cf6',
                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'bottom', labels: { color: '#a1a1aa' } } },
            scales: {
                x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#71717a' } },
                y: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#71717a', callback: v => '‚Ç¨' + (v/1000) + 'K' } }
            }
        }
    });
}

// ==================== ANALYTICS ====================
function renderAnalytics() {
    return `<div class="page active">
        <div class="page-header">
            <div>
                <h1><span class="icon">üìà</span> Analytics</h1>
                <p>Detaillierte Auswertungen und KPIs</p>
            </div>
            <div class="page-actions">
                <select class="form-control" style="width:auto">
                    <option>Letzte 30 Tage</option>
                    <option>Dieses Quartal</option>
                    <option>Dieses Jahr</option>
                </select>
                <button class="btn btn-secondary">üì• Export</button>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-value">‚Ç¨847K</div><div class="stat-label">Gesamtumsatz</div><div class="stat-trend up">‚Üë 23.5% vs. Vorjahr</div></div>
            <div class="stat-card"><div class="stat-value">29%</div><div class="stat-label">Conversion Rate</div><div class="stat-trend up">‚Üë 5.2%</div></div>
            <div class="stat-card"><div class="stat-value">‚Ç¨68K</div><div class="stat-label">√ò Deal-Gr√∂√üe</div><div class="stat-trend up">‚Üë 12%</div></div>
            <div class="stat-card"><div class="stat-value">18 Tage</div><div class="stat-label">√ò Sales Cycle</div><div class="stat-trend down">‚Üì 3 Tage</div></div>
        </div>
        
        <div class="grid-2">
            <div class="card">
                <div class="card-header"><h3>üìä Lead Sources</h3></div>
                <div class="card-body"><div class="chart-container"><canvas id="sourceChart"></canvas></div></div>
            </div>
            <div class="card">
                <div class="card-header"><h3>üéØ Pipeline Stages</h3></div>
                <div class="card-body"><div class="chart-container"><canvas id="pipelineChart"></canvas></div></div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header"><h3>üìà Forecast</h3></div>
            <div class="card-body">
                <div class="chart-container"><canvas id="forecastChart"></canvas></div>
            </div>
        </div>
    </div>`;
}

function initAnalyticsCharts() {
    // Source Chart
    const sourceCtx = document.getElementById('sourceChart');
    if (sourceCtx) {
        new Chart(sourceCtx, {
            type: 'doughnut',
            data: {
                labels: ['Website', 'Lead Generator', 'Empfehlung', 'LinkedIn', 'Ads'],
                datasets: [{ data: [35, 28, 20, 10, 7], backgroundColor: ['#6366f1', '#8b5cf6', '#10b981', '#06b6d4', '#f59e0b'] }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { color: '#a1a1aa' } } } }
        });
    }
    
    // Pipeline Chart
    const pipelineCtx = document.getElementById('pipelineChart');
    if (pipelineCtx) {
        new Chart(pipelineCtx, {
            type: 'bar',
            data: {
                labels: ['Neu', 'Qualifiziert', 'Angebot', 'Gewonnen'],
                datasets: [{ label: 'Leads', data: [12, 8, 5, 3], backgroundColor: ['#f59e0b', '#06b6d4', '#8b5cf6', '#10b981'] }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { display: false } }, y: { grid: { color: 'rgba(255,255,255,0.05)' } } } }
        });
    }
}

// ==================== PLACEHOLDER PAGES ====================
function renderReports() { return renderComingSoon('Reports', 'üìë', 'Custom Reports und Dashboards'); }
function renderAIScoring() { return renderComingSoon('AI Lead Scoring', 'ü§ñ', 'KI-basierte Lead-Bewertung'); }
function renderDeals() { return renderComingSoon('Deals', 'ü§ù', 'Deal Management'); }
function renderScheduler() { return renderComingSoon('Meeting Scheduler', 'üìÖ', 'Automatische Terminbuchung'); }
function renderBanking() { return renderComingSoon('Banking', 'üè¶', 'Bankanbindung & Konto√ºbersicht'); }
function renderCalendar() { return renderComingSoon('Kalender', 'üìÖ', 'Termine & Events'); }
function renderTimeTracking() { return renderComingSoon('Zeiterfassung', '‚è±Ô∏è', 'Projektzeiten tracken'); }
function renderConfigurator() { return renderComingSoon('Smart Home Konfigurator', 'üõ†Ô∏è', 'LOXONE Konfiguration'); }
function renderChat() { return renderComingSoon('Team Chat', 'üí¨', 'Interner Messenger'); }
function renderAPI() { return renderComingSoon('API Hub', 'üîó', 'API Dokumentation & Keys'); }

function renderComingSoon(title, icon, desc) {
    return `<div class="page active">
        <div class="empty-state" style="padding:100px 20px">
            <div class="empty-state-icon">${icon}</div>
            <h3>${title}</h3>
            <p>${desc}</p>
            <p style="color:var(--primary);margin-top:8px">üöÄ Coming Soon in v4.1</p>
            <button class="btn btn-secondary" style="margin-top:20px" onclick="showPage('dashboard')">‚Üê Zum Dashboard</button>
        </div>
    </div>`;
}

// Continued in Part 2...

// ==================== LEAD GENERATOR ====================
function renderLeadGenerator() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üîç</span> Lead Generator</h1><p>B2B Leads aus √∂ffentlichen Datenbanken</p></div><div class="page-actions"><button class="btn btn-gradient" onclick="showToast('info','Suche','Datenbanken werden durchsucht...')">üîç Neue Suche</button></div></div>
        <div class="stats-grid">
            <div class="stat-card highlight"><div class="stat-value">${data.b2bDatabase.filter(l=>l.status==='hot').length}</div><div class="stat-label">Hot üî•</div></div>
            <div class="stat-card"><div class="stat-value">${data.b2bDatabase.filter(l=>l.status==='warm').length}</div><div class="stat-label">Warm ‚òÄÔ∏è</div></div>
            <div class="stat-card"><div class="stat-value">${data.b2bDatabase.filter(l=>l.status==='cold').length}</div><div class="stat-label">Cold ‚ùÑÔ∏è</div></div>
            <div class="stat-card"><div class="stat-value">${data.b2bDatabase.length}</div><div class="stat-label">Gesamt</div></div>
        </div>
        <div class="card"><div class="card-header"><h3>üìã B2B Leads</h3></div><div class="card-body no-padding"><div class="table-wrapper"><table class="data-table"><thead><tr><th>Firma</th><th>Branche</th><th>Stadt</th><th>Score</th><th>Aktionen</th></tr></thead><tbody>${data.b2bDatabase.map(l=>`<tr><td><strong>${l.company}</strong><br><span style="font-size:11px;color:var(--text-3)">${l.decisionMaker}</span></td><td>${l.industry}</td><td>${l.city}</td><td><span class="status ${l.status}">${l.score}%</span></td><td><button class="btn btn-sm btn-primary" onclick="convertB2BToLead(${l.id})">‚ûï</button></td></tr>`).join('')}</tbody></table></div></div></div>
    </div>`;
}

function renderB2BDatabase() { return renderLeadGenerator(); }

function convertB2BToLead(id) {
    const l = data.b2bDatabase.find(x => x.id === id);
    if (!l) return;
    data.leads.unshift({id: Date.now(), name: 'B2B - ' + l.company, company: l.company, value: 25000, status: 'new', source: 'Lead Generator', probability: 40, assignee: currentUser.name});
    data.contacts.unshift({id: Date.now(), firstName: l.decisionMaker.split(' ')[0], lastName: l.decisionMaker.split(' ').slice(1).join(' '), email: l.email, phone: l.phone, company: l.company, status: 'active'});
    saveData(); updateAllCounts();
    showToast('success', 'Lead erstellt', l.company);
}

function renderContacts() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üë•</span> Kontakte</h1><p>${data.contacts.length} Kontakte</p></div><div class="page-actions"><button class="btn btn-primary" onclick="openModal('contact')">+ Neu</button></div></div>
        <div class="card"><div class="card-body no-padding"><div class="table-wrapper"><table class="data-table"><thead><tr><th>Name</th><th>E-Mail</th><th>Telefon</th><th>Firma</th><th>Status</th><th></th></tr></thead><tbody>${data.contacts.map(c=>`<tr><td><strong>${c.firstName} ${c.lastName}</strong></td><td>${c.email}</td><td>${c.phone||'-'}</td><td>${c.company||'-'}</td><td><span class="status ${c.status}">${c.status}</span></td><td><button class="btn btn-sm btn-danger" onclick="deleteContact(${c.id})">üóëÔ∏è</button></td></tr>`).join('')}</tbody></table></div></div></div>
    </div>`;
}

function renderLeads() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üéØ</span> Leads</h1><p>${data.leads.length} Leads ¬∑ ${formatCurrency(data.leads.reduce((s,l)=>s+l.value,0))} Pipeline</p></div><div class="page-actions"><button class="btn btn-primary" onclick="openModal('lead')">+ Neu</button></div></div>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-value">${data.leads.filter(l=>l.status==='new').length}</div><div class="stat-label">Neu</div></div>
            <div class="stat-card"><div class="stat-value">${data.leads.filter(l=>l.status==='qualified').length}</div><div class="stat-label">Qualifiziert</div></div>
            <div class="stat-card"><div class="stat-value">${data.leads.filter(l=>l.status==='proposal').length}</div><div class="stat-label">Angebot</div></div>
            <div class="stat-card highlight"><div class="stat-value">${data.leads.filter(l=>l.status==='won').length}</div><div class="stat-label">Gewonnen</div></div>
        </div>
        <div class="card"><div class="card-body no-padding"><div class="table-wrapper"><table class="data-table"><thead><tr><th>Lead</th><th>Firma</th><th>Wert</th><th>Status</th><th>Quelle</th><th></th></tr></thead><tbody>${data.leads.map(l=>`<tr><td><strong>${l.name}</strong></td><td>${l.company}</td><td><strong style="color:var(--emerald)">${formatCurrency(l.value)}</strong></td><td><span class="status ${l.status}">${statusLabel(l.status)}</span></td><td>${l.source}</td><td><button class="btn btn-sm btn-danger" onclick="deleteLead('${l.id}')">üóëÔ∏è</button></td></tr>`).join('')}</tbody></table></div></div></div>
    </div>`;
}

function renderPipeline() {
    const stages = [{id:'new',name:'üÜï Neu'},{id:'qualified',name:'‚úì Qualifiziert'},{id:'proposal',name:'üìã Angebot'},{id:'won',name:'üéâ Gewonnen'}];
    stages.forEach(s => s.items = data.leads.filter(l => l.status === s.id));
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üìà</span> Pipeline</h1><p>${formatCurrency(data.leads.reduce((s,l)=>s+l.value,0))} Gesamtwert</p></div></div>
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:16px">${stages.map(s=>`<div class="card"><div class="card-header"><h3 style="font-size:13px">${s.name}</h3><span>${formatCurrency(s.items.reduce((a,l)=>a+l.value,0))}</span></div><div class="card-body" style="min-height:200px">${s.items.map(l=>`<div style="background:var(--bg-3);border-radius:8px;padding:12px;margin-bottom:8px"><div style="font-weight:500">${l.company}</div><div style="font-size:12px;color:var(--text-3)">${l.name}</div><div style="color:var(--emerald);font-weight:700;margin-top:8px">${formatCurrency(l.value)}</div></div>`).join('')||'<div style="text-align:center;color:var(--text-3);padding:20px">Keine Leads</div>'}</div></div>`).join('')}</div>
    </div>`;
}

function renderInbox() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üì•</span> Inbox</h1><p>${data.conversations.length} Konversationen</p></div><div class="page-actions"><button class="btn btn-primary" onclick="openModal('message')">‚úâÔ∏è Neu</button></div></div>
        <div style="display:grid;grid-template-columns:350px 1fr;gap:20px;height:500px">
            <div class="card" style="overflow:hidden"><div class="card-body no-padding" style="height:100%;overflow-y:auto" id="inboxList"></div></div>
            <div class="card" id="inboxMain"><div class="empty-state"><div class="empty-state-icon">üì•</div><h3>Konversation ausw√§hlen</h3></div></div>
        </div>
    </div>`;
}

function initInbox() {
    const list = document.getElementById('inboxList');
    if (!list) return;
    list.innerHTML = data.conversations.map(c=>`<div style="padding:14px 16px;border-bottom:1px solid var(--border);cursor:pointer;display:flex;gap:12px;background:${c.unread?'var(--bg-3)':''}" onclick="selectConversation(${c.id})"><div style="width:40px;height:40px;border-radius:50%;background:${c.type==='whatsapp'?'rgba(37,211,102,0.15)':'rgba(234,67,53,0.15)'};display:flex;align-items:center;justify-content:center">${c.type==='whatsapp'?'üí¨':'üìß'}</div><div style="flex:1;min-width:0"><div style="display:flex;justify-content:space-between"><span style="font-weight:${c.unread?'600':'400'}">${c.contact}</span><span style="font-size:11px;color:var(--text-3)">${c.messages[c.messages.length-1].time}</span></div><div style="font-size:12px;color:var(--text-2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${c.messages[c.messages.length-1].text}</div></div>${c.unread?'<div style="width:8px;height:8px;background:var(--primary);border-radius:50%"></div>':''}</div>`).join('');
}

function selectConversation(id) {
    const c = data.conversations.find(x=>x.id===id);
    if (!c) return;
    c.unread = false; saveData(); updateAllCounts(); initInbox();
    document.getElementById('inboxMain').innerHTML = `<div style="padding:16px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between"><div style="display:flex;align-items:center;gap:12px"><div style="width:44px;height:44px;border-radius:50%;background:${c.type==='whatsapp'?'rgba(37,211,102,0.15)':'rgba(234,67,53,0.15)'};display:flex;align-items:center;justify-content:center">${c.type==='whatsapp'?'üí¨':'üìß'}</div><div><div style="font-weight:600">${c.contact}</div><div style="font-size:12px;color:var(--text-3)">${c.phone||c.email||''}</div></div></div></div><div style="flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:12px">${c.messages.map(m=>`<div style="max-width:70%;padding:12px 16px;border-radius:16px;${m.outgoing?'background:var(--primary);color:white;align-self:flex-end':'background:var(--bg-3);align-self:flex-start'}"><div>${m.text}</div><div style="font-size:10px;${m.outgoing?'color:rgba(255,255,255,0.7)':'color:var(--text-3)'};margin-top:4px;text-align:right">${m.time}</div></div>`).join('')}</div><div style="padding:16px;border-top:1px solid var(--border);display:flex;gap:12px"><textarea id="replyText" class="form-control" style="flex:1;min-height:44px;max-height:100px;resize:none" placeholder="Nachricht..." onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendReply(${id})}"></textarea><button class="btn btn-primary" onclick="sendReply(${id})">üì§</button></div>`;
}

function sendReply(id) {
    const text = document.getElementById('replyText').value.trim();
    if (!text) return;
    const c = data.conversations.find(x=>x.id===id);
    if (!c) return;
    c.messages.push({id: Date.now(), text, time: new Date().toLocaleTimeString('de-DE',{hour:'2-digit',minute:'2-digit'}), outgoing: true});
    saveData(); selectConversation(id);
    showToast('success', 'Gesendet', c.contact);
}

function renderCampaigns() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üìß</span> Kampagnen</h1><p>${data.campaigns.length} Kampagnen</p></div><div class="page-actions"><button class="btn btn-primary" onclick="openModal('campaign')">+ Neu</button></div></div>
        <div class="card"><div class="card-body no-padding"><div class="table-wrapper"><table class="data-table"><thead><tr><th>Name</th><th>Typ</th><th>Status</th><th>Gesendet</th><th>Ge√∂ffnet</th><th>Antworten</th></tr></thead><tbody>${data.campaigns.map(c=>`<tr><td><strong>${c.name}</strong></td><td>${c.type==='email'?'üìß':'üí¨'}</td><td><span class="status ${c.status}">${c.status}</span></td><td>${c.sent}/${c.total}</td><td>${c.opened}</td><td>${c.replied}</td></tr>`).join('')}</tbody></table></div></div></div>
    </div>`;
}

function renderTemplates() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üìù</span> Vorlagen</h1><p>${data.templates.length} Vorlagen</p></div></div>
        <div class="grid-3">${data.templates.map(t=>`<div class="card"><div class="card-header"><h3 style="font-size:14px">${t.type==='email'?'üìß':'üí¨'} ${t.name}</h3></div><div class="card-body"><div style="font-size:12px;color:var(--text-2);max-height:100px;overflow:hidden">${t.body.substring(0,150)}...</div></div></div>`).join('')}</div>
    </div>`;
}

function renderInvoices() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üìÑ</span> Rechnungen</h1><p>${data.invoices.length} Rechnungen</p></div><div class="page-actions"><button class="btn btn-primary" onclick="openModal('invoice')">+ Neu</button></div></div>
        <div class="stats-grid">
            <div class="stat-card success"><div class="stat-value">${formatCurrency(data.invoices.filter(i=>i.status==='paid').reduce((s,i)=>s+i.amount,0))}</div><div class="stat-label">Bezahlt</div></div>
            <div class="stat-card warning"><div class="stat-value">${formatCurrency(data.invoices.filter(i=>i.status==='pending').reduce((s,i)=>s+i.amount,0))}</div><div class="stat-label">Offen</div></div>
            <div class="stat-card danger"><div class="stat-value">${formatCurrency(data.invoices.filter(i=>i.status==='overdue').reduce((s,i)=>s+i.amount,0))}</div><div class="stat-label">√úberf√§llig</div></div>
        </div>
        <div class="card"><div class="card-body no-padding"><div class="table-wrapper"><table class="data-table"><thead><tr><th>Nr.</th><th>Kunde</th><th>Betrag</th><th>Status</th><th>Datum</th><th></th></tr></thead><tbody>${data.invoices.map(i=>`<tr><td><strong>${i.id}</strong></td><td>${i.customer}</td><td><strong>${formatCurrency(i.amount)}</strong></td><td><span class="status ${i.status}">${statusLabel(i.status)}</span></td><td>${formatDate(i.date)}</td><td>${i.status!=='paid'?`<button class="btn btn-sm btn-success" onclick="markAsPaid('${i.id}')">‚úÖ</button>`:''}</td></tr>`).join('')}</tbody></table></div></div></div>
    </div>`;
}

function markAsPaid(id) {
    const inv = data.invoices.find(i=>i.id===id);
    if (inv) { inv.status = 'paid'; saveData(); showPage('invoices'); showToast('success','Bezahlt',id); }
}

function renderQuotes() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üìã</span> Angebote</h1><p>${data.quotes.length} Angebote</p></div></div>
        <div class="card"><div class="card-body no-padding"><div class="table-wrapper"><table class="data-table"><thead><tr><th>Nr.</th><th>Kunde</th><th>Betrag</th><th>Status</th><th>G√ºltig bis</th></tr></thead><tbody>${data.quotes.map(q=>`<tr><td><strong>${q.id}</strong></td><td>${q.customer}</td><td><strong>${formatCurrency(q.amount)}</strong></td><td><span class="status ${q.status}">${statusLabel(q.status)}</span></td><td>${formatDate(q.validUntil)}</td></tr>`).join('')}</tbody></table></div></div></div>
    </div>`;
}

function renderExpenses() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üí≥</span> Ausgaben</h1><p>${formatCurrency(data.expenses.reduce((s,e)=>s+e.amount,0))} gesamt</p></div></div>
        <div class="card"><div class="card-body no-padding"><div class="table-wrapper"><table class="data-table"><thead><tr><th>Beschreibung</th><th>Kategorie</th><th>Betrag</th><th>Datum</th></tr></thead><tbody>${data.expenses.map(e=>`<tr><td><strong>${e.description}</strong></td><td>${e.category}</td><td style="color:var(--rose)"><strong>${formatCurrency(e.amount)}</strong></td><td>${formatDate(e.date)}</td></tr>`).join('')}</tbody></table></div></div></div>
    </div>`;
}

function renderProjects() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üìÅ</span> Projekte</h1><p>${data.projects.length} Projekte</p></div></div>
        <div class="grid-3">${data.projects.map(p=>`<div class="card"><div class="card-header"><h3 style="font-size:14px">${p.name}</h3><span class="status ${p.status}">${statusLabel(p.status)}</span></div><div class="card-body"><div style="font-size:12px;color:var(--text-3);margin-bottom:12px">${p.customer}</div><div style="margin-bottom:8px"><div style="display:flex;justify-content:space-between;font-size:11px;margin-bottom:4px"><span>Fortschritt</span><span>${p.progress}%</span></div><div class="progress-bar"><div class="progress-bar-fill gradient" style="width:${p.progress}%"></div></div></div><div style="font-size:12px"><span style="color:var(--text-3)">Budget:</span> ${formatCurrency(p.budget)}</div></div></div>`).join('')}</div>
    </div>`;
}

function renderTasks() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">‚úÖ</span> Aufgaben</h1><p>${data.tasks.length} Aufgaben</p></div><div class="page-actions"><button class="btn btn-primary" onclick="openModal('task')">+ Neu</button></div></div>
        <div class="card"><div class="card-body no-padding">${data.tasks.map(t=>`<div style="padding:14px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;${t.status==='completed'?'opacity:0.5':''}"><input type="checkbox" ${t.status==='completed'?'checked':''} onchange="toggleTask(${t.id})" style="width:18px;height:18px"><div style="flex:1"><div style="font-weight:500;${t.status==='completed'?'text-decoration:line-through':''}">${t.title}</div><div style="font-size:12px;color:var(--text-3)">${t.dueDate?formatDate(t.dueDate):''} ${t.priority==='high'?'üî¥':t.priority==='medium'?'üü°':'üü¢'}</div></div><button class="btn btn-sm btn-danger" onclick="deleteTask(${t.id})">üóëÔ∏è</button></div>`).join('')}</div></div>
    </div>`;
}

function toggleTask(id) {
    const t = data.tasks.find(x=>x.id===id);
    if (t) { t.status = t.status==='completed'?'pending':'completed'; saveData(); showPage('tasks'); updateAllCounts(); }
}

function deleteTask(id) {
    if (!confirm('L√∂schen?')) return;
    data.tasks = data.tasks.filter(t=>t.id!==id);
    saveData(); showPage('tasks'); updateAllCounts();
}

function renderProducts() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üì¶</span> Produktkatalog</h1><p>${data.products.length} Produkte</p></div></div>
        <div class="grid-3">${data.products.map(p=>`<div class="card"><div class="card-body"><div style="display:flex;gap:16px"><div style="width:64px;height:64px;background:var(--bg-3);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:32px">${p.image}</div><div><div style="font-weight:600">${p.name}</div><div style="font-size:12px;color:var(--text-3)">${p.sku}</div><div class="tag" style="margin-top:8px">${p.category}</div></div></div><div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:16px;text-align:center"><div><div style="font-weight:700;color:var(--emerald)">${formatCurrency(p.price)}</div><div style="font-size:10px;color:var(--text-3)">VK</div></div><div><div style="font-weight:700">${formatCurrency(p.cost)}</div><div style="font-size:10px;color:var(--text-3)">EK</div></div><div><div style="font-weight:700;color:${p.stock<10?'var(--rose)':'var(--text-0)'}">${p.stock}</div><div style="font-size:10px;color:var(--text-3)">Lager</div></div></div></div></div>`).join('')}</div>
    </div>`;
}

function renderTeam() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üë•</span> Team</h1><p>${data.team.length} Mitglieder</p></div></div>
        <div class="grid-3">${data.team.map(m=>`<div class="card"><div class="card-body" style="text-align:center"><div class="avatar xl" style="background:linear-gradient(135deg,var(--primary),var(--violet));margin:0 auto 16px">${m.avatar}</div><div style="font-size:18px;font-weight:600">${m.name}</div><div style="color:var(--text-3);margin-bottom:8px">${m.position}</div><span class="status ${m.status==='online'?'active':'inactive'}">${m.status==='online'?'üü¢ Online':'‚ö´ Offline'}</span></div></div>`).join('')}</div>
    </div>`;
}

function renderActivity() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üìä</span> Aktivit√§ten</h1></div></div>
        <div class="card"><div class="card-body no-padding">${data.activities.map(a=>`<div style="padding:14px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px"><div style="width:40px;height:40px;background:var(--primary-glow);border-radius:10px;display:flex;align-items:center;justify-content:center">${a.icon}</div><div style="flex:1"><div>${a.text}</div><div style="font-size:12px;color:var(--text-3)">${a.time} ¬∑ ${a.user}</div></div></div>`).join('')}</div></div>
    </div>`;
}

function renderIntegrations() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üîå</span> Integrationen</h1><p>${data.integrations.filter(i=>i.status==='connected').length}/${data.integrations.length} verbunden</p></div></div>
        <div class="grid-3">${data.integrations.map(i=>`<div class="card" style="${i.status==='connected'?'border-color:var(--emerald)':''}"><div class="card-body"><div style="display:flex;align-items:center;gap:12px;margin-bottom:12px"><div style="width:48px;height:48px;background:var(--bg-3);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px">${i.icon}</div><div><div style="font-weight:600">${i.name}</div><div style="font-size:12px;color:var(--text-3)">${i.category}</div></div><span class="status ${i.status==='connected'?'active':'pending'}">${i.status==='connected'?'‚úì':'‚óã'}</span></div>${i.lastSync?`<div style="font-size:11px;color:var(--text-3)">Sync: ${i.lastSync}</div>`:''}</div><div class="card-footer"><button class="btn btn-sm ${i.status==='connected'?'btn-secondary':'btn-primary'}" style="width:100%">${i.status==='connected'?'‚öôÔ∏è Config':'üîå Connect'}</button></div></div>`).join('')}</div>
    </div>`;
}

function renderAutomations() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">‚ö°</span> Automatisierungen</h1><p>${data.sequences.length} Sequenzen</p></div><div class="page-actions"><button class="btn btn-primary" onclick="openModal('sequence')">+ Neu</button></div></div>
        <div class="grid-3">${data.sequences.map(s=>`<div class="card"><div class="card-header"><h3 style="font-size:14px">‚ö° ${s.name}</h3><span class="status ${s.active?'active':'inactive'}">${s.active?'üü¢':'‚è∏Ô∏è'}</span></div><div class="card-body"><div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;text-align:center;margin-bottom:12px"><div style="background:var(--bg-3);padding:12px;border-radius:8px"><div style="font-size:20px;font-weight:700">${s.steps}</div><div style="font-size:11px;color:var(--text-3)">Schritte</div></div><div style="background:var(--bg-3);padding:12px;border-radius:8px"><div style="font-size:20px;font-weight:700">${s.enrolled}</div><div style="font-size:11px;color:var(--text-3)">Enrolled</div></div></div></div><div class="card-footer"><button class="btn btn-sm ${s.active?'btn-warning':'btn-success'}" style="width:100%" onclick="toggleSequence(${s.id})">${s.active?'‚è∏Ô∏è Pause':'‚ñ∂Ô∏è Start'}</button></div></div>`).join('')}</div>
    </div>`;
}

function toggleSequence(id) {
    const s = data.sequences.find(x=>x.id===id);
    if (s) { s.active = !s.active; saveData(); showPage('automations'); showToast('info', s.active?'Aktiviert':'Pausiert', s.name); }
}

function renderSettings() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">‚öôÔ∏è</span> Einstellungen</h1></div><div class="page-actions"><button class="btn btn-primary" onclick="showToast('success','Gespeichert','OK')">üíæ Speichern</button></div></div>
        <div class="grid-2">
            <div class="card"><div class="card-header"><h3>üè¢ Unternehmen</h3></div><div class="card-body"><div class="form-group"><label>Firma</label><input type="text" class="form-control" value="${data.settings.company.name}"></div><div class="form-group"><label>IBAN</label><input type="text" class="form-control" value="${data.settings.company.iban}"></div></div></div>
            <div class="card"><div class="card-header"><h3>üé® Theme</h3></div><div class="card-body"><div style="display:flex;gap:12px"><button class="btn ${currentTheme==='dark'?'btn-primary':'btn-secondary'}" onclick="setTheme('dark')">üåô Dark</button><button class="btn ${currentTheme==='light'?'btn-primary':'btn-secondary'}" onclick="setTheme('light')">‚òÄÔ∏è Light</button></div></div></div>
        </div>
        <div class="card" style="margin-top:16px"><div class="card-header"><h3>‚ö†Ô∏è Gefahrenzone</h3></div><div class="card-body"><button class="btn btn-danger" onclick="if(confirm('Alles l√∂schen?')){localStorage.clear();location.reload()}">üóëÔ∏è Daten l√∂schen</button></div></div>
    </div>`;
}

function renderAudit() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üìã</span> Audit Log</h1></div></div>
        <div class="card"><div class="card-body no-padding"><div class="table-wrapper"><table class="data-table"><thead><tr><th>Zeit</th><th>Aktion</th><th>User</th><th>Details</th></tr></thead><tbody>${data.auditLog.map(l=>`<tr><td style="font-size:12px">${formatDateTime(l.timestamp)}</td><td><span class="tag">${l.action}</span></td><td>${l.user}</td><td style="font-size:12px;color:var(--text-3)">${l.details}</td></tr>`).join('')}</tbody></table></div></div></div>
    </div>`;
}

function renderProfile() {
    return `<div class="page active">
        <div class="page-header"><div><h1><span class="icon">üë§</span> Profil</h1></div></div>
        <div class="card" style="max-width:400px"><div class="card-body" style="text-align:center"><div class="avatar xl" style="background:linear-gradient(135deg,var(--primary),var(--violet));margin:0 auto 20px">${getInitials(currentUser.name)}</div><div style="font-size:24px;font-weight:700">${currentUser.name}</div><div style="color:var(--text-3)">${currentUser.email}</div><div style="margin-top:12px"><span class="tag primary">${currentUser.role==='admin'?'üëë Admin':'üë§ User'}</span></div></div></div>
    </div>`;
}

// ==================== MODALS ====================
function openModal(type) {
    const overlay = document.getElementById('modalOverlay');
    const modals = {
        contact: `<div class="modal active"><div class="modal-header"><h2>üë§ Neuer Kontakt</h2><button class="modal-close" onclick="closeModal()">√ó</button></div><div class="modal-body"><div class="form-row"><div class="form-group"><label>Vorname *</label><input type="text" class="form-control" id="cFirst"></div><div class="form-group"><label>Nachname *</label><input type="text" class="form-control" id="cLast"></div></div><div class="form-group"><label>E-Mail *</label><input type="email" class="form-control" id="cEmail"></div><div class="form-group"><label>Telefon</label><input type="tel" class="form-control" id="cPhone"></div><div class="form-group"><label>Firma</label><input type="text" class="form-control" id="cCompany"></div></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button><button class="btn btn-primary" onclick="saveContact()">Speichern</button></div></div>`,
        lead: `<div class="modal active"><div class="modal-header"><h2>üéØ Neuer Lead</h2><button class="modal-close" onclick="closeModal()">√ó</button></div><div class="modal-body"><div class="form-group"><label>Name *</label><input type="text" class="form-control" id="lName"></div><div class="form-group"><label>Firma</label><input type="text" class="form-control" id="lCompany"></div><div class="form-group"><label>Wert (‚Ç¨)</label><input type="number" class="form-control" id="lValue" value="25000"></div><div class="form-group"><label>Quelle</label><select class="form-control" id="lSource"><option>Lead Generator</option><option>Website</option><option>Empfehlung</option></select></div></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button><button class="btn btn-primary" onclick="saveLead()">Speichern</button></div></div>`,
        task: `<div class="modal active"><div class="modal-header"><h2>‚úÖ Neue Aufgabe</h2><button class="modal-close" onclick="closeModal()">√ó</button></div><div class="modal-body"><div class="form-group"><label>Titel *</label><input type="text" class="form-control" id="tTitle"></div><div class="form-group"><label>F√§llig am</label><input type="date" class="form-control" id="tDue"></div><div class="form-group"><label>Priorit√§t</label><select class="form-control" id="tPriority"><option value="high">üî¥ Hoch</option><option value="medium" selected>üü° Mittel</option><option value="low">üü¢ Niedrig</option></select></div></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button><button class="btn btn-primary" onclick="saveTask()">Speichern</button></div></div>`,
        invoice: `<div class="modal active"><div class="modal-header"><h2>üìÑ Neue Rechnung</h2><button class="modal-close" onclick="closeModal()">√ó</button></div><div class="modal-body"><div class="form-group"><label>Kunde *</label><input type="text" class="form-control" id="iCustomer"></div><div class="form-group"><label>Betrag (‚Ç¨) *</label><input type="number" class="form-control" id="iAmount"></div></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button><button class="btn btn-primary" onclick="saveInvoice()">Erstellen</button></div></div>`,
        message: `<div class="modal active"><div class="modal-header"><h2>‚úâÔ∏è Nachricht</h2><button class="modal-close" onclick="closeModal()">√ó</button></div><div class="modal-body"><div class="form-group"><label>Kanal</label><select class="form-control" id="msgChannel"><option value="whatsapp">üí¨ WhatsApp</option><option value="email">üìß E-Mail</option></select></div><div class="form-group"><label>Empf√§nger</label><input type="text" class="form-control" id="msgTo"></div><div class="form-group"><label>Nachricht</label><textarea class="form-control" id="msgText" rows="4"></textarea></div></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button><button class="btn btn-primary" onclick="sendNewMessage()">üì§ Senden</button></div></div>`,
        campaign: `<div class="modal active lg"><div class="modal-header"><h2>üìß Kampagne</h2><button class="modal-close" onclick="closeModal()">√ó</button></div><div class="modal-body"><div class="form-group"><label>Name</label><input type="text" class="form-control" id="campName"></div><div class="form-group"><label>Nachricht</label><textarea class="form-control" id="campMessage" rows="5"></textarea></div></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button><button class="btn btn-gradient" onclick="startCampaign()">üöÄ Starten</button></div></div>`,
        sequence: `<div class="modal active"><div class="modal-header"><h2>‚ö° Sequenz</h2><button class="modal-close" onclick="closeModal()">√ó</button></div><div class="modal-body"><div class="form-group"><label>Name</label><input type="text" class="form-control" id="seqName"></div></div><div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal()">Abbrechen</button><button class="btn btn-gradient" onclick="saveSequence()">Erstellen</button></div></div>`
    };
    overlay.innerHTML = modals[type] || '<div class="modal active"><div class="modal-header"><h2>Modal</h2><button class="modal-close" onclick="closeModal()">√ó</button></div><div class="modal-body">Coming soon</div></div>';
    overlay.classList.add('active');
}

function closeModal() { document.getElementById('modalOverlay').classList.remove('active'); document.getElementById('commandPalette').classList.remove('active'); }

function saveContact() {
    const first = document.getElementById('cFirst').value.trim(), last = document.getElementById('cLast').value.trim(), email = document.getElementById('cEmail').value.trim();
    if (!first || !last || !email) return showToast('error', 'Fehler', 'Pflichtfelder ausf√ºllen');
    data.contacts.unshift({id: Date.now(), firstName: first, lastName: last, email, phone: document.getElementById('cPhone').value, company: document.getElementById('cCompany').value, status: 'active'});
    saveData(); closeModal(); showPage(currentPage); updateAllCounts(); showToast('success', 'Erstellt', `${first} ${last}`);
}

function saveLead() {
    const name = document.getElementById('lName').value.trim();
    if (!name) return showToast('error', 'Fehler', 'Name erforderlich');
    data.leads.unshift({id: Date.now(), name, company: document.getElementById('lCompany').value, value: parseInt(document.getElementById('lValue').value)||25000, status: 'new', source: document.getElementById('lSource').value, probability: 40, assignee: currentUser.name});
    saveData(); closeModal(); showPage(currentPage); updateAllCounts(); showToast('success', 'Erstellt', name);
}

function saveTask() {
    const title = document.getElementById('tTitle').value.trim();
    if (!title) return showToast('error', 'Fehler', 'Titel erforderlich');
    data.tasks.unshift({id: Date.now(), title, status: 'pending', priority: document.getElementById('tPriority').value, dueDate: document.getElementById('tDue').value, assignee: currentUser.name});
    saveData(); closeModal(); showPage(currentPage); updateAllCounts(); showToast('success', 'Erstellt', title);
}

function saveInvoice() {
    const customer = document.getElementById('iCustomer').value.trim(), amount = parseInt(document.getElementById('iAmount').value);
    if (!customer || !amount) return showToast('error', 'Fehler', 'Pflichtfelder');
    const id = `RE-2025-${String(data.invoices.length+1).padStart(3,'0')}`;
    data.invoices.unshift({id, customer, amount, status: 'pending', date: new Date().toISOString().split('T')[0], dueDate: new Date(Date.now()+14*24*60*60*1000).toISOString().split('T')[0]});
    saveData(); closeModal(); showPage(currentPage); showToast('success', 'Erstellt', `${id} - ${formatCurrency(amount)}`);
}

function sendNewMessage() {
    const to = document.getElementById('msgTo').value.trim(), text = document.getElementById('msgText').value.trim();
    if (!to || !text) return showToast('error', 'Fehler', 'Felder ausf√ºllen');
    data.conversations.unshift({id: Date.now(), contact: to, type: document.getElementById('msgChannel').value, unread: false, messages: [{id:1, text, time: new Date().toLocaleTimeString('de-DE',{hour:'2-digit',minute:'2-digit'}), outgoing:true}]});
    saveData(); closeModal(); showToast('success', 'Gesendet', to);
}

function startCampaign() {
    const name = document.getElementById('campName').value.trim();
    if (!name) return showToast('error', 'Fehler', 'Name erforderlich');
    data.campaigns.unshift({id: Date.now(), name, type: 'email', status: 'active', sent: 0, total: data.leads.length, opened: 0, clicked: 0, replied: 0});
    saveData(); closeModal(); showToast('success', 'Gestartet', name);
}

function saveSequence() {
    const name = document.getElementById('seqName').value.trim();
    if (!name) return showToast('error', 'Fehler', 'Name erforderlich');
    data.sequences.unshift({id: Date.now(), name, steps: 3, enrolled: 0, completed: 0, active: true});
    saveData(); closeModal(); showPage('automations'); showToast('success', 'Erstellt', name);
}

function deleteContact(id) { if (!confirm('L√∂schen?')) return; data.contacts = data.contacts.filter(c=>c.id!==id); saveData(); showPage(currentPage); updateAllCounts(); }
function deleteLead(id) { if (!confirm('L√∂schen?')) return; data.leads = data.leads.filter(l=>l.id!=id); saveData(); showPage(currentPage); updateAllCounts(); }

// ==================== KEYBOARD SHORTCUTS ====================
document.addEventListener('keydown', function(e) {
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') { e.preventDefault(); document.getElementById('commandPalette').classList.toggle('active'); }
    if (e.key === 'Escape') closeModal();
});

// ==================== INIT ====================
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('loginForm').addEventListener('submit', handleLogin);
    document.getElementById('modalOverlay').addEventListener('click', function(e) { if (e.target === this) closeModal(); });
    document.getElementById('commandPalette').addEventListener('click', function(e) { if (e.target === this) closeModal(); });
    if (currentUser) showApp();
});

console.log('‚ö° West Money OS v4.0 Ultimate Edition');
</script>
</body>
</html>
